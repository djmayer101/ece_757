<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>gem5: dev/x86/i8042.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>dev/x86/i8042.cc</h1>  </div>
</div>
<div class="contents">
<a href="i8042_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2008 The Regents of The University of Michigan</span>
<a name="l00003"></a>00003 <span class="comment"> * All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00006"></a>00006 <span class="comment"> * modification, are permitted provided that the following conditions are</span>
<a name="l00007"></a>00007 <span class="comment"> * met: redistributions of source code must retain the above copyright</span>
<a name="l00008"></a>00008 <span class="comment"> * notice, this list of conditions and the following disclaimer;</span>
<a name="l00009"></a>00009 <span class="comment"> * redistributions in binary form must reproduce the above copyright</span>
<a name="l00010"></a>00010 <span class="comment"> * notice, this list of conditions and the following disclaimer in the</span>
<a name="l00011"></a>00011 <span class="comment"> * documentation and/or other materials provided with the distribution;</span>
<a name="l00012"></a>00012 <span class="comment"> * neither the name of the copyright holders nor the names of its</span>
<a name="l00013"></a>00013 <span class="comment"> * contributors may be used to endorse or promote products derived from</span>
<a name="l00014"></a>00014 <span class="comment"> * this software without specific prior written permission.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00017"></a>00017 <span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00018"></a>00018 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00019"></a>00019 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00020"></a>00020 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00021"></a>00021 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00022"></a>00022 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00023"></a>00023 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00024"></a>00024 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00025"></a>00025 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00026"></a>00026 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00027"></a>00027 <span class="comment"> *</span>
<a name="l00028"></a>00028 <span class="comment"> * Authors: Gabe Black</span>
<a name="l00029"></a>00029 <span class="comment"> */</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="bitunion_8hh.html">base/bitunion.hh</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;debug/I8042.hh&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="i8042_8hh.html">dev/x86/i8042.hh</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="packet_8hh.html" title="Declaration of the Packet class.">mem/packet.hh</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="packet__access_8hh.html">mem/packet_access.hh</a>&quot;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="comment">// The 8042 has a whopping 32 bytes of internal RAM.</span>
<a name="l00038"></a><a class="code" href="i8042_8cc.html#a527fb948ab9d231a8845ce970e7a7df9">00038</a> <span class="keyword">const</span> uint8_t <a class="code" href="i8042_8cc.html#a527fb948ab9d231a8845ce970e7a7df9">RamSize</a> = 32;
<a name="l00039"></a><a class="code" href="i8042_8cc.html#a90f09d11846a6089f12415643b5bc38a">00039</a> <span class="keyword">const</span> uint8_t <a class="code" href="i8042_8cc.html#a90f09d11846a6089f12415643b5bc38a">NumOutputBits</a> = 14;
<a name="l00040"></a>00040 <span class="keyword">const</span> uint8_t <a class="code" href="classX86ISA_1_1PS2Keyboard.html#a44394dd7632ba79c6b21b9bcac9fb5b1">X86ISA::PS2Keyboard::ID</a>[] = {0xab, 0x83};
<a name="l00041"></a>00041 <span class="keyword">const</span> uint8_t <a class="code" href="classX86ISA_1_1PS2Mouse.html#a981ef5a7a8d6dcbd7f2bbd87124f06d8">X86ISA::PS2Mouse::ID</a>[] = {0x00};
<a name="l00042"></a><a class="code" href="i8042_8cc.html#aed7c438a346286aa02a3f743a234ee0c">00042</a> <span class="keyword">const</span> uint8_t <a class="code" href="i8042_8cc.html#aed7c438a346286aa02a3f743a234ee0c">CommandAck</a> = 0xfa;
<a name="l00043"></a><a class="code" href="i8042_8cc.html#abfe00500bb49ec70e3ab3199ccf65f5f">00043</a> <span class="keyword">const</span> uint8_t <a class="code" href="i8042_8cc.html#abfe00500bb49ec70e3ab3199ccf65f5f">CommandNack</a> = 0xfe;
<a name="l00044"></a><a class="code" href="i8042_8cc.html#a6bed7ac9ea70559e265f0c1997015de8">00044</a> <span class="keyword">const</span> uint8_t <a class="code" href="i8042_8cc.html#a6bed7ac9ea70559e265f0c1997015de8">BatSuccessful</a> = 0xaa;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <a class="code" href="classstd_1_1list.html">AddrRangeList</a>
<a name="l00047"></a><a class="code" href="classX86ISA_1_1I8042.html#a065d4287cbac046009975eab8bc8b6c8">00047</a> <a class="code" href="classX86ISA_1_1I8042.html#a065d4287cbac046009975eab8bc8b6c8" title="Determine the address ranges that this device responds to.">X86ISA::I8042::getAddrRanges</a>()<span class="keyword"> const</span>
<a name="l00048"></a>00048 <span class="keyword"></span>{
<a name="l00049"></a>00049     <a class="code" href="classstd_1_1list.html">AddrRangeList</a> ranges;
<a name="l00050"></a>00050     <span class="comment">// TODO: Are these really supposed to be a single byte and not 4?</span>
<a name="l00051"></a>00051     ranges.push_back(<a class="code" href="addr__range_8hh.html#a59cd089c5b2fbc6eecd8507757432740">RangeSize</a>(<a class="code" href="classX86ISA_1_1I8042.html#ad96bf6f127a4a399607330188ee48969">dataPort</a>, 1));
<a name="l00052"></a>00052     ranges.push_back(<a class="code" href="addr__range_8hh.html#a59cd089c5b2fbc6eecd8507757432740">RangeSize</a>(<a class="code" href="classX86ISA_1_1I8042.html#a6326633eaeab4bfb2d78005451b66a9a">commandPort</a>, 1));
<a name="l00053"></a>00053     <span class="keywordflow">return</span> ranges;
<a name="l00054"></a>00054 }
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="keywordtype">void</span>
<a name="l00057"></a><a class="code" href="classX86ISA_1_1I8042.html#ade1174c89c729648e4665bc4781e2f48">00057</a> <a class="code" href="classX86ISA_1_1I8042.html#ade1174c89c729648e4665bc4781e2f48">X86ISA::I8042::writeData</a>(uint8_t newData, <span class="keywordtype">bool</span> mouse)
<a name="l00058"></a>00058 {
<a name="l00059"></a>00059     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Set data %#02x.\n&quot;</span>, newData);
<a name="l00060"></a>00060     <a class="code" href="classX86ISA_1_1I8042.html#a0b39a57c75470f0c0798ed65e81eae1d">dataReg</a> = newData;
<a name="l00061"></a>00061     <a class="code" href="classX86ISA_1_1I8042.html#ae61419ebf85015b1b8b0de8d5b900d8b">statusReg</a>.outputFull = 1;
<a name="l00062"></a>00062     <a class="code" href="classX86ISA_1_1I8042.html#ae61419ebf85015b1b8b0de8d5b900d8b">statusReg</a>.mouseOutputFull = (mouse ? 1 : 0);
<a name="l00063"></a>00063     <span class="keywordflow">if</span> (!mouse &amp;&amp; <a class="code" href="classX86ISA_1_1I8042.html#a0774382b3fdb1f5bdfdb60d71af67495">commandByte</a>.keyboardFullInt) {
<a name="l00064"></a>00064         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Sending keyboard interrupt.\n&quot;</span>);
<a name="l00065"></a>00065         <a class="code" href="classX86ISA_1_1I8042.html#a3f3cae8ed32673f443d217acd79f56a1">keyboardIntPin</a>-&gt;<a class="code" href="classX86ISA_1_1IntSourcePin.html#a1c4e97a38b1f7206bbc6f06bebbc814d">raise</a>();
<a name="l00066"></a>00066         <span class="comment">//This is a hack</span>
<a name="l00067"></a>00067         <a class="code" href="classX86ISA_1_1I8042.html#a3f3cae8ed32673f443d217acd79f56a1">keyboardIntPin</a>-&gt;<a class="code" href="classX86ISA_1_1IntSourcePin.html#ac2fe66004c85481a8dd5c23670652531">lower</a>();
<a name="l00068"></a>00068     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mouse &amp;&amp; <a class="code" href="classX86ISA_1_1I8042.html#a0774382b3fdb1f5bdfdb60d71af67495">commandByte</a>.mouseFullInt) {
<a name="l00069"></a>00069         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Sending mouse interrupt.\n&quot;</span>);
<a name="l00070"></a>00070         <a class="code" href="classX86ISA_1_1I8042.html#a02f15e90148b0d1f94222196d7f4d02a">mouseIntPin</a>-&gt;<a class="code" href="classX86ISA_1_1IntSourcePin.html#a1c4e97a38b1f7206bbc6f06bebbc814d">raise</a>();
<a name="l00071"></a>00071         <span class="comment">//This is a hack</span>
<a name="l00072"></a>00072         <a class="code" href="classX86ISA_1_1I8042.html#a02f15e90148b0d1f94222196d7f4d02a">mouseIntPin</a>-&gt;<a class="code" href="classX86ISA_1_1IntSourcePin.html#ac2fe66004c85481a8dd5c23670652531">lower</a>();
<a name="l00073"></a>00073     }
<a name="l00074"></a>00074 }
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="keywordtype">void</span>
<a name="l00077"></a><a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">00077</a> <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">X86ISA::PS2Device::ack</a>()
<a name="l00078"></a>00078 {
<a name="l00079"></a>00079     <a class="code" href="classX86ISA_1_1PS2Device.html#a8f0b245c3c2f35423e28e9d040b4a0d4">bufferData</a>(&amp;<a class="code" href="i8042_8cc.html#aed7c438a346286aa02a3f743a234ee0c">CommandAck</a>, <span class="keyword">sizeof</span>(<a class="code" href="i8042_8cc.html#aed7c438a346286aa02a3f743a234ee0c">CommandAck</a>));
<a name="l00080"></a>00080 }
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <span class="keywordtype">void</span>
<a name="l00083"></a><a class="code" href="classX86ISA_1_1PS2Device.html#a9a763c8181cb96ef470f6c88065a1ea8">00083</a> <a class="code" href="classX86ISA_1_1PS2Device.html#a9a763c8181cb96ef470f6c88065a1ea8">X86ISA::PS2Device::nack</a>()
<a name="l00084"></a>00084 {
<a name="l00085"></a>00085     <a class="code" href="classX86ISA_1_1PS2Device.html#a8f0b245c3c2f35423e28e9d040b4a0d4">bufferData</a>(&amp;<a class="code" href="i8042_8cc.html#abfe00500bb49ec70e3ab3199ccf65f5f">CommandNack</a>, <span class="keyword">sizeof</span>(<a class="code" href="i8042_8cc.html#abfe00500bb49ec70e3ab3199ccf65f5f">CommandNack</a>));
<a name="l00086"></a>00086 }
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="keywordtype">void</span>
<a name="l00089"></a><a class="code" href="classX86ISA_1_1PS2Device.html#a8f0b245c3c2f35423e28e9d040b4a0d4">00089</a> <a class="code" href="classX86ISA_1_1PS2Device.html#a8f0b245c3c2f35423e28e9d040b4a0d4">X86ISA::PS2Device::bufferData</a>(<span class="keyword">const</span> uint8_t *data, <span class="keywordtype">int</span> size)
<a name="l00090"></a>00090 {
<a name="l00091"></a>00091     assert(data || size == 0);
<a name="l00092"></a>00092     <span class="keywordflow">while</span> (size) {
<a name="l00093"></a>00093         <a class="code" href="classX86ISA_1_1PS2Device.html#a8b85c2ab84e84fd1046edd16134379c8">outBuffer</a>.push(*(data++));
<a name="l00094"></a>00094         size--;
<a name="l00095"></a>00095     }
<a name="l00096"></a>00096 }
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 uint8_t
<a name="l00099"></a><a class="code" href="classX86ISA_1_1I8042.html#a87fee86e12f022ebfc57d1c46a700770">00099</a> <a class="code" href="classX86ISA_1_1I8042.html#a87fee86e12f022ebfc57d1c46a700770">X86ISA::I8042::readDataOut</a>()
<a name="l00100"></a>00100 {
<a name="l00101"></a>00101     uint8_t data = <a class="code" href="classX86ISA_1_1I8042.html#a0b39a57c75470f0c0798ed65e81eae1d">dataReg</a>;
<a name="l00102"></a>00102     <a class="code" href="classX86ISA_1_1I8042.html#ae61419ebf85015b1b8b0de8d5b900d8b">statusReg</a>.outputFull = 0;
<a name="l00103"></a>00103     <a class="code" href="classX86ISA_1_1I8042.html#ae61419ebf85015b1b8b0de8d5b900d8b">statusReg</a>.mouseOutputFull = 0;
<a name="l00104"></a>00104     <span class="keywordflow">if</span> (<a class="code" href="classX86ISA_1_1I8042.html#a08cbe40002343be8076506f835f40fde">keyboard</a>.<a class="code" href="classX86ISA_1_1PS2Device.html#a0fbd698738b07170a3f5d733f4c0d794">hasData</a>()) {
<a name="l00105"></a>00105         <a class="code" href="classX86ISA_1_1I8042.html#ade1174c89c729648e4665bc4781e2f48">writeData</a>(<a class="code" href="classX86ISA_1_1I8042.html#a08cbe40002343be8076506f835f40fde">keyboard</a>.<a class="code" href="classX86ISA_1_1PS2Device.html#a6b58dd6f1ec41e0c789641724314f4dd">getData</a>(), <span class="keyword">false</span>);
<a name="l00106"></a>00106     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classX86ISA_1_1I8042.html#af8f75241626d58dd48a92808b3ff6353">mouse</a>.<a class="code" href="classX86ISA_1_1PS2Device.html#a0fbd698738b07170a3f5d733f4c0d794">hasData</a>()) {
<a name="l00107"></a>00107         <a class="code" href="classX86ISA_1_1I8042.html#ade1174c89c729648e4665bc4781e2f48">writeData</a>(<a class="code" href="classX86ISA_1_1I8042.html#af8f75241626d58dd48a92808b3ff6353">mouse</a>.<a class="code" href="classX86ISA_1_1PS2Device.html#a6b58dd6f1ec41e0c789641724314f4dd">getData</a>(), <span class="keyword">true</span>);
<a name="l00108"></a>00108     }
<a name="l00109"></a>00109     <span class="keywordflow">return</span> data;
<a name="l00110"></a>00110 }
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 <span class="keywordtype">bool</span>
<a name="l00113"></a><a class="code" href="classX86ISA_1_1PS2Keyboard.html#aff76fe66f17af799ca048cfa90a40b47">00113</a> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#aff76fe66f17af799ca048cfa90a40b47">X86ISA::PS2Keyboard::processData</a>(uint8_t data)
<a name="l00114"></a>00114 {
<a name="l00115"></a>00115     <span class="keywordflow">if</span> (<a class="code" href="classX86ISA_1_1PS2Device.html#ab7036c7a1ccb7433472f49e28ca57b61">lastCommand</a> != <a class="code" href="classX86ISA_1_1PS2Device.html#a1cd96146ff9cced5bb605b65cfda1dbf">NoCommand</a>) {
<a name="l00116"></a>00116         <span class="keywordflow">switch</span> (<a class="code" href="classX86ISA_1_1PS2Device.html#ab7036c7a1ccb7433472f49e28ca57b61">lastCommand</a>) {
<a name="l00117"></a>00117           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0a3627aaecdad3f13a4c80431c13d1ec4c">LEDWrite</a>:
<a name="l00118"></a>00118             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Setting LEDs: &quot;</span>
<a name="l00119"></a>00119                     <span class="stringliteral">&quot;caps lock %s, num lock %s, scroll lock %s\n&quot;</span>,
<a name="l00120"></a>00120                     <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive) from &amp;#39;val&amp;#39; a...">bits</a>(data, 2) ? <span class="stringliteral">&quot;on&quot;</span> : <span class="stringliteral">&quot;off&quot;</span>,
<a name="l00121"></a>00121                     <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive) from &amp;#39;val&amp;#39; a...">bits</a>(data, 1) ? <span class="stringliteral">&quot;on&quot;</span> : <span class="stringliteral">&quot;off&quot;</span>,
<a name="l00122"></a>00122                     <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive) from &amp;#39;val&amp;#39; a...">bits</a>(data, 0) ? <span class="stringliteral">&quot;on&quot;</span> : <span class="stringliteral">&quot;off&quot;</span>);
<a name="l00123"></a>00123             <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00124"></a>00124             <a class="code" href="classX86ISA_1_1PS2Device.html#ab7036c7a1ccb7433472f49e28ca57b61">lastCommand</a> = <a class="code" href="classX86ISA_1_1PS2Device.html#a1cd96146ff9cced5bb605b65cfda1dbf">NoCommand</a>;
<a name="l00125"></a>00125             <span class="keywordflow">break</span>;
<a name="l00126"></a>00126           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0a69f34fc22794c70976d2c59977a50e53">TypematicInfo</a>:
<a name="l00127"></a>00127             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Setting typematic info to %#02x.\n&quot;</span>, data);
<a name="l00128"></a>00128             <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00129"></a>00129             <a class="code" href="classX86ISA_1_1PS2Device.html#ab7036c7a1ccb7433472f49e28ca57b61">lastCommand</a> = <a class="code" href="classX86ISA_1_1PS2Device.html#a1cd96146ff9cced5bb605b65cfda1dbf">NoCommand</a>;
<a name="l00130"></a>00130             <span class="keywordflow">break</span>;
<a name="l00131"></a>00131         }
<a name="l00132"></a>00132         <span class="keywordflow">return</span> <a class="code" href="classX86ISA_1_1PS2Device.html#a0fbd698738b07170a3f5d733f4c0d794">hasData</a>();
<a name="l00133"></a>00133     }
<a name="l00134"></a>00134     <span class="keywordflow">switch</span> (data) {
<a name="l00135"></a>00135       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0a3627aaecdad3f13a4c80431c13d1ec4c">LEDWrite</a>:
<a name="l00136"></a>00136         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Got LED write command.\n&quot;</span>);
<a name="l00137"></a>00137         <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00138"></a>00138         <a class="code" href="classX86ISA_1_1PS2Device.html#ab7036c7a1ccb7433472f49e28ca57b61">lastCommand</a> = LEDWrite;
<a name="l00139"></a>00139         <span class="keywordflow">break</span>;
<a name="l00140"></a>00140       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0a83f4bcc45c12b704cb31c70f0a3f99ca">DiagnosticEcho</a>:
<a name="l00141"></a>00141         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Keyboard diagnostic echo unimplemented.\n&quot;</span>);
<a name="l00142"></a>00142       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0aaad54e2352ac7f8d0da638152ced242f">AlternateScanCodes</a>:
<a name="l00143"></a>00143         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Accessing alternate scan codes unimplemented.\n&quot;</span>);
<a name="l00144"></a>00144       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0a399a4751b205d962986345dfec71bc6a">ReadID</a>:
<a name="l00145"></a>00145         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Got keyboard read ID command.\n&quot;</span>);
<a name="l00146"></a>00146         <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00147"></a>00147         <a class="code" href="classX86ISA_1_1PS2Device.html#a8f0b245c3c2f35423e28e9d040b4a0d4">bufferData</a>((uint8_t *)&amp;<a class="code" href="classX86ISA_1_1PS2Keyboard.html#a44394dd7632ba79c6b21b9bcac9fb5b1">ID</a>, <span class="keyword">sizeof</span>(ID));
<a name="l00148"></a>00148         <span class="keywordflow">break</span>;
<a name="l00149"></a>00149       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0a69f34fc22794c70976d2c59977a50e53">TypematicInfo</a>:
<a name="l00150"></a>00150         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Setting typematic info.\n&quot;</span>);
<a name="l00151"></a>00151         <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00152"></a>00152         <a class="code" href="classX86ISA_1_1PS2Device.html#ab7036c7a1ccb7433472f49e28ca57b61">lastCommand</a> = TypematicInfo;
<a name="l00153"></a>00153         <span class="keywordflow">break</span>;
<a name="l00154"></a>00154       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0a2f93c390423e7793d98554f901456bdb">Enable</a>:
<a name="l00155"></a>00155         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Enabling the keyboard.\n&quot;</span>);
<a name="l00156"></a>00156         <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00157"></a>00157         <span class="keywordflow">break</span>;
<a name="l00158"></a>00158       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0a08f1869a89d658e8b28b3bca1ad330a6">Disable</a>:
<a name="l00159"></a>00159         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Disabling the keyboard.\n&quot;</span>);
<a name="l00160"></a>00160         <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00161"></a>00161         <span class="keywordflow">break</span>;
<a name="l00162"></a>00162       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0a9a78f9379ebffb980934dcaaecf492d2">DefaultsAndDisable</a>:
<a name="l00163"></a>00163         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Disabling and resetting the keyboard.\n&quot;</span>);
<a name="l00164"></a>00164         <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00165"></a>00165         <span class="keywordflow">break</span>;
<a name="l00166"></a>00166       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0a2d055efe69d2ede849da9cd966429bf6">AllKeysToTypematic</a>:
<a name="l00167"></a>00167         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Setting all keys to typemantic unimplemented.\n&quot;</span>);
<a name="l00168"></a>00168       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0aeefa3bb20ddfc1214c42f35ded030d7c">AllKeysToMakeRelease</a>:
<a name="l00169"></a>00169         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Setting all keys to make/release unimplemented.\n&quot;</span>);
<a name="l00170"></a>00170       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0a1ed66d17b4eb5e5195b35f68c4837b80">AllKeysToMake</a>:
<a name="l00171"></a>00171         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Setting all keys to make unimplemented.\n&quot;</span>);
<a name="l00172"></a>00172       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0ab658442bed6cc0ff59990f78e093e227">AllKeysToTypematicMakeRelease</a>:
<a name="l00173"></a>00173         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Setting all keys to &quot;</span>
<a name="l00174"></a>00174                 <span class="stringliteral">&quot;typematic/make/release unimplemented.\n&quot;</span>);
<a name="l00175"></a>00175       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0a9506532499222c1203be45f7ee3d867c">KeyToTypematic</a>:
<a name="l00176"></a>00176         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Setting a key to typematic unimplemented.\n&quot;</span>);
<a name="l00177"></a>00177       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0ae3e4cbbb02241bb831873e0a3a0f2dfa">KeyToMakeRelease</a>:
<a name="l00178"></a>00178         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Setting a key to make/release unimplemented.\n&quot;</span>);
<a name="l00179"></a>00179       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0aa4ec0f5e1b6a12cdd9afa22c8b101e02">KeyToMakeOnly</a>:
<a name="l00180"></a>00180         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Setting key to make only unimplemented.\n&quot;</span>);
<a name="l00181"></a>00181       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0ad6af5eeeeab5dd3c4270426f5537f3ae">Resend</a>:
<a name="l00182"></a>00182         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Keyboard resend unimplemented.\n&quot;</span>);
<a name="l00183"></a>00183       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Keyboard.html#adf0c5f641547cfd38c61d38ae15077a0a49d3215adc0fd2a351b4be458be2450c">Reset</a>:
<a name="l00184"></a>00184         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Keyboard reset unimplemented.\n&quot;</span>);
<a name="l00185"></a>00185       <span class="keywordflow">default</span>:
<a name="l00186"></a>00186         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unknown keyboard command %#02x.\n&quot;</span>, data);
<a name="l00187"></a>00187     }
<a name="l00188"></a>00188     <span class="keywordflow">return</span> <a class="code" href="classX86ISA_1_1PS2Device.html#a0fbd698738b07170a3f5d733f4c0d794">hasData</a>();
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 <span class="keywordtype">bool</span>
<a name="l00192"></a><a class="code" href="classX86ISA_1_1PS2Mouse.html#af52350e9bc67de28e5834950e2f75799">00192</a> <a class="code" href="classX86ISA_1_1PS2Mouse.html#af52350e9bc67de28e5834950e2f75799">X86ISA::PS2Mouse::processData</a>(uint8_t data)
<a name="l00193"></a>00193 {
<a name="l00194"></a>00194     <span class="keywordflow">if</span> (<a class="code" href="classX86ISA_1_1PS2Device.html#ab7036c7a1ccb7433472f49e28ca57b61">lastCommand</a> != <a class="code" href="classX86ISA_1_1PS2Device.html#a1cd96146ff9cced5bb605b65cfda1dbf">NoCommand</a>) {
<a name="l00195"></a>00195         <span class="keywordflow">switch</span>(<a class="code" href="classX86ISA_1_1PS2Device.html#ab7036c7a1ccb7433472f49e28ca57b61">lastCommand</a>) {
<a name="l00196"></a>00196           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Mouse.html#a956c781041e9df05fe78ec6d8bc3d28aa7ba770382b3d845af94318403cc93ab9">SetResolution</a>:
<a name="l00197"></a>00197             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Mouse resolution set to %d.\n&quot;</span>, data);
<a name="l00198"></a>00198             <a class="code" href="classX86ISA_1_1PS2Mouse.html#aeae6a53ce9045109789f17d00a88f355">resolution</a> = data;
<a name="l00199"></a>00199             <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00200"></a>00200             <a class="code" href="classX86ISA_1_1PS2Device.html#ab7036c7a1ccb7433472f49e28ca57b61">lastCommand</a> = <a class="code" href="classX86ISA_1_1PS2Device.html#a1cd96146ff9cced5bb605b65cfda1dbf">NoCommand</a>;
<a name="l00201"></a>00201             <span class="keywordflow">break</span>;
<a name="l00202"></a>00202           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Mouse.html#a956c781041e9df05fe78ec6d8bc3d28aa938f93609c77848409e1724e339a8abd">SampleRate</a>:
<a name="l00203"></a>00203             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Mouse sample rate %d samples &quot;</span>
<a name="l00204"></a>00204                     <span class="stringliteral">&quot;per second.\n&quot;</span>, data);
<a name="l00205"></a>00205             <a class="code" href="classX86ISA_1_1PS2Mouse.html#aece85d2e5e5bbed37e78561aa5c8f705">sampleRate</a> = data;
<a name="l00206"></a>00206             <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00207"></a>00207             <a class="code" href="classX86ISA_1_1PS2Device.html#ab7036c7a1ccb7433472f49e28ca57b61">lastCommand</a> = <a class="code" href="classX86ISA_1_1PS2Device.html#a1cd96146ff9cced5bb605b65cfda1dbf">NoCommand</a>;
<a name="l00208"></a>00208             <span class="keywordflow">break</span>;
<a name="l00209"></a>00209           <span class="keywordflow">default</span>:
<a name="l00210"></a>00210             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Not expecting data for a mouse command.\n&quot;</span>);
<a name="l00211"></a>00211         }
<a name="l00212"></a>00212         <span class="keywordflow">return</span> <a class="code" href="classX86ISA_1_1PS2Device.html#a0fbd698738b07170a3f5d733f4c0d794">hasData</a>();
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214     <span class="keywordflow">switch</span> (data) {
<a name="l00215"></a>00215       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Mouse.html#a956c781041e9df05fe78ec6d8bc3d28aa7474c37f407ca187ba8bc5d33b28441b">Scale1to1</a>:
<a name="l00216"></a>00216         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Setting mouse scale to 1:1.\n&quot;</span>);
<a name="l00217"></a>00217         status.twoToOne = 0;
<a name="l00218"></a>00218         <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00219"></a>00219         <span class="keywordflow">break</span>;
<a name="l00220"></a>00220       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Mouse.html#a956c781041e9df05fe78ec6d8bc3d28aadbaef289ef571da0ccc13c61cefa1a35">Scale2to1</a>:
<a name="l00221"></a>00221         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Setting mouse scale to 2:1.\n&quot;</span>);
<a name="l00222"></a>00222         status.twoToOne = 1;
<a name="l00223"></a>00223         <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00224"></a>00224         <span class="keywordflow">break</span>;
<a name="l00225"></a>00225       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Mouse.html#a956c781041e9df05fe78ec6d8bc3d28aa7ba770382b3d845af94318403cc93ab9">SetResolution</a>:
<a name="l00226"></a>00226         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Setting mouse resolution.\n&quot;</span>);
<a name="l00227"></a>00227         <a class="code" href="classX86ISA_1_1PS2Device.html#ab7036c7a1ccb7433472f49e28ca57b61">lastCommand</a> = SetResolution;
<a name="l00228"></a>00228         <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00229"></a>00229         <span class="keywordflow">break</span>;
<a name="l00230"></a>00230       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Mouse.html#a956c781041e9df05fe78ec6d8bc3d28aad01326d9d322b8f41ca088b6d63505cc">GetStatus</a>:
<a name="l00231"></a>00231         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Getting mouse status.\n&quot;</span>);
<a name="l00232"></a>00232         <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00233"></a>00233         <a class="code" href="classX86ISA_1_1PS2Device.html#a8f0b245c3c2f35423e28e9d040b4a0d4">bufferData</a>((uint8_t *)&amp;(status), 1);
<a name="l00234"></a>00234         <a class="code" href="classX86ISA_1_1PS2Device.html#a8f0b245c3c2f35423e28e9d040b4a0d4">bufferData</a>(&amp;<a class="code" href="classX86ISA_1_1PS2Mouse.html#aeae6a53ce9045109789f17d00a88f355">resolution</a>, <span class="keyword">sizeof</span>(<a class="code" href="classX86ISA_1_1PS2Mouse.html#aeae6a53ce9045109789f17d00a88f355">resolution</a>));
<a name="l00235"></a>00235         <a class="code" href="classX86ISA_1_1PS2Device.html#a8f0b245c3c2f35423e28e9d040b4a0d4">bufferData</a>(&amp;<a class="code" href="classX86ISA_1_1PS2Mouse.html#aece85d2e5e5bbed37e78561aa5c8f705">sampleRate</a>, <span class="keyword">sizeof</span>(<a class="code" href="classX86ISA_1_1PS2Mouse.html#aece85d2e5e5bbed37e78561aa5c8f705">sampleRate</a>));
<a name="l00236"></a>00236         <span class="keywordflow">break</span>;
<a name="l00237"></a>00237       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Mouse.html#a956c781041e9df05fe78ec6d8bc3d28aa10c1945158670dfb777b58c0bfda1903">ReadData</a>:
<a name="l00238"></a>00238         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Reading mouse data unimplemented.\n&quot;</span>);
<a name="l00239"></a>00239       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Mouse.html#a956c781041e9df05fe78ec6d8bc3d28aa5c6d31ec500e042adf06c660eb731577">ResetWrapMode</a>:
<a name="l00240"></a>00240         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Resetting mouse wrap mode unimplemented.\n&quot;</span>);
<a name="l00241"></a>00241       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Mouse.html#a956c781041e9df05fe78ec6d8bc3d28aaff1e8c31ad3ccd534929e603e4ef227b">WrapMode</a>:
<a name="l00242"></a>00242         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Setting mouse wrap mode unimplemented.\n&quot;</span>);
<a name="l00243"></a>00243       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Mouse.html#a956c781041e9df05fe78ec6d8bc3d28aab806efe108f9185a14e547b4625a4eb6">RemoteMode</a>:
<a name="l00244"></a>00244         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Setting mouse remote mode unimplemented.\n&quot;</span>);
<a name="l00245"></a>00245       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Mouse.html#a956c781041e9df05fe78ec6d8bc3d28aad533d74b047a66eda0e7bf9119e08276">ReadID</a>:
<a name="l00246"></a>00246         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Mouse ID requested.\n&quot;</span>);
<a name="l00247"></a>00247         <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00248"></a>00248         <a class="code" href="classX86ISA_1_1PS2Device.html#a8f0b245c3c2f35423e28e9d040b4a0d4">bufferData</a>(<a class="code" href="classX86ISA_1_1PS2Mouse.html#a981ef5a7a8d6dcbd7f2bbd87124f06d8">ID</a>, <span class="keyword">sizeof</span>(<a class="code" href="classX86ISA_1_1PS2Mouse.html#a981ef5a7a8d6dcbd7f2bbd87124f06d8">ID</a>));
<a name="l00249"></a>00249         <span class="keywordflow">break</span>;
<a name="l00250"></a>00250       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Mouse.html#a956c781041e9df05fe78ec6d8bc3d28aa938f93609c77848409e1724e339a8abd">SampleRate</a>:
<a name="l00251"></a>00251         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Setting mouse sample rate.\n&quot;</span>);
<a name="l00252"></a>00252         <a class="code" href="classX86ISA_1_1PS2Device.html#ab7036c7a1ccb7433472f49e28ca57b61">lastCommand</a> = SampleRate;
<a name="l00253"></a>00253         <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00254"></a>00254         <span class="keywordflow">break</span>;
<a name="l00255"></a>00255       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Mouse.html#a956c781041e9df05fe78ec6d8bc3d28aa235f493ba8c4a5afbc1d3789516d732a">DisableReporting</a>:
<a name="l00256"></a>00256         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Disabling data reporting.\n&quot;</span>);
<a name="l00257"></a>00257         status.enabled = 0;
<a name="l00258"></a>00258         <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00259"></a>00259         <span class="keywordflow">break</span>;
<a name="l00260"></a>00260       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Mouse.html#a956c781041e9df05fe78ec6d8bc3d28aae8b4ea4fb7a13eb4cc943f6866111552">EnableReporting</a>:
<a name="l00261"></a>00261         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Enabling data reporting.\n&quot;</span>);
<a name="l00262"></a>00262         status.enabled = 1;
<a name="l00263"></a>00263         <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00264"></a>00264         <span class="keywordflow">break</span>;
<a name="l00265"></a>00265       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Mouse.html#a956c781041e9df05fe78ec6d8bc3d28aafc5e4d5c0d6f24c78bf4ad2c376ecc56">DefaultsAndDisable</a>:
<a name="l00266"></a>00266         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Disabling and resetting mouse.\n&quot;</span>);
<a name="l00267"></a>00267         <a class="code" href="classX86ISA_1_1PS2Mouse.html#aece85d2e5e5bbed37e78561aa5c8f705">sampleRate</a> = 100;
<a name="l00268"></a>00268         <a class="code" href="classX86ISA_1_1PS2Mouse.html#aeae6a53ce9045109789f17d00a88f355">resolution</a> = 4;
<a name="l00269"></a>00269         status.twoToOne = 0;
<a name="l00270"></a>00270         status.enabled = 0;
<a name="l00271"></a>00271         <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00272"></a>00272         <span class="keywordflow">break</span>;
<a name="l00273"></a>00273       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Mouse.html#a956c781041e9df05fe78ec6d8bc3d28aaba3b0efcbca713a7ccb016a135ea78c5">Resend</a>:
<a name="l00274"></a>00274         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Mouse resend unimplemented.\n&quot;</span>);
<a name="l00275"></a>00275       <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1PS2Mouse.html#a956c781041e9df05fe78ec6d8bc3d28aaceb53784dd6dfa2bb7054f7f04942994">Reset</a>:
<a name="l00276"></a>00276         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Resetting the mouse.\n&quot;</span>);
<a name="l00277"></a>00277         <a class="code" href="classX86ISA_1_1PS2Mouse.html#aece85d2e5e5bbed37e78561aa5c8f705">sampleRate</a> = 100;
<a name="l00278"></a>00278         <a class="code" href="classX86ISA_1_1PS2Mouse.html#aeae6a53ce9045109789f17d00a88f355">resolution</a> = 4;
<a name="l00279"></a>00279         status.twoToOne = 0;
<a name="l00280"></a>00280         status.enabled = 0;
<a name="l00281"></a>00281         <a class="code" href="classX86ISA_1_1PS2Device.html#a02153e795485ff014e2eabec12120f2f">ack</a>();
<a name="l00282"></a>00282         <a class="code" href="classX86ISA_1_1PS2Device.html#a8f0b245c3c2f35423e28e9d040b4a0d4">bufferData</a>(&amp;<a class="code" href="i8042_8cc.html#a6bed7ac9ea70559e265f0c1997015de8">BatSuccessful</a>, <span class="keyword">sizeof</span>(<a class="code" href="i8042_8cc.html#a6bed7ac9ea70559e265f0c1997015de8">BatSuccessful</a>));
<a name="l00283"></a>00283         <a class="code" href="classX86ISA_1_1PS2Device.html#a8f0b245c3c2f35423e28e9d040b4a0d4">bufferData</a>(<a class="code" href="classX86ISA_1_1PS2Mouse.html#a981ef5a7a8d6dcbd7f2bbd87124f06d8">ID</a>, <span class="keyword">sizeof</span>(<a class="code" href="classX86ISA_1_1PS2Mouse.html#a981ef5a7a8d6dcbd7f2bbd87124f06d8">ID</a>));
<a name="l00284"></a>00284         <span class="keywordflow">break</span>;
<a name="l00285"></a>00285       <span class="keywordflow">default</span>:
<a name="l00286"></a>00286         <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;Unknown mouse command %#02x.\n&quot;</span>, data);
<a name="l00287"></a>00287         <a class="code" href="classX86ISA_1_1PS2Device.html#a9a763c8181cb96ef470f6c88065a1ea8">nack</a>();
<a name="l00288"></a>00288         <span class="keywordflow">break</span>;
<a name="l00289"></a>00289     }
<a name="l00290"></a>00290     <span class="keywordflow">return</span> <a class="code" href="classX86ISA_1_1PS2Device.html#a0fbd698738b07170a3f5d733f4c0d794">hasData</a>();
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 
<a name="l00294"></a>00294 <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a>
<a name="l00295"></a><a class="code" href="classX86ISA_1_1I8042.html#a109776e8059692f3ae9b7dd1e340275a">00295</a> <a class="code" href="classX86ISA_1_1I8042.html#a109776e8059692f3ae9b7dd1e340275a" title="Pure virtual function that the device must implement.">X86ISA::I8042::read</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt)
<a name="l00296"></a>00296 {
<a name="l00297"></a>00297     assert(pkt-&gt;<a class="code" href="classPacket.html#ad7c96bd8cd06acddebb3a373b37e6e59">getSize</a>() == 1);
<a name="l00298"></a>00298     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> <a class="code" href="namespaceX86ISA.html#a79b5c08c190167d17c9b9b3fd40112f6">addr</a> = pkt-&gt;<a class="code" href="classPacket.html#a1c04785186ba5aa70a40cac9b2bfc86e">getAddr</a>();
<a name="l00299"></a>00299     <span class="keywordflow">if</span> (addr == <a class="code" href="classX86ISA_1_1I8042.html#ad96bf6f127a4a399607330188ee48969">dataPort</a>) {
<a name="l00300"></a>00300         uint8_t data = <a class="code" href="classX86ISA_1_1I8042.html#a87fee86e12f022ebfc57d1c46a700770">readDataOut</a>();
<a name="l00301"></a>00301         <span class="comment">//DPRINTF(I8042, &quot;Read from data port got %#02x.\n&quot;, data);</span>
<a name="l00302"></a>00302         pkt-&gt;<a class="code" href="classPacket.html#ac63debc6335e01dcb4941e4c760a6962" title="set the value in the data pointer to v.">set</a>&lt;uint8_t&gt;(data);
<a name="l00303"></a>00303     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (addr == <a class="code" href="classX86ISA_1_1I8042.html#a6326633eaeab4bfb2d78005451b66a9a">commandPort</a>) {
<a name="l00304"></a>00304         <span class="comment">//DPRINTF(I8042, &quot;Read status as %#02x.\n&quot;, (uint8_t)statusReg);</span>
<a name="l00305"></a>00305         pkt-&gt;<a class="code" href="classPacket.html#ac63debc6335e01dcb4941e4c760a6962" title="set the value in the data pointer to v.">set</a>&lt;uint8_t&gt;((uint8_t)<a class="code" href="classX86ISA_1_1I8042.html#ae61419ebf85015b1b8b0de8d5b900d8b">statusReg</a>);
<a name="l00306"></a>00306     } <span class="keywordflow">else</span> {
<a name="l00307"></a>00307         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Read from unrecognized port %#x.\n&quot;</span>, addr);
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309     pkt-&gt;<a class="code" href="classPacket.html#a79f71e6885712d4951e70eaba2e364cb">makeAtomicResponse</a>();
<a name="l00310"></a>00310     <span class="keywordflow">return</span> latency;
<a name="l00311"></a>00311 }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a>
<a name="l00314"></a><a class="code" href="classX86ISA_1_1I8042.html#a59306ef6bfa53bd1582b8175f4bcb391">00314</a> <a class="code" href="classX86ISA_1_1I8042.html#a59306ef6bfa53bd1582b8175f4bcb391" title="Pure virtual function that the device must implement.">X86ISA::I8042::write</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt)
<a name="l00315"></a>00315 {
<a name="l00316"></a>00316     assert(pkt-&gt;<a class="code" href="classPacket.html#ad7c96bd8cd06acddebb3a373b37e6e59">getSize</a>() == 1);
<a name="l00317"></a>00317     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> <a class="code" href="namespaceX86ISA.html#a79b5c08c190167d17c9b9b3fd40112f6">addr</a> = pkt-&gt;<a class="code" href="classPacket.html#a1c04785186ba5aa70a40cac9b2bfc86e">getAddr</a>();
<a name="l00318"></a>00318     uint8_t data = pkt-&gt;<a class="code" href="classPacket.html#a4fa1463610c7bda8c0b160b1457f1a52" title="return the value of what is pointed to in the packet.">get</a>&lt;uint8_t&gt;();
<a name="l00319"></a>00319     <span class="keywordflow">if</span> (addr == <a class="code" href="classX86ISA_1_1I8042.html#ad96bf6f127a4a399607330188ee48969">dataPort</a>) {
<a name="l00320"></a>00320         <a class="code" href="classX86ISA_1_1I8042.html#ae61419ebf85015b1b8b0de8d5b900d8b">statusReg</a>.commandLast = 0;
<a name="l00321"></a>00321         <span class="keywordflow">switch</span> (<a class="code" href="classX86ISA_1_1I8042.html#a915a5ca662ebaf2fa1e871de6b3c68e2">lastCommand</a>) {
<a name="l00322"></a>00322           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a09c1ed7bea8cf47b59988a430a181551">NoCommand</a>:
<a name="l00323"></a>00323             <span class="keywordflow">if</span> (<a class="code" href="classX86ISA_1_1I8042.html#a08cbe40002343be8076506f835f40fde">keyboard</a>.<a class="code" href="classX86ISA_1_1PS2Keyboard.html#aff76fe66f17af799ca048cfa90a40b47">processData</a>(data)) {
<a name="l00324"></a>00324                 <a class="code" href="classX86ISA_1_1I8042.html#ade1174c89c729648e4665bc4781e2f48">writeData</a>(<a class="code" href="classX86ISA_1_1I8042.html#a08cbe40002343be8076506f835f40fde">keyboard</a>.<a class="code" href="classX86ISA_1_1PS2Device.html#a6b58dd6f1ec41e0c789641724314f4dd">getData</a>(), <span class="keyword">false</span>);
<a name="l00325"></a>00325             }
<a name="l00326"></a>00326             <span class="keywordflow">break</span>;
<a name="l00327"></a>00327           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7cae9adf79ab89295bee40be923013ae7cc">WriteToMouse</a>:
<a name="l00328"></a>00328             <span class="keywordflow">if</span> (<a class="code" href="classX86ISA_1_1I8042.html#af8f75241626d58dd48a92808b3ff6353">mouse</a>.<a class="code" href="classX86ISA_1_1PS2Mouse.html#af52350e9bc67de28e5834950e2f75799">processData</a>(data)) {
<a name="l00329"></a>00329                 <a class="code" href="classX86ISA_1_1I8042.html#ade1174c89c729648e4665bc4781e2f48">writeData</a>(<a class="code" href="classX86ISA_1_1I8042.html#af8f75241626d58dd48a92808b3ff6353">mouse</a>.<a class="code" href="classX86ISA_1_1PS2Device.html#a6b58dd6f1ec41e0c789641724314f4dd">getData</a>(), <span class="keyword">true</span>);
<a name="l00330"></a>00330             }
<a name="l00331"></a>00331             <span class="keywordflow">break</span>;
<a name="l00332"></a>00332           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7cadb280cb54e784ece95d7c3562357c90e">WriteCommandByte</a>:
<a name="l00333"></a>00333             <a class="code" href="classX86ISA_1_1I8042.html#a0774382b3fdb1f5bdfdb60d71af67495">commandByte</a> = data;
<a name="l00334"></a>00334             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Got data %#02x for \&quot;Write &quot;</span>
<a name="l00335"></a>00335                     <span class="stringliteral">&quot;command byte\&quot; command.\n&quot;</span>, data);
<a name="l00336"></a>00336             <a class="code" href="classX86ISA_1_1I8042.html#ae61419ebf85015b1b8b0de8d5b900d8b">statusReg</a>.passedSelfTest = (uint8_t)<a class="code" href="classX86ISA_1_1I8042.html#a0774382b3fdb1f5bdfdb60d71af67495">commandByte</a>.passedSelfTest;
<a name="l00337"></a>00337             <span class="keywordflow">break</span>;
<a name="l00338"></a>00338           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca08d7d4b4515c07c1ee550739c47f255d">WriteMouseOutputBuff</a>:
<a name="l00339"></a>00339             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Got data %#02x for \&quot;Write &quot;</span>
<a name="l00340"></a>00340                     <span class="stringliteral">&quot;mouse output buffer\&quot; command.\n&quot;</span>, data);
<a name="l00341"></a>00341             <a class="code" href="classX86ISA_1_1I8042.html#ade1174c89c729648e4665bc4781e2f48">writeData</a>(data, <span class="keyword">true</span>);
<a name="l00342"></a>00342             <span class="keywordflow">break</span>;
<a name="l00343"></a>00343           <span class="keywordflow">default</span>:
<a name="l00344"></a>00344             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Data written for unrecognized &quot;</span>
<a name="l00345"></a>00345                     <span class="stringliteral">&quot;command %#02x\n&quot;</span>, <a class="code" href="classX86ISA_1_1I8042.html#a915a5ca662ebaf2fa1e871de6b3c68e2">lastCommand</a>);
<a name="l00346"></a>00346         }
<a name="l00347"></a>00347         <a class="code" href="classX86ISA_1_1I8042.html#a915a5ca662ebaf2fa1e871de6b3c68e2">lastCommand</a> = <a class="code" href="classX86ISA_1_1I8042.html#a09c1ed7bea8cf47b59988a430a181551">NoCommand</a>;
<a name="l00348"></a>00348     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (addr == <a class="code" href="classX86ISA_1_1I8042.html#a6326633eaeab4bfb2d78005451b66a9a">commandPort</a>) {
<a name="l00349"></a>00349         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Got command %#02x.\n&quot;</span>, data);
<a name="l00350"></a>00350         <a class="code" href="classX86ISA_1_1I8042.html#ae61419ebf85015b1b8b0de8d5b900d8b">statusReg</a>.commandLast = 1;
<a name="l00351"></a>00351         <span class="comment">// These purposefully leave off the first byte of the controller RAM</span>
<a name="l00352"></a>00352         <span class="comment">// so it can be handled specially.</span>
<a name="l00353"></a>00353         <span class="keywordflow">if</span> (data &gt; <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca0896ea0d10ae0a123d0bec4ad8e4a0d3">ReadControllerRamBase</a> &amp;&amp;
<a name="l00354"></a>00354                 data &lt; <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca0896ea0d10ae0a123d0bec4ad8e4a0d3">ReadControllerRamBase</a> + <a class="code" href="i8042_8cc.html#a527fb948ab9d231a8845ce970e7a7df9">RamSize</a>) {
<a name="l00355"></a>00355             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Attempted to use i8042 read controller RAM command to &quot;</span>
<a name="l00356"></a>00356                     <span class="stringliteral">&quot;get byte %d.\n&quot;</span>, data - <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca0896ea0d10ae0a123d0bec4ad8e4a0d3">ReadControllerRamBase</a>);
<a name="l00357"></a>00357         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data &gt; <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca3f27aa760b598a2b1b53fc873cdbe88b">WriteControllerRamBase</a> &amp;&amp;
<a name="l00358"></a>00358                 data &lt; <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca3f27aa760b598a2b1b53fc873cdbe88b">WriteControllerRamBase</a> + <a class="code" href="i8042_8cc.html#a527fb948ab9d231a8845ce970e7a7df9">RamSize</a>) {
<a name="l00359"></a>00359             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Attempted to use i8042 read controller RAM command to &quot;</span>
<a name="l00360"></a>00360                     <span class="stringliteral">&quot;get byte %d.\n&quot;</span>, data - <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca0896ea0d10ae0a123d0bec4ad8e4a0d3">ReadControllerRamBase</a>);
<a name="l00361"></a>00361         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data &gt;= <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca505b5da2c267669b2ed17e671aecbb10">PulseOutputBitBase</a> &amp;&amp;
<a name="l00362"></a>00362                 data &lt; <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca505b5da2c267669b2ed17e671aecbb10">PulseOutputBitBase</a> + <a class="code" href="i8042_8cc.html#a90f09d11846a6089f12415643b5bc38a">NumOutputBits</a>) {
<a name="l00363"></a>00363             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Attempted to use i8042 pulse output bit command to &quot;</span>
<a name="l00364"></a>00364                     <span class="stringliteral">&quot;to pulse bit %d.\n&quot;</span>, data - <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca505b5da2c267669b2ed17e671aecbb10">PulseOutputBitBase</a>);
<a name="l00365"></a>00365         }
<a name="l00366"></a>00366         <span class="keywordflow">switch</span> (data) {
<a name="l00367"></a>00367           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7cae7c2d75005c5396d84c87b69f87ef014">GetCommandByte</a>:
<a name="l00368"></a>00368             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Getting command byte.\n&quot;</span>);
<a name="l00369"></a>00369             <a class="code" href="classX86ISA_1_1I8042.html#ade1174c89c729648e4665bc4781e2f48">writeData</a>(<a class="code" href="classX86ISA_1_1I8042.html#a0774382b3fdb1f5bdfdb60d71af67495">commandByte</a>);
<a name="l00370"></a>00370             <span class="keywordflow">break</span>;
<a name="l00371"></a>00371           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7cadb280cb54e784ece95d7c3562357c90e">WriteCommandByte</a>:
<a name="l00372"></a>00372             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Setting command byte.\n&quot;</span>);
<a name="l00373"></a>00373             <a class="code" href="classX86ISA_1_1I8042.html#a915a5ca662ebaf2fa1e871de6b3c68e2">lastCommand</a> = WriteCommandByte;
<a name="l00374"></a>00374             <span class="keywordflow">break</span>;
<a name="l00375"></a>00375           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca85e40d2935e469479ca3a8c25cc25717">CheckForPassword</a>:
<a name="l00376"></a>00376             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;i8042 \&quot;Check for password\&quot; command not implemented.\n&quot;</span>);
<a name="l00377"></a>00377           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca7d16c52e2f56e08cd5a0cba45ab4db6a">LoadPassword</a>:
<a name="l00378"></a>00378             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;i8042 \&quot;Load password\&quot; command not implemented.\n&quot;</span>);
<a name="l00379"></a>00379           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca0caa698dfd1b322fdb50724b95d34876">CheckPassword</a>:
<a name="l00380"></a>00380             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;i8042 \&quot;Check password\&quot; command not implemented.\n&quot;</span>);
<a name="l00381"></a>00381           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca7cfbc0d539fedbe6d92020be3e822e7b">DisableMouse</a>:
<a name="l00382"></a>00382             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Disabling mouse at controller.\n&quot;</span>);
<a name="l00383"></a>00383             <a class="code" href="classX86ISA_1_1I8042.html#a0774382b3fdb1f5bdfdb60d71af67495">commandByte</a>.disableMouse = 1;
<a name="l00384"></a>00384             <span class="keywordflow">break</span>;
<a name="l00385"></a>00385           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7cae1a2979cf514b6f17f3522be25031d11">EnableMouse</a>:
<a name="l00386"></a>00386             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Enabling mouse at controller.\n&quot;</span>);
<a name="l00387"></a>00387             <a class="code" href="classX86ISA_1_1I8042.html#a0774382b3fdb1f5bdfdb60d71af67495">commandByte</a>.disableMouse = 0;
<a name="l00388"></a>00388             <span class="keywordflow">break</span>;
<a name="l00389"></a>00389           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca19a4e89970f888d38886a0ca34228b8f">TestMouse</a>:
<a name="l00390"></a>00390             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;i8042 \&quot;Test mouse\&quot; command not implemented.\n&quot;</span>);
<a name="l00391"></a>00391           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca5a5997a313061504d58622fa2db44a67">SelfTest</a>:
<a name="l00392"></a>00392             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;i8042 \&quot;Self test\&quot; command not implemented.\n&quot;</span>);
<a name="l00393"></a>00393           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7cabd1a2a0ef89de2cfae764a08e765eeca">InterfaceTest</a>:
<a name="l00394"></a>00394             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;i8042 \&quot;Interface test\&quot; command not implemented.\n&quot;</span>);
<a name="l00395"></a>00395           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca0f5cc598f55013752b8901fd06a9f7d2">DiagnosticDump</a>:
<a name="l00396"></a>00396             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;i8042 \&quot;Diagnostic dump\&quot; command not implemented.\n&quot;</span>);
<a name="l00397"></a>00397           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7cad79b0d0c7c585f828d8c98d151529a7b">DisableKeyboard</a>:
<a name="l00398"></a>00398             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Disabling keyboard at controller.\n&quot;</span>);
<a name="l00399"></a>00399             <a class="code" href="classX86ISA_1_1I8042.html#a0774382b3fdb1f5bdfdb60d71af67495">commandByte</a>.disableKeyboard = 1;
<a name="l00400"></a>00400             <span class="keywordflow">break</span>;
<a name="l00401"></a>00401           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7cae499955f8ec0c4d85041707192482757">EnableKeyboard</a>:
<a name="l00402"></a>00402             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Enabling keyboard at controller.\n&quot;</span>);
<a name="l00403"></a>00403             <a class="code" href="classX86ISA_1_1I8042.html#a0774382b3fdb1f5bdfdb60d71af67495">commandByte</a>.disableKeyboard = 0;
<a name="l00404"></a>00404             <span class="keywordflow">break</span>;
<a name="l00405"></a>00405           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7caf7987cdeecfb1b04c863db28256b4234">ReadInputPort</a>:
<a name="l00406"></a>00406             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;i8042 \&quot;Read input port\&quot; command not implemented.\n&quot;</span>);
<a name="l00407"></a>00407           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca7ca3ba84f2025a26d5528e8848cd9aa8">ContinuousPollLow</a>:
<a name="l00408"></a>00408             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;i8042 \&quot;Continuous poll low\&quot; command not implemented.\n&quot;</span>);
<a name="l00409"></a>00409           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca07b94804b3279f07eb445aeef758cf49">ContinuousPollHigh</a>:
<a name="l00410"></a>00410             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;i8042 \&quot;Continuous poll high\&quot; command not implemented.\n&quot;</span>);
<a name="l00411"></a>00411           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca0be81469f49ea8f8ae373d349f17d856">ReadOutputPort</a>:
<a name="l00412"></a>00412             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;i8042 \&quot;Read output port\&quot; command not implemented.\n&quot;</span>);
<a name="l00413"></a>00413           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca8e7b4b7c4c7c7446e75daffa4f711c87">WriteOutputPort</a>:
<a name="l00414"></a>00414             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;i8042 \&quot;Write output port\&quot; command not implemented.\n&quot;</span>);
<a name="l00415"></a>00415           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca4b029c54027d6fa77b7edead474ae301">WriteKeyboardOutputBuff</a>:
<a name="l00416"></a>00416             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;i8042 \&quot;Write keyboard output buffer\&quot; &quot;</span>
<a name="l00417"></a>00417                     <span class="stringliteral">&quot;command not implemented.\n&quot;</span>);
<a name="l00418"></a>00418           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca08d7d4b4515c07c1ee550739c47f255d">WriteMouseOutputBuff</a>:
<a name="l00419"></a>00419             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Got command to write to mouse output buffer.\n&quot;</span>);
<a name="l00420"></a>00420             <a class="code" href="classX86ISA_1_1I8042.html#a915a5ca662ebaf2fa1e871de6b3c68e2">lastCommand</a> = WriteMouseOutputBuff;
<a name="l00421"></a>00421             <span class="keywordflow">break</span>;
<a name="l00422"></a>00422           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7cae9adf79ab89295bee40be923013ae7cc">WriteToMouse</a>:
<a name="l00423"></a>00423             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1I8042.html">I8042</a>, <span class="stringliteral">&quot;Expecting mouse command.\n&quot;</span>);
<a name="l00424"></a>00424             <a class="code" href="classX86ISA_1_1I8042.html#a915a5ca662ebaf2fa1e871de6b3c68e2">lastCommand</a> = WriteToMouse;
<a name="l00425"></a>00425             <span class="keywordflow">break</span>;
<a name="l00426"></a>00426           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7caa52f553afd17088b8cdf01accbea07d6">DisableA20</a>:
<a name="l00427"></a>00427             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;i8042 \&quot;Disable A20\&quot; command not implemented.\n&quot;</span>);
<a name="l00428"></a>00428           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca043af6e1629d680da19bd5b34a4026e2">EnableA20</a>:
<a name="l00429"></a>00429             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;i8042 \&quot;Enable A20\&quot; command not implemented.\n&quot;</span>);
<a name="l00430"></a>00430           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7ca270595bde6a6395b155682607d3221cd">ReadTestInputs</a>:
<a name="l00431"></a>00431             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;i8042 \&quot;Read test inputs\&quot; command not implemented.\n&quot;</span>);
<a name="l00432"></a>00432           <span class="keywordflow">case</span> <a class="code" href="classX86ISA_1_1I8042.html#a6d290f34bbfaee3494dd0b160c326a7cad9fb892f45b7d2bc272869e33994b7b1">SystemReset</a>:
<a name="l00433"></a>00433             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;i8042 \&quot;System reset\&quot; command not implemented.\n&quot;</span>);
<a name="l00434"></a>00434           <span class="keywordflow">default</span>:
<a name="l00435"></a>00435             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Write to unknown i8042 &quot;</span>
<a name="l00436"></a>00436                     <span class="stringliteral">&quot;(keyboard controller) command port.\n&quot;</span>);
<a name="l00437"></a>00437         }
<a name="l00438"></a>00438     } <span class="keywordflow">else</span> {
<a name="l00439"></a>00439         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Write to unrecognized port %#x.\n&quot;</span>, addr);
<a name="l00440"></a>00440     }
<a name="l00441"></a>00441     pkt-&gt;<a class="code" href="classPacket.html#a79f71e6885712d4951e70eaba2e364cb">makeAtomicResponse</a>();
<a name="l00442"></a>00442     <span class="keywordflow">return</span> latency;
<a name="l00443"></a>00443 }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445 <span class="keywordtype">void</span>
<a name="l00446"></a><a class="code" href="classX86ISA_1_1I8042.html#a66ff12e407b8edd2a70985d36d5b9352">00446</a> <a class="code" href="thread__context_8cc.html#a40792bd7060f1fdd6c31469ce46d0a95" title="Thread context serialization helpers.">X86ISA::I8042::serialize</a>(std::ostream &amp;<a class="code" href="namespaceX86ISA.html#aea9fbab71662ba06cf536e05edfaaad1">os</a>)
<a name="l00447"></a>00447 {
<a name="l00448"></a>00448     uint8_t statusRegData = <a class="code" href="classX86ISA_1_1I8042.html#ae61419ebf85015b1b8b0de8d5b900d8b">statusReg</a>.__data;
<a name="l00449"></a>00449     uint8_t commandByteData = <a class="code" href="classX86ISA_1_1I8042.html#a0774382b3fdb1f5bdfdb60d71af67495">commandByte</a>.__data;
<a name="l00450"></a>00450     
<a name="l00451"></a>00451     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classX86ISA_1_1I8042.html#ad96bf6f127a4a399607330188ee48969">dataPort</a>);
<a name="l00452"></a>00452     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classX86ISA_1_1I8042.html#a6326633eaeab4bfb2d78005451b66a9a">commandPort</a>);
<a name="l00453"></a>00453     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(statusRegData);
<a name="l00454"></a>00454     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(commandByteData);
<a name="l00455"></a>00455     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classX86ISA_1_1I8042.html#a0b39a57c75470f0c0798ed65e81eae1d">dataReg</a>);
<a name="l00456"></a>00456     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classX86ISA_1_1I8042.html#a915a5ca662ebaf2fa1e871de6b3c68e2">lastCommand</a>);
<a name="l00457"></a>00457     <a class="code" href="classX86ISA_1_1I8042.html#af8f75241626d58dd48a92808b3ff6353">mouse</a>.<a class="code" href="classX86ISA_1_1PS2Mouse.html#aa4f6624cb03d36568f0f17a96070255e">serialize</a>(<span class="stringliteral">&quot;mouse&quot;</span>, os);
<a name="l00458"></a>00458     <a class="code" href="classX86ISA_1_1I8042.html#a08cbe40002343be8076506f835f40fde">keyboard</a>.<a class="code" href="classX86ISA_1_1PS2Keyboard.html#a3624b89345522f6fd4932eae19043958">serialize</a>(<span class="stringliteral">&quot;keyboard&quot;</span>, os);
<a name="l00459"></a>00459 }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 <span class="keywordtype">void</span>
<a name="l00462"></a><a class="code" href="classX86ISA_1_1I8042.html#a960ad956ea6aa3009b8900194190fe47">00462</a> <a class="code" href="thread__context_8cc.html#aab2bbbf3710db70a2886ed6c49038af7">X86ISA::I8042::unserialize</a>(<a class="code" href="classCheckpoint.html">Checkpoint</a> *cp, <span class="keyword">const</span> std::string &amp;section)
<a name="l00463"></a>00463 {
<a name="l00464"></a>00464     uint8_t statusRegData;
<a name="l00465"></a>00465     uint8_t commandByteData;
<a name="l00466"></a>00466 
<a name="l00467"></a>00467     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classX86ISA_1_1I8042.html#ad96bf6f127a4a399607330188ee48969">dataPort</a>);
<a name="l00468"></a>00468     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classX86ISA_1_1I8042.html#a6326633eaeab4bfb2d78005451b66a9a">commandPort</a>);
<a name="l00469"></a>00469     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(statusRegData);
<a name="l00470"></a>00470     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(commandByteData);
<a name="l00471"></a>00471     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classX86ISA_1_1I8042.html#a0b39a57c75470f0c0798ed65e81eae1d">dataReg</a>);
<a name="l00472"></a>00472     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classX86ISA_1_1I8042.html#a915a5ca662ebaf2fa1e871de6b3c68e2">lastCommand</a>);
<a name="l00473"></a>00473     <a class="code" href="classX86ISA_1_1I8042.html#af8f75241626d58dd48a92808b3ff6353">mouse</a>.<a class="code" href="classX86ISA_1_1PS2Mouse.html#ab9d51a50ddcdd3c559ad93f75686220c">unserialize</a>(<span class="stringliteral">&quot;mouse&quot;</span>, cp, section);
<a name="l00474"></a>00474     <a class="code" href="classX86ISA_1_1I8042.html#a08cbe40002343be8076506f835f40fde">keyboard</a>.<a class="code" href="classX86ISA_1_1PS2Keyboard.html#add9eacd24782a08eba9ad9f21e37a554">unserialize</a>(<span class="stringliteral">&quot;keyboard&quot;</span>, cp, section);
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     <a class="code" href="classX86ISA_1_1I8042.html#ae61419ebf85015b1b8b0de8d5b900d8b">statusReg</a>.__data = statusRegData;
<a name="l00477"></a>00477     <a class="code" href="classX86ISA_1_1I8042.html#a0774382b3fdb1f5bdfdb60d71af67495">commandByte</a>.__data = commandByteData;
<a name="l00478"></a>00478 }
<a name="l00479"></a>00479 
<a name="l00480"></a>00480 <span class="keywordtype">void</span>
<a name="l00481"></a><a class="code" href="classX86ISA_1_1PS2Keyboard.html#a3624b89345522f6fd4932eae19043958">00481</a> <a class="code" href="thread__context_8cc.html#a40792bd7060f1fdd6c31469ce46d0a95" title="Thread context serialization helpers.">X86ISA::PS2Keyboard::serialize</a>(<span class="keyword">const</span> std::string &amp;<a class="code" href="namespaceX86ISA.html#aa3826b335948154c40c1b6a32cbd10f5">base</a>, std::ostream &amp;<a class="code" href="namespaceX86ISA.html#aea9fbab71662ba06cf536e05edfaaad1">os</a>)
<a name="l00482"></a>00482 {
<a name="l00483"></a>00483     <a class="code" href="arch_2x86_2types_8cc.html#adc6b6ea750b0d7ff7441ea35588abbdb">paramOut</a>(os, base + <span class="stringliteral">&quot;.lastCommand&quot;</span>, <a class="code" href="classX86ISA_1_1PS2Device.html#ab7036c7a1ccb7433472f49e28ca57b61">lastCommand</a>);
<a name="l00484"></a>00484     <span class="keywordtype">int</span> bufferSize = <a class="code" href="classX86ISA_1_1PS2Device.html#a8b85c2ab84e84fd1046edd16134379c8">outBuffer</a>.size();
<a name="l00485"></a>00485     <a class="code" href="arch_2x86_2types_8cc.html#adc6b6ea750b0d7ff7441ea35588abbdb">paramOut</a>(os, base + <span class="stringliteral">&quot;.outBuffer.size&quot;</span>, bufferSize);
<a name="l00486"></a>00486     uint8_t *buffer = <span class="keyword">new</span> uint8_t[bufferSize];
<a name="l00487"></a>00487     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> = 0; <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> &lt; bufferSize; ++<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>) {
<a name="l00488"></a>00488         buffer[<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>] = <a class="code" href="classX86ISA_1_1PS2Device.html#a8b85c2ab84e84fd1046edd16134379c8">outBuffer</a>.front();
<a name="l00489"></a>00489         <a class="code" href="classX86ISA_1_1PS2Device.html#a8b85c2ab84e84fd1046edd16134379c8">outBuffer</a>.pop();
<a name="l00490"></a>00490     }
<a name="l00491"></a>00491     <a class="code" href="serialize_8cc.html#a1dfe0fd5d936a18e30db1851b378bb41">arrayParamOut</a>(os, base + <span class="stringliteral">&quot;.outBuffer.elts&quot;</span>, buffer,
<a name="l00492"></a>00492             bufferSize*<span class="keyword">sizeof</span>(uint8_t));
<a name="l00493"></a>00493     <span class="keyword">delete</span>[] buffer;
<a name="l00494"></a>00494 }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496 <span class="keywordtype">void</span>
<a name="l00497"></a><a class="code" href="classX86ISA_1_1PS2Keyboard.html#add9eacd24782a08eba9ad9f21e37a554">00497</a> <a class="code" href="thread__context_8cc.html#aab2bbbf3710db70a2886ed6c49038af7">X86ISA::PS2Keyboard::unserialize</a>(<span class="keyword">const</span> std::string &amp;<a class="code" href="namespaceX86ISA.html#aa3826b335948154c40c1b6a32cbd10f5">base</a>, <a class="code" href="classCheckpoint.html">Checkpoint</a> *cp,
<a name="l00498"></a>00498         <span class="keyword">const</span> std::string &amp;section)
<a name="l00499"></a>00499 {
<a name="l00500"></a>00500     <a class="code" href="arch_2x86_2types_8cc.html#a2c99d2d69578d585494e1182085cb158">paramIn</a>(cp, section, base + <span class="stringliteral">&quot;.lastCommand&quot;</span>, <a class="code" href="classX86ISA_1_1PS2Device.html#ab7036c7a1ccb7433472f49e28ca57b61">lastCommand</a>);
<a name="l00501"></a>00501     <span class="keywordtype">int</span> bufferSize;
<a name="l00502"></a>00502     <a class="code" href="arch_2x86_2types_8cc.html#a2c99d2d69578d585494e1182085cb158">paramIn</a>(cp, section, base + <span class="stringliteral">&quot;.outBuffer.size&quot;</span>, bufferSize);
<a name="l00503"></a>00503     uint8_t *buffer = <span class="keyword">new</span> uint8_t[bufferSize];
<a name="l00504"></a>00504     <a class="code" href="serialize_8cc.html#a20ca99a4b0b51976ea5acc22dbf034b1">arrayParamIn</a>(cp, section, base + <span class="stringliteral">&quot;.outBuffer.elts&quot;</span>, buffer,
<a name="l00505"></a>00505             bufferSize*<span class="keyword">sizeof</span>(uint8_t));
<a name="l00506"></a>00506     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> = 0; <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> &lt; bufferSize; ++<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>) {
<a name="l00507"></a>00507         <a class="code" href="classX86ISA_1_1PS2Device.html#a8b85c2ab84e84fd1046edd16134379c8">outBuffer</a>.push(buffer[<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>]);
<a name="l00508"></a>00508     }
<a name="l00509"></a>00509     <span class="keyword">delete</span>[] buffer;
<a name="l00510"></a>00510 }
<a name="l00511"></a>00511 
<a name="l00512"></a>00512 <span class="keywordtype">void</span>
<a name="l00513"></a><a class="code" href="classX86ISA_1_1PS2Mouse.html#aa4f6624cb03d36568f0f17a96070255e">00513</a> <a class="code" href="thread__context_8cc.html#a40792bd7060f1fdd6c31469ce46d0a95" title="Thread context serialization helpers.">X86ISA::PS2Mouse::serialize</a>(<span class="keyword">const</span> std::string &amp;<a class="code" href="namespaceX86ISA.html#aa3826b335948154c40c1b6a32cbd10f5">base</a>, std::ostream &amp;<a class="code" href="namespaceX86ISA.html#aea9fbab71662ba06cf536e05edfaaad1">os</a>)
<a name="l00514"></a>00514 {
<a name="l00515"></a>00515     uint8_t statusData = status.__data;
<a name="l00516"></a>00516     <a class="code" href="arch_2x86_2types_8cc.html#adc6b6ea750b0d7ff7441ea35588abbdb">paramOut</a>(os, base + <span class="stringliteral">&quot;.lastCommand&quot;</span>, <a class="code" href="classX86ISA_1_1PS2Device.html#ab7036c7a1ccb7433472f49e28ca57b61">lastCommand</a>);
<a name="l00517"></a>00517     <span class="keywordtype">int</span> bufferSize = <a class="code" href="classX86ISA_1_1PS2Device.html#a8b85c2ab84e84fd1046edd16134379c8">outBuffer</a>.size();
<a name="l00518"></a>00518     <a class="code" href="arch_2x86_2types_8cc.html#adc6b6ea750b0d7ff7441ea35588abbdb">paramOut</a>(os, base + <span class="stringliteral">&quot;.outBuffer.size&quot;</span>, bufferSize);
<a name="l00519"></a>00519     uint8_t *buffer = <span class="keyword">new</span> uint8_t[bufferSize];
<a name="l00520"></a>00520     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> = 0; <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> &lt; bufferSize; ++<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>) {
<a name="l00521"></a>00521         buffer[<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>] = <a class="code" href="classX86ISA_1_1PS2Device.html#a8b85c2ab84e84fd1046edd16134379c8">outBuffer</a>.front();
<a name="l00522"></a>00522         <a class="code" href="classX86ISA_1_1PS2Device.html#a8b85c2ab84e84fd1046edd16134379c8">outBuffer</a>.pop();
<a name="l00523"></a>00523     }
<a name="l00524"></a>00524     <a class="code" href="serialize_8cc.html#a1dfe0fd5d936a18e30db1851b378bb41">arrayParamOut</a>(os, base + <span class="stringliteral">&quot;.outBuffer.elts&quot;</span>, buffer,
<a name="l00525"></a>00525             bufferSize*<span class="keyword">sizeof</span>(uint8_t));
<a name="l00526"></a>00526     <span class="keyword">delete</span>[] buffer;
<a name="l00527"></a>00527     <a class="code" href="arch_2x86_2types_8cc.html#adc6b6ea750b0d7ff7441ea35588abbdb">paramOut</a>(os, base + <span class="stringliteral">&quot;.status&quot;</span>, statusData);
<a name="l00528"></a>00528     <a class="code" href="arch_2x86_2types_8cc.html#adc6b6ea750b0d7ff7441ea35588abbdb">paramOut</a>(os, base + <span class="stringliteral">&quot;.resolution&quot;</span>, <a class="code" href="classX86ISA_1_1PS2Mouse.html#aeae6a53ce9045109789f17d00a88f355">resolution</a>);
<a name="l00529"></a>00529     <a class="code" href="arch_2x86_2types_8cc.html#adc6b6ea750b0d7ff7441ea35588abbdb">paramOut</a>(os, base + <span class="stringliteral">&quot;.sampleRate&quot;</span>, <a class="code" href="classX86ISA_1_1PS2Mouse.html#aece85d2e5e5bbed37e78561aa5c8f705">sampleRate</a>);
<a name="l00530"></a>00530 }
<a name="l00531"></a>00531 
<a name="l00532"></a>00532 <span class="keywordtype">void</span>
<a name="l00533"></a><a class="code" href="classX86ISA_1_1PS2Mouse.html#ab9d51a50ddcdd3c559ad93f75686220c">00533</a> <a class="code" href="thread__context_8cc.html#aab2bbbf3710db70a2886ed6c49038af7">X86ISA::PS2Mouse::unserialize</a>(<span class="keyword">const</span> std::string &amp;<a class="code" href="namespaceX86ISA.html#aa3826b335948154c40c1b6a32cbd10f5">base</a>, <a class="code" href="classCheckpoint.html">Checkpoint</a> *cp,
<a name="l00534"></a>00534         <span class="keyword">const</span> std::string &amp;section)
<a name="l00535"></a>00535 {
<a name="l00536"></a>00536     uint8_t statusData;
<a name="l00537"></a>00537     <a class="code" href="arch_2x86_2types_8cc.html#a2c99d2d69578d585494e1182085cb158">paramIn</a>(cp, section, base + <span class="stringliteral">&quot;.lastCommand&quot;</span>, <a class="code" href="classX86ISA_1_1PS2Device.html#ab7036c7a1ccb7433472f49e28ca57b61">lastCommand</a>);
<a name="l00538"></a>00538     <span class="keywordtype">int</span> bufferSize;
<a name="l00539"></a>00539     <a class="code" href="arch_2x86_2types_8cc.html#a2c99d2d69578d585494e1182085cb158">paramIn</a>(cp, section, base + <span class="stringliteral">&quot;.outBuffer.size&quot;</span>, bufferSize);
<a name="l00540"></a>00540     uint8_t *buffer = <span class="keyword">new</span> uint8_t[bufferSize];
<a name="l00541"></a>00541     <a class="code" href="serialize_8cc.html#a20ca99a4b0b51976ea5acc22dbf034b1">arrayParamIn</a>(cp, section, base + <span class="stringliteral">&quot;.outBuffer.elts&quot;</span>, buffer,
<a name="l00542"></a>00542             bufferSize*<span class="keyword">sizeof</span>(uint8_t));
<a name="l00543"></a>00543     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> = 0; <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> &lt; bufferSize; ++<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>) {
<a name="l00544"></a>00544         <a class="code" href="classX86ISA_1_1PS2Device.html#a8b85c2ab84e84fd1046edd16134379c8">outBuffer</a>.push(buffer[<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>]);
<a name="l00545"></a>00545     }
<a name="l00546"></a>00546     <span class="keyword">delete</span>[] buffer;
<a name="l00547"></a>00547     <a class="code" href="arch_2x86_2types_8cc.html#a2c99d2d69578d585494e1182085cb158">paramIn</a>(cp, section, base + <span class="stringliteral">&quot;.status&quot;</span>, statusData);
<a name="l00548"></a>00548     <a class="code" href="arch_2x86_2types_8cc.html#a2c99d2d69578d585494e1182085cb158">paramIn</a>(cp, section, base + <span class="stringliteral">&quot;.resolution&quot;</span>, <a class="code" href="classX86ISA_1_1PS2Mouse.html#aeae6a53ce9045109789f17d00a88f355">resolution</a>);
<a name="l00549"></a>00549     <a class="code" href="arch_2x86_2types_8cc.html#a2c99d2d69578d585494e1182085cb158">paramIn</a>(cp, section, base + <span class="stringliteral">&quot;.sampleRate&quot;</span>, <a class="code" href="classX86ISA_1_1PS2Mouse.html#aece85d2e5e5bbed37e78561aa5c8f705">sampleRate</a>);
<a name="l00550"></a>00550 
<a name="l00551"></a>00551     status.__data = statusData;
<a name="l00552"></a>00552 }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 <a class="code" href="classX86ISA_1_1I8042.html">X86ISA::I8042</a> *
<a name="l00555"></a>00555 I8042Params::create()
<a name="l00556"></a>00556 {
<a name="l00557"></a>00557     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classX86ISA_1_1I8042.html">X86ISA::I8042</a>(<span class="keyword">this</span>);
<a name="l00558"></a>00558 }
</pre></div></div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"><address style="align: right;"><small>
Generated on Sun Apr 7 2013 18:16:38 for gem5 by <a href="http://www.doxygen.org/index.html"> doxygen</a> 1.7.1</small></address>

</body>
</html>
