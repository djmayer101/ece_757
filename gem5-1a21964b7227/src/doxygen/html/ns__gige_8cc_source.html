<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>gem5: dev/ns_gige.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>dev/ns_gige.cc</h1>  </div>
</div>
<div class="contents">
<a href="ns__gige_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2004-2005 The Regents of The University of Michigan</span>
<a name="l00003"></a>00003 <span class="comment"> * All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00006"></a>00006 <span class="comment"> * modification, are permitted provided that the following conditions are</span>
<a name="l00007"></a>00007 <span class="comment"> * met: redistributions of source code must retain the above copyright</span>
<a name="l00008"></a>00008 <span class="comment"> * notice, this list of conditions and the following disclaimer;</span>
<a name="l00009"></a>00009 <span class="comment"> * redistributions in binary form must reproduce the above copyright</span>
<a name="l00010"></a>00010 <span class="comment"> * notice, this list of conditions and the following disclaimer in the</span>
<a name="l00011"></a>00011 <span class="comment"> * documentation and/or other materials provided with the distribution;</span>
<a name="l00012"></a>00012 <span class="comment"> * neither the name of the copyright holders nor the names of its</span>
<a name="l00013"></a>00013 <span class="comment"> * contributors may be used to endorse or promote products derived from</span>
<a name="l00014"></a>00014 <span class="comment"> * this software without specific prior written permission.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00017"></a>00017 <span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00018"></a>00018 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00019"></a>00019 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00020"></a>00020 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00021"></a>00021 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00022"></a>00022 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00023"></a>00023 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00024"></a>00024 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00025"></a>00025 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00026"></a>00026 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00027"></a>00027 <span class="comment"> *</span>
<a name="l00028"></a>00028 <span class="comment"> * Authors: Nathan Binkert</span>
<a name="l00029"></a>00029 <span class="comment"> *          Lisa Hsu</span>
<a name="l00030"></a>00030 <span class="comment"> */</span>
<a name="l00031"></a>00031 
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;deque&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="base_2debug_8hh.html">base/debug.hh</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="inet_8hh.html">base/inet.hh</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="base_2types_8hh.html" title="Defines global host-dependent types: Counter, Tick, and (indirectly) {int,uint}{8,16,32,64}_t.">base/types.hh</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;config/the_isa.hh&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="thread__context_8hh.html">cpu/thread_context.hh</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;debug/EthernetAll.hh&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="etherlink_8hh.html">dev/etherlink.hh</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="ns__gige_8hh.html" title="Device module for modelling the National Semiconductor DP83820 ethernet controller.">dev/ns_gige.hh</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="pciconfigall_8hh.html">dev/pciconfigall.hh</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="packet_8hh.html" title="Declaration of the Packet class.">mem/packet.hh</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="packet__access_8hh.html">mem/packet_access.hh</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;params/NSGigE.hh&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="sim_2system_8hh.html">sim/system.hh</a>&quot;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="comment">// clang complains about std::set being overloaded with Packet::set if</span>
<a name="l00054"></a>00054 <span class="comment">// we open up the entire namespace std</span>
<a name="l00055"></a>00055 <span class="keyword">using</span> std::min;
<a name="l00056"></a>00056 <span class="keyword">using</span> std::ostream;
<a name="l00057"></a>00057 <span class="keyword">using</span> std::string;
<a name="l00058"></a>00058 
<a name="l00059"></a><a class="code" href="ns__gige_8cc.html#ad6f3c3e40104a80a184491a00ba6a41d">00059</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ns__gige_8cc.html#ad6f3c3e40104a80a184491a00ba6a41d">NsRxStateStrings</a>[] =
<a name="l00060"></a>00060 {
<a name="l00061"></a>00061     <span class="stringliteral">&quot;rxIdle&quot;</span>,
<a name="l00062"></a>00062     <span class="stringliteral">&quot;rxDescRefr&quot;</span>,
<a name="l00063"></a>00063     <span class="stringliteral">&quot;rxDescRead&quot;</span>,
<a name="l00064"></a>00064     <span class="stringliteral">&quot;rxFifoBlock&quot;</span>,
<a name="l00065"></a>00065     <span class="stringliteral">&quot;rxFragWrite&quot;</span>,
<a name="l00066"></a>00066     <span class="stringliteral">&quot;rxDescWrite&quot;</span>,
<a name="l00067"></a>00067     <span class="stringliteral">&quot;rxAdvance&quot;</span>
<a name="l00068"></a>00068 };
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="ns__gige_8cc.html#ae072bc5252468e83d34f7c497ad3ce71">00070</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ns__gige_8cc.html#ae072bc5252468e83d34f7c497ad3ce71">NsTxStateStrings</a>[] =
<a name="l00071"></a>00071 {
<a name="l00072"></a>00072     <span class="stringliteral">&quot;txIdle&quot;</span>,
<a name="l00073"></a>00073     <span class="stringliteral">&quot;txDescRefr&quot;</span>,
<a name="l00074"></a>00074     <span class="stringliteral">&quot;txDescRead&quot;</span>,
<a name="l00075"></a>00075     <span class="stringliteral">&quot;txFifoBlock&quot;</span>,
<a name="l00076"></a>00076     <span class="stringliteral">&quot;txFragRead&quot;</span>,
<a name="l00077"></a>00077     <span class="stringliteral">&quot;txDescWrite&quot;</span>,
<a name="l00078"></a>00078     <span class="stringliteral">&quot;txAdvance&quot;</span>
<a name="l00079"></a>00079 };
<a name="l00080"></a>00080 
<a name="l00081"></a><a class="code" href="ns__gige_8cc.html#affb1f222c7c2700edaa37d14c8f64722">00081</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ns__gige_8cc.html#affb1f222c7c2700edaa37d14c8f64722">NsDmaState</a>[] =
<a name="l00082"></a>00082 {
<a name="l00083"></a>00083     <span class="stringliteral">&quot;dmaIdle&quot;</span>,
<a name="l00084"></a>00084     <span class="stringliteral">&quot;dmaReading&quot;</span>,
<a name="l00085"></a>00085     <span class="stringliteral">&quot;dmaWriting&quot;</span>,
<a name="l00086"></a>00086     <span class="stringliteral">&quot;dmaReadWaiting&quot;</span>,
<a name="l00087"></a>00087     <span class="stringliteral">&quot;dmaWriteWaiting&quot;</span>
<a name="l00088"></a>00088 };
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="keyword">using namespace </span>Net;
<a name="l00091"></a>00091 <span class="keyword">using namespace </span>TheISA;
<a name="l00092"></a>00092 
<a name="l00094"></a>00094 <span class="comment">//</span>
<a name="l00095"></a>00095 <span class="comment">// NSGigE PCI Device</span>
<a name="l00096"></a>00096 <span class="comment">//</span>
<a name="l00097"></a><a class="code" href="classNSGigE.html#a1247657d1e66bf8126b4203053ad34c9">00097</a> <a class="code" href="classNSGigE.html#a1247657d1e66bf8126b4203053ad34c9">NSGigE::NSGigE</a>(<a class="code" href="classDmaDevice.html#ac7bbaf5193e605eb9e8fd3491a131e95">Params</a> *<a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>)
<a name="l00098"></a>00098     : <a class="code" href="classEtherDevBase.html" title="Dummy class to keep the Python class hierarchy in sync with the C++ object hierarchy.">EtherDevBase</a>(p), ioEnable(false),
<a name="l00099"></a>00099       txFifo(p-&gt;tx_fifo_size), rxFifo(p-&gt;rx_fifo_size),
<a name="l00100"></a>00100       txPacket(0), rxPacket(0), txPacketBufPtr(NULL), rxPacketBufPtr(NULL),
<a name="l00101"></a>00101       txXferLen(0), rxXferLen(0), rxDmaFree(false), txDmaFree(false),
<a name="l00102"></a>00102       txState(txIdle), txEnable(false), CTDD(false), txHalt(false),
<a name="l00103"></a>00103       txFragPtr(0), txDescCnt(0), txDmaState(dmaIdle), rxState(rxIdle),
<a name="l00104"></a>00104       rxEnable(false), CRDD(false), rxPktBytes(0), rxHalt(false),
<a name="l00105"></a>00105       rxFragPtr(0), rxDescCnt(0), rxDmaState(dmaIdle), extstsEnable(false),
<a name="l00106"></a>00106       eepromState(eepromStart), eepromClk(false), eepromBitsToRx(0),
<a name="l00107"></a>00107       eepromOpcode(0), eepromAddress(0), eepromData(0),
<a name="l00108"></a>00108       dmaReadDelay(p-&gt;dma_read_delay), dmaWriteDelay(p-&gt;dma_write_delay),
<a name="l00109"></a>00109       dmaReadFactor(p-&gt;dma_read_factor), dmaWriteFactor(p-&gt;dma_write_factor),
<a name="l00110"></a>00110       rxDmaData(NULL), rxDmaAddr(0), rxDmaLen(0),
<a name="l00111"></a>00111       txDmaData(NULL), txDmaAddr(0), txDmaLen(0),
<a name="l00112"></a>00112       rxDmaReadEvent(this), rxDmaWriteEvent(this),
<a name="l00113"></a>00113       txDmaReadEvent(this), txDmaWriteEvent(this),
<a name="l00114"></a>00114       dmaDescFree(p-&gt;dma_desc_free), dmaDataFree(p-&gt;dma_data_free),
<a name="l00115"></a>00115       txDelay(p-&gt;tx_delay), rxDelay(p-&gt;rx_delay),
<a name="l00116"></a>00116       rxKickTick(0), rxKickEvent(this), txKickTick(0), txKickEvent(this),
<a name="l00117"></a>00117       txEvent(this), rxFilterEnable(p-&gt;rx_filter),
<a name="l00118"></a>00118       acceptBroadcast(false), acceptMulticast(false), acceptUnicast(false),
<a name="l00119"></a>00119       acceptPerfect(false), acceptArp(false), multicastHashEnable(false),
<a name="l00120"></a>00120       intrDelay(p-&gt;intr_delay), intrTick(0), cpuPendingIntr(false),
<a name="l00121"></a>00121       intrEvent(0), interface(0)
<a name="l00122"></a>00122 {
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 
<a name="l00125"></a>00125     <a class="code" href="classNSGigE.html#ab0989afb60b9d6f0f049b35976d17264">interface</a> = <span class="keyword">new</span> <a class="code" href="classNSGigEInt.html">NSGigEInt</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.int0&quot;</span>, <span class="keyword">this</span>);
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     <a class="code" href="classNSGigE.html#ad7aa4282dafb24f59ce1f608e32f405a">regsReset</a>();
<a name="l00128"></a>00128     memcpy(&amp;<a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>, p-&gt;hardware_address.bytes(), ETH_ADDR_LEN);
<a name="l00129"></a>00129 
<a name="l00130"></a>00130     memset(&amp;<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>));
<a name="l00131"></a>00131     memset(&amp;<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>));
<a name="l00132"></a>00132     memset(&amp;<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>));
<a name="l00133"></a>00133     memset(&amp;<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>));
<a name="l00134"></a>00134 }
<a name="l00135"></a>00135 
<a name="l00136"></a><a class="code" href="classNSGigE.html#abbd1e0a8b776d607e7b53362004b6daf">00136</a> <a class="code" href="classNSGigE.html#abbd1e0a8b776d607e7b53362004b6daf">NSGigE::~NSGigE</a>()
<a name="l00137"></a>00137 {
<a name="l00138"></a>00138     <span class="keyword">delete</span> <a class="code" href="classNSGigE.html#ab0989afb60b9d6f0f049b35976d17264">interface</a>;
<a name="l00139"></a>00139 }
<a name="l00140"></a>00140 
<a name="l00144"></a>00144 <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a>
<a name="l00145"></a><a class="code" href="classNSGigE.html#a4975eca99acf13a2c4ff5a2577e036ee">00145</a> <a class="code" href="classNSGigE.html#a4975eca99acf13a2c4ff5a2577e036ee" title="This is to write to the PCI general configuration registers.">NSGigE::writeConfig</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt)
<a name="l00146"></a>00146 {
<a name="l00147"></a>00147     <span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#a19e4a68ca5c93c6136351d804b432b09">offset</a> = pkt-&gt;<a class="code" href="classPacket.html#a1c04785186ba5aa70a40cac9b2bfc86e">getAddr</a>() &amp; PCI_CONFIG_SIZE;
<a name="l00148"></a>00148     <span class="keywordflow">if</span> (offset &lt; <a class="code" href="pcireg_8h.html#abb02d00821657dc348f9c78eab5f1995">PCI_DEVICE_SPECIFIC</a>)
<a name="l00149"></a>00149         <a class="code" href="classNSGigE.html#a4975eca99acf13a2c4ff5a2577e036ee" title="This is to write to the PCI general configuration registers.">PciDev::writeConfig</a>(pkt);
<a name="l00150"></a>00150     <span class="keywordflow">else</span>
<a name="l00151"></a>00151         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Device specific PCI config space not implemented!\n&quot;</span>);
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <span class="keywordflow">switch</span> (offset) {
<a name="l00154"></a>00154         <span class="comment">// seems to work fine without all these PCI settings, but i</span>
<a name="l00155"></a>00155         <span class="comment">// put in the IO to double check, an assertion will fail if we</span>
<a name="l00156"></a>00156         <span class="comment">// need to properly implement it</span>
<a name="l00157"></a>00157       <span class="keywordflow">case</span> <a class="code" href="pcireg_8h.html#ace199ecb77d8e32d759ac065c22304b3">PCI_COMMAND</a>:
<a name="l00158"></a>00158         <span class="keywordflow">if</span> (<a class="code" href="classPciDev.html#a79570d54c378a76ee402587fc5063857" title="The current config space.">config</a>.<a class="code" href="unionPCIConfig.html#ab0dc6e5f5cf9db340b97b1c8d75fce94">data</a>[offset] &amp; <a class="code" href="pcireg_8h.html#a5ef611f182e4d3e653e8de20c1e5cece">PCI_CMD_IOSE</a>)
<a name="l00159"></a>00159             <a class="code" href="classNSGigE.html#a06cd8c902dcbd8093c38d803009db49d" title="pci settings">ioEnable</a> = <span class="keyword">true</span>;
<a name="l00160"></a>00160         <span class="keywordflow">else</span>
<a name="l00161"></a>00161             <a class="code" href="classNSGigE.html#a06cd8c902dcbd8093c38d803009db49d" title="pci settings">ioEnable</a> = <span class="keyword">false</span>;
<a name="l00162"></a>00162         <span class="keywordflow">break</span>;
<a name="l00163"></a>00163     }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <span class="keywordflow">return</span> <a class="code" href="classPciDev.html#a068d26ab5bf2ba2350933df45b14785f">configDelay</a>;
<a name="l00166"></a>00166 }
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 <a class="code" href="classEtherInt.html">EtherInt</a>*
<a name="l00169"></a><a class="code" href="classNSGigE.html#aed7c51c14f32d7850ccd6efc8852d78d">00169</a> <a class="code" href="classNSGigE.html#aed7c51c14f32d7850ccd6efc8852d78d" title="Additional function to return the Port of a memory object.">NSGigE::getEthPort</a>(<span class="keyword">const</span> std::string &amp;if_name, <span class="keywordtype">int</span> idx)
<a name="l00170"></a>00170 {
<a name="l00171"></a>00171     <span class="keywordflow">if</span> (if_name == <span class="stringliteral">&quot;interface&quot;</span>) {
<a name="l00172"></a>00172        <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#ab0989afb60b9d6f0f049b35976d17264">interface</a>-&gt;<a class="code" href="classEtherInt.html#a98c02fdff5a81c539ca2c98f186473a9">getPeer</a>())
<a name="l00173"></a>00173            <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;interface already connected to\n&quot;</span>);
<a name="l00174"></a>00174        <span class="keywordflow">return</span> <a class="code" href="classNSGigE.html#ab0989afb60b9d6f0f049b35976d17264">interface</a>;
<a name="l00175"></a>00175     }
<a name="l00176"></a>00176     <span class="keywordflow">return</span> NULL;
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178 
<a name="l00183"></a>00183 <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a>
<a name="l00184"></a><a class="code" href="classNSGigE.html#aa511df14fe6c8ccbcddc0439fca46b89">00184</a> <a class="code" href="classNSGigE.html#aa511df14fe6c8ccbcddc0439fca46b89" title="This reads the device registers, which are detailed in the NS83820 spec sheet.">NSGigE::read</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt)
<a name="l00185"></a>00185 {
<a name="l00186"></a>00186     assert(<a class="code" href="classNSGigE.html#a06cd8c902dcbd8093c38d803009db49d" title="pci settings">ioEnable</a>);
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     pkt-&gt;<a class="code" href="classPacket.html#aaa5d4a16d37597168dcff5857d9c6717" title="If there isn&amp;#39;t data in the packet, allocate some.">allocate</a>();
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     <span class="comment">//The mask is to give you only the offset into the device register file</span>
<a name="l00191"></a>00191     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> daddr = pkt-&gt;<a class="code" href="classPacket.html#a1c04785186ba5aa70a40cac9b2bfc86e">getAddr</a>() &amp; 0xfff;
<a name="l00192"></a>00192     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetPIO, <span class="stringliteral">&quot;read  da=%#x pa=%#x size=%d\n&quot;</span>,
<a name="l00193"></a>00193             daddr, pkt-&gt;<a class="code" href="classPacket.html#a1c04785186ba5aa70a40cac9b2bfc86e">getAddr</a>(), pkt-&gt;<a class="code" href="classPacket.html#ad7c96bd8cd06acddebb3a373b37e6e59">getSize</a>());
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 
<a name="l00196"></a>00196     <span class="comment">// there are some reserved registers, you can see ns_gige_reg.h and</span>
<a name="l00197"></a>00197     <span class="comment">// the spec sheet for details</span>
<a name="l00198"></a>00198     <span class="keywordflow">if</span> (daddr &gt; <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a990cd45e93be2b4661f3499e0a658a33">LAST</a> &amp;&amp; daddr &lt;=  <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25afe4c21755babfece7188666f75c7386b">RESERVED</a>) {
<a name="l00199"></a>00199         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Accessing reserved register&quot;</span>);
<a name="l00200"></a>00200     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (daddr &gt; <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25afe4c21755babfece7188666f75c7386b">RESERVED</a> &amp;&amp; daddr &lt;= 0x3FC) {
<a name="l00201"></a>00201         <span class="keywordflow">return</span> <a class="code" href="classPciDev.html#a53e576eb61676bc3688d101147f73549" title="Read from the PCI config space data that is stored locally.">readConfig</a>(pkt);
<a name="l00202"></a>00202     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (daddr &gt;= <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a05bb70822f122919a2506857a198b953">MIB_START</a> &amp;&amp; daddr &lt;= <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a327f20cac71d436ea60e87ee2ad37a31">MIB_END</a>) {
<a name="l00203"></a>00203         <span class="comment">// don&#39;t implement all the MIB&#39;s.  hopefully the kernel</span>
<a name="l00204"></a>00204         <span class="comment">// doesn&#39;t actually DEPEND upon their values</span>
<a name="l00205"></a>00205         <span class="comment">// MIB are just hardware stats keepers</span>
<a name="l00206"></a>00206         pkt-&gt;<a class="code" href="classPacket.html#ac63debc6335e01dcb4941e4c760a6962" title="set the value in the data pointer to v.">set</a>&lt;<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&gt;(0);
<a name="l00207"></a>00207         pkt-&gt;<a class="code" href="classPacket.html#a79f71e6885712d4951e70eaba2e364cb">makeAtomicResponse</a>();
<a name="l00208"></a>00208         <span class="keywordflow">return</span> <a class="code" href="classPciDev.html#a8f5bebdc51249cfa29fe1f87a81d5fc1">pioDelay</a>;
<a name="l00209"></a>00209     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (daddr &gt; 0x3FC)
<a name="l00210"></a>00210         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Something is messed up!\n&quot;</span>);
<a name="l00211"></a>00211 
<a name="l00212"></a>00212     assert(pkt-&gt;<a class="code" href="classPacket.html#ad7c96bd8cd06acddebb3a373b37e6e59">getSize</a>() == <span class="keyword">sizeof</span>(uint32_t));
<a name="l00213"></a>00213         <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> &amp;<a class="code" href="namespaceX86ISA.html#a6c9f38e48611db30642897e93a05104c">reg</a> = *pkt-&gt;<a class="code" href="classPacket.html#ad9552d30d60e5425e0a66b5c4e5c85d8" title="get a pointer to the data ptr.">getPtr</a>&lt;<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&gt;();
<a name="l00214"></a>00214         uint16_t rfaddr;
<a name="l00215"></a>00215 
<a name="l00216"></a>00216         <span class="keywordflow">switch</span> (daddr) {
<a name="l00217"></a>00217           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25aaaa8401b50cb34e3a0d58729f70494f0">CR</a>:
<a name="l00218"></a>00218             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a9600015476b774b3442165cf61f29ad9">command</a>;
<a name="l00219"></a>00219             <span class="comment">//these are supposed to be cleared on a read</span>
<a name="l00220"></a>00220             reg &amp;= ~(<a class="code" href="ns__gige__reg_8h.html#a25ab0edf42365ee5677703ae777f4424a18c9488d4b439d55d7f40b163952497a">CR_RXD</a> | <a class="code" href="ns__gige__reg_8h.html#a25ab0edf42365ee5677703ae777f4424a7865b59ebf477ecc29df1f94c56f6af0">CR_TXD</a> | <a class="code" href="ns__gige__reg_8h.html#a25ab0edf42365ee5677703ae777f4424a010518531d8fadfb5bb43c75428cc40a">CR_TXR</a> | CR_RXR);
<a name="l00221"></a>00221             <span class="keywordflow">break</span>;
<a name="l00222"></a>00222 
<a name="l00223"></a>00223           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25afbc4afeaffc324badfe21ddc14c90ed9">CFGR</a>:
<a name="l00224"></a>00224             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a7b90dafdbf78c3094e26e3b445a45118">config</a>;
<a name="l00225"></a>00225             <span class="keywordflow">break</span>;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a113d9a63f26f07777cd9a0967f1836d8">MEAR</a>:
<a name="l00228"></a>00228             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49e054c501a5a1f8d1fa342999a6c4e8">mear</a>;
<a name="l00229"></a>00229             <span class="keywordflow">break</span>;
<a name="l00230"></a>00230 
<a name="l00231"></a>00231           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a3f3b76dd337d3d696768fef36d7a314c">PTSCR</a>:
<a name="l00232"></a>00232             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a32d4c8c44c00b5b1d6fc66568f24fee0">ptscr</a>;
<a name="l00233"></a>00233             <span class="keywordflow">break</span>;
<a name="l00234"></a>00234 
<a name="l00235"></a>00235           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25aca31e5168f5b741f9e55de5628d9f2f3">ISR</a>:
<a name="l00236"></a>00236             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a>;
<a name="l00237"></a>00237             <a class="code" href="classNSGigE.html#a08b5f97229e03bea98020c9a227e51ba">devIntrClear</a>(<a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84a49d921f52ab8e9aea6bb5167a58984b9">ISR_ALL</a>);
<a name="l00238"></a>00238             <span class="keywordflow">break</span>;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a7c1d11a9bbf54a9ff9af0ad29823bd73">IMR</a>:
<a name="l00241"></a>00241             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a>;
<a name="l00242"></a>00242             <span class="keywordflow">break</span>;
<a name="l00243"></a>00243 
<a name="l00244"></a>00244           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25aa4fe81a2a70fb56b8e15785301bc7eb2">IER</a>:
<a name="l00245"></a>00245             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#af82b628490afa00a40d0296a35f8ca80">ier</a>;
<a name="l00246"></a>00246             <span class="keywordflow">break</span>;
<a name="l00247"></a>00247 
<a name="l00248"></a>00248           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a804313d150167dbc33984588f5c6a524">IHR</a>:
<a name="l00249"></a>00249             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2c267f1982b8c6826b03fe00f7631397">ihr</a>;
<a name="l00250"></a>00250             <span class="keywordflow">break</span>;
<a name="l00251"></a>00251 
<a name="l00252"></a>00252           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a804db1164d59b54529c77038834527c0">TXDP</a>:
<a name="l00253"></a>00253             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acff64aa194acd44f476d4a1f741203e1">txdp</a>;
<a name="l00254"></a>00254             <span class="keywordflow">break</span>;
<a name="l00255"></a>00255 
<a name="l00256"></a>00256           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a03d8e070806a5d36573ed6c5fba0a715">TXDP_HI</a>:
<a name="l00257"></a>00257             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#ae4b6bf5e002d832cbb70312510f7d537">txdp_hi</a>;
<a name="l00258"></a>00258             <span class="keywordflow">break</span>;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25afd8c7078b386b6059654aeb6b1a94732">TX_CFG</a>:
<a name="l00261"></a>00261             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acf32d2fcfab30be47767f1531f75a2cc">txcfg</a>;
<a name="l00262"></a>00262             <span class="keywordflow">break</span>;
<a name="l00263"></a>00263 
<a name="l00264"></a>00264           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25ac890250653bf0f2642da0efba7b5c776">GPIOR</a>:
<a name="l00265"></a>00265             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49fbb19ec37ec570701899609ae22cd6">gpior</a>;
<a name="l00266"></a>00266             <span class="keywordflow">break</span>;
<a name="l00267"></a>00267 
<a name="l00268"></a>00268           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a242a3cfc4e3678d4660b4b317cdf2703">RXDP</a>:
<a name="l00269"></a>00269             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2174f997477d58985b12c3a059d38bf8">rxdp</a>;
<a name="l00270"></a>00270             <span class="keywordflow">break</span>;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25ac096320cf3d114b30588fba0afae14f9">RXDP_HI</a>:
<a name="l00273"></a>00273             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a5c2e9f02a7b391d4e117630478ad11b9">rxdp_hi</a>;
<a name="l00274"></a>00274             <span class="keywordflow">break</span>;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a5c49af0c1afdec035bdffc03803e9b78">RX_CFG</a>:
<a name="l00277"></a>00277             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a725ebce5e39e17777f38adc25d8c71f5">rxcfg</a>;
<a name="l00278"></a>00278             <span class="keywordflow">break</span>;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a7088a56d79f18acc7bd868e2b822d3d9">PQCR</a>:
<a name="l00281"></a>00281             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2041e1c015742a4bd93e1160b2a995a2">pqcr</a>;
<a name="l00282"></a>00282             <span class="keywordflow">break</span>;
<a name="l00283"></a>00283 
<a name="l00284"></a>00284           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a4c9b532dc4d3aa5f4375e70f61f09b88">WCSR</a>:
<a name="l00285"></a>00285             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a7cca9c6177ccc42f5f38b91e19f4df38">wcsr</a>;
<a name="l00286"></a>00286             <span class="keywordflow">break</span>;
<a name="l00287"></a>00287 
<a name="l00288"></a>00288           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25aada5ac22f141879a3be1813e49d21057">PCR</a>:
<a name="l00289"></a>00289             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a956e3bb62b522823287435d048a75059">pcr</a>;
<a name="l00290"></a>00290             <span class="keywordflow">break</span>;
<a name="l00291"></a>00291 
<a name="l00292"></a>00292             <span class="comment">// see the spec sheet for how RFCR and RFDR work</span>
<a name="l00293"></a>00293             <span class="comment">// basically, you write to RFCR to tell the machine</span>
<a name="l00294"></a>00294             <span class="comment">// what you want to do next, then you act upon RFDR,</span>
<a name="l00295"></a>00295             <span class="comment">// and the device will be prepared b/c of what you</span>
<a name="l00296"></a>00296             <span class="comment">// wrote to RFCR</span>
<a name="l00297"></a>00297           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a9d527b6a73b509500c2ce768b7153377">RFCR</a>:
<a name="l00298"></a>00298             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a525ccc417f2173ef149f5e84cc8dbe61">rfcr</a>;
<a name="l00299"></a>00299             <span class="keywordflow">break</span>;
<a name="l00300"></a>00300 
<a name="l00301"></a>00301           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25afb024013e0dd4ef200b16e7ddf4feb3e">RFDR</a>:
<a name="l00302"></a>00302             rfaddr = (uint16_t)(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a525ccc417f2173ef149f5e84cc8dbe61">rfcr</a> &amp; <a class="code" href="ns__gige__reg_8h.html#a710fe9a2d6d1f5c41f43cc9c36029b4ba7294173f5e92483088029ba48a6f1db1">RFCR_RFADDR</a>);
<a name="l00303"></a>00303             <span class="keywordflow">switch</span> (rfaddr) {
<a name="l00304"></a>00304               <span class="comment">// Read from perfect match ROM octets</span>
<a name="l00305"></a>00305               <span class="keywordflow">case</span> 0x000:
<a name="l00306"></a>00306                 reg = <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[1];
<a name="l00307"></a>00307                 reg = reg &lt;&lt; 8;
<a name="l00308"></a>00308                 reg += <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[0];
<a name="l00309"></a>00309                 <span class="keywordflow">break</span>;
<a name="l00310"></a>00310               <span class="keywordflow">case</span> 0x002:
<a name="l00311"></a>00311                 reg = <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[3] &lt;&lt; 8;
<a name="l00312"></a>00312                 reg += <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[2];
<a name="l00313"></a>00313                 <span class="keywordflow">break</span>;
<a name="l00314"></a>00314               <span class="keywordflow">case</span> 0x004:
<a name="l00315"></a>00315                 reg = <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[5] &lt;&lt; 8;
<a name="l00316"></a>00316                 reg += <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[4];
<a name="l00317"></a>00317                 <span class="keywordflow">break</span>;
<a name="l00318"></a>00318               <span class="keywordflow">default</span>:
<a name="l00319"></a>00319                 <span class="comment">// Read filter hash table</span>
<a name="l00320"></a>00320                 <span class="keywordflow">if</span> (rfaddr &gt;= <a class="code" href="ns__gige_8hh.html#a351fddd1359b79f333a7680e36221a73">FHASH_ADDR</a> &amp;&amp;
<a name="l00321"></a>00321                     rfaddr &lt; <a class="code" href="ns__gige_8hh.html#a351fddd1359b79f333a7680e36221a73">FHASH_ADDR</a> + <a class="code" href="ns__gige_8hh.html#a7d7c3db3667c7110b37292d81dc81362">FHASH_SIZE</a>) {
<a name="l00322"></a>00322 
<a name="l00323"></a>00323                     <span class="comment">// Only word-aligned reads supported</span>
<a name="l00324"></a>00324                     <span class="keywordflow">if</span> (rfaddr % 2)
<a name="l00325"></a>00325                         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;unaligned read from filter hash table!&quot;</span>);
<a name="l00326"></a>00326 
<a name="l00327"></a>00327                     reg = <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#a260603c4f6a5b5f188f9c26bbf136bad" title="for hash table memory.">filterHash</a>[rfaddr - <a class="code" href="ns__gige_8hh.html#a351fddd1359b79f333a7680e36221a73">FHASH_ADDR</a> + 1] &lt;&lt; 8;
<a name="l00328"></a>00328                     reg += <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#a260603c4f6a5b5f188f9c26bbf136bad" title="for hash table memory.">filterHash</a>[rfaddr - <a class="code" href="ns__gige_8hh.html#a351fddd1359b79f333a7680e36221a73">FHASH_ADDR</a>];
<a name="l00329"></a>00329                     <span class="keywordflow">break</span>;
<a name="l00330"></a>00330                 }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;reading RFDR for something other than pattern&quot;</span>
<a name="l00333"></a>00333                       <span class="stringliteral">&quot; matching or hashing! %#x\n&quot;</span>, rfaddr);
<a name="l00334"></a>00334             }
<a name="l00335"></a>00335             <span class="keywordflow">break</span>;
<a name="l00336"></a>00336 
<a name="l00337"></a>00337           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25ab32fd5480aa7a7431c84f82cdccb060c">SRR</a>:
<a name="l00338"></a>00338             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a210ef455baf3b7a9c577d2fef3757c85">srr</a>;
<a name="l00339"></a>00339             <span class="keywordflow">break</span>;
<a name="l00340"></a>00340 
<a name="l00341"></a>00341           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a8548fb064a7d49f83310e239b5799878">MIBC</a>:
<a name="l00342"></a>00342             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a28bad330789b6511f93e3b8f8ec3c4e3">mibc</a>;
<a name="l00343"></a>00343             reg &amp;= ~(<a class="code" href="ns__gige__reg_8h.html#ab52197dcc6392efc604eefc8b762daa2a7c9fdc60f2ca6560b901e4a108b3f810">MIBC_MIBS</a> | MIBC_ACLR);
<a name="l00344"></a>00344             <span class="keywordflow">break</span>;
<a name="l00345"></a>00345 
<a name="l00346"></a>00346           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a35581fe69a8e2ba505c419b78764aecd">VRCR</a>:
<a name="l00347"></a>00347             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#aac2bbec11b4590f8b2eb1583c147e2ee">vrcr</a>;
<a name="l00348"></a>00348             <span class="keywordflow">break</span>;
<a name="l00349"></a>00349 
<a name="l00350"></a>00350           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a8d738fd8ff5fa4fd30aa1e9caa3e963f">VTCR</a>:
<a name="l00351"></a>00351             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#ad97af13deb1a5c24f449f538b0bf695d">vtcr</a>;
<a name="l00352"></a>00352             <span class="keywordflow">break</span>;
<a name="l00353"></a>00353 
<a name="l00354"></a>00354           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a923bc9bcd837b0f18e3a636c26342151">VDR</a>:
<a name="l00355"></a>00355             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a74ae9c0bdd32efa2efc9dcca19d8437d">vdr</a>;
<a name="l00356"></a>00356             <span class="keywordflow">break</span>;
<a name="l00357"></a>00357 
<a name="l00358"></a>00358           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a1de6e2cccf66f9f8f986562fd3cdd705">CCSR</a>:
<a name="l00359"></a>00359             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#ae9c8447eb409d13a9d0e404caa921374">ccsr</a>;
<a name="l00360"></a>00360             <span class="keywordflow">break</span>;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25afeaf59b9c0f634ea0e99d68d99047811">TBICR</a>:
<a name="l00363"></a>00363             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a9113118d642b41d2aad8c551514759af">tbicr</a>;
<a name="l00364"></a>00364             <span class="keywordflow">break</span>;
<a name="l00365"></a>00365 
<a name="l00366"></a>00366           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25acc00a47300aa1d4018fcc431d259da66">TBISR</a>:
<a name="l00367"></a>00367             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2eee77294a95ae2e2f5652c3abbf2922">tbisr</a>;
<a name="l00368"></a>00368             <span class="keywordflow">break</span>;
<a name="l00369"></a>00369 
<a name="l00370"></a>00370           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25ad7a6d7bd2635a5112142f663b862e0a5">TANAR</a>:
<a name="l00371"></a>00371             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a639aecec1e7fed4b0cb5dbcfbcdbed56">tanar</a>;
<a name="l00372"></a>00372             <span class="keywordflow">break</span>;
<a name="l00373"></a>00373 
<a name="l00374"></a>00374           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a072e6a9a8270dbf30f7ed55fbd09f596">TANLPAR</a>:
<a name="l00375"></a>00375             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a52c74bd6cb93b3bbc7f4a7c4ad66e60e">tanlpar</a>;
<a name="l00376"></a>00376             <span class="keywordflow">break</span>;
<a name="l00377"></a>00377 
<a name="l00378"></a>00378           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25ada853e9785cabacd24a852b2a641d0e1">TANER</a>:
<a name="l00379"></a>00379             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a71e889615b767822bbeb1d497ed2fa74">taner</a>;
<a name="l00380"></a>00380             <span class="keywordflow">break</span>;
<a name="l00381"></a>00381 
<a name="l00382"></a>00382           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25ab7b4bbff0e7e615f1a5a579d630f71b9">TESR</a>:
<a name="l00383"></a>00383             reg = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a73c04ab08a0f39d76d90dd9f60464b6f">tesr</a>;
<a name="l00384"></a>00384             <span class="keywordflow">break</span>;
<a name="l00385"></a>00385 
<a name="l00386"></a>00386           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a37733f4bac5aa9804815b2e506445148">M5REG</a>:
<a name="l00387"></a>00387             reg = 0;
<a name="l00388"></a>00388             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a3cd339db5bca9b7e67e2b4633c32f352">params</a>()-&gt;rx_thread)
<a name="l00389"></a>00389                 reg |= <a class="code" href="ns__gige__reg_8h.html#a807c9cc3cb7f527978c4f0ec01cfde9aa02fd720468a6e91d604e922467d46a92">M5REG_RX_THREAD</a>;
<a name="l00390"></a>00390             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a3cd339db5bca9b7e67e2b4633c32f352">params</a>()-&gt;tx_thread)
<a name="l00391"></a>00391                 reg |= <a class="code" href="ns__gige__reg_8h.html#a807c9cc3cb7f527978c4f0ec01cfde9aae81357a76b04d1e4f019171d34e0973f">M5REG_TX_THREAD</a>;
<a name="l00392"></a>00392             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a3cd339db5bca9b7e67e2b4633c32f352">params</a>()-&gt;rss)
<a name="l00393"></a>00393                 reg |= <a class="code" href="ns__gige__reg_8h.html#a807c9cc3cb7f527978c4f0ec01cfde9aaba7f93006dd8757c4b26b816cd7ab8d1">M5REG_RSS</a>;
<a name="l00394"></a>00394             <span class="keywordflow">break</span>;
<a name="l00395"></a>00395 
<a name="l00396"></a>00396           <span class="keywordflow">default</span>:
<a name="l00397"></a>00397             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;reading unimplemented register: addr=%#x&quot;</span>, daddr);
<a name="l00398"></a>00398         }
<a name="l00399"></a>00399 
<a name="l00400"></a>00400         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetPIO, <span class="stringliteral">&quot;read from %#x: data=%d data=%#x\n&quot;</span>,
<a name="l00401"></a>00401                 daddr, reg, reg);
<a name="l00402"></a>00402 
<a name="l00403"></a>00403     pkt-&gt;<a class="code" href="classPacket.html#a79f71e6885712d4951e70eaba2e364cb">makeAtomicResponse</a>();
<a name="l00404"></a>00404     <span class="keywordflow">return</span> <a class="code" href="classPciDev.html#a8f5bebdc51249cfa29fe1f87a81d5fc1">pioDelay</a>;
<a name="l00405"></a>00405 }
<a name="l00406"></a>00406 
<a name="l00407"></a>00407 <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a>
<a name="l00408"></a><a class="code" href="classNSGigE.html#adb6022e4d9c9338543fc7d545bdd53df">00408</a> <a class="code" href="classNSGigE.html#adb6022e4d9c9338543fc7d545bdd53df" title="Pure virtual function that the device must implement.">NSGigE::write</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt)
<a name="l00409"></a>00409 {
<a name="l00410"></a>00410     assert(<a class="code" href="classNSGigE.html#a06cd8c902dcbd8093c38d803009db49d" title="pci settings">ioEnable</a>);
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> daddr = pkt-&gt;<a class="code" href="classPacket.html#a1c04785186ba5aa70a40cac9b2bfc86e">getAddr</a>() &amp; 0xfff;
<a name="l00413"></a>00413     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetPIO, <span class="stringliteral">&quot;write da=%#x pa=%#x size=%d\n&quot;</span>,
<a name="l00414"></a>00414             daddr, pkt-&gt;<a class="code" href="classPacket.html#a1c04785186ba5aa70a40cac9b2bfc86e">getAddr</a>(), pkt-&gt;<a class="code" href="classPacket.html#ad7c96bd8cd06acddebb3a373b37e6e59">getSize</a>());
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     <span class="keywordflow">if</span> (daddr &gt; <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a990cd45e93be2b4661f3499e0a658a33">LAST</a> &amp;&amp; daddr &lt;=  <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25afe4c21755babfece7188666f75c7386b">RESERVED</a>) {
<a name="l00417"></a>00417         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Accessing reserved register&quot;</span>);
<a name="l00418"></a>00418     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (daddr &gt; <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25afe4c21755babfece7188666f75c7386b">RESERVED</a> &amp;&amp; daddr &lt;= 0x3FC) {
<a name="l00419"></a>00419         <span class="keywordflow">return</span> <a class="code" href="classNSGigE.html#a4975eca99acf13a2c4ff5a2577e036ee" title="This is to write to the PCI general configuration registers.">writeConfig</a>(pkt);
<a name="l00420"></a>00420     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (daddr &gt; 0x3FC)
<a name="l00421"></a>00421         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Something is messed up!\n&quot;</span>);
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#ad7c96bd8cd06acddebb3a373b37e6e59">getSize</a>() == <span class="keyword">sizeof</span>(uint32_t)) {
<a name="l00424"></a>00424         <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="code" href="namespaceX86ISA.html#a6c9f38e48611db30642897e93a05104c">reg</a> = pkt-&gt;<a class="code" href="classPacket.html#a4fa1463610c7bda8c0b160b1457f1a52" title="return the value of what is pointed to in the packet.">get</a>&lt;<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&gt;();
<a name="l00425"></a>00425         uint16_t rfaddr;
<a name="l00426"></a>00426 
<a name="l00427"></a>00427         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetPIO, <span class="stringliteral">&quot;write data=%d data=%#x\n&quot;</span>, reg, reg);
<a name="l00428"></a>00428 
<a name="l00429"></a>00429         <span class="keywordflow">switch</span> (daddr) {
<a name="l00430"></a>00430           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25aaaa8401b50cb34e3a0d58729f70494f0">CR</a>:
<a name="l00431"></a>00431             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a9600015476b774b3442165cf61f29ad9">command</a> = reg;
<a name="l00432"></a>00432             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a25ab0edf42365ee5677703ae777f4424a7865b59ebf477ecc29df1f94c56f6af0">CR_TXD</a>) {
<a name="l00433"></a>00433                 <a class="code" href="classNSGigE.html#ac12794e1d7747b59b28f474813e42b6f">txEnable</a> = <span class="keyword">false</span>;
<a name="l00434"></a>00434             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a25ab0edf42365ee5677703ae777f4424afdbc5cf2720c477de510c16f905d8913">CR_TXE</a>) {
<a name="l00435"></a>00435                 <a class="code" href="classNSGigE.html#ac12794e1d7747b59b28f474813e42b6f">txEnable</a> = <span class="keyword">true</span>;
<a name="l00436"></a>00436 
<a name="l00437"></a>00437                 <span class="comment">// the kernel is enabling the transmit machine</span>
<a name="l00438"></a>00438                 <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#ab9b31ecee249b2c50ef0ce8de53a9f63">txState</a> == <a class="code" href="classNSGigE.html#a96770da20ac1781f03a08eaed5d8fdcda9fd2e93087d0af025f9d021a93a210f2">txIdle</a>)
<a name="l00439"></a>00439                     <a class="code" href="classNSGigE.html#ac37bda95e09a290e343ef80fc3fc9e2b">txKick</a>();
<a name="l00440"></a>00440             }
<a name="l00441"></a>00441 
<a name="l00442"></a>00442             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a25ab0edf42365ee5677703ae777f4424a18c9488d4b439d55d7f40b163952497a">CR_RXD</a>) {
<a name="l00443"></a>00443                 <a class="code" href="classNSGigE.html#abd3ee6dd80adc02a83aabb691332a92d">rxEnable</a> = <span class="keyword">false</span>;
<a name="l00444"></a>00444             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a25ab0edf42365ee5677703ae777f4424afdde959f3280c4e7c417c0f0bb94613c">CR_RXE</a>) {
<a name="l00445"></a>00445                 <a class="code" href="classNSGigE.html#abd3ee6dd80adc02a83aabb691332a92d">rxEnable</a> = <span class="keyword">true</span>;
<a name="l00446"></a>00446 
<a name="l00447"></a>00447                 <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a73d1c398c20206c6e6d40fface8f73f9" title="rx State Machine">rxState</a> == <a class="code" href="classNSGigE.html#ae525551f95b665ca94ab6ce5f0f48510ad0df408ad7d99a35ce4ada84fde1a41d">rxIdle</a>)
<a name="l00448"></a>00448                     <a class="code" href="classNSGigE.html#aec2097dcddfbd9263ce8cfd2fd11c474">rxKick</a>();
<a name="l00449"></a>00449             }
<a name="l00450"></a>00450 
<a name="l00451"></a>00451             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a25ab0edf42365ee5677703ae777f4424a010518531d8fadfb5bb43c75428cc40a">CR_TXR</a>)
<a name="l00452"></a>00452                 <a class="code" href="classNSGigE.html#a81093623dd1fdf472ff7962f3af15e9c">txReset</a>();
<a name="l00453"></a>00453 
<a name="l00454"></a>00454             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a25ab0edf42365ee5677703ae777f4424aff52f8c25b31e054c072496e390b1473">CR_RXR</a>)
<a name="l00455"></a>00455                 <a class="code" href="classNSGigE.html#a999252ab5187288af26bc45fed0ddb75">rxReset</a>();
<a name="l00456"></a>00456 
<a name="l00457"></a>00457             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a25ab0edf42365ee5677703ae777f4424a98e59be960621aa1395bd8c028db9509">CR_SWI</a>)
<a name="l00458"></a>00458                 <a class="code" href="classNSGigE.html#a6d9924c69c46eeb592083661da9012e6" title="Interrupt management.">devIntrPost</a>(<a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84aa623084274cad44265171c808ffabef0">ISR_SWI</a>);
<a name="l00459"></a>00459 
<a name="l00460"></a>00460             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a25ab0edf42365ee5677703ae777f4424af1dbbe349959b8269da4b1a1b15c87e8">CR_RST</a>) {
<a name="l00461"></a>00461                 <a class="code" href="classNSGigE.html#a81093623dd1fdf472ff7962f3af15e9c">txReset</a>();
<a name="l00462"></a>00462                 <a class="code" href="classNSGigE.html#a999252ab5187288af26bc45fed0ddb75">rxReset</a>();
<a name="l00463"></a>00463 
<a name="l00464"></a>00464                 <a class="code" href="classNSGigE.html#ad7aa4282dafb24f59ce1f608e32f405a">regsReset</a>();
<a name="l00465"></a>00465             }
<a name="l00466"></a>00466             <span class="keywordflow">break</span>;
<a name="l00467"></a>00467 
<a name="l00468"></a>00468           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25afbc4afeaffc324badfe21ddc14c90ed9">CFGR</a>:
<a name="l00469"></a>00469             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a2c097cab9c0e3dfc136f26df78c461f2">CFGR_LNKSTS</a> ||
<a name="l00470"></a>00470                 reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a6c134f8e1f0d99f37db1ac92376182d9">CFGR_SPDSTS</a> ||
<a name="l00471"></a>00471                 reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a77bb0d70bfd1c65e0e3d14a752e3cb11">CFGR_DUPSTS</a> ||
<a name="l00472"></a>00472                 reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a8927845a42276dba173d4cba25857119">CFGR_RESERVED</a> ||
<a name="l00473"></a>00473                 reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5ae793b5893608d22f2205c2dd24187d1f">CFGR_T64ADDR</a> ||
<a name="l00474"></a>00474                 reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5aca62e17b7e3234b46a7dfb64c11e8499">CFGR_PCI64_DET</a>) {
<a name="l00475"></a>00475                 <span class="comment">// First clear all writable bits</span>
<a name="l00476"></a>00476                 <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a7b90dafdbf78c3094e26e3b445a45118">config</a> &amp;= <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a2c097cab9c0e3dfc136f26df78c461f2">CFGR_LNKSTS</a> | <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a6c134f8e1f0d99f37db1ac92376182d9">CFGR_SPDSTS</a> | <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a77bb0d70bfd1c65e0e3d14a752e3cb11">CFGR_DUPSTS</a> |
<a name="l00477"></a>00477                     <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a8927845a42276dba173d4cba25857119">CFGR_RESERVED</a> | <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5ae793b5893608d22f2205c2dd24187d1f">CFGR_T64ADDR</a> |
<a name="l00478"></a>00478                     CFGR_PCI64_DET;
<a name="l00479"></a>00479                 <span class="comment">// Now set the appropriate writable bits</span>
<a name="l00480"></a>00480                 <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a7b90dafdbf78c3094e26e3b445a45118">config</a> |= reg &amp; ~(<a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a2c097cab9c0e3dfc136f26df78c461f2">CFGR_LNKSTS</a> | <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a6c134f8e1f0d99f37db1ac92376182d9">CFGR_SPDSTS</a> | <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a77bb0d70bfd1c65e0e3d14a752e3cb11">CFGR_DUPSTS</a> |
<a name="l00481"></a>00481                                        <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a8927845a42276dba173d4cba25857119">CFGR_RESERVED</a> | <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5ae793b5893608d22f2205c2dd24187d1f">CFGR_T64ADDR</a> |
<a name="l00482"></a>00482                                        CFGR_PCI64_DET);
<a name="l00483"></a>00483             }
<a name="l00484"></a>00484 
<a name="l00485"></a>00485 <span class="comment">// all these #if 0&#39;s are because i don&#39;t THINK the kernel needs to</span>
<a name="l00486"></a>00486 <span class="comment">// have these implemented. if there is a problem relating to one of</span>
<a name="l00487"></a>00487 <span class="comment">// these, you may need to add functionality in.</span>
<a name="l00488"></a>00488 
<a name="l00489"></a>00489 <span class="comment">// grouped together and #if 0&#39;ed to avoid empty if body and make clang happy</span>
<a name="l00490"></a>00490 <span class="preprocessor">#if 0</span>
<a name="l00491"></a>00491 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a4e9c3be1a013e53614a66ce824e06a5f">CFGR_TBI_EN</a>) ;
<a name="l00492"></a>00492             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a8cd201d1d6d7215d74b0aedc19077ed8">CFGR_MODE_1000</a>) ;
<a name="l00493"></a>00493 
<a name="l00494"></a>00494             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5ae0cc2becab93507bf494fa1da57be3ab">CFGR_PINT_DUPSTS</a> ||
<a name="l00495"></a>00495                 reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5adce295ce7a52c84d296205b29a3789ac">CFGR_PINT_LNKSTS</a> ||
<a name="l00496"></a>00496                 reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a3529064194143dc06f99fd2b038702ef">CFGR_PINT_SPDSTS</a>)
<a name="l00497"></a>00497                 ;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a0c4d3d4154997134a16dbd289c76dd20">CFGR_TMRTEST</a>) ;
<a name="l00500"></a>00500             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5ab43ce5c6c5455d219544d81536fda879">CFGR_MRM_DIS</a>) ;
<a name="l00501"></a>00501             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5aefb0d6b42cd6eb4d921350dc08e36813">CFGR_MWI_DIS</a>) ;
<a name="l00502"></a>00502 
<a name="l00503"></a>00503             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a483d4f2b4a6956a99e2f976e78f8482e">CFGR_DATA64_EN</a>) ;
<a name="l00504"></a>00504             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a7bf5a5a54dab741cd91dcfcba6d6c46f">CFGR_M64ADDR</a>) ;
<a name="l00505"></a>00505             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a5a492a4d3fa182b292b42a6c0e010029">CFGR_PHY_RST</a>) ;
<a name="l00506"></a>00506             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a9b12ad065e82955cfd9be9167a050da0">CFGR_PHY_DIS</a>) ;
<a name="l00507"></a>00507 
<a name="l00508"></a>00508             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a722ee4333f93dbad56bee172718356a5">CFGR_REQALG</a>) ;
<a name="l00509"></a>00509             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5ae4767c1b3b2afdfdb218083a9d47ceca">CFGR_SB</a>) ;
<a name="l00510"></a>00510             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5afff6bd1d8d7ddcf74ac02397d794f71f">CFGR_POW</a>) ;
<a name="l00511"></a>00511             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5aa565f32ce96f8774befd38fb20ca35a9">CFGR_EXD</a>) ;
<a name="l00512"></a>00512             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a020d7024f760726c979400bc0de31719">CFGR_PESEL</a>) ;
<a name="l00513"></a>00513             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a645e4e39b2110cc6dd24f5a5dcef978a">CFGR_BROM_DIS</a>) ;
<a name="l00514"></a>00514             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a42184322d70535043bae1a6dd62281ef">CFGR_EXT_125</a>) ;
<a name="l00515"></a>00515             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a82bbbeb5e7e7dc75bcfea8bfad0f309e">CFGR_BEM</a>) ;
<a name="l00516"></a>00516 
<a name="l00517"></a>00517             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5ae793b5893608d22f2205c2dd24187d1f">CFGR_T64ADDR</a>) ;
<a name="l00518"></a>00518             <span class="comment">// panic(&quot;CFGR_T64ADDR is read only register!\n&quot;);</span>
<a name="l00519"></a>00519 <span class="preprocessor">#endif</span>
<a name="l00520"></a>00520 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a5125f83794011867e888eeab25e6f5ec">CFGR_AUTO_1000</a>)
<a name="l00521"></a>00521                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;CFGR_AUTO_1000 not implemented!\n&quot;</span>);
<a name="l00522"></a>00522 
<a name="l00523"></a>00523             <span class="keywordflow">if</span> (reg &amp; CFGR_PCI64_DET)
<a name="l00524"></a>00524                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;CFGR_PCI64_DET is read only register!\n&quot;</span>);
<a name="l00525"></a>00525 
<a name="l00526"></a>00526             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a3cc1d2063f93ab3ae08c58f38a7f6dc2">CFGR_EXTSTS_EN</a>)
<a name="l00527"></a>00527                 <a class="code" href="classNSGigE.html#af6f500f63b3d9787299aa4a4fcccb103">extstsEnable</a> = <span class="keyword">true</span>;
<a name="l00528"></a>00528             <span class="keywordflow">else</span>
<a name="l00529"></a>00529                 <a class="code" href="classNSGigE.html#af6f500f63b3d9787299aa4a4fcccb103">extstsEnable</a> = <span class="keyword">false</span>;
<a name="l00530"></a>00530             <span class="keywordflow">break</span>;
<a name="l00531"></a>00531 
<a name="l00532"></a>00532           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a113d9a63f26f07777cd9a0967f1836d8">MEAR</a>:
<a name="l00533"></a>00533             <span class="comment">// Clear writable bits</span>
<a name="l00534"></a>00534             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49e054c501a5a1f8d1fa342999a6c4e8">mear</a> &amp;= MEAR_EEDO;
<a name="l00535"></a>00535             <span class="comment">// Set appropriate writable bits</span>
<a name="l00536"></a>00536             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49e054c501a5a1f8d1fa342999a6c4e8">mear</a> |= reg &amp; ~MEAR_EEDO;
<a name="l00537"></a>00537 
<a name="l00538"></a>00538             <span class="comment">// FreeBSD uses the EEPROM to read PMATCH (for the MAC address)</span>
<a name="l00539"></a>00539             <span class="comment">// even though it could get it through RFDR</span>
<a name="l00540"></a>00540             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a09f9907a9a0297b5b40995a25b5f1daea52302a3e5254d260f41ef2466dbaa4b3">MEAR_EESEL</a>) {
<a name="l00541"></a>00541                 <span class="comment">// Rising edge of clock</span>
<a name="l00542"></a>00542                 <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a09f9907a9a0297b5b40995a25b5f1daea53ab3ea09db3a47e13a2f8310985ad9a">MEAR_EECLK</a> &amp;&amp; !<a class="code" href="classNSGigE.html#ac1aa342b2168049136febe69fdb7dae0">eepromClk</a>)
<a name="l00543"></a>00543                     <a class="code" href="classNSGigE.html#afc5f2bab586db986f68ed1cab571d6d3" title="Advance the EEPROM state machine Called on rising edge of EEPROM clock bit in MEAR.">eepromKick</a>();
<a name="l00544"></a>00544             }
<a name="l00545"></a>00545             <span class="keywordflow">else</span> {
<a name="l00546"></a>00546                 <a class="code" href="classNSGigE.html#a2ba8f255a9f234fb035d7ecab71fbd5b" title="EEPROM State Machine.">eepromState</a> = eepromStart;
<a name="l00547"></a>00547                 <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49e054c501a5a1f8d1fa342999a6c4e8">mear</a> &amp;= ~MEAR_EEDI;
<a name="l00548"></a>00548             }
<a name="l00549"></a>00549 
<a name="l00550"></a>00550             <a class="code" href="classNSGigE.html#ac1aa342b2168049136febe69fdb7dae0">eepromClk</a> = reg &amp; MEAR_EECLK;
<a name="l00551"></a>00551 
<a name="l00552"></a>00552             <span class="comment">// since phy is completely faked, MEAR_MD* don&#39;t matter</span>
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 <span class="comment">// grouped together and #if 0&#39;ed to avoid empty if body and make clang happy</span>
<a name="l00555"></a>00555 <span class="preprocessor">#if 0</span>
<a name="l00556"></a>00556 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a09f9907a9a0297b5b40995a25b5f1daea0286d10dfd97d4d3d90e06dbd6eb7733">MEAR_MDIO</a>) ;
<a name="l00557"></a>00557             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a09f9907a9a0297b5b40995a25b5f1daea617c3c375b456b4dfef24df682dacf12">MEAR_MDDIR</a>) ;
<a name="l00558"></a>00558             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a09f9907a9a0297b5b40995a25b5f1daeaebd92cb5ae2f37b6aeaa31e727b94564">MEAR_MDC</a>) ;
<a name="l00559"></a>00559 <span class="preprocessor">#endif</span>
<a name="l00560"></a>00560 <span class="preprocessor"></span>            <span class="keywordflow">break</span>;
<a name="l00561"></a>00561 
<a name="l00562"></a>00562           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a3f3b76dd337d3d696768fef36d7a314c">PTSCR</a>:
<a name="l00563"></a>00563             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a32d4c8c44c00b5b1d6fc66568f24fee0">ptscr</a> = reg &amp; ~(PTSCR_RBIST_RDONLY);
<a name="l00564"></a>00564             <span class="comment">// these control BISTs for various parts of chip - we</span>
<a name="l00565"></a>00565             <span class="comment">// don&#39;t care or do just fake that the BIST is done</span>
<a name="l00566"></a>00566             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a434546233cb3f790d47548f7d2f716dfad92bfb1a1fe11ca0dccc8e2f34b4f171">PTSCR_RBIST_EN</a>)
<a name="l00567"></a>00567                 <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a32d4c8c44c00b5b1d6fc66568f24fee0">ptscr</a> |= PTSCR_RBIST_DONE;
<a name="l00568"></a>00568             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a434546233cb3f790d47548f7d2f716dfa91bdb632a939a9f0a60c5199a698c046">PTSCR_EEBIST_EN</a>)
<a name="l00569"></a>00569                 <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a32d4c8c44c00b5b1d6fc66568f24fee0">ptscr</a> &amp;= ~PTSCR_EEBIST_EN;
<a name="l00570"></a>00570             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a434546233cb3f790d47548f7d2f716dfaf24a81bc50f9b8cd7a25ac4e7f2b8b1c">PTSCR_EELOAD_EN</a>)
<a name="l00571"></a>00571                 <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a32d4c8c44c00b5b1d6fc66568f24fee0">ptscr</a> &amp;= ~PTSCR_EELOAD_EN;
<a name="l00572"></a>00572             <span class="keywordflow">break</span>;
<a name="l00573"></a>00573 
<a name="l00574"></a>00574           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25aca31e5168f5b741f9e55de5628d9f2f3">ISR</a>: <span class="comment">/* writing to the ISR has no effect */</span>
<a name="l00575"></a>00575             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;ISR is a read only register!\n&quot;</span>);
<a name="l00576"></a>00576 
<a name="l00577"></a>00577           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a7c1d11a9bbf54a9ff9af0ad29823bd73">IMR</a>:
<a name="l00578"></a>00578             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a> = reg;
<a name="l00579"></a>00579             <a class="code" href="classNSGigE.html#a1f47df98a6a70cf62ac53e80c488d7b2">devIntrChangeMask</a>();
<a name="l00580"></a>00580             <span class="keywordflow">break</span>;
<a name="l00581"></a>00581 
<a name="l00582"></a>00582           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25aa4fe81a2a70fb56b8e15785301bc7eb2">IER</a>:
<a name="l00583"></a>00583             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#af82b628490afa00a40d0296a35f8ca80">ier</a> = reg;
<a name="l00584"></a>00584             <span class="keywordflow">break</span>;
<a name="l00585"></a>00585 
<a name="l00586"></a>00586           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a804313d150167dbc33984588f5c6a524">IHR</a>:
<a name="l00587"></a>00587             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2c267f1982b8c6826b03fe00f7631397">ihr</a> = reg;
<a name="l00588"></a>00588             <span class="comment">/* not going to implement real interrupt holdoff */</span>
<a name="l00589"></a>00589             <span class="keywordflow">break</span>;
<a name="l00590"></a>00590 
<a name="l00591"></a>00591           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a804db1164d59b54529c77038834527c0">TXDP</a>:
<a name="l00592"></a>00592             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acff64aa194acd44f476d4a1f741203e1">txdp</a> = (reg &amp; 0xFFFFFFFC);
<a name="l00593"></a>00593             assert(<a class="code" href="classNSGigE.html#ab9b31ecee249b2c50ef0ce8de53a9f63">txState</a> == <a class="code" href="classNSGigE.html#a96770da20ac1781f03a08eaed5d8fdcda9fd2e93087d0af025f9d021a93a210f2">txIdle</a>);
<a name="l00594"></a>00594             <a class="code" href="classNSGigE.html#a42daaa387f54470e251759d4f42aed8a" title="Current Transmit Descriptor Done.">CTDD</a> = <span class="keyword">false</span>;
<a name="l00595"></a>00595             <span class="keywordflow">break</span>;
<a name="l00596"></a>00596 
<a name="l00597"></a>00597           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a03d8e070806a5d36573ed6c5fba0a715">TXDP_HI</a>:
<a name="l00598"></a>00598             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#ae4b6bf5e002d832cbb70312510f7d537">txdp_hi</a> = reg;
<a name="l00599"></a>00599             <span class="keywordflow">break</span>;
<a name="l00600"></a>00600 
<a name="l00601"></a>00601           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25afd8c7078b386b6059654aeb6b1a94732">TX_CFG</a>:
<a name="l00602"></a>00602             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acf32d2fcfab30be47767f1531f75a2cc">txcfg</a> = reg;
<a name="l00603"></a>00603 <span class="preprocessor">#if 0</span>
<a name="l00604"></a>00604 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#aa29e9c23be4c8e4640d96acdceb79148a12c9aae0a9f69e0caa78fdaf39cc722c">TX_CFG_CSI</a>) ;
<a name="l00605"></a>00605             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#aa29e9c23be4c8e4640d96acdceb79148a4402a39bc4dcc857da60c8a0246b3bfa">TX_CFG_HBI</a>) ;
<a name="l00606"></a>00606             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#aa29e9c23be4c8e4640d96acdceb79148a4e530551d5970f338789952c23c76408">TX_CFG_MLB</a>) ;
<a name="l00607"></a>00607             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#aa29e9c23be4c8e4640d96acdceb79148a697c4c4ae96ff96d0960d7180bd22e04">TX_CFG_ATP</a>) ;
<a name="l00608"></a>00608             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#aa29e9c23be4c8e4640d96acdceb79148a71d542018297daf1297878750c7cd3fb">TX_CFG_ECRETRY</a>) {
<a name="l00609"></a>00609                 <span class="comment">/*</span>
<a name="l00610"></a>00610 <span class="comment">                 * this could easily be implemented, but considering</span>
<a name="l00611"></a>00611 <span class="comment">                 * the network is just a fake pipe, wouldn&#39;t make</span>
<a name="l00612"></a>00612 <span class="comment">                 * sense to do this</span>
<a name="l00613"></a>00613 <span class="comment">                 */</span>
<a name="l00614"></a>00614             }
<a name="l00615"></a>00615 
<a name="l00616"></a>00616             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#aa29e9c23be4c8e4640d96acdceb79148a6a22f2e0a083dbfb069ec45366532d26">TX_CFG_BRST_DIS</a>) ;
<a name="l00617"></a>00617 <span class="preprocessor">#endif</span>
<a name="l00618"></a>00618 <span class="preprocessor"></span>
<a name="l00619"></a>00619 <span class="preprocessor">#if 0</span>
<a name="l00620"></a>00620 <span class="preprocessor"></span>            <span class="comment">/* we handle our own DMA, ignore the kernel&#39;s exhortations */</span>
<a name="l00621"></a>00621             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#aa29e9c23be4c8e4640d96acdceb79148a9da6602ef5ae2f34801e6028b52d5a4a">TX_CFG_MXDMA</a>) ;
<a name="l00622"></a>00622 <span class="preprocessor">#endif</span>
<a name="l00623"></a>00623 <span class="preprocessor"></span>
<a name="l00624"></a>00624             <span class="comment">// also, we currently don&#39;t care about fill/drain</span>
<a name="l00625"></a>00625             <span class="comment">// thresholds though this may change in the future with</span>
<a name="l00626"></a>00626             <span class="comment">// more realistic networks or a driver which changes it</span>
<a name="l00627"></a>00627             <span class="comment">// according to feedback</span>
<a name="l00628"></a>00628 
<a name="l00629"></a>00629             <span class="keywordflow">break</span>;
<a name="l00630"></a>00630 
<a name="l00631"></a>00631           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25ac890250653bf0f2642da0efba7b5c776">GPIOR</a>:
<a name="l00632"></a>00632             <span class="comment">// Only write writable bits</span>
<a name="l00633"></a>00633             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49fbb19ec37ec570701899609ae22cd6">gpior</a> &amp;= <a class="code" href="ns__gige__reg_8h.html#a0c3b46ea9c4502eb0be83f4825ffda36a24f9c7b9f33977c2eb47d6909b70c228">GPIOR_UNUSED</a> | <a class="code" href="ns__gige__reg_8h.html#a0c3b46ea9c4502eb0be83f4825ffda36a4ee7bfc2e2d6ca496e4696bd7c80d29b">GPIOR_GP5_IN</a> | <a class="code" href="ns__gige__reg_8h.html#a0c3b46ea9c4502eb0be83f4825ffda36af1a21c5447ec6628976e6008197f6d65">GPIOR_GP4_IN</a>
<a name="l00634"></a>00634                         | <a class="code" href="ns__gige__reg_8h.html#a0c3b46ea9c4502eb0be83f4825ffda36aa5c06f3d58547b8fb57439dffaf87fd7">GPIOR_GP3_IN</a> | <a class="code" href="ns__gige__reg_8h.html#a0c3b46ea9c4502eb0be83f4825ffda36a2928d6ead5a319bce0b12c410c5bd7a1">GPIOR_GP2_IN</a> | GPIOR_GP1_IN;
<a name="l00635"></a>00635             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49fbb19ec37ec570701899609ae22cd6">gpior</a> |= reg &amp; ~(<a class="code" href="ns__gige__reg_8h.html#a0c3b46ea9c4502eb0be83f4825ffda36a24f9c7b9f33977c2eb47d6909b70c228">GPIOR_UNUSED</a> | <a class="code" href="ns__gige__reg_8h.html#a0c3b46ea9c4502eb0be83f4825ffda36a4ee7bfc2e2d6ca496e4696bd7c80d29b">GPIOR_GP5_IN</a> | <a class="code" href="ns__gige__reg_8h.html#a0c3b46ea9c4502eb0be83f4825ffda36af1a21c5447ec6628976e6008197f6d65">GPIOR_GP4_IN</a>
<a name="l00636"></a>00636                                 | <a class="code" href="ns__gige__reg_8h.html#a0c3b46ea9c4502eb0be83f4825ffda36aa5c06f3d58547b8fb57439dffaf87fd7">GPIOR_GP3_IN</a> | <a class="code" href="ns__gige__reg_8h.html#a0c3b46ea9c4502eb0be83f4825ffda36a2928d6ead5a319bce0b12c410c5bd7a1">GPIOR_GP2_IN</a> | GPIOR_GP1_IN);
<a name="l00637"></a>00637             <span class="comment">/* these just control general purpose i/o pins, don&#39;t matter */</span>
<a name="l00638"></a>00638             <span class="keywordflow">break</span>;
<a name="l00639"></a>00639 
<a name="l00640"></a>00640           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a242a3cfc4e3678d4660b4b317cdf2703">RXDP</a>:
<a name="l00641"></a>00641             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2174f997477d58985b12c3a059d38bf8">rxdp</a> = reg;
<a name="l00642"></a>00642             <a class="code" href="classNSGigE.html#a47964f2eddd257dd82a72a49e07e2952" title="Current Receive Descriptor Done.">CRDD</a> = <span class="keyword">false</span>;
<a name="l00643"></a>00643             <span class="keywordflow">break</span>;
<a name="l00644"></a>00644 
<a name="l00645"></a>00645           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25ac096320cf3d114b30588fba0afae14f9">RXDP_HI</a>:
<a name="l00646"></a>00646             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a5c2e9f02a7b391d4e117630478ad11b9">rxdp_hi</a> = reg;
<a name="l00647"></a>00647             <span class="keywordflow">break</span>;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a5c49af0c1afdec035bdffc03803e9b78">RX_CFG</a>:
<a name="l00650"></a>00650             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a725ebce5e39e17777f38adc25d8c71f5">rxcfg</a> = reg;
<a name="l00651"></a>00651 <span class="preprocessor">#if 0</span>
<a name="l00652"></a>00652 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a7d6b989086a84ceb35e5af4bc8fcc889a60b5df11fe07ebbfd3381ca2db78de03">RX_CFG_AEP</a>) ;
<a name="l00653"></a>00653             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a7d6b989086a84ceb35e5af4bc8fcc889a91d81096e9a7df86363a4012a6716f07">RX_CFG_ARP</a>) ;
<a name="l00654"></a>00654             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a7d6b989086a84ceb35e5af4bc8fcc889ae1235d4bb557f18e9eb66724dce26090">RX_CFG_STRIPCRC</a>) ;
<a name="l00655"></a>00655             <span class="keywordflow">if</span> (reg &amp; RX_CFG_RX_RD) ;
<a name="l00656"></a>00656             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a7d6b989086a84ceb35e5af4bc8fcc889ac705d9d684bc3084cacffd768aa4f438">RX_CFG_ALP</a>) ;
<a name="l00657"></a>00657             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a7d6b989086a84ceb35e5af4bc8fcc889a44111112ca319693905230e67368b73c">RX_CFG_AIRL</a>) ;
<a name="l00658"></a>00658 
<a name="l00659"></a>00659             <span class="comment">/* we handle our own DMA, ignore what kernel says about it */</span>
<a name="l00660"></a>00660             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a7d6b989086a84ceb35e5af4bc8fcc889a43f8cbdba455892324cfcb112908e806">RX_CFG_MXDMA</a>) ;
<a name="l00661"></a>00661 
<a name="l00662"></a>00662             <span class="comment">//also, we currently don&#39;t care about fill/drain thresholds</span>
<a name="l00663"></a>00663             <span class="comment">//though this may change in the future with more realistic</span>
<a name="l00664"></a>00664             <span class="comment">//networks or a driver which changes it according to feedback</span>
<a name="l00665"></a>00665             <span class="keywordflow">if</span> (reg &amp; (<a class="code" href="ns__gige__reg_8h.html#a7d6b989086a84ceb35e5af4bc8fcc889a6a612bf4c4e31b91c0d01a1b32ca5b46">RX_CFG_DRTH</a> | <a class="code" href="ns__gige__reg_8h.html#a7d6b989086a84ceb35e5af4bc8fcc889af8c195be5803c9440291f517e55e9ab3">RX_CFG_DRTH0</a>)) ;
<a name="l00666"></a>00666 <span class="preprocessor">#endif</span>
<a name="l00667"></a>00667 <span class="preprocessor"></span>            <span class="keywordflow">break</span>;
<a name="l00668"></a>00668 
<a name="l00669"></a>00669           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a7088a56d79f18acc7bd868e2b822d3d9">PQCR</a>:
<a name="l00670"></a>00670             <span class="comment">/* there is no priority queueing used in the linux 2.6 driver */</span>
<a name="l00671"></a>00671             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2041e1c015742a4bd93e1160b2a995a2">pqcr</a> = reg;
<a name="l00672"></a>00672             <span class="keywordflow">break</span>;
<a name="l00673"></a>00673 
<a name="l00674"></a>00674           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a4c9b532dc4d3aa5f4375e70f61f09b88">WCSR</a>:
<a name="l00675"></a>00675             <span class="comment">/* not going to implement wake on LAN */</span>
<a name="l00676"></a>00676             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a7cca9c6177ccc42f5f38b91e19f4df38">wcsr</a> = reg;
<a name="l00677"></a>00677             <span class="keywordflow">break</span>;
<a name="l00678"></a>00678 
<a name="l00679"></a>00679           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25aada5ac22f141879a3be1813e49d21057">PCR</a>:
<a name="l00680"></a>00680             <span class="comment">/* not going to implement pause control */</span>
<a name="l00681"></a>00681             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a956e3bb62b522823287435d048a75059">pcr</a> = reg;
<a name="l00682"></a>00682             <span class="keywordflow">break</span>;
<a name="l00683"></a>00683 
<a name="l00684"></a>00684           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a9d527b6a73b509500c2ce768b7153377">RFCR</a>:
<a name="l00685"></a>00685             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a525ccc417f2173ef149f5e84cc8dbe61">rfcr</a> = reg;
<a name="l00686"></a>00686 
<a name="l00687"></a>00687             <a class="code" href="classNSGigE.html#af13268cbb1795582c363a211ff17a604" title="receive address filter">rxFilterEnable</a> = (reg &amp; RFCR_RFEN) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00688"></a>00688             <a class="code" href="classNSGigE.html#afe19d30d3ec62ef1a129e5ecd5e8ea1e">acceptBroadcast</a> = (reg &amp; RFCR_AAB) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00689"></a>00689             <a class="code" href="classNSGigE.html#a3d4914b10c5606a632c550251ef3079b">acceptMulticast</a> = (reg &amp; RFCR_AAM) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00690"></a>00690             <a class="code" href="classNSGigE.html#a402a74038f39b5a1551dfd137e9876d5">acceptUnicast</a> = (reg &amp; RFCR_AAU) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00691"></a>00691             <a class="code" href="classNSGigE.html#acc0f2bddaadb14d655d6f6e33a85b077">acceptPerfect</a> = (reg &amp; RFCR_APM) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00692"></a>00692             <a class="code" href="classNSGigE.html#a0097dd413d75e23e9b2c24d5b9b86657">acceptArp</a> = (reg &amp; RFCR_AARP) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00693"></a>00693             <a class="code" href="classNSGigE.html#a1d87be28edf16677e019a3015fed059e">multicastHashEnable</a> = (reg &amp; RFCR_MHEN) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00694"></a>00694 
<a name="l00695"></a>00695 <span class="preprocessor">#if 0</span>
<a name="l00696"></a>00696 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a710fe9a2d6d1f5c41f43cc9c36029b4ba4848e12ad4e97068c4676149dbf69feb">RFCR_APAT</a>)
<a name="l00697"></a>00697                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;RFCR_APAT not implemented!\n&quot;</span>);
<a name="l00698"></a>00698 <span class="preprocessor">#endif</span>
<a name="l00699"></a>00699 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a710fe9a2d6d1f5c41f43cc9c36029b4ba48cb48f919b9242a4d722e4285f92f49">RFCR_UHEN</a>)
<a name="l00700"></a>00700                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unicast hash filtering not used by drivers!\n&quot;</span>);
<a name="l00701"></a>00701 
<a name="l00702"></a>00702             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#a710fe9a2d6d1f5c41f43cc9c36029b4bad4f1981e5cbcc21f83e16c129a11168c">RFCR_ULM</a>)
<a name="l00703"></a>00703                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;RFCR_ULM not implemented!\n&quot;</span>);
<a name="l00704"></a>00704 
<a name="l00705"></a>00705             <span class="keywordflow">break</span>;
<a name="l00706"></a>00706 
<a name="l00707"></a>00707           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25afb024013e0dd4ef200b16e7ddf4feb3e">RFDR</a>:
<a name="l00708"></a>00708             rfaddr = (uint16_t)(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a525ccc417f2173ef149f5e84cc8dbe61">rfcr</a> &amp; <a class="code" href="ns__gige__reg_8h.html#a710fe9a2d6d1f5c41f43cc9c36029b4ba7294173f5e92483088029ba48a6f1db1">RFCR_RFADDR</a>);
<a name="l00709"></a>00709             <span class="keywordflow">switch</span> (rfaddr) {
<a name="l00710"></a>00710               <span class="keywordflow">case</span> 0x000:
<a name="l00711"></a>00711                 <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[0] = (uint8_t)reg;
<a name="l00712"></a>00712                 <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[1] = (uint8_t)(reg &gt;&gt; 8);
<a name="l00713"></a>00713                 <span class="keywordflow">break</span>;
<a name="l00714"></a>00714               <span class="keywordflow">case</span> 0x002:
<a name="l00715"></a>00715                 <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[2] = (uint8_t)reg;
<a name="l00716"></a>00716                 <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[3] = (uint8_t)(reg &gt;&gt; 8);
<a name="l00717"></a>00717                 <span class="keywordflow">break</span>;
<a name="l00718"></a>00718               <span class="keywordflow">case</span> 0x004:
<a name="l00719"></a>00719                 <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[4] = (uint8_t)reg;
<a name="l00720"></a>00720                 <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[5] = (uint8_t)(reg &gt;&gt; 8);
<a name="l00721"></a>00721                 <span class="keywordflow">break</span>;
<a name="l00722"></a>00722               <span class="keywordflow">default</span>:
<a name="l00723"></a>00723 
<a name="l00724"></a>00724                 <span class="keywordflow">if</span> (rfaddr &gt;= <a class="code" href="ns__gige_8hh.html#a351fddd1359b79f333a7680e36221a73">FHASH_ADDR</a> &amp;&amp;
<a name="l00725"></a>00725                     rfaddr &lt; <a class="code" href="ns__gige_8hh.html#a351fddd1359b79f333a7680e36221a73">FHASH_ADDR</a> + <a class="code" href="ns__gige_8hh.html#a7d7c3db3667c7110b37292d81dc81362">FHASH_SIZE</a>) {
<a name="l00726"></a>00726 
<a name="l00727"></a>00727                     <span class="comment">// Only word-aligned writes supported</span>
<a name="l00728"></a>00728                     <span class="keywordflow">if</span> (rfaddr % 2)
<a name="l00729"></a>00729                         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;unaligned write to filter hash table!&quot;</span>);
<a name="l00730"></a>00730 
<a name="l00731"></a>00731                     <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#a260603c4f6a5b5f188f9c26bbf136bad" title="for hash table memory.">filterHash</a>[rfaddr - <a class="code" href="ns__gige_8hh.html#a351fddd1359b79f333a7680e36221a73">FHASH_ADDR</a>] = (uint8_t)reg;
<a name="l00732"></a>00732                     <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#a260603c4f6a5b5f188f9c26bbf136bad" title="for hash table memory.">filterHash</a>[rfaddr - <a class="code" href="ns__gige_8hh.html#a351fddd1359b79f333a7680e36221a73">FHASH_ADDR</a> + 1]
<a name="l00733"></a>00733                         = (uint8_t)(reg &gt;&gt; 8);
<a name="l00734"></a>00734                     <span class="keywordflow">break</span>;
<a name="l00735"></a>00735                 }
<a name="l00736"></a>00736                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;writing RFDR for something other than pattern matching\</span>
<a name="l00737"></a>00737 <span class="stringliteral">                    or hashing! %#x\n&quot;</span>, rfaddr);
<a name="l00738"></a>00738             }
<a name="l00739"></a>00739 
<a name="l00740"></a>00740           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25addff2e2ebbc506254a21a22bb53ad679">BRAR</a>:
<a name="l00741"></a>00741             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#abef81a0ada42cd949d77552b57c58532">brar</a> = reg;
<a name="l00742"></a>00742             <span class="keywordflow">break</span>;
<a name="l00743"></a>00743 
<a name="l00744"></a>00744           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a194b396b6cbe688fa03021f7ea707091">BRDR</a>:
<a name="l00745"></a>00745             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;the driver never uses BRDR, something is wrong!\n&quot;</span>);
<a name="l00746"></a>00746 
<a name="l00747"></a>00747           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25ab32fd5480aa7a7431c84f82cdccb060c">SRR</a>:
<a name="l00748"></a>00748             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;SRR is read only register!\n&quot;</span>);
<a name="l00749"></a>00749 
<a name="l00750"></a>00750           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a8548fb064a7d49f83310e239b5799878">MIBC</a>:
<a name="l00751"></a>00751             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;the driver never uses MIBC, something is wrong!\n&quot;</span>);
<a name="l00752"></a>00752 
<a name="l00753"></a>00753           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a35581fe69a8e2ba505c419b78764aecd">VRCR</a>:
<a name="l00754"></a>00754             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#aac2bbec11b4590f8b2eb1583c147e2ee">vrcr</a> = reg;
<a name="l00755"></a>00755             <span class="keywordflow">break</span>;
<a name="l00756"></a>00756 
<a name="l00757"></a>00757           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a8d738fd8ff5fa4fd30aa1e9caa3e963f">VTCR</a>:
<a name="l00758"></a>00758             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#ad97af13deb1a5c24f449f538b0bf695d">vtcr</a> = reg;
<a name="l00759"></a>00759             <span class="keywordflow">break</span>;
<a name="l00760"></a>00760 
<a name="l00761"></a>00761           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a923bc9bcd837b0f18e3a636c26342151">VDR</a>:
<a name="l00762"></a>00762             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;the driver never uses VDR, something is wrong!\n&quot;</span>);
<a name="l00763"></a>00763 
<a name="l00764"></a>00764           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a1de6e2cccf66f9f8f986562fd3cdd705">CCSR</a>:
<a name="l00765"></a>00765             <span class="comment">/* not going to implement clockrun stuff */</span>
<a name="l00766"></a>00766             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#ae9c8447eb409d13a9d0e404caa921374">ccsr</a> = reg;
<a name="l00767"></a>00767             <span class="keywordflow">break</span>;
<a name="l00768"></a>00768 
<a name="l00769"></a>00769           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25afeaf59b9c0f634ea0e99d68d99047811">TBICR</a>:
<a name="l00770"></a>00770             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a9113118d642b41d2aad8c551514759af">tbicr</a> = reg;
<a name="l00771"></a>00771             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#acccce28eb20f178269a02d25f006472ba7e3490693ee5cd2f1d4c920a7bd715f7">TBICR_MR_LOOPBACK</a>)
<a name="l00772"></a>00772                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;TBICR_MR_LOOPBACK never used, something wrong!\n&quot;</span>);
<a name="l00773"></a>00773 
<a name="l00774"></a>00774             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#acccce28eb20f178269a02d25f006472baf320d426b83d51eb0b0925d338b11c1c">TBICR_MR_AN_ENABLE</a>) {
<a name="l00775"></a>00775                 <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a52c74bd6cb93b3bbc7f4a7c4ad66e60e">tanlpar</a> = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a639aecec1e7fed4b0cb5dbcfbcdbed56">tanar</a>;
<a name="l00776"></a>00776                 <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2eee77294a95ae2e2f5652c3abbf2922">tbisr</a> |= (<a class="code" href="ns__gige__reg_8h.html#a3f7bb47e4f02817553ec8edd6243ce53a7a9b036da5f51cd1bc5a6afc05dc5809">TBISR_MR_AN_COMPLETE</a> | TBISR_MR_LINK_STATUS);
<a name="l00777"></a>00777             }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779 <span class="preprocessor">#if 0</span>
<a name="l00780"></a>00780 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#acccce28eb20f178269a02d25f006472ba75aa0dcc71ce962cd49791f2117c4408">TBICR_MR_RESTART_AN</a>) ;
<a name="l00781"></a>00781 <span class="preprocessor">#endif</span>
<a name="l00782"></a>00782 <span class="preprocessor"></span>
<a name="l00783"></a>00783             <span class="keywordflow">break</span>;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25acc00a47300aa1d4018fcc431d259da66">TBISR</a>:
<a name="l00786"></a>00786             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;TBISR is read only register!\n&quot;</span>);
<a name="l00787"></a>00787 
<a name="l00788"></a>00788           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25ad7a6d7bd2635a5112142f663b862e0a5">TANAR</a>:
<a name="l00789"></a>00789             <span class="comment">// Only write the writable bits</span>
<a name="l00790"></a>00790             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a639aecec1e7fed4b0cb5dbcfbcdbed56">tanar</a> &amp;= <a class="code" href="ns__gige__reg_8h.html#ae226cce1495032c99ec8488694817405ae21cfacaa98d857ed4aad82cffa66291">TANAR_RF1</a> | <a class="code" href="ns__gige__reg_8h.html#ae226cce1495032c99ec8488694817405a4a4d1dc0f91cc7455b91af304c4f8e2e">TANAR_RF2</a> | TANAR_UNUSED;
<a name="l00791"></a>00791             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a639aecec1e7fed4b0cb5dbcfbcdbed56">tanar</a> |= reg &amp; ~(<a class="code" href="ns__gige__reg_8h.html#ae226cce1495032c99ec8488694817405ae21cfacaa98d857ed4aad82cffa66291">TANAR_RF1</a> | <a class="code" href="ns__gige__reg_8h.html#ae226cce1495032c99ec8488694817405a4a4d1dc0f91cc7455b91af304c4f8e2e">TANAR_RF2</a> | TANAR_UNUSED);
<a name="l00792"></a>00792 
<a name="l00793"></a>00793             <span class="comment">// Pause capability unimplemented</span>
<a name="l00794"></a>00794 <span class="preprocessor">#if 0</span>
<a name="l00795"></a>00795 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#ae226cce1495032c99ec8488694817405a9dda703a0d808b1185022d38db761178">TANAR_PS2</a>) ;
<a name="l00796"></a>00796             <span class="keywordflow">if</span> (reg &amp; <a class="code" href="ns__gige__reg_8h.html#ae226cce1495032c99ec8488694817405a26f0d6e700ba3a8a3f8a8734341e8cc8">TANAR_PS1</a>) ;
<a name="l00797"></a>00797 <span class="preprocessor">#endif</span>
<a name="l00798"></a>00798 <span class="preprocessor"></span>
<a name="l00799"></a>00799             <span class="keywordflow">break</span>;
<a name="l00800"></a>00800 
<a name="l00801"></a>00801           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25a072e6a9a8270dbf30f7ed55fbd09f596">TANLPAR</a>:
<a name="l00802"></a>00802             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;this should only be written to by the fake phy!\n&quot;</span>);
<a name="l00803"></a>00803 
<a name="l00804"></a>00804           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25ada853e9785cabacd24a852b2a641d0e1">TANER</a>:
<a name="l00805"></a>00805             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;TANER is read only register!\n&quot;</span>);
<a name="l00806"></a>00806 
<a name="l00807"></a>00807           <span class="keywordflow">case</span> <a class="code" href="ns__gige__reg_8h.html#af9b2bc35443700665f9aad2ff1b86d25ab7b4bbff0e7e615f1a5a579d630f71b9">TESR</a>:
<a name="l00808"></a>00808             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a73c04ab08a0f39d76d90dd9f60464b6f">tesr</a> = reg;
<a name="l00809"></a>00809             <span class="keywordflow">break</span>;
<a name="l00810"></a>00810 
<a name="l00811"></a>00811           <span class="keywordflow">default</span>:
<a name="l00812"></a>00812             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;invalid register access daddr=%#x&quot;</span>, daddr);
<a name="l00813"></a>00813         }
<a name="l00814"></a>00814     } <span class="keywordflow">else</span> {
<a name="l00815"></a>00815         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Invalid Request Size&quot;</span>);
<a name="l00816"></a>00816     }
<a name="l00817"></a>00817     pkt-&gt;<a class="code" href="classPacket.html#a79f71e6885712d4951e70eaba2e364cb">makeAtomicResponse</a>();
<a name="l00818"></a>00818     <span class="keywordflow">return</span> <a class="code" href="classPciDev.html#a8f5bebdc51249cfa29fe1f87a81d5fc1">pioDelay</a>;
<a name="l00819"></a>00819 }
<a name="l00820"></a>00820 
<a name="l00821"></a>00821 <span class="keywordtype">void</span>
<a name="l00822"></a><a class="code" href="classNSGigE.html#a6d9924c69c46eeb592083661da9012e6">00822</a> <a class="code" href="classNSGigE.html#a6d9924c69c46eeb592083661da9012e6" title="Interrupt management.">NSGigE::devIntrPost</a>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> interrupts)
<a name="l00823"></a>00823 {
<a name="l00824"></a>00824     <span class="keywordflow">if</span> (interrupts &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84acc1b54cf2f6d3ae77f306953152cf961">ISR_RESERVE</a>)
<a name="l00825"></a>00825         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Cannot set a reserved interrupt&quot;</span>);
<a name="l00826"></a>00826 
<a name="l00827"></a>00827     <span class="keywordflow">if</span> (interrupts &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84ad3c3bf21b8d1feb05fa561bf99ec29e3">ISR_NOIMPL</a>)
<a name="l00828"></a>00828         <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;interrupt not implemented %#x\n&quot;</span>, interrupts);
<a name="l00829"></a>00829 
<a name="l00830"></a>00830     interrupts &amp;= ISR_IMPL;
<a name="l00831"></a>00831     <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a> |= interrupts;
<a name="l00832"></a>00832 
<a name="l00833"></a>00833     <span class="keywordflow">if</span> (interrupts &amp; <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a>) {
<a name="l00834"></a>00834         <span class="keywordflow">if</span> (interrupts &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84aa623084274cad44265171c808ffabef0">ISR_SWI</a>) {
<a name="l00835"></a>00835             <a class="code" href="classEtherDevice.html#ad73546703d5de6473ae834909a545307">totalSwi</a>++;
<a name="l00836"></a>00836         }
<a name="l00837"></a>00837         <span class="keywordflow">if</span> (interrupts &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84aeaba8ecba36bf0fbd0857553f317c5b9">ISR_RXIDLE</a>) {
<a name="l00838"></a>00838             <a class="code" href="classEtherDevice.html#af76536f26308515567f6f1b9e855adab">totalRxIdle</a>++;
<a name="l00839"></a>00839         }
<a name="l00840"></a>00840         <span class="keywordflow">if</span> (interrupts &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84a472df975b04a9e64a08a515466219dfa">ISR_RXOK</a>) {
<a name="l00841"></a>00841             <a class="code" href="classEtherDevice.html#ab768556d3169b6586c18dbcfa1f3f278">totalRxOk</a>++;
<a name="l00842"></a>00842         }
<a name="l00843"></a>00843         <span class="keywordflow">if</span> (interrupts &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84a09dc47cc47b8e6dcb88e4afb936130f5">ISR_RXDESC</a>) {
<a name="l00844"></a>00844             <a class="code" href="classEtherDevice.html#ac0539e44bd9fe5d2d25af1b8b6ff5e25">totalRxDesc</a>++;
<a name="l00845"></a>00845         }
<a name="l00846"></a>00846         <span class="keywordflow">if</span> (interrupts &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84a517d681f1339e3a103166dd37bd6e6bb">ISR_TXOK</a>) {
<a name="l00847"></a>00847             <a class="code" href="classEtherDevice.html#a75053b369db5b0ee5467e6c6502c8637">totalTxOk</a>++;
<a name="l00848"></a>00848         }
<a name="l00849"></a>00849         <span class="keywordflow">if</span> (interrupts &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84ae4a5db36871c2a3322b708854515dafe">ISR_TXIDLE</a>) {
<a name="l00850"></a>00850             <a class="code" href="classEtherDevice.html#aa0757ee7c57015982b27951af9017528">totalTxIdle</a>++;
<a name="l00851"></a>00851         }
<a name="l00852"></a>00852         <span class="keywordflow">if</span> (interrupts &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84ae1c46578010d906b4e30793d8a9f8bab">ISR_TXDESC</a>) {
<a name="l00853"></a>00853             <a class="code" href="classEtherDevice.html#a59e1d6034db8cbe6e9cbe32d99dbef7c">totalTxDesc</a>++;
<a name="l00854"></a>00854         }
<a name="l00855"></a>00855         <span class="keywordflow">if</span> (interrupts &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84a7a0ca7d152b841a977e536dfea2f74b8">ISR_RXORN</a>) {
<a name="l00856"></a>00856             <a class="code" href="classEtherDevice.html#a99ccf5219a1cdca80a5556f62be5056a">totalRxOrn</a>++;
<a name="l00857"></a>00857         }
<a name="l00858"></a>00858     }
<a name="l00859"></a>00859 
<a name="l00860"></a>00860     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetIntr,
<a name="l00861"></a>00861             <span class="stringliteral">&quot;interrupt written to ISR: intr=%#x isr=%#x imr=%#x\n&quot;</span>,
<a name="l00862"></a>00862             interrupts, <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a>, <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a>);
<a name="l00863"></a>00863 
<a name="l00864"></a>00864     <span class="keywordflow">if</span> ((<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a> &amp; <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a>)) {
<a name="l00865"></a>00865         <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> when = <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>();
<a name="l00866"></a>00866         <span class="keywordflow">if</span> ((<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a> &amp; <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a> &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84a4854dadc5f925840f3792bf995f5776b">ISR_NODELAY</a>) == 0)
<a name="l00867"></a>00867             when += <a class="code" href="classNSGigE.html#a5f2a19a453bfed050f8274f6b74e2471">intrDelay</a>;
<a name="l00868"></a>00868         <a class="code" href="classEtherDevice.html#adc5ceb75606c8211617f41562725beab">postedInterrupts</a>++;
<a name="l00869"></a>00869         <a class="code" href="classNSGigE.html#a16a963d4924b7c2e82d338d693abe4af">cpuIntrPost</a>(when);
<a name="l00870"></a>00870     }
<a name="l00871"></a>00871 }
<a name="l00872"></a>00872 
<a name="l00873"></a>00873 <span class="comment">/* writing this interrupt counting stats inside this means that this function</span>
<a name="l00874"></a>00874 <span class="comment">   is now limited to being used to clear all interrupts upon the kernel</span>
<a name="l00875"></a>00875 <span class="comment">   reading isr and servicing.  just telling you in case you were thinking</span>
<a name="l00876"></a>00876 <span class="comment">   of expanding use.</span>
<a name="l00877"></a>00877 <span class="comment">*/</span>
<a name="l00878"></a>00878 <span class="keywordtype">void</span>
<a name="l00879"></a><a class="code" href="classNSGigE.html#a08b5f97229e03bea98020c9a227e51ba">00879</a> <a class="code" href="classNSGigE.html#a08b5f97229e03bea98020c9a227e51ba">NSGigE::devIntrClear</a>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> interrupts)
<a name="l00880"></a>00880 {
<a name="l00881"></a>00881     <span class="keywordflow">if</span> (interrupts &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84acc1b54cf2f6d3ae77f306953152cf961">ISR_RESERVE</a>)
<a name="l00882"></a>00882         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Cannot clear a reserved interrupt&quot;</span>);
<a name="l00883"></a>00883 
<a name="l00884"></a>00884     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a> &amp; <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a> &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84aa623084274cad44265171c808ffabef0">ISR_SWI</a>) {
<a name="l00885"></a>00885         <a class="code" href="classEtherDevice.html#ab1c213f74a294d0ce6e208860641a3fe">postedSwi</a>++;
<a name="l00886"></a>00886     }
<a name="l00887"></a>00887     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a> &amp; <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a> &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84aeaba8ecba36bf0fbd0857553f317c5b9">ISR_RXIDLE</a>) {
<a name="l00888"></a>00888         <a class="code" href="classEtherDevice.html#a9d3d63a615fcac232f44dae25ba4ee03">postedRxIdle</a>++;
<a name="l00889"></a>00889     }
<a name="l00890"></a>00890     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a> &amp; <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a> &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84a472df975b04a9e64a08a515466219dfa">ISR_RXOK</a>) {
<a name="l00891"></a>00891         <a class="code" href="classEtherDevice.html#aa9508062e262656ec2980cd5a1ee32aa">postedRxOk</a>++;
<a name="l00892"></a>00892     }
<a name="l00893"></a>00893     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a> &amp; <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a> &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84a09dc47cc47b8e6dcb88e4afb936130f5">ISR_RXDESC</a>) {
<a name="l00894"></a>00894             <a class="code" href="classEtherDevice.html#a45a72dadad69d506e15442d284050436">postedRxDesc</a>++;
<a name="l00895"></a>00895     }
<a name="l00896"></a>00896     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a> &amp; <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a> &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84a517d681f1339e3a103166dd37bd6e6bb">ISR_TXOK</a>) {
<a name="l00897"></a>00897         <a class="code" href="classEtherDevice.html#ae87c754ca33e82882c8e34ded398ecea">postedTxOk</a>++;
<a name="l00898"></a>00898     }
<a name="l00899"></a>00899     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a> &amp; <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a> &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84ae4a5db36871c2a3322b708854515dafe">ISR_TXIDLE</a>) {
<a name="l00900"></a>00900         <a class="code" href="classEtherDevice.html#ada111121df75a454fc3c822601e1aece">postedTxIdle</a>++;
<a name="l00901"></a>00901     }
<a name="l00902"></a>00902     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a> &amp; <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a> &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84ae1c46578010d906b4e30793d8a9f8bab">ISR_TXDESC</a>) {
<a name="l00903"></a>00903         <a class="code" href="classEtherDevice.html#a15bd72a7ece7d785b6393a481554cf1f">postedTxDesc</a>++;
<a name="l00904"></a>00904     }
<a name="l00905"></a>00905     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a> &amp; <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a> &amp; <a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84a7a0ca7d152b841a977e536dfea2f74b8">ISR_RXORN</a>) {
<a name="l00906"></a>00906         <a class="code" href="classEtherDevice.html#aea2e9d47cd746d58e55a04bacdacae7c">postedRxOrn</a>++;
<a name="l00907"></a>00907     }
<a name="l00908"></a>00908 
<a name="l00909"></a>00909     interrupts &amp;= ~ISR_NOIMPL;
<a name="l00910"></a>00910     <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a> &amp;= ~interrupts;
<a name="l00911"></a>00911 
<a name="l00912"></a>00912     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetIntr,
<a name="l00913"></a>00913             <span class="stringliteral">&quot;interrupt cleared from ISR: intr=%x isr=%x imr=%x\n&quot;</span>,
<a name="l00914"></a>00914             interrupts, <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a>, <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a>);
<a name="l00915"></a>00915 
<a name="l00916"></a>00916     <span class="keywordflow">if</span> (!(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a> &amp; <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a>))
<a name="l00917"></a>00917         <a class="code" href="classNSGigE.html#ac0cdb19b23420aedb851f36d23dc0eb1">cpuIntrClear</a>();
<a name="l00918"></a>00918 }
<a name="l00919"></a>00919 
<a name="l00920"></a>00920 <span class="keywordtype">void</span>
<a name="l00921"></a><a class="code" href="classNSGigE.html#a1f47df98a6a70cf62ac53e80c488d7b2">00921</a> <a class="code" href="classNSGigE.html#a1f47df98a6a70cf62ac53e80c488d7b2">NSGigE::devIntrChangeMask</a>()
<a name="l00922"></a>00922 {
<a name="l00923"></a>00923     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetIntr, <span class="stringliteral">&quot;interrupt mask changed: isr=%x imr=%x masked=%x\n&quot;</span>,
<a name="l00924"></a>00924             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a>, <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a>, <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a> &amp; <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a>);
<a name="l00925"></a>00925 
<a name="l00926"></a>00926     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a> &amp; <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a>)
<a name="l00927"></a>00927         <a class="code" href="classNSGigE.html#a16a963d4924b7c2e82d338d693abe4af">cpuIntrPost</a>(<a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>());
<a name="l00928"></a>00928     <span class="keywordflow">else</span>
<a name="l00929"></a>00929         <a class="code" href="classNSGigE.html#ac0cdb19b23420aedb851f36d23dc0eb1">cpuIntrClear</a>();
<a name="l00930"></a>00930 }
<a name="l00931"></a>00931 
<a name="l00932"></a>00932 <span class="keywordtype">void</span>
<a name="l00933"></a><a class="code" href="classNSGigE.html#a16a963d4924b7c2e82d338d693abe4af">00933</a> <a class="code" href="classNSGigE.html#a16a963d4924b7c2e82d338d693abe4af">NSGigE::cpuIntrPost</a>(<a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> when)
<a name="l00934"></a>00934 {
<a name="l00935"></a>00935     <span class="comment">// If the interrupt you want to post is later than an interrupt</span>
<a name="l00936"></a>00936     <span class="comment">// already scheduled, just let it post in the coming one and don&#39;t</span>
<a name="l00937"></a>00937     <span class="comment">// schedule another.</span>
<a name="l00938"></a>00938     <span class="comment">// HOWEVER, must be sure that the scheduled intrTick is in the</span>
<a name="l00939"></a>00939     <span class="comment">// future (this was formerly the source of a bug)</span>
<a name="l00944"></a>00944 <span class="comment"></span>    assert(when &gt;= <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>());
<a name="l00945"></a>00945     assert(<a class="code" href="classNSGigE.html#a2929b39dcabc4b8384a72cb035dd307b">intrTick</a> &gt;= <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>() || <a class="code" href="classNSGigE.html#a2929b39dcabc4b8384a72cb035dd307b">intrTick</a> == 0);
<a name="l00946"></a>00946     <span class="keywordflow">if</span> (when &gt; <a class="code" href="classNSGigE.html#a2929b39dcabc4b8384a72cb035dd307b">intrTick</a> &amp;&amp; <a class="code" href="classNSGigE.html#a2929b39dcabc4b8384a72cb035dd307b">intrTick</a> != 0) {
<a name="l00947"></a>00947         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetIntr, <span class="stringliteral">&quot;don&#39;t need to schedule event...intrTick=%d\n&quot;</span>,
<a name="l00948"></a>00948                 <a class="code" href="classNSGigE.html#a2929b39dcabc4b8384a72cb035dd307b">intrTick</a>);
<a name="l00949"></a>00949         <span class="keywordflow">return</span>;
<a name="l00950"></a>00950     }
<a name="l00951"></a>00951 
<a name="l00952"></a>00952     <a class="code" href="classNSGigE.html#a2929b39dcabc4b8384a72cb035dd307b">intrTick</a> = when;
<a name="l00953"></a>00953     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a2929b39dcabc4b8384a72cb035dd307b">intrTick</a> &lt; <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>()) {
<a name="l00954"></a>00954         <a class="code" href="namespaceDebug.html#a3a24898e3ca48ef89e2029ab6e43665c">Debug::breakpoint</a>();
<a name="l00955"></a>00955         <a class="code" href="classNSGigE.html#a2929b39dcabc4b8384a72cb035dd307b">intrTick</a> = <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>();
<a name="l00956"></a>00956     }
<a name="l00957"></a>00957 
<a name="l00958"></a>00958     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetIntr, <span class="stringliteral">&quot;going to schedule an interrupt for intrTick=%d\n&quot;</span>,
<a name="l00959"></a>00959             <a class="code" href="classNSGigE.html#a2929b39dcabc4b8384a72cb035dd307b">intrTick</a>);
<a name="l00960"></a>00960 
<a name="l00961"></a>00961     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a9a347760a0cc3d9ffa531314af40bf06">intrEvent</a>)
<a name="l00962"></a>00962         <a class="code" href="classNSGigE.html#a9a347760a0cc3d9ffa531314af40bf06">intrEvent</a>-&gt;<a class="code" href="classEvent.html#a91707c0c1d479ac987d1ec416406cb3f" title="Squash the current event.">squash</a>();
<a name="l00963"></a>00963     <a class="code" href="classNSGigE.html#a9a347760a0cc3d9ffa531314af40bf06">intrEvent</a> = <span class="keyword">new</span> <a class="code" href="classNSGigE.html#a162c36c6f7535681982e5652221af901">IntrEvent</a>(<span class="keyword">this</span>, <span class="keyword">true</span>);
<a name="l00964"></a>00964     <a class="code" href="classEventManager.html#a749a10828b2dd5017a2582960d04e400">schedule</a>(<a class="code" href="classNSGigE.html#a9a347760a0cc3d9ffa531314af40bf06">intrEvent</a>, <a class="code" href="classNSGigE.html#a2929b39dcabc4b8384a72cb035dd307b">intrTick</a>);
<a name="l00965"></a>00965 }
<a name="l00966"></a>00966 
<a name="l00967"></a>00967 <span class="keywordtype">void</span>
<a name="l00968"></a><a class="code" href="classNSGigE.html#ab69e13e04adaa9c7002e4ba855a5800d">00968</a> <a class="code" href="classNSGigE.html#ab69e13e04adaa9c7002e4ba855a5800d">NSGigE::cpuInterrupt</a>()
<a name="l00969"></a>00969 {
<a name="l00970"></a>00970     assert(<a class="code" href="classNSGigE.html#a2929b39dcabc4b8384a72cb035dd307b">intrTick</a> == <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>());
<a name="l00971"></a>00971 
<a name="l00972"></a>00972     <span class="comment">// Whether or not there&#39;s a pending interrupt, we don&#39;t care about</span>
<a name="l00973"></a>00973     <span class="comment">// it anymore</span>
<a name="l00974"></a>00974     <a class="code" href="classNSGigE.html#a9a347760a0cc3d9ffa531314af40bf06">intrEvent</a> = 0;
<a name="l00975"></a>00975     <a class="code" href="classNSGigE.html#a2929b39dcabc4b8384a72cb035dd307b">intrTick</a> = 0;
<a name="l00976"></a>00976 
<a name="l00977"></a>00977     <span class="comment">// Don&#39;t send an interrupt if there&#39;s already one</span>
<a name="l00978"></a>00978     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#af3381915c8c18105505516cc4795d3f1">cpuPendingIntr</a>) {
<a name="l00979"></a>00979         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetIntr,
<a name="l00980"></a>00980                 <span class="stringliteral">&quot;would send an interrupt now, but there&#39;s already pending\n&quot;</span>);
<a name="l00981"></a>00981     } <span class="keywordflow">else</span> {
<a name="l00982"></a>00982         <span class="comment">// Send interrupt</span>
<a name="l00983"></a>00983         <a class="code" href="classNSGigE.html#af3381915c8c18105505516cc4795d3f1">cpuPendingIntr</a> = <span class="keyword">true</span>;
<a name="l00984"></a>00984 
<a name="l00985"></a>00985         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetIntr, <span class="stringliteral">&quot;posting interrupt\n&quot;</span>);
<a name="l00986"></a>00986         <a class="code" href="classPciDev.html#aba354b60d7d6818157ddecfcca99183a">intrPost</a>();
<a name="l00987"></a>00987     }
<a name="l00988"></a>00988 }
<a name="l00989"></a>00989 
<a name="l00990"></a>00990 <span class="keywordtype">void</span>
<a name="l00991"></a><a class="code" href="classNSGigE.html#ac0cdb19b23420aedb851f36d23dc0eb1">00991</a> <a class="code" href="classNSGigE.html#ac0cdb19b23420aedb851f36d23dc0eb1">NSGigE::cpuIntrClear</a>()
<a name="l00992"></a>00992 {
<a name="l00993"></a>00993     <span class="keywordflow">if</span> (!<a class="code" href="classNSGigE.html#af3381915c8c18105505516cc4795d3f1">cpuPendingIntr</a>)
<a name="l00994"></a>00994         <span class="keywordflow">return</span>;
<a name="l00995"></a>00995 
<a name="l00996"></a>00996     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a9a347760a0cc3d9ffa531314af40bf06">intrEvent</a>) {
<a name="l00997"></a>00997         <a class="code" href="classNSGigE.html#a9a347760a0cc3d9ffa531314af40bf06">intrEvent</a>-&gt;<a class="code" href="classEvent.html#a91707c0c1d479ac987d1ec416406cb3f" title="Squash the current event.">squash</a>();
<a name="l00998"></a>00998         <a class="code" href="classNSGigE.html#a9a347760a0cc3d9ffa531314af40bf06">intrEvent</a> = 0;
<a name="l00999"></a>00999     }
<a name="l01000"></a>01000 
<a name="l01001"></a>01001     <a class="code" href="classNSGigE.html#a2929b39dcabc4b8384a72cb035dd307b">intrTick</a> = 0;
<a name="l01002"></a>01002 
<a name="l01003"></a>01003     <a class="code" href="classNSGigE.html#af3381915c8c18105505516cc4795d3f1">cpuPendingIntr</a> = <span class="keyword">false</span>;
<a name="l01004"></a>01004 
<a name="l01005"></a>01005     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetIntr, <span class="stringliteral">&quot;clearing interrupt\n&quot;</span>);
<a name="l01006"></a>01006     <a class="code" href="classPciDev.html#a942e28b3d96095320f51a6f6c0c36c8a">intrClear</a>();
<a name="l01007"></a>01007 }
<a name="l01008"></a>01008 
<a name="l01009"></a>01009 <span class="keywordtype">bool</span>
<a name="l01010"></a><a class="code" href="classNSGigE.html#ac53b4715fb28e5fd8a950e1b7e50c03d">01010</a> <a class="code" href="classNSGigE.html#ac53b4715fb28e5fd8a950e1b7e50c03d">NSGigE::cpuIntrPending</a>()<span class="keyword"> const</span>
<a name="l01011"></a>01011 <span class="keyword"></span>{ <span class="keywordflow">return</span> <a class="code" href="classNSGigE.html#af3381915c8c18105505516cc4795d3f1">cpuPendingIntr</a>; }
<a name="l01012"></a>01012 
<a name="l01013"></a>01013 <span class="keywordtype">void</span>
<a name="l01014"></a><a class="code" href="classNSGigE.html#a81093623dd1fdf472ff7962f3af15e9c">01014</a> <a class="code" href="classNSGigE.html#a81093623dd1fdf472ff7962f3af15e9c">NSGigE::txReset</a>()
<a name="l01015"></a>01015 {
<a name="l01016"></a>01016 
<a name="l01017"></a>01017     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet, <span class="stringliteral">&quot;transmit reset\n&quot;</span>);
<a name="l01018"></a>01018 
<a name="l01019"></a>01019     <a class="code" href="classNSGigE.html#a42daaa387f54470e251759d4f42aed8a" title="Current Transmit Descriptor Done.">CTDD</a> = <span class="keyword">false</span>;
<a name="l01020"></a>01020     <a class="code" href="classNSGigE.html#ac12794e1d7747b59b28f474813e42b6f">txEnable</a> = <span class="keyword">false</span>;;
<a name="l01021"></a>01021     <a class="code" href="classNSGigE.html#a35898de98a734b7d95c842ea88e88b46" title="ptr to the next byte in the current fragment">txFragPtr</a> = 0;
<a name="l01022"></a>01022     assert(<a class="code" href="classNSGigE.html#a66ca0e897397c87dc5c667ab26d5bafe" title="count of bytes remaining in the current descriptor">txDescCnt</a> == 0);
<a name="l01023"></a>01023     <a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#aff6614db891b7a01bb43853894806534">clear</a>();
<a name="l01024"></a>01024     <a class="code" href="classNSGigE.html#ab9b31ecee249b2c50ef0ce8de53a9f63">txState</a> = txIdle;
<a name="l01025"></a>01025     assert(<a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa6d0e755f71150562d9034139967941f">dmaIdle</a>);
<a name="l01026"></a>01026 }
<a name="l01027"></a>01027 
<a name="l01028"></a>01028 <span class="keywordtype">void</span>
<a name="l01029"></a><a class="code" href="classNSGigE.html#a999252ab5187288af26bc45fed0ddb75">01029</a> <a class="code" href="classNSGigE.html#a999252ab5187288af26bc45fed0ddb75">NSGigE::rxReset</a>()
<a name="l01030"></a>01030 {
<a name="l01031"></a>01031     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet, <span class="stringliteral">&quot;receive reset\n&quot;</span>);
<a name="l01032"></a>01032 
<a name="l01033"></a>01033     <a class="code" href="classNSGigE.html#a47964f2eddd257dd82a72a49e07e2952" title="Current Receive Descriptor Done.">CRDD</a> = <span class="keyword">false</span>;
<a name="l01034"></a>01034     assert(<a class="code" href="classNSGigE.html#a3fb29961f0bc18f17040d87f2d8c6d62" title="num of bytes in the current packet being drained from rxDataFifo">rxPktBytes</a> == 0);
<a name="l01035"></a>01035     <a class="code" href="classNSGigE.html#abd3ee6dd80adc02a83aabb691332a92d">rxEnable</a> = <span class="keyword">false</span>;
<a name="l01036"></a>01036     <a class="code" href="classNSGigE.html#a5bf18fd3cabd4a420f540760525da581" title="ptr to the next byte in current fragment">rxFragPtr</a> = 0;
<a name="l01037"></a>01037     assert(<a class="code" href="classNSGigE.html#adc888bffd26d4e89da0ff44e9b82095c" title="count of bytes remaining in the current descriptor">rxDescCnt</a> == 0);
<a name="l01038"></a>01038     assert(<a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa6d0e755f71150562d9034139967941f">dmaIdle</a>);
<a name="l01039"></a>01039     <a class="code" href="classNSGigE.html#a6767f0e97ec4877c56c24b7a41e6d71d">rxFifo</a>.<a class="code" href="classPacketFifo.html#aff6614db891b7a01bb43853894806534">clear</a>();
<a name="l01040"></a>01040     <a class="code" href="classNSGigE.html#a73d1c398c20206c6e6d40fface8f73f9" title="rx State Machine">rxState</a> = rxIdle;
<a name="l01041"></a>01041 }
<a name="l01042"></a>01042 
<a name="l01043"></a>01043 <span class="keywordtype">void</span>
<a name="l01044"></a><a class="code" href="classNSGigE.html#ad7aa4282dafb24f59ce1f608e32f405a">01044</a> <a class="code" href="classNSGigE.html#ad7aa4282dafb24f59ce1f608e32f405a">NSGigE::regsReset</a>()
<a name="l01045"></a>01045 {
<a name="l01046"></a>01046     memset(&amp;<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>));
<a name="l01047"></a>01047     <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a7b90dafdbf78c3094e26e3b445a45118">config</a> = (<a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a2c097cab9c0e3dfc136f26df78c461f2">CFGR_LNKSTS</a> | <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a4e9c3be1a013e53614a66ce824e06a5f">CFGR_TBI_EN</a> | CFGR_MODE_1000);
<a name="l01048"></a>01048     <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49e054c501a5a1f8d1fa342999a6c4e8">mear</a> = 0x12;
<a name="l01049"></a>01049     <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acf32d2fcfab30be47767f1531f75a2cc">txcfg</a> = 0x120; <span class="comment">// set drain threshold to 1024 bytes and</span>
<a name="l01050"></a>01050                         <span class="comment">// fill threshold to 32 bytes</span>
<a name="l01051"></a>01051     <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a725ebce5e39e17777f38adc25d8c71f5">rxcfg</a> = 0x4;   <span class="comment">// set drain threshold to 16 bytes</span>
<a name="l01052"></a>01052     <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a210ef455baf3b7a9c577d2fef3757c85">srr</a> = 0x0103;  <span class="comment">// set the silicon revision to rev B or 0x103</span>
<a name="l01053"></a>01053     <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a28bad330789b6511f93e3b8f8ec3c4e3">mibc</a> = MIBC_FRZ;
<a name="l01054"></a>01054     <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a74ae9c0bdd32efa2efc9dcca19d8437d">vdr</a> = 0x81;    <span class="comment">// set the vlan tag type to 802.1q</span>
<a name="l01055"></a>01055     <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a73c04ab08a0f39d76d90dd9f60464b6f">tesr</a> = 0xc000; <span class="comment">// TBI capable of both full and half duplex</span>
<a name="l01056"></a>01056     <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#abef81a0ada42cd949d77552b57c58532">brar</a> = 0xffffffff;
<a name="l01057"></a>01057 
<a name="l01058"></a>01058     <a class="code" href="classNSGigE.html#af6f500f63b3d9787299aa4a4fcccb103">extstsEnable</a> = <span class="keyword">false</span>;
<a name="l01059"></a>01059     <a class="code" href="classNSGigE.html#afe19d30d3ec62ef1a129e5ecd5e8ea1e">acceptBroadcast</a> = <span class="keyword">false</span>;
<a name="l01060"></a>01060     <a class="code" href="classNSGigE.html#a3d4914b10c5606a632c550251ef3079b">acceptMulticast</a> = <span class="keyword">false</span>;
<a name="l01061"></a>01061     <a class="code" href="classNSGigE.html#a402a74038f39b5a1551dfd137e9876d5">acceptUnicast</a> = <span class="keyword">false</span>;
<a name="l01062"></a>01062     <a class="code" href="classNSGigE.html#acc0f2bddaadb14d655d6f6e33a85b077">acceptPerfect</a> = <span class="keyword">false</span>;
<a name="l01063"></a>01063     <a class="code" href="classNSGigE.html#a0097dd413d75e23e9b2c24d5b9b86657">acceptArp</a> = <span class="keyword">false</span>;
<a name="l01064"></a>01064 }
<a name="l01065"></a>01065 
<a name="l01066"></a>01066 <span class="keywordtype">bool</span>
<a name="l01067"></a><a class="code" href="classNSGigE.html#a8f22a0749d7c07defc7a51f879b8cbcf">01067</a> <a class="code" href="classNSGigE.html#a8f22a0749d7c07defc7a51f879b8cbcf">NSGigE::doRxDmaRead</a>()
<a name="l01068"></a>01068 {
<a name="l01069"></a>01069     assert(<a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa6d0e755f71150562d9034139967941f">dmaIdle</a> || <a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432a4034c574db402302229306bd7ff355d6">dmaReadWaiting</a>);
<a name="l01070"></a>01070     <a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> = dmaReading;
<a name="l01071"></a>01071 
<a name="l01072"></a>01072     <span class="keywordflow">if</span> (<a class="code" href="classDmaDevice.html#a4672e6f8435fb000ee7830f235ec11d5">dmaPending</a>() || <a class="code" href="classDrainable.html#a0e5f525d2e1df1af3e87ce17530b40dc">getDrainState</a>() != <a class="code" href="classDrainable.html#a6173416423af6af1bfe17262be40b5ffa2cea28320073053047fb4cd4471b5075">Drainable::Running</a>)
<a name="l01073"></a>01073         <a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> = dmaReadWaiting;
<a name="l01074"></a>01074     <span class="keywordflow">else</span>
<a name="l01075"></a>01075         <a class="code" href="classDmaDevice.html#a5e2f5335eff62ca1326f567cd355d992">dmaRead</a>(<a class="code" href="classNSGigE.html#a72d24c697a3184ad7c5dd78c4b1692fb">rxDmaAddr</a>, <a class="code" href="classNSGigE.html#aff03d713abb5e5d24f05092b1bc98546">rxDmaLen</a>, &amp;<a class="code" href="classNSGigE.html#adb196252cd06d937d8bd5d9a7f429905">rxDmaReadEvent</a>, (uint8_t*)<a class="code" href="classNSGigE.html#a103e4d82ab1ed080bb3babba2b09bb23">rxDmaData</a>);
<a name="l01076"></a>01076 
<a name="l01077"></a>01077     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01078"></a>01078 }
<a name="l01079"></a>01079 
<a name="l01080"></a>01080 <span class="keywordtype">void</span>
<a name="l01081"></a><a class="code" href="classNSGigE.html#a0fe9bd67b5a8e40d6b45bb94d65c9bde">01081</a> <a class="code" href="classNSGigE.html#a0fe9bd67b5a8e40d6b45bb94d65c9bde">NSGigE::rxDmaReadDone</a>()
<a name="l01082"></a>01082 {
<a name="l01083"></a>01083     assert(<a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432acc16d5445eb241eb4d8bb5058d4f24b6">dmaReading</a>);
<a name="l01084"></a>01084     <a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> = dmaIdle;
<a name="l01085"></a>01085 
<a name="l01086"></a>01086     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetDMA, <span class="stringliteral">&quot;rx dma read  paddr=%#x len=%d\n&quot;</span>,
<a name="l01087"></a>01087             <a class="code" href="classNSGigE.html#a72d24c697a3184ad7c5dd78c4b1692fb">rxDmaAddr</a>, <a class="code" href="classNSGigE.html#aff03d713abb5e5d24f05092b1bc98546">rxDmaLen</a>);
<a name="l01088"></a>01088     <a class="code" href="trace_8hh.html#a556faf39d3fa9f7db5f344487ddbb397">DDUMP</a>(EthernetDMA, <a class="code" href="classNSGigE.html#a103e4d82ab1ed080bb3babba2b09bb23">rxDmaData</a>, <a class="code" href="classNSGigE.html#aff03d713abb5e5d24f05092b1bc98546">rxDmaLen</a>);
<a name="l01089"></a>01089 
<a name="l01090"></a>01090     <span class="comment">// If the transmit state machine has a pending DMA, let it go first</span>
<a name="l01091"></a>01091     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432a4034c574db402302229306bd7ff355d6">dmaReadWaiting</a> || <a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432a4e1c9ae1af6b515947eca20fbde485c0">dmaWriteWaiting</a>)
<a name="l01092"></a>01092         <a class="code" href="classNSGigE.html#ac37bda95e09a290e343ef80fc3fc9e2b">txKick</a>();
<a name="l01093"></a>01093 
<a name="l01094"></a>01094     <a class="code" href="classNSGigE.html#aec2097dcddfbd9263ce8cfd2fd11c474">rxKick</a>();
<a name="l01095"></a>01095 }
<a name="l01096"></a>01096 
<a name="l01097"></a>01097 <span class="keywordtype">bool</span>
<a name="l01098"></a><a class="code" href="classNSGigE.html#a6e6960f594a94d6d1d2ecfd42b0862de">01098</a> <a class="code" href="classNSGigE.html#a6e6960f594a94d6d1d2ecfd42b0862de">NSGigE::doRxDmaWrite</a>()
<a name="l01099"></a>01099 {
<a name="l01100"></a>01100     assert(<a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa6d0e755f71150562d9034139967941f">dmaIdle</a> || <a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432a4e1c9ae1af6b515947eca20fbde485c0">dmaWriteWaiting</a>);
<a name="l01101"></a>01101     <a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> = dmaWriting;
<a name="l01102"></a>01102 
<a name="l01103"></a>01103     <span class="keywordflow">if</span> (<a class="code" href="classDmaDevice.html#a4672e6f8435fb000ee7830f235ec11d5">dmaPending</a>() || <a class="code" href="classDrainable.html#a0e5f525d2e1df1af3e87ce17530b40dc">getDrainState</a>() != <a class="code" href="classDrainable.html#a6173416423af6af1bfe17262be40b5ffa2cea28320073053047fb4cd4471b5075">Running</a>)
<a name="l01104"></a>01104         <a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> = dmaWriteWaiting;
<a name="l01105"></a>01105     <span class="keywordflow">else</span>
<a name="l01106"></a>01106         <a class="code" href="classDmaDevice.html#ada6ca94d958378ea74a108a52f067888">dmaWrite</a>(<a class="code" href="classNSGigE.html#a72d24c697a3184ad7c5dd78c4b1692fb">rxDmaAddr</a>, <a class="code" href="classNSGigE.html#aff03d713abb5e5d24f05092b1bc98546">rxDmaLen</a>, &amp;<a class="code" href="classNSGigE.html#a21177ad645a0b780a70c6b447972f5f5">rxDmaWriteEvent</a>, (uint8_t*)<a class="code" href="classNSGigE.html#a103e4d82ab1ed080bb3babba2b09bb23">rxDmaData</a>);
<a name="l01107"></a>01107     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01108"></a>01108 }
<a name="l01109"></a>01109 
<a name="l01110"></a>01110 <span class="keywordtype">void</span>
<a name="l01111"></a><a class="code" href="classNSGigE.html#ae70ad4de8dd40cfacb4e142736671319">01111</a> <a class="code" href="classNSGigE.html#ae70ad4de8dd40cfacb4e142736671319">NSGigE::rxDmaWriteDone</a>()
<a name="l01112"></a>01112 {
<a name="l01113"></a>01113     assert(<a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa30c5324ded4755003f71c298c92f605">dmaWriting</a>);
<a name="l01114"></a>01114     <a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> = dmaIdle;
<a name="l01115"></a>01115 
<a name="l01116"></a>01116     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetDMA, <span class="stringliteral">&quot;rx dma write paddr=%#x len=%d\n&quot;</span>,
<a name="l01117"></a>01117             <a class="code" href="classNSGigE.html#a72d24c697a3184ad7c5dd78c4b1692fb">rxDmaAddr</a>, <a class="code" href="classNSGigE.html#aff03d713abb5e5d24f05092b1bc98546">rxDmaLen</a>);
<a name="l01118"></a>01118     <a class="code" href="trace_8hh.html#a556faf39d3fa9f7db5f344487ddbb397">DDUMP</a>(EthernetDMA, <a class="code" href="classNSGigE.html#a103e4d82ab1ed080bb3babba2b09bb23">rxDmaData</a>, <a class="code" href="classNSGigE.html#aff03d713abb5e5d24f05092b1bc98546">rxDmaLen</a>);
<a name="l01119"></a>01119 
<a name="l01120"></a>01120     <span class="comment">// If the transmit state machine has a pending DMA, let it go first</span>
<a name="l01121"></a>01121     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432a4034c574db402302229306bd7ff355d6">dmaReadWaiting</a> || <a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432a4e1c9ae1af6b515947eca20fbde485c0">dmaWriteWaiting</a>)
<a name="l01122"></a>01122         <a class="code" href="classNSGigE.html#ac37bda95e09a290e343ef80fc3fc9e2b">txKick</a>();
<a name="l01123"></a>01123 
<a name="l01124"></a>01124     <a class="code" href="classNSGigE.html#aec2097dcddfbd9263ce8cfd2fd11c474">rxKick</a>();
<a name="l01125"></a>01125 }
<a name="l01126"></a>01126 
<a name="l01127"></a>01127 <span class="keywordtype">void</span>
<a name="l01128"></a><a class="code" href="classNSGigE.html#aec2097dcddfbd9263ce8cfd2fd11c474">01128</a> <a class="code" href="classNSGigE.html#aec2097dcddfbd9263ce8cfd2fd11c474">NSGigE::rxKick</a>()
<a name="l01129"></a>01129 {
<a name="l01130"></a>01130     <span class="keywordtype">bool</span> is64bit = (bool)(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a7b90dafdbf78c3094e26e3b445a45118">config</a> &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a7bf5a5a54dab741cd91dcfcba6d6c46f">CFGR_M64ADDR</a>);
<a name="l01131"></a>01131 
<a name="l01132"></a>01132     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM,
<a name="l01133"></a>01133             <span class="stringliteral">&quot;receive kick rxState=%s (rxBuf.size=%d) %d-bit\n&quot;</span>,
<a name="l01134"></a>01134             <a class="code" href="ns__gige_8cc.html#ad6f3c3e40104a80a184491a00ba6a41d">NsRxStateStrings</a>[<a class="code" href="classNSGigE.html#a73d1c398c20206c6e6d40fface8f73f9" title="rx State Machine">rxState</a>], <a class="code" href="classNSGigE.html#a6767f0e97ec4877c56c24b7a41e6d71d">rxFifo</a>.<a class="code" href="classPacketFifo.html#a2dbca9a15d75e1729f8d3f5581161773">size</a>(), is64bit ? 64 : 32);
<a name="l01135"></a>01135 
<a name="l01136"></a>01136     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> link, bufptr;
<a name="l01137"></a>01137     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> &amp;cmdsts = is64bit ? <a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>.<a class="code" href="structns__desc64.html#a436fe4aab8750c7e98c059b512549c05">cmdsts</a> : <a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>.<a class="code" href="structns__desc32.html#a3e24fd8f58ccd00550375969412d4915">cmdsts</a>;
<a name="l01138"></a>01138     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> &amp;extsts = is64bit ? <a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>.<a class="code" href="structns__desc64.html#ac0dc609d94bcdf47d8a87cc00321a531">extsts</a> : <a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>.<a class="code" href="structns__desc32.html#a0bb874ccd5bfb9f31b6e6be18f544ada">extsts</a>;
<a name="l01139"></a>01139 
<a name="l01140"></a>01140   next:
<a name="l01141"></a>01141     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#aa7d7349c084992d2d9ba6f3db2f0dfb6">rxKickTick</a> &gt; <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>()) {
<a name="l01142"></a>01142         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;receive kick exiting, can&#39;t run till %d\n&quot;</span>,
<a name="l01143"></a>01143                 <a class="code" href="classNSGigE.html#aa7d7349c084992d2d9ba6f3db2f0dfb6">rxKickTick</a>);
<a name="l01144"></a>01144 
<a name="l01145"></a>01145         <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01146"></a>01146     }
<a name="l01147"></a>01147 
<a name="l01148"></a>01148     <span class="comment">// Go to the next state machine clock tick.</span>
<a name="l01149"></a>01149     <a class="code" href="classNSGigE.html#aa7d7349c084992d2d9ba6f3db2f0dfb6">rxKickTick</a> = <a class="code" href="classClockedObject.html#a7c1f64c925f158530be84323a503dbb7" title="Determine the tick when a cycle begins, by default the current one, but the argument also enables the...">clockEdge</a>(<a class="code" href="classCycles.html" title="Cycles is a wrapper class for representing cycle counts, i.e.">Cycles</a>(1));
<a name="l01150"></a>01150 
<a name="l01151"></a>01151     <span class="keywordflow">switch</span>(<a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a>) {
<a name="l01152"></a>01152       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432a4034c574db402302229306bd7ff355d6">dmaReadWaiting</a>:
<a name="l01153"></a>01153         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a8f22a0749d7c07defc7a51f879b8cbcf">doRxDmaRead</a>())
<a name="l01154"></a>01154             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01155"></a>01155         <span class="keywordflow">break</span>;
<a name="l01156"></a>01156       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432a4e1c9ae1af6b515947eca20fbde485c0">dmaWriteWaiting</a>:
<a name="l01157"></a>01157         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a6e6960f594a94d6d1d2ecfd42b0862de">doRxDmaWrite</a>())
<a name="l01158"></a>01158             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01159"></a>01159         <span class="keywordflow">break</span>;
<a name="l01160"></a>01160       <span class="keywordflow">default</span>:
<a name="l01161"></a>01161         <span class="keywordflow">break</span>;
<a name="l01162"></a>01162     }
<a name="l01163"></a>01163 
<a name="l01164"></a>01164     link = is64bit ? (Addr)<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>.<a class="code" href="structns__desc64.html#ab8f1bd57eea3d30c7df8f5ecf33f7b7d">link</a> : (<a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a>)<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>.<a class="code" href="structns__desc32.html#acf6b169af8584eaeeafbfdec9b7a2bf1">link</a>;
<a name="l01165"></a>01165     bufptr = is64bit ? (Addr)<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>.<a class="code" href="structns__desc64.html#a5eeef802e303dbc13955b0dd997352ab">bufptr</a> : (<a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a>)<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>.<a class="code" href="structns__desc32.html#a0a47a3d5c0183ab5cd6567ee7d89ea32">bufptr</a>;
<a name="l01166"></a>01166 
<a name="l01167"></a>01167     <span class="comment">// see state machine from spec for details</span>
<a name="l01168"></a>01168     <span class="comment">// the way this works is, if you finish work on one state and can</span>
<a name="l01169"></a>01169     <span class="comment">// go directly to another, you do that through jumping to the</span>
<a name="l01170"></a>01170     <span class="comment">// label &quot;next&quot;.  however, if you have intermediate work, like DMA</span>
<a name="l01171"></a>01171     <span class="comment">// so that you can&#39;t go to the next state yet, you go to exit and</span>
<a name="l01172"></a>01172     <span class="comment">// exit the loop.  however, when the DMA is done it will trigger</span>
<a name="l01173"></a>01173     <span class="comment">// an event and come back to this loop.</span>
<a name="l01174"></a>01174     <span class="keywordflow">switch</span> (rxState) {
<a name="l01175"></a>01175       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#ae525551f95b665ca94ab6ce5f0f48510ad0df408ad7d99a35ce4ada84fde1a41d">rxIdle</a>:
<a name="l01176"></a>01176         <span class="keywordflow">if</span> (!<a class="code" href="classNSGigE.html#abd3ee6dd80adc02a83aabb691332a92d">rxEnable</a>) {
<a name="l01177"></a>01177             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;Receive Disabled! Nothing to do.\n&quot;</span>);
<a name="l01178"></a>01178             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01179"></a>01179         }
<a name="l01180"></a>01180 
<a name="l01181"></a>01181         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a47964f2eddd257dd82a72a49e07e2952" title="Current Receive Descriptor Done.">CRDD</a>) {
<a name="l01182"></a>01182             rxState = rxDescRefr;
<a name="l01183"></a>01183 
<a name="l01184"></a>01184             <a class="code" href="classNSGigE.html#a72d24c697a3184ad7c5dd78c4b1692fb">rxDmaAddr</a> = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2174f997477d58985b12c3a059d38bf8">rxdp</a> &amp; 0x3fffffff;
<a name="l01185"></a>01185             <a class="code" href="classNSGigE.html#a103e4d82ab1ed080bb3babba2b09bb23">rxDmaData</a> =
<a name="l01186"></a>01186                 is64bit ? (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>.<a class="code" href="structns__desc64.html#ab8f1bd57eea3d30c7df8f5ecf33f7b7d">link</a> : (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>.<a class="code" href="structns__desc32.html#acf6b169af8584eaeeafbfdec9b7a2bf1">link</a>;
<a name="l01187"></a>01187             <a class="code" href="classNSGigE.html#aff03d713abb5e5d24f05092b1bc98546">rxDmaLen</a> = is64bit ? <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>.<a class="code" href="structns__desc64.html#ab8f1bd57eea3d30c7df8f5ecf33f7b7d">link</a>) : <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>.<a class="code" href="structns__desc32.html#acf6b169af8584eaeeafbfdec9b7a2bf1">link</a>);
<a name="l01188"></a>01188             <a class="code" href="classNSGigE.html#ac011716237ad6c71ceb02c519b305e8a">rxDmaFree</a> = <a class="code" href="classNSGigE.html#ad58dedc82d60f8fbeec43fbe43f3a726">dmaDescFree</a>;
<a name="l01189"></a>01189 
<a name="l01190"></a>01190             <a class="code" href="classEtherDevice.html#a0e15528d29e1ba23ac90008f8cfc3996">descDmaReads</a>++;
<a name="l01191"></a>01191             <a class="code" href="classEtherDevice.html#a84700d6596dacdb2dd61880560cc95bd">descDmaRdBytes</a> += <a class="code" href="classNSGigE.html#aff03d713abb5e5d24f05092b1bc98546">rxDmaLen</a>;
<a name="l01192"></a>01192 
<a name="l01193"></a>01193             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a8f22a0749d7c07defc7a51f879b8cbcf">doRxDmaRead</a>())
<a name="l01194"></a>01194                 <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01195"></a>01195         } <span class="keywordflow">else</span> {
<a name="l01196"></a>01196             rxState = rxDescRead;
<a name="l01197"></a>01197 
<a name="l01198"></a>01198             <a class="code" href="classNSGigE.html#a72d24c697a3184ad7c5dd78c4b1692fb">rxDmaAddr</a> = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2174f997477d58985b12c3a059d38bf8">rxdp</a> &amp; 0x3fffffff;
<a name="l01199"></a>01199             <a class="code" href="classNSGigE.html#a103e4d82ab1ed080bb3babba2b09bb23">rxDmaData</a> = is64bit ? (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a> : (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>;
<a name="l01200"></a>01200             <a class="code" href="classNSGigE.html#aff03d713abb5e5d24f05092b1bc98546">rxDmaLen</a> = is64bit ? <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>) : <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>);
<a name="l01201"></a>01201             <a class="code" href="classNSGigE.html#ac011716237ad6c71ceb02c519b305e8a">rxDmaFree</a> = <a class="code" href="classNSGigE.html#ad58dedc82d60f8fbeec43fbe43f3a726">dmaDescFree</a>;
<a name="l01202"></a>01202 
<a name="l01203"></a>01203             <a class="code" href="classEtherDevice.html#a0e15528d29e1ba23ac90008f8cfc3996">descDmaReads</a>++;
<a name="l01204"></a>01204             <a class="code" href="classEtherDevice.html#a84700d6596dacdb2dd61880560cc95bd">descDmaRdBytes</a> += <a class="code" href="classNSGigE.html#aff03d713abb5e5d24f05092b1bc98546">rxDmaLen</a>;
<a name="l01205"></a>01205 
<a name="l01206"></a>01206             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a8f22a0749d7c07defc7a51f879b8cbcf">doRxDmaRead</a>())
<a name="l01207"></a>01207                 <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01208"></a>01208         }
<a name="l01209"></a>01209         <span class="keywordflow">break</span>;
<a name="l01210"></a>01210 
<a name="l01211"></a>01211       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#ae525551f95b665ca94ab6ce5f0f48510adc3bcc31603ecb5dd1cc5b3fe9d3394e">rxDescRefr</a>:
<a name="l01212"></a>01212         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> != <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa6d0e755f71150562d9034139967941f">dmaIdle</a>)
<a name="l01213"></a>01213             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01214"></a>01214 
<a name="l01215"></a>01215         rxState = rxAdvance;
<a name="l01216"></a>01216         <span class="keywordflow">break</span>;
<a name="l01217"></a>01217 
<a name="l01218"></a>01218      <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#ae525551f95b665ca94ab6ce5f0f48510a2912cc09c83e1a240aec1641f386752f">rxDescRead</a>:
<a name="l01219"></a>01219         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> != <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa6d0e755f71150562d9034139967941f">dmaIdle</a>)
<a name="l01220"></a>01220             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01221"></a>01221 
<a name="l01222"></a>01222         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetDesc, <span class="stringliteral">&quot;rxDesc: addr=%08x read descriptor\n&quot;</span>,
<a name="l01223"></a>01223                 <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2174f997477d58985b12c3a059d38bf8">rxdp</a> &amp; 0x3fffffff);
<a name="l01224"></a>01224         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetDesc,
<a name="l01225"></a>01225                 <span class="stringliteral">&quot;rxDesc: link=%#x bufptr=%#x cmdsts=%08x extsts=%08x\n&quot;</span>,
<a name="l01226"></a>01226                 link, bufptr, cmdsts, extsts);
<a name="l01227"></a>01227 
<a name="l01228"></a>01228         <span class="keywordflow">if</span> (cmdsts &amp; <a class="code" href="ns__gige__reg_8h.html#ab03e8c6ba2b8e57cbbe1c6f0421c5641acafcc1556a555eecf204cf3803daca5f">CMDSTS_OWN</a>) {
<a name="l01229"></a>01229             <a class="code" href="classNSGigE.html#a6d9924c69c46eeb592083661da9012e6" title="Interrupt management.">devIntrPost</a>(<a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84aeaba8ecba36bf0fbd0857553f317c5b9">ISR_RXIDLE</a>);
<a name="l01230"></a>01230             rxState = rxIdle;
<a name="l01231"></a>01231             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01232"></a>01232         } <span class="keywordflow">else</span> {
<a name="l01233"></a>01233             rxState = rxFifoBlock;
<a name="l01234"></a>01234             <a class="code" href="classNSGigE.html#a5bf18fd3cabd4a420f540760525da581" title="ptr to the next byte in current fragment">rxFragPtr</a> = bufptr;
<a name="l01235"></a>01235             <a class="code" href="classNSGigE.html#adc888bffd26d4e89da0ff44e9b82095c" title="count of bytes remaining in the current descriptor">rxDescCnt</a> = cmdsts &amp; CMDSTS_LEN_MASK;
<a name="l01236"></a>01236         }
<a name="l01237"></a>01237         <span class="keywordflow">break</span>;
<a name="l01238"></a>01238 
<a name="l01239"></a>01239       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#ae525551f95b665ca94ab6ce5f0f48510a9fa0525a7d6a1ac0d44e0119b5932e21">rxFifoBlock</a>:
<a name="l01240"></a>01240         <span class="keywordflow">if</span> (!<a class="code" href="classNSGigE.html#a0ef842e4e509199950b7fcc341259980">rxPacket</a>) {
<a name="l01246"></a>01246             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a6767f0e97ec4877c56c24b7a41e6d71d">rxFifo</a>.<a class="code" href="classPacketFifo.html#aa4dbf488d04bc18c8c388595869a5d17">empty</a>())
<a name="l01247"></a>01247                 <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01248"></a>01248 
<a name="l01249"></a>01249             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;****processing receive of new packet****\n&quot;</span>);
<a name="l01250"></a>01250 
<a name="l01251"></a>01251             <span class="comment">// If we don&#39;t have a packet, grab a new one from the fifo.</span>
<a name="l01252"></a>01252             <a class="code" href="classNSGigE.html#a0ef842e4e509199950b7fcc341259980">rxPacket</a> = <a class="code" href="classNSGigE.html#a6767f0e97ec4877c56c24b7a41e6d71d">rxFifo</a>.<a class="code" href="classPacketFifo.html#a748426efffbc0b6e2f151cbc0b5d9884">front</a>();
<a name="l01253"></a>01253             <a class="code" href="classNSGigE.html#a3fb29961f0bc18f17040d87f2d8c6d62" title="num of bytes in the current packet being drained from rxDataFifo">rxPktBytes</a> = <a class="code" href="classNSGigE.html#a0ef842e4e509199950b7fcc341259980">rxPacket</a>-&gt;length;
<a name="l01254"></a>01254             <a class="code" href="classNSGigE.html#af777184a7b069629f67818b9025adc15">rxPacketBufPtr</a> = <a class="code" href="classNSGigE.html#a0ef842e4e509199950b7fcc341259980">rxPacket</a>-&gt;<a class="code" href="classRefCountingPtr.html#a6b357f8b956e6421ef12211897528b6d" title="The stored pointer.">data</a>;
<a name="l01255"></a>01255 
<a name="l01256"></a>01256 <span class="preprocessor">#if TRACING_ON</span>
<a name="l01257"></a>01257 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="trace_8hh.html#af76c9f7776aade1bf9d7dfa8a0c6b341">DTRACE</a>(Ethernet)) {
<a name="l01258"></a>01258                 <a class="code" href="classNet_1_1IpPtr.html">IpPtr</a> <a class="code" href="namespaceiGbReg_1_1TxdOp.html#a95c40243f7e4760653e10ce95673f381">ip</a>(<a class="code" href="classNSGigE.html#a0ef842e4e509199950b7fcc341259980">rxPacket</a>);
<a name="l01259"></a>01259                 <span class="keywordflow">if</span> (ip) {
<a name="l01260"></a>01260                     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet, <span class="stringliteral">&quot;ID is %d\n&quot;</span>, ip-&gt;id());
<a name="l01261"></a>01261                     <a class="code" href="classNet_1_1TcpPtr.html">TcpPtr</a> <a class="code" href="namespaceiGbReg_1_1TxdOp.html#aff380643c92de5f84ae7d6675820723c">tcp</a>(ip);
<a name="l01262"></a>01262                     <span class="keywordflow">if</span> (tcp) {
<a name="l01263"></a>01263                         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet,
<a name="l01264"></a>01264                                 <span class="stringliteral">&quot;Src Port=%d, Dest Port=%d, Seq=%d, Ack=%d\n&quot;</span>,
<a name="l01265"></a>01265                                 tcp-&gt;sport(), tcp-&gt;dport(), tcp-&gt;seq(),
<a name="l01266"></a>01266                                 tcp-&gt;ack());
<a name="l01267"></a>01267                     }
<a name="l01268"></a>01268                 }
<a name="l01269"></a>01269             }
<a name="l01270"></a>01270 <span class="preprocessor">#endif</span>
<a name="l01271"></a>01271 <span class="preprocessor"></span>
<a name="l01272"></a>01272             <span class="comment">// sanity check - i think the driver behaves like this</span>
<a name="l01273"></a>01273             assert(<a class="code" href="classNSGigE.html#adc888bffd26d4e89da0ff44e9b82095c" title="count of bytes remaining in the current descriptor">rxDescCnt</a> &gt;= <a class="code" href="classNSGigE.html#a3fb29961f0bc18f17040d87f2d8c6d62" title="num of bytes in the current packet being drained from rxDataFifo">rxPktBytes</a>);
<a name="l01274"></a>01274             <a class="code" href="classNSGigE.html#a6767f0e97ec4877c56c24b7a41e6d71d">rxFifo</a>.<a class="code" href="classPacketFifo.html#ad56389c821fb424d8e71dde61c33aed4">pop</a>();
<a name="l01275"></a>01275         }
<a name="l01276"></a>01276 
<a name="l01277"></a>01277 
<a name="l01278"></a>01278         <span class="comment">// dont&#39; need the &amp;&amp; rxDescCnt &gt; 0 if driver sanity check</span>
<a name="l01279"></a>01279         <span class="comment">// above holds</span>
<a name="l01280"></a>01280         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a3fb29961f0bc18f17040d87f2d8c6d62" title="num of bytes in the current packet being drained from rxDataFifo">rxPktBytes</a> &gt; 0) {
<a name="l01281"></a>01281             rxState = rxFragWrite;
<a name="l01282"></a>01282             <span class="comment">// don&#39;t need min&lt;&gt;(rxPktBytes,rxDescCnt) if above sanity</span>
<a name="l01283"></a>01283             <span class="comment">// check holds</span>
<a name="l01284"></a>01284             <a class="code" href="classNSGigE.html#a0c8ab45b8e570a013b671d8952ec1193">rxXferLen</a> = <a class="code" href="classNSGigE.html#a3fb29961f0bc18f17040d87f2d8c6d62" title="num of bytes in the current packet being drained from rxDataFifo">rxPktBytes</a>;
<a name="l01285"></a>01285 
<a name="l01286"></a>01286             <a class="code" href="classNSGigE.html#a72d24c697a3184ad7c5dd78c4b1692fb">rxDmaAddr</a> = <a class="code" href="classNSGigE.html#a5bf18fd3cabd4a420f540760525da581" title="ptr to the next byte in current fragment">rxFragPtr</a> &amp; 0x3fffffff;
<a name="l01287"></a>01287             <a class="code" href="classNSGigE.html#a103e4d82ab1ed080bb3babba2b09bb23">rxDmaData</a> = <a class="code" href="classNSGigE.html#af777184a7b069629f67818b9025adc15">rxPacketBufPtr</a>;
<a name="l01288"></a>01288             <a class="code" href="classNSGigE.html#aff03d713abb5e5d24f05092b1bc98546">rxDmaLen</a> = <a class="code" href="classNSGigE.html#a0c8ab45b8e570a013b671d8952ec1193">rxXferLen</a>;
<a name="l01289"></a>01289             <a class="code" href="classNSGigE.html#ac011716237ad6c71ceb02c519b305e8a">rxDmaFree</a> = <a class="code" href="classNSGigE.html#af8f66ce4f5331cfd458ee5e85a176892">dmaDataFree</a>;
<a name="l01290"></a>01290 
<a name="l01291"></a>01291             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a6e6960f594a94d6d1d2ecfd42b0862de">doRxDmaWrite</a>())
<a name="l01292"></a>01292                 <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01293"></a>01293 
<a name="l01294"></a>01294         } <span class="keywordflow">else</span> {
<a name="l01295"></a>01295             rxState = rxDescWrite;
<a name="l01296"></a>01296 
<a name="l01297"></a>01297             <span class="comment">//if (rxPktBytes == 0) {  /* packet is done */</span>
<a name="l01298"></a>01298             assert(<a class="code" href="classNSGigE.html#a3fb29961f0bc18f17040d87f2d8c6d62" title="num of bytes in the current packet being drained from rxDataFifo">rxPktBytes</a> == 0);
<a name="l01299"></a>01299             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;done with receiving packet\n&quot;</span>);
<a name="l01300"></a>01300 
<a name="l01301"></a>01301             cmdsts |= CMDSTS_OWN;
<a name="l01302"></a>01302             cmdsts &amp;= ~CMDSTS_MORE;
<a name="l01303"></a>01303             cmdsts |= CMDSTS_OK;
<a name="l01304"></a>01304             cmdsts &amp;= 0xffff0000;
<a name="l01305"></a>01305             cmdsts += <a class="code" href="classNSGigE.html#a0ef842e4e509199950b7fcc341259980">rxPacket</a>-&gt;length;   <span class="comment">//i.e. set CMDSTS_SIZE</span>
<a name="l01306"></a>01306 
<a name="l01307"></a>01307 <span class="preprocessor">#if 0</span>
<a name="l01308"></a>01308 <span class="preprocessor"></span>            <span class="comment">/*</span>
<a name="l01309"></a>01309 <span class="comment">             * all the driver uses these are for its own stats keeping</span>
<a name="l01310"></a>01310 <span class="comment">             * which we don&#39;t care about, aren&#39;t necessary for</span>
<a name="l01311"></a>01311 <span class="comment">             * functionality and doing this would just slow us down.</span>
<a name="l01312"></a>01312 <span class="comment">             * if they end up using this in a later version for</span>
<a name="l01313"></a>01313 <span class="comment">             * functional purposes, just undef</span>
<a name="l01314"></a>01314 <span class="comment">             */</span>
<a name="l01315"></a>01315             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#af13268cbb1795582c363a211ff17a604" title="receive address filter">rxFilterEnable</a>) {
<a name="l01316"></a>01316                 cmdsts &amp;= ~CMDSTS_DEST_MASK;
<a name="l01317"></a>01317                 <span class="keyword">const</span> <a class="code" href="structNet_1_1EthAddr.html">EthAddr</a> &amp;dst = rxFifoFront()-&gt;dst();
<a name="l01318"></a>01318                 <span class="keywordflow">if</span> (dst-&gt;<a class="code" href="structNet_1_1EthAddr.html#a5699fc1cb150090212dd660a786b1b17">unicast</a>())
<a name="l01319"></a>01319                     cmdsts |= <a class="code" href="ns__gige__reg_8h.html#ab03e8c6ba2b8e57cbbe1c6f0421c5641af5fe6a4944f07f8fba203a3219dc51de">CMDSTS_DEST_SELF</a>;
<a name="l01320"></a>01320                 <span class="keywordflow">if</span> (dst-&gt;<a class="code" href="structNet_1_1EthAddr.html#aadf7534cd04b204b63f936a239df4481">multicast</a>())
<a name="l01321"></a>01321                     cmdsts |= <a class="code" href="ns__gige__reg_8h.html#ab03e8c6ba2b8e57cbbe1c6f0421c5641a8669ac280c5dbe84f3405542b8e6746b">CMDSTS_DEST_MULTI</a>;
<a name="l01322"></a>01322                 <span class="keywordflow">if</span> (dst-&gt;<a class="code" href="structNet_1_1EthAddr.html#a8a161654fa9208e504feb355b0c2e5d0">broadcast</a>())
<a name="l01323"></a>01323                     cmdsts |= <a class="code" href="ns__gige__reg_8h.html#ab03e8c6ba2b8e57cbbe1c6f0421c5641a5e4d8fa076d9e0a393b24f839a33d0e9">CMDSTS_DEST_MASK</a>;
<a name="l01324"></a>01324             }
<a name="l01325"></a>01325 <span class="preprocessor">#endif</span>
<a name="l01326"></a>01326 <span class="preprocessor"></span>
<a name="l01327"></a>01327             <a class="code" href="classNet_1_1IpPtr.html">IpPtr</a> <a class="code" href="namespaceiGbReg_1_1TxdOp.html#a95c40243f7e4760653e10ce95673f381">ip</a>(<a class="code" href="classNSGigE.html#a0ef842e4e509199950b7fcc341259980">rxPacket</a>);
<a name="l01328"></a>01328             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#af6f500f63b3d9787299aa4a4fcccb103">extstsEnable</a> &amp;&amp; ip) {
<a name="l01329"></a>01329                 extsts |= EXTSTS_IPPKT;
<a name="l01330"></a>01330                 <a class="code" href="classEtherDevice.html#aee9c236ec7515e3e42242628ce2fc0a1">rxIpChecksums</a>++;
<a name="l01331"></a>01331                 <span class="keywordflow">if</span> (<a class="code" href="namespaceNet.html#a5ec87e377d6c9fd11933ed008df58af2">cksum</a>(ip) != 0) {
<a name="l01332"></a>01332                     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetCksum, <span class="stringliteral">&quot;Rx IP Checksum Error\n&quot;</span>);
<a name="l01333"></a>01333                     extsts |= EXTSTS_IPERR;
<a name="l01334"></a>01334                 }
<a name="l01335"></a>01335                 <a class="code" href="classNet_1_1TcpPtr.html">TcpPtr</a> <a class="code" href="namespaceiGbReg_1_1TxdOp.html#aff380643c92de5f84ae7d6675820723c">tcp</a>(ip);
<a name="l01336"></a>01336                 <a class="code" href="classNet_1_1UdpPtr.html">UdpPtr</a> udp(ip);
<a name="l01337"></a>01337                 <span class="keywordflow">if</span> (tcp) {
<a name="l01338"></a>01338                     extsts |= EXTSTS_TCPPKT;
<a name="l01339"></a>01339                     <a class="code" href="classEtherDevice.html#a769d97454c861bbfdcb1055e9c2c274e">rxTcpChecksums</a>++;
<a name="l01340"></a>01340                     <span class="keywordflow">if</span> (<a class="code" href="namespaceNet.html#a5ec87e377d6c9fd11933ed008df58af2">cksum</a>(tcp) != 0) {
<a name="l01341"></a>01341                         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetCksum, <span class="stringliteral">&quot;Rx TCP Checksum Error\n&quot;</span>);
<a name="l01342"></a>01342                         extsts |= EXTSTS_TCPERR;
<a name="l01343"></a>01343 
<a name="l01344"></a>01344                     }
<a name="l01345"></a>01345                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (udp) {
<a name="l01346"></a>01346                     extsts |= EXTSTS_UDPPKT;
<a name="l01347"></a>01347                     <a class="code" href="classEtherDevice.html#ae1d8f1273caae826a2f3a16e50f5c328">rxUdpChecksums</a>++;
<a name="l01348"></a>01348                     <span class="keywordflow">if</span> (<a class="code" href="namespaceNet.html#a5ec87e377d6c9fd11933ed008df58af2">cksum</a>(udp) != 0) {
<a name="l01349"></a>01349                         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetCksum, <span class="stringliteral">&quot;Rx UDP Checksum Error\n&quot;</span>);
<a name="l01350"></a>01350                         extsts |= EXTSTS_UDPERR;
<a name="l01351"></a>01351                     }
<a name="l01352"></a>01352                 }
<a name="l01353"></a>01353             }
<a name="l01354"></a>01354             <a class="code" href="classNSGigE.html#a0ef842e4e509199950b7fcc341259980">rxPacket</a> = 0;
<a name="l01355"></a>01355 
<a name="l01356"></a>01356             <span class="comment">/*</span>
<a name="l01357"></a>01357 <span class="comment">             * the driver seems to always receive into desc buffers</span>
<a name="l01358"></a>01358 <span class="comment">             * of size 1514, so you never have a pkt that is split</span>
<a name="l01359"></a>01359 <span class="comment">             * into multiple descriptors on the receive side, so</span>
<a name="l01360"></a>01360 <span class="comment">             * i don&#39;t implement that case, hence the assert above.</span>
<a name="l01361"></a>01361 <span class="comment">             */</span>
<a name="l01362"></a>01362 
<a name="l01363"></a>01363             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetDesc,
<a name="l01364"></a>01364                     <span class="stringliteral">&quot;rxDesc: addr=%08x writeback cmdsts extsts\n&quot;</span>,
<a name="l01365"></a>01365                     <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2174f997477d58985b12c3a059d38bf8">rxdp</a> &amp; 0x3fffffff);
<a name="l01366"></a>01366             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetDesc,
<a name="l01367"></a>01367                     <span class="stringliteral">&quot;rxDesc: link=%#x bufptr=%#x cmdsts=%08x extsts=%08x\n&quot;</span>,
<a name="l01368"></a>01368                     link, bufptr, cmdsts, extsts);
<a name="l01369"></a>01369 
<a name="l01370"></a>01370             <a class="code" href="classNSGigE.html#a72d24c697a3184ad7c5dd78c4b1692fb">rxDmaAddr</a> = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2174f997477d58985b12c3a059d38bf8">rxdp</a> &amp; 0x3fffffff;
<a name="l01371"></a>01371             <a class="code" href="classNSGigE.html#a103e4d82ab1ed080bb3babba2b09bb23">rxDmaData</a> = &amp;cmdsts;
<a name="l01372"></a>01372             <span class="keywordflow">if</span> (is64bit) {
<a name="l01373"></a>01373                 <a class="code" href="classNSGigE.html#a72d24c697a3184ad7c5dd78c4b1692fb">rxDmaAddr</a> += offsetof(<a class="code" href="structns__desc64.html">ns_desc64</a>, cmdsts);
<a name="l01374"></a>01374                 <a class="code" href="classNSGigE.html#aff03d713abb5e5d24f05092b1bc98546">rxDmaLen</a> = <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>.<a class="code" href="structns__desc64.html#a436fe4aab8750c7e98c059b512549c05">cmdsts</a>) + <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>.<a class="code" href="structns__desc64.html#ac0dc609d94bcdf47d8a87cc00321a531">extsts</a>);
<a name="l01375"></a>01375             } <span class="keywordflow">else</span> {
<a name="l01376"></a>01376                 <a class="code" href="classNSGigE.html#a72d24c697a3184ad7c5dd78c4b1692fb">rxDmaAddr</a> += offsetof(<a class="code" href="structns__desc32.html">ns_desc32</a>, cmdsts);
<a name="l01377"></a>01377                 <a class="code" href="classNSGigE.html#aff03d713abb5e5d24f05092b1bc98546">rxDmaLen</a> = <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>.<a class="code" href="structns__desc32.html#a3e24fd8f58ccd00550375969412d4915">cmdsts</a>) + <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>.<a class="code" href="structns__desc32.html#a0bb874ccd5bfb9f31b6e6be18f544ada">extsts</a>);
<a name="l01378"></a>01378             }
<a name="l01379"></a>01379             <a class="code" href="classNSGigE.html#ac011716237ad6c71ceb02c519b305e8a">rxDmaFree</a> = <a class="code" href="classNSGigE.html#ad58dedc82d60f8fbeec43fbe43f3a726">dmaDescFree</a>;
<a name="l01380"></a>01380 
<a name="l01381"></a>01381             <a class="code" href="classEtherDevice.html#a8b6394c8b73bfa13584ad19efea1cf3b">descDmaWrites</a>++;
<a name="l01382"></a>01382             <a class="code" href="classEtherDevice.html#a420150292014de18928cd238ddd47985">descDmaWrBytes</a> += <a class="code" href="classNSGigE.html#aff03d713abb5e5d24f05092b1bc98546">rxDmaLen</a>;
<a name="l01383"></a>01383 
<a name="l01384"></a>01384             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a6e6960f594a94d6d1d2ecfd42b0862de">doRxDmaWrite</a>())
<a name="l01385"></a>01385                 <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01386"></a>01386         }
<a name="l01387"></a>01387         <span class="keywordflow">break</span>;
<a name="l01388"></a>01388 
<a name="l01389"></a>01389       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#ae525551f95b665ca94ab6ce5f0f48510aa49978f705a8308da9a1d64b196a1eb3">rxFragWrite</a>:
<a name="l01390"></a>01390         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> != <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa6d0e755f71150562d9034139967941f">dmaIdle</a>)
<a name="l01391"></a>01391             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01392"></a>01392 
<a name="l01393"></a>01393         <a class="code" href="classNSGigE.html#af777184a7b069629f67818b9025adc15">rxPacketBufPtr</a> += <a class="code" href="classNSGigE.html#a0c8ab45b8e570a013b671d8952ec1193">rxXferLen</a>;
<a name="l01394"></a>01394         <a class="code" href="classNSGigE.html#a5bf18fd3cabd4a420f540760525da581" title="ptr to the next byte in current fragment">rxFragPtr</a> += <a class="code" href="classNSGigE.html#a0c8ab45b8e570a013b671d8952ec1193">rxXferLen</a>;
<a name="l01395"></a>01395         <a class="code" href="classNSGigE.html#a3fb29961f0bc18f17040d87f2d8c6d62" title="num of bytes in the current packet being drained from rxDataFifo">rxPktBytes</a> -= <a class="code" href="classNSGigE.html#a0c8ab45b8e570a013b671d8952ec1193">rxXferLen</a>;
<a name="l01396"></a>01396 
<a name="l01397"></a>01397         rxState = rxFifoBlock;
<a name="l01398"></a>01398         <span class="keywordflow">break</span>;
<a name="l01399"></a>01399 
<a name="l01400"></a>01400       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#ae525551f95b665ca94ab6ce5f0f48510acfd2d548265ad052a8b9d40db26086a6">rxDescWrite</a>:
<a name="l01401"></a>01401         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> != <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa6d0e755f71150562d9034139967941f">dmaIdle</a>)
<a name="l01402"></a>01402             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01403"></a>01403 
<a name="l01404"></a>01404         assert(cmdsts &amp; CMDSTS_OWN);
<a name="l01405"></a>01405 
<a name="l01406"></a>01406         assert(<a class="code" href="classNSGigE.html#a0ef842e4e509199950b7fcc341259980">rxPacket</a> == 0);
<a name="l01407"></a>01407         <a class="code" href="classNSGigE.html#a6d9924c69c46eeb592083661da9012e6" title="Interrupt management.">devIntrPost</a>(<a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84a472df975b04a9e64a08a515466219dfa">ISR_RXOK</a>);
<a name="l01408"></a>01408 
<a name="l01409"></a>01409         <span class="keywordflow">if</span> (cmdsts &amp; <a class="code" href="ns__gige__reg_8h.html#ab03e8c6ba2b8e57cbbe1c6f0421c5641a785068b01144b680a5155d09e73fd1bc">CMDSTS_INTR</a>)
<a name="l01410"></a>01410             <a class="code" href="classNSGigE.html#a6d9924c69c46eeb592083661da9012e6" title="Interrupt management.">devIntrPost</a>(<a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84a09dc47cc47b8e6dcb88e4afb936130f5">ISR_RXDESC</a>);
<a name="l01411"></a>01411 
<a name="l01412"></a>01412         <span class="keywordflow">if</span> (!<a class="code" href="classNSGigE.html#abd3ee6dd80adc02a83aabb691332a92d">rxEnable</a>) {
<a name="l01413"></a>01413             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;Halting the RX state machine\n&quot;</span>);
<a name="l01414"></a>01414             rxState = rxIdle;
<a name="l01415"></a>01415             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01416"></a>01416         } <span class="keywordflow">else</span>
<a name="l01417"></a>01417             rxState = rxAdvance;
<a name="l01418"></a>01418         <span class="keywordflow">break</span>;
<a name="l01419"></a>01419 
<a name="l01420"></a>01420       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#ae525551f95b665ca94ab6ce5f0f48510a2f678996303ed4b11cf9403f1427ef17">rxAdvance</a>:
<a name="l01421"></a>01421         <span class="keywordflow">if</span> (link == 0) {
<a name="l01422"></a>01422             <a class="code" href="classNSGigE.html#a6d9924c69c46eeb592083661da9012e6" title="Interrupt management.">devIntrPost</a>(<a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84aeaba8ecba36bf0fbd0857553f317c5b9">ISR_RXIDLE</a>);
<a name="l01423"></a>01423             rxState = rxIdle;
<a name="l01424"></a>01424             <a class="code" href="classNSGigE.html#a47964f2eddd257dd82a72a49e07e2952" title="Current Receive Descriptor Done.">CRDD</a> = <span class="keyword">true</span>;
<a name="l01425"></a>01425             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01426"></a>01426         } <span class="keywordflow">else</span> {
<a name="l01427"></a>01427             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> != <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa6d0e755f71150562d9034139967941f">dmaIdle</a>)
<a name="l01428"></a>01428                 <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01429"></a>01429             rxState = rxDescRead;
<a name="l01430"></a>01430             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2174f997477d58985b12c3a059d38bf8">rxdp</a> = link;
<a name="l01431"></a>01431             <a class="code" href="classNSGigE.html#a47964f2eddd257dd82a72a49e07e2952" title="Current Receive Descriptor Done.">CRDD</a> = <span class="keyword">false</span>;
<a name="l01432"></a>01432 
<a name="l01433"></a>01433             <a class="code" href="classNSGigE.html#a72d24c697a3184ad7c5dd78c4b1692fb">rxDmaAddr</a> = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2174f997477d58985b12c3a059d38bf8">rxdp</a> &amp; 0x3fffffff;
<a name="l01434"></a>01434             <a class="code" href="classNSGigE.html#a103e4d82ab1ed080bb3babba2b09bb23">rxDmaData</a> = is64bit ? (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a> : (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>;
<a name="l01435"></a>01435             <a class="code" href="classNSGigE.html#aff03d713abb5e5d24f05092b1bc98546">rxDmaLen</a> = is64bit ? <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>) : <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>);
<a name="l01436"></a>01436             <a class="code" href="classNSGigE.html#ac011716237ad6c71ceb02c519b305e8a">rxDmaFree</a> = <a class="code" href="classNSGigE.html#ad58dedc82d60f8fbeec43fbe43f3a726">dmaDescFree</a>;
<a name="l01437"></a>01437 
<a name="l01438"></a>01438             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a8f22a0749d7c07defc7a51f879b8cbcf">doRxDmaRead</a>())
<a name="l01439"></a>01439                 <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01440"></a>01440         }
<a name="l01441"></a>01441         <span class="keywordflow">break</span>;
<a name="l01442"></a>01442 
<a name="l01443"></a>01443       <span class="keywordflow">default</span>:
<a name="l01444"></a>01444         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Invalid rxState!&quot;</span>);
<a name="l01445"></a>01445     }
<a name="l01446"></a>01446 
<a name="l01447"></a>01447     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;entering next rxState=%s\n&quot;</span>,
<a name="l01448"></a>01448             <a class="code" href="ns__gige_8cc.html#ad6f3c3e40104a80a184491a00ba6a41d">NsRxStateStrings</a>[rxState]);
<a name="l01449"></a>01449     <span class="keywordflow">goto</span> next;
<a name="l01450"></a>01450 
<a name="l01451"></a>01451   <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>:
<a name="l01455"></a>01455     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;rx state machine exited rxState=%s\n&quot;</span>,
<a name="l01456"></a>01456             <a class="code" href="ns__gige_8cc.html#ad6f3c3e40104a80a184491a00ba6a41d">NsRxStateStrings</a>[rxState]);
<a name="l01457"></a>01457 
<a name="l01458"></a>01458     <span class="keywordflow">if</span> (!<a class="code" href="classNSGigE.html#ab2e7c701035b1897012b8a4ba62b6ff4">rxKickEvent</a>.<a class="code" href="classEvent.html#a36bdc2ee73215ed7670a7bfc0f25ab8b" title="Determine if the current event is scheduled.">scheduled</a>())
<a name="l01459"></a>01459         <a class="code" href="classEventManager.html#a749a10828b2dd5017a2582960d04e400">schedule</a>(<a class="code" href="classNSGigE.html#ab2e7c701035b1897012b8a4ba62b6ff4">rxKickEvent</a>, <a class="code" href="classNSGigE.html#aa7d7349c084992d2d9ba6f3db2f0dfb6">rxKickTick</a>);
<a name="l01460"></a>01460 }
<a name="l01461"></a>01461 
<a name="l01462"></a>01462 <span class="keywordtype">void</span>
<a name="l01463"></a><a class="code" href="classNSGigE.html#a60efe7cad4f7197b11b413f06cb4777d">01463</a> <a class="code" href="classNSGigE.html#a60efe7cad4f7197b11b413f06cb4777d" title="Retransmit event.">NSGigE::transmit</a>()
<a name="l01464"></a>01464 {
<a name="l01465"></a>01465     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#aa4dbf488d04bc18c8c388595869a5d17">empty</a>()) {
<a name="l01466"></a>01466         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet, <span class="stringliteral">&quot;nothing to transmit\n&quot;</span>);
<a name="l01467"></a>01467         <span class="keywordflow">return</span>;
<a name="l01468"></a>01468     }
<a name="l01469"></a>01469 
<a name="l01470"></a>01470     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet, <span class="stringliteral">&quot;Attempt Pkt Transmit: txFifo length=%d\n&quot;</span>,
<a name="l01471"></a>01471             <a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#a2dbca9a15d75e1729f8d3f5581161773">size</a>());
<a name="l01472"></a>01472     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#ab0989afb60b9d6f0f049b35976d17264">interface</a>-&gt;<a class="code" href="classEtherInt.html#a7e6519bf1b247256aab9ef8bcc9441c3">sendPacket</a>(<a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#a748426efffbc0b6e2f151cbc0b5d9884">front</a>())) {
<a name="l01473"></a>01473 <span class="preprocessor">#if TRACING_ON</span>
<a name="l01474"></a>01474 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="trace_8hh.html#af76c9f7776aade1bf9d7dfa8a0c6b341">DTRACE</a>(Ethernet)) {
<a name="l01475"></a>01475             <a class="code" href="classNet_1_1IpPtr.html">IpPtr</a> <a class="code" href="namespaceiGbReg_1_1TxdOp.html#a95c40243f7e4760653e10ce95673f381">ip</a>(<a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#a748426efffbc0b6e2f151cbc0b5d9884">front</a>());
<a name="l01476"></a>01476             <span class="keywordflow">if</span> (<a class="code" href="namespaceiGbReg_1_1TxdOp.html#a95c40243f7e4760653e10ce95673f381">ip</a>) {
<a name="l01477"></a>01477                 <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet, <span class="stringliteral">&quot;ID is %d\n&quot;</span>, <a class="code" href="namespaceiGbReg_1_1TxdOp.html#a95c40243f7e4760653e10ce95673f381">ip</a>-&gt;id());
<a name="l01478"></a>01478                 <a class="code" href="classNet_1_1TcpPtr.html">TcpPtr</a> <a class="code" href="namespaceiGbReg_1_1TxdOp.html#aff380643c92de5f84ae7d6675820723c">tcp</a>(<a class="code" href="namespaceiGbReg_1_1TxdOp.html#a95c40243f7e4760653e10ce95673f381">ip</a>);
<a name="l01479"></a>01479                 <span class="keywordflow">if</span> (tcp) {
<a name="l01480"></a>01480                     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet,
<a name="l01481"></a>01481                             <span class="stringliteral">&quot;Src Port=%d, Dest Port=%d, Seq=%d, Ack=%d\n&quot;</span>,
<a name="l01482"></a>01482                             tcp-&gt;sport(), tcp-&gt;dport(), tcp-&gt;seq(),
<a name="l01483"></a>01483                             tcp-&gt;ack());
<a name="l01484"></a>01484                 }
<a name="l01485"></a>01485             }
<a name="l01486"></a>01486         }
<a name="l01487"></a>01487 <span class="preprocessor">#endif</span>
<a name="l01488"></a>01488 <span class="preprocessor"></span>
<a name="l01489"></a>01489         <a class="code" href="trace_8hh.html#a556faf39d3fa9f7db5f344487ddbb397">DDUMP</a>(EthernetData, <a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#a748426efffbc0b6e2f151cbc0b5d9884">front</a>()-&gt;<a class="code" href="classRefCountingPtr.html#a6b357f8b956e6421ef12211897528b6d" title="The stored pointer.">data</a>, <a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#a748426efffbc0b6e2f151cbc0b5d9884">front</a>()-&gt;length);
<a name="l01490"></a>01490         <a class="code" href="classEtherDevice.html#a372ada2debd208f712085a2ac60c12ab">txBytes</a> += <a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#a748426efffbc0b6e2f151cbc0b5d9884">front</a>()-&gt;length;
<a name="l01491"></a>01491         <a class="code" href="classEtherDevice.html#a844ad3c63250e548dd5557c44a9fd89c">txPackets</a>++;
<a name="l01492"></a>01492 
<a name="l01493"></a>01493         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet, <span class="stringliteral">&quot;Successful Xmit! now txFifoAvail is %d\n&quot;</span>,
<a name="l01494"></a>01494                 <a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#a5abf953b4c5e2ef51cdb1045424d3214">avail</a>());
<a name="l01495"></a>01495         <a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#ad56389c821fb424d8e71dde61c33aed4">pop</a>();
<a name="l01496"></a>01496 
<a name="l01497"></a>01497         <span class="comment">/*</span>
<a name="l01498"></a>01498 <span class="comment">         * normally do a writeback of the descriptor here, and ONLY</span>
<a name="l01499"></a>01499 <span class="comment">         * after that is done, send this interrupt.  but since our</span>
<a name="l01500"></a>01500 <span class="comment">         * stuff never actually fails, just do this interrupt here,</span>
<a name="l01501"></a>01501 <span class="comment">         * otherwise the code has to stray from this nice format.</span>
<a name="l01502"></a>01502 <span class="comment">         * besides, it&#39;s functionally the same.</span>
<a name="l01503"></a>01503 <span class="comment">         */</span>
<a name="l01504"></a>01504         <a class="code" href="classNSGigE.html#a6d9924c69c46eeb592083661da9012e6" title="Interrupt management.">devIntrPost</a>(<a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84a517d681f1339e3a103166dd37bd6e6bb">ISR_TXOK</a>);
<a name="l01505"></a>01505     }
<a name="l01506"></a>01506 
<a name="l01507"></a>01507    <span class="keywordflow">if</span> (!<a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#aa4dbf488d04bc18c8c388595869a5d17">empty</a>() &amp;&amp; !<a class="code" href="classNSGigE.html#a12950bf2b9b52611e65f9411f221d1f5">txEvent</a>.<a class="code" href="classEvent.html#a36bdc2ee73215ed7670a7bfc0f25ab8b" title="Determine if the current event is scheduled.">scheduled</a>()) {
<a name="l01508"></a>01508        <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet, <span class="stringliteral">&quot;reschedule transmit\n&quot;</span>);
<a name="l01509"></a>01509        <a class="code" href="classEventManager.html#a749a10828b2dd5017a2582960d04e400">schedule</a>(<a class="code" href="classNSGigE.html#a12950bf2b9b52611e65f9411f221d1f5">txEvent</a>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>() + <a class="code" href="core_8hh.html#aabf2ecba12e5e7712c4926d64bd10b46">retryTime</a>);
<a name="l01510"></a>01510    }
<a name="l01511"></a>01511 }
<a name="l01512"></a>01512 
<a name="l01513"></a>01513 <span class="keywordtype">bool</span>
<a name="l01514"></a><a class="code" href="classNSGigE.html#a00e372ccb15b7f8384eb2b42b116c669">01514</a> <a class="code" href="classNSGigE.html#a00e372ccb15b7f8384eb2b42b116c669">NSGigE::doTxDmaRead</a>()
<a name="l01515"></a>01515 {
<a name="l01516"></a>01516     assert(<a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa6d0e755f71150562d9034139967941f">dmaIdle</a> || <a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432a4034c574db402302229306bd7ff355d6">dmaReadWaiting</a>);
<a name="l01517"></a>01517     <a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> = dmaReading;
<a name="l01518"></a>01518 
<a name="l01519"></a>01519     <span class="keywordflow">if</span> (<a class="code" href="classDmaDevice.html#a4672e6f8435fb000ee7830f235ec11d5">dmaPending</a>() || <a class="code" href="classDrainable.html#a0e5f525d2e1df1af3e87ce17530b40dc">getDrainState</a>() != <a class="code" href="classDrainable.html#a6173416423af6af1bfe17262be40b5ffa2cea28320073053047fb4cd4471b5075">Running</a>)
<a name="l01520"></a>01520         <a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> = dmaReadWaiting;
<a name="l01521"></a>01521     <span class="keywordflow">else</span>
<a name="l01522"></a>01522         <a class="code" href="classDmaDevice.html#a5e2f5335eff62ca1326f567cd355d992">dmaRead</a>(<a class="code" href="classNSGigE.html#a4b78f3a978843d16fb8a930d2d810e2b">txDmaAddr</a>, <a class="code" href="classNSGigE.html#af6ecb02dc9ebe79715a1b1dff7976096">txDmaLen</a>, &amp;<a class="code" href="classNSGigE.html#a30f7e59380f281b27dfe5074e4a398b4">txDmaReadEvent</a>, (uint8_t*)<a class="code" href="classNSGigE.html#a4ee4e63250e8c724e3354702dc1fb5cb">txDmaData</a>);
<a name="l01523"></a>01523 
<a name="l01524"></a>01524     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01525"></a>01525 }
<a name="l01526"></a>01526 
<a name="l01527"></a>01527 <span class="keywordtype">void</span>
<a name="l01528"></a><a class="code" href="classNSGigE.html#aa07d98029b088f55a456fdcd7d6154a9">01528</a> <a class="code" href="classNSGigE.html#aa07d98029b088f55a456fdcd7d6154a9">NSGigE::txDmaReadDone</a>()
<a name="l01529"></a>01529 {
<a name="l01530"></a>01530     assert(<a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432acc16d5445eb241eb4d8bb5058d4f24b6">dmaReading</a>);
<a name="l01531"></a>01531     <a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> = dmaIdle;
<a name="l01532"></a>01532 
<a name="l01533"></a>01533     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetDMA, <span class="stringliteral">&quot;tx dma read  paddr=%#x len=%d\n&quot;</span>,
<a name="l01534"></a>01534             <a class="code" href="classNSGigE.html#a4b78f3a978843d16fb8a930d2d810e2b">txDmaAddr</a>, <a class="code" href="classNSGigE.html#af6ecb02dc9ebe79715a1b1dff7976096">txDmaLen</a>);
<a name="l01535"></a>01535     <a class="code" href="trace_8hh.html#a556faf39d3fa9f7db5f344487ddbb397">DDUMP</a>(EthernetDMA, <a class="code" href="classNSGigE.html#a4ee4e63250e8c724e3354702dc1fb5cb">txDmaData</a>, <a class="code" href="classNSGigE.html#af6ecb02dc9ebe79715a1b1dff7976096">txDmaLen</a>);
<a name="l01536"></a>01536 
<a name="l01537"></a>01537     <span class="comment">// If the receive state machine  has a pending DMA, let it go first</span>
<a name="l01538"></a>01538     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432a4034c574db402302229306bd7ff355d6">dmaReadWaiting</a> || <a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432a4e1c9ae1af6b515947eca20fbde485c0">dmaWriteWaiting</a>)
<a name="l01539"></a>01539         <a class="code" href="classNSGigE.html#aec2097dcddfbd9263ce8cfd2fd11c474">rxKick</a>();
<a name="l01540"></a>01540 
<a name="l01541"></a>01541     <a class="code" href="classNSGigE.html#ac37bda95e09a290e343ef80fc3fc9e2b">txKick</a>();
<a name="l01542"></a>01542 }
<a name="l01543"></a>01543 
<a name="l01544"></a>01544 <span class="keywordtype">bool</span>
<a name="l01545"></a><a class="code" href="classNSGigE.html#a31cb1112372e413cf5206f8f3e0b2b7d">01545</a> <a class="code" href="classNSGigE.html#a31cb1112372e413cf5206f8f3e0b2b7d">NSGigE::doTxDmaWrite</a>()
<a name="l01546"></a>01546 {
<a name="l01547"></a>01547     assert(<a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa6d0e755f71150562d9034139967941f">dmaIdle</a> || <a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432a4e1c9ae1af6b515947eca20fbde485c0">dmaWriteWaiting</a>);
<a name="l01548"></a>01548     <a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> = dmaWriting;
<a name="l01549"></a>01549 
<a name="l01550"></a>01550     <span class="keywordflow">if</span> (<a class="code" href="classDmaDevice.html#a4672e6f8435fb000ee7830f235ec11d5">dmaPending</a>() || <a class="code" href="classDrainable.html#a0e5f525d2e1df1af3e87ce17530b40dc">getDrainState</a>() != <a class="code" href="classDrainable.html#a6173416423af6af1bfe17262be40b5ffa2cea28320073053047fb4cd4471b5075">Running</a>)
<a name="l01551"></a>01551         <a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> = dmaWriteWaiting;
<a name="l01552"></a>01552     <span class="keywordflow">else</span>
<a name="l01553"></a>01553         <a class="code" href="classDmaDevice.html#ada6ca94d958378ea74a108a52f067888">dmaWrite</a>(<a class="code" href="classNSGigE.html#a4b78f3a978843d16fb8a930d2d810e2b">txDmaAddr</a>, <a class="code" href="classNSGigE.html#af6ecb02dc9ebe79715a1b1dff7976096">txDmaLen</a>, &amp;<a class="code" href="classNSGigE.html#a6dc6246d366e87280e8433f177200639">txDmaWriteEvent</a>, (uint8_t*)<a class="code" href="classNSGigE.html#a4ee4e63250e8c724e3354702dc1fb5cb">txDmaData</a>);
<a name="l01554"></a>01554     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01555"></a>01555 }
<a name="l01556"></a>01556 
<a name="l01557"></a>01557 <span class="keywordtype">void</span>
<a name="l01558"></a><a class="code" href="classNSGigE.html#a06d9fcacc5b47b20f16d9c8303171e46">01558</a> <a class="code" href="classNSGigE.html#a06d9fcacc5b47b20f16d9c8303171e46">NSGigE::txDmaWriteDone</a>()
<a name="l01559"></a>01559 {
<a name="l01560"></a>01560     assert(<a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa30c5324ded4755003f71c298c92f605">dmaWriting</a>);
<a name="l01561"></a>01561     <a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> = dmaIdle;
<a name="l01562"></a>01562 
<a name="l01563"></a>01563     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetDMA, <span class="stringliteral">&quot;tx dma write paddr=%#x len=%d\n&quot;</span>,
<a name="l01564"></a>01564             <a class="code" href="classNSGigE.html#a4b78f3a978843d16fb8a930d2d810e2b">txDmaAddr</a>, <a class="code" href="classNSGigE.html#af6ecb02dc9ebe79715a1b1dff7976096">txDmaLen</a>);
<a name="l01565"></a>01565     <a class="code" href="trace_8hh.html#a556faf39d3fa9f7db5f344487ddbb397">DDUMP</a>(EthernetDMA, <a class="code" href="classNSGigE.html#a4ee4e63250e8c724e3354702dc1fb5cb">txDmaData</a>, <a class="code" href="classNSGigE.html#af6ecb02dc9ebe79715a1b1dff7976096">txDmaLen</a>);
<a name="l01566"></a>01566 
<a name="l01567"></a>01567     <span class="comment">// If the receive state machine  has a pending DMA, let it go first</span>
<a name="l01568"></a>01568     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432a4034c574db402302229306bd7ff355d6">dmaReadWaiting</a> || <a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> == <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432a4e1c9ae1af6b515947eca20fbde485c0">dmaWriteWaiting</a>)
<a name="l01569"></a>01569         <a class="code" href="classNSGigE.html#aec2097dcddfbd9263ce8cfd2fd11c474">rxKick</a>();
<a name="l01570"></a>01570 
<a name="l01571"></a>01571     <a class="code" href="classNSGigE.html#ac37bda95e09a290e343ef80fc3fc9e2b">txKick</a>();
<a name="l01572"></a>01572 }
<a name="l01573"></a>01573 
<a name="l01574"></a>01574 <span class="keywordtype">void</span>
<a name="l01575"></a><a class="code" href="classNSGigE.html#ac37bda95e09a290e343ef80fc3fc9e2b">01575</a> <a class="code" href="classNSGigE.html#ac37bda95e09a290e343ef80fc3fc9e2b">NSGigE::txKick</a>()
<a name="l01576"></a>01576 {
<a name="l01577"></a>01577     <span class="keywordtype">bool</span> is64bit = (bool)(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a7b90dafdbf78c3094e26e3b445a45118">config</a> &amp; <a class="code" href="ns__gige__reg_8h.html#abc05549c258a8fcedcead004aa87e5b5a7bf5a5a54dab741cd91dcfcba6d6c46f">CFGR_M64ADDR</a>);
<a name="l01578"></a>01578 
<a name="l01579"></a>01579     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;transmit kick txState=%s %d-bit\n&quot;</span>,
<a name="l01580"></a>01580             <a class="code" href="ns__gige_8cc.html#ae072bc5252468e83d34f7c497ad3ce71">NsTxStateStrings</a>[<a class="code" href="classNSGigE.html#ab9b31ecee249b2c50ef0ce8de53a9f63">txState</a>], is64bit ? 64 : 32);
<a name="l01581"></a>01581 
<a name="l01582"></a>01582     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> link, bufptr;
<a name="l01583"></a>01583     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> &amp;cmdsts = is64bit ? <a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>.<a class="code" href="structns__desc64.html#a436fe4aab8750c7e98c059b512549c05">cmdsts</a> : <a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>.<a class="code" href="structns__desc32.html#a3e24fd8f58ccd00550375969412d4915">cmdsts</a>;
<a name="l01584"></a>01584     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> &amp;extsts = is64bit ? <a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>.<a class="code" href="structns__desc64.html#ac0dc609d94bcdf47d8a87cc00321a531">extsts</a> : <a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>.<a class="code" href="structns__desc32.html#a0bb874ccd5bfb9f31b6e6be18f544ada">extsts</a>;
<a name="l01585"></a>01585 
<a name="l01586"></a>01586   next:
<a name="l01587"></a>01587     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a571a3c7d12873ad3fa81db8a488459e2">txKickTick</a> &gt; <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>()) {
<a name="l01588"></a>01588         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;transmit kick exiting, can&#39;t run till %d\n&quot;</span>,
<a name="l01589"></a>01589                 <a class="code" href="classNSGigE.html#a571a3c7d12873ad3fa81db8a488459e2">txKickTick</a>);
<a name="l01590"></a>01590         <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01591"></a>01591     }
<a name="l01592"></a>01592 
<a name="l01593"></a>01593     <span class="comment">// Go to the next state machine clock tick.</span>
<a name="l01594"></a>01594     <a class="code" href="classNSGigE.html#a571a3c7d12873ad3fa81db8a488459e2">txKickTick</a> = <a class="code" href="classClockedObject.html#a7c1f64c925f158530be84323a503dbb7" title="Determine the tick when a cycle begins, by default the current one, but the argument also enables the...">clockEdge</a>(<a class="code" href="classCycles.html" title="Cycles is a wrapper class for representing cycle counts, i.e.">Cycles</a>(1));
<a name="l01595"></a>01595 
<a name="l01596"></a>01596     <span class="keywordflow">switch</span>(<a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a>) {
<a name="l01597"></a>01597       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432a4034c574db402302229306bd7ff355d6">dmaReadWaiting</a>:
<a name="l01598"></a>01598         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a00e372ccb15b7f8384eb2b42b116c669">doTxDmaRead</a>())
<a name="l01599"></a>01599             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01600"></a>01600         <span class="keywordflow">break</span>;
<a name="l01601"></a>01601       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432a4e1c9ae1af6b515947eca20fbde485c0">dmaWriteWaiting</a>:
<a name="l01602"></a>01602         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a31cb1112372e413cf5206f8f3e0b2b7d">doTxDmaWrite</a>())
<a name="l01603"></a>01603             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01604"></a>01604         <span class="keywordflow">break</span>;
<a name="l01605"></a>01605       <span class="keywordflow">default</span>:
<a name="l01606"></a>01606         <span class="keywordflow">break</span>;
<a name="l01607"></a>01607     }
<a name="l01608"></a>01608 
<a name="l01609"></a>01609     link = is64bit ? (Addr)<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>.<a class="code" href="structns__desc64.html#ab8f1bd57eea3d30c7df8f5ecf33f7b7d">link</a> : (<a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a>)<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>.<a class="code" href="structns__desc32.html#acf6b169af8584eaeeafbfdec9b7a2bf1">link</a>;
<a name="l01610"></a>01610     bufptr = is64bit ? (Addr)<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>.<a class="code" href="structns__desc64.html#a5eeef802e303dbc13955b0dd997352ab">bufptr</a> : (<a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a>)<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>.<a class="code" href="structns__desc32.html#a0a47a3d5c0183ab5cd6567ee7d89ea32">bufptr</a>;
<a name="l01611"></a>01611     <span class="keywordflow">switch</span> (txState) {
<a name="l01612"></a>01612       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#a96770da20ac1781f03a08eaed5d8fdcda9fd2e93087d0af025f9d021a93a210f2">txIdle</a>:
<a name="l01613"></a>01613         <span class="keywordflow">if</span> (!<a class="code" href="classNSGigE.html#ac12794e1d7747b59b28f474813e42b6f">txEnable</a>) {
<a name="l01614"></a>01614             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;Transmit disabled.  Nothing to do.\n&quot;</span>);
<a name="l01615"></a>01615             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01616"></a>01616         }
<a name="l01617"></a>01617 
<a name="l01618"></a>01618         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a42daaa387f54470e251759d4f42aed8a" title="Current Transmit Descriptor Done.">CTDD</a>) {
<a name="l01619"></a>01619             txState = txDescRefr;
<a name="l01620"></a>01620 
<a name="l01621"></a>01621             <a class="code" href="classNSGigE.html#a4b78f3a978843d16fb8a930d2d810e2b">txDmaAddr</a> = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acff64aa194acd44f476d4a1f741203e1">txdp</a> &amp; 0x3fffffff;
<a name="l01622"></a>01622             <a class="code" href="classNSGigE.html#a4ee4e63250e8c724e3354702dc1fb5cb">txDmaData</a> =
<a name="l01623"></a>01623                 is64bit ? (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>.<a class="code" href="structns__desc64.html#ab8f1bd57eea3d30c7df8f5ecf33f7b7d">link</a> : (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>.<a class="code" href="structns__desc32.html#acf6b169af8584eaeeafbfdec9b7a2bf1">link</a>;
<a name="l01624"></a>01624             <a class="code" href="classNSGigE.html#af6ecb02dc9ebe79715a1b1dff7976096">txDmaLen</a> = is64bit ? <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>.<a class="code" href="structns__desc64.html#ab8f1bd57eea3d30c7df8f5ecf33f7b7d">link</a>) : <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>.<a class="code" href="structns__desc32.html#acf6b169af8584eaeeafbfdec9b7a2bf1">link</a>);
<a name="l01625"></a>01625             <a class="code" href="classNSGigE.html#a01a9ee317b5a21b068b10e6c66c9703b">txDmaFree</a> = <a class="code" href="classNSGigE.html#ad58dedc82d60f8fbeec43fbe43f3a726">dmaDescFree</a>;
<a name="l01626"></a>01626 
<a name="l01627"></a>01627             <a class="code" href="classEtherDevice.html#a0e15528d29e1ba23ac90008f8cfc3996">descDmaReads</a>++;
<a name="l01628"></a>01628             <a class="code" href="classEtherDevice.html#a84700d6596dacdb2dd61880560cc95bd">descDmaRdBytes</a> += <a class="code" href="classNSGigE.html#af6ecb02dc9ebe79715a1b1dff7976096">txDmaLen</a>;
<a name="l01629"></a>01629 
<a name="l01630"></a>01630             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a00e372ccb15b7f8384eb2b42b116c669">doTxDmaRead</a>())
<a name="l01631"></a>01631                 <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01632"></a>01632 
<a name="l01633"></a>01633         } <span class="keywordflow">else</span> {
<a name="l01634"></a>01634             txState = txDescRead;
<a name="l01635"></a>01635 
<a name="l01636"></a>01636             <a class="code" href="classNSGigE.html#a4b78f3a978843d16fb8a930d2d810e2b">txDmaAddr</a> = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acff64aa194acd44f476d4a1f741203e1">txdp</a> &amp; 0x3fffffff;
<a name="l01637"></a>01637             <a class="code" href="classNSGigE.html#a4ee4e63250e8c724e3354702dc1fb5cb">txDmaData</a> = is64bit ? (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a> : (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>;
<a name="l01638"></a>01638             <a class="code" href="classNSGigE.html#af6ecb02dc9ebe79715a1b1dff7976096">txDmaLen</a> = is64bit ? <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>) : <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>);
<a name="l01639"></a>01639             <a class="code" href="classNSGigE.html#a01a9ee317b5a21b068b10e6c66c9703b">txDmaFree</a> = <a class="code" href="classNSGigE.html#ad58dedc82d60f8fbeec43fbe43f3a726">dmaDescFree</a>;
<a name="l01640"></a>01640 
<a name="l01641"></a>01641             <a class="code" href="classEtherDevice.html#a0e15528d29e1ba23ac90008f8cfc3996">descDmaReads</a>++;
<a name="l01642"></a>01642             <a class="code" href="classEtherDevice.html#a84700d6596dacdb2dd61880560cc95bd">descDmaRdBytes</a> += <a class="code" href="classNSGigE.html#af6ecb02dc9ebe79715a1b1dff7976096">txDmaLen</a>;
<a name="l01643"></a>01643 
<a name="l01644"></a>01644             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a00e372ccb15b7f8384eb2b42b116c669">doTxDmaRead</a>())
<a name="l01645"></a>01645                 <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01646"></a>01646         }
<a name="l01647"></a>01647         <span class="keywordflow">break</span>;
<a name="l01648"></a>01648 
<a name="l01649"></a>01649       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#a96770da20ac1781f03a08eaed5d8fdcda63c0d99759b163b5c4afcfd52d642a16">txDescRefr</a>:
<a name="l01650"></a>01650         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> != <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa6d0e755f71150562d9034139967941f">dmaIdle</a>)
<a name="l01651"></a>01651             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01652"></a>01652 
<a name="l01653"></a>01653         txState = txAdvance;
<a name="l01654"></a>01654         <span class="keywordflow">break</span>;
<a name="l01655"></a>01655 
<a name="l01656"></a>01656       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#a96770da20ac1781f03a08eaed5d8fdcda838d3218386f25e226d79aec7f0b27ea">txDescRead</a>:
<a name="l01657"></a>01657         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> != <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa6d0e755f71150562d9034139967941f">dmaIdle</a>)
<a name="l01658"></a>01658             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01659"></a>01659 
<a name="l01660"></a>01660         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetDesc, <span class="stringliteral">&quot;txDesc: addr=%08x read descriptor\n&quot;</span>,
<a name="l01661"></a>01661                 <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acff64aa194acd44f476d4a1f741203e1">txdp</a> &amp; 0x3fffffff);
<a name="l01662"></a>01662         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetDesc,
<a name="l01663"></a>01663                 <span class="stringliteral">&quot;txDesc: link=%#x bufptr=%#x cmdsts=%#08x extsts=%#08x\n&quot;</span>,
<a name="l01664"></a>01664                 link, bufptr, cmdsts, extsts);
<a name="l01665"></a>01665 
<a name="l01666"></a>01666         <span class="keywordflow">if</span> (cmdsts &amp; <a class="code" href="ns__gige__reg_8h.html#ab03e8c6ba2b8e57cbbe1c6f0421c5641acafcc1556a555eecf204cf3803daca5f">CMDSTS_OWN</a>) {
<a name="l01667"></a>01667             txState = txFifoBlock;
<a name="l01668"></a>01668             <a class="code" href="classNSGigE.html#a35898de98a734b7d95c842ea88e88b46" title="ptr to the next byte in the current fragment">txFragPtr</a> = bufptr;
<a name="l01669"></a>01669             <a class="code" href="classNSGigE.html#a66ca0e897397c87dc5c667ab26d5bafe" title="count of bytes remaining in the current descriptor">txDescCnt</a> = cmdsts &amp; CMDSTS_LEN_MASK;
<a name="l01670"></a>01670         } <span class="keywordflow">else</span> {
<a name="l01671"></a>01671             <a class="code" href="classNSGigE.html#a6d9924c69c46eeb592083661da9012e6" title="Interrupt management.">devIntrPost</a>(<a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84ae4a5db36871c2a3322b708854515dafe">ISR_TXIDLE</a>);
<a name="l01672"></a>01672             txState = txIdle;
<a name="l01673"></a>01673             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01674"></a>01674         }
<a name="l01675"></a>01675         <span class="keywordflow">break</span>;
<a name="l01676"></a>01676 
<a name="l01677"></a>01677       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#a96770da20ac1781f03a08eaed5d8fdcda52bd5c63d514fcfac6879b0ac3ca8450">txFifoBlock</a>:
<a name="l01678"></a>01678         <span class="keywordflow">if</span> (!<a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a>) {
<a name="l01679"></a>01679             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;****starting the tx of a new packet****\n&quot;</span>);
<a name="l01680"></a>01680             <a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a> = <span class="keyword">new</span> <a class="code" href="classEthPacketData.html">EthPacketData</a>(16384);
<a name="l01681"></a>01681             <a class="code" href="classNSGigE.html#a83d14ec681383903f0a29949bdb99019">txPacketBufPtr</a> = <a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a>-&gt;<a class="code" href="classRefCountingPtr.html#a6b357f8b956e6421ef12211897528b6d" title="The stored pointer.">data</a>;
<a name="l01682"></a>01682         }
<a name="l01683"></a>01683 
<a name="l01684"></a>01684         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a66ca0e897397c87dc5c667ab26d5bafe" title="count of bytes remaining in the current descriptor">txDescCnt</a> == 0) {
<a name="l01685"></a>01685             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;the txDescCnt == 0, done with descriptor\n&quot;</span>);
<a name="l01686"></a>01686             <span class="keywordflow">if</span> (cmdsts &amp; <a class="code" href="ns__gige__reg_8h.html#ab03e8c6ba2b8e57cbbe1c6f0421c5641a39ecfef56623b83c0eaf11a953dbc26f">CMDSTS_MORE</a>) {
<a name="l01687"></a>01687                 <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;there are more descriptors to come\n&quot;</span>);
<a name="l01688"></a>01688                 txState = txDescWrite;
<a name="l01689"></a>01689 
<a name="l01690"></a>01690                 cmdsts &amp;= ~CMDSTS_OWN;
<a name="l01691"></a>01691 
<a name="l01692"></a>01692                 <a class="code" href="classNSGigE.html#a4b78f3a978843d16fb8a930d2d810e2b">txDmaAddr</a> = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acff64aa194acd44f476d4a1f741203e1">txdp</a> &amp; 0x3fffffff;
<a name="l01693"></a>01693                 <a class="code" href="classNSGigE.html#a4ee4e63250e8c724e3354702dc1fb5cb">txDmaData</a> = &amp;cmdsts;
<a name="l01694"></a>01694                 <span class="keywordflow">if</span> (is64bit) {
<a name="l01695"></a>01695                     <a class="code" href="classNSGigE.html#a4b78f3a978843d16fb8a930d2d810e2b">txDmaAddr</a> += offsetof(<a class="code" href="structns__desc64.html">ns_desc64</a>, cmdsts);
<a name="l01696"></a>01696                     <a class="code" href="classNSGigE.html#af6ecb02dc9ebe79715a1b1dff7976096">txDmaLen</a> = <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>.<a class="code" href="structns__desc64.html#a436fe4aab8750c7e98c059b512549c05">cmdsts</a>);
<a name="l01697"></a>01697                 } <span class="keywordflow">else</span> {
<a name="l01698"></a>01698                     <a class="code" href="classNSGigE.html#a4b78f3a978843d16fb8a930d2d810e2b">txDmaAddr</a> += offsetof(<a class="code" href="structns__desc32.html">ns_desc32</a>, cmdsts);
<a name="l01699"></a>01699                     <a class="code" href="classNSGigE.html#af6ecb02dc9ebe79715a1b1dff7976096">txDmaLen</a> = <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>.<a class="code" href="structns__desc32.html#a3e24fd8f58ccd00550375969412d4915">cmdsts</a>);
<a name="l01700"></a>01700                 }
<a name="l01701"></a>01701                 <a class="code" href="classNSGigE.html#a01a9ee317b5a21b068b10e6c66c9703b">txDmaFree</a> = <a class="code" href="classNSGigE.html#ad58dedc82d60f8fbeec43fbe43f3a726">dmaDescFree</a>;
<a name="l01702"></a>01702 
<a name="l01703"></a>01703                 <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a31cb1112372e413cf5206f8f3e0b2b7d">doTxDmaWrite</a>())
<a name="l01704"></a>01704                     <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01705"></a>01705 
<a name="l01706"></a>01706             } <span class="keywordflow">else</span> { <span class="comment">/* this packet is totally done */</span>
<a name="l01707"></a>01707                 <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;This packet is done, let&#39;s wrap it up\n&quot;</span>);
<a name="l01708"></a>01708                 <span class="comment">/* deal with the the packet that just finished */</span>
<a name="l01709"></a>01709                 <span class="keywordflow">if</span> ((<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#ad97af13deb1a5c24f449f538b0bf695d">vtcr</a> &amp; <a class="code" href="ns__gige__reg_8h.html#a061f52c9913e5a8e8ca388b22198c979aec07153aef7f541a71bd5687a1fa5303">VTCR_PPCHK</a>) &amp;&amp; <a class="code" href="classNSGigE.html#af6f500f63b3d9787299aa4a4fcccb103">extstsEnable</a>) {
<a name="l01710"></a>01710                     <a class="code" href="classNet_1_1IpPtr.html">IpPtr</a> <a class="code" href="namespaceiGbReg_1_1TxdOp.html#a95c40243f7e4760653e10ce95673f381">ip</a>(<a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a>);
<a name="l01711"></a>01711                     <span class="keywordflow">if</span> (extsts &amp; <a class="code" href="ns__gige__reg_8h.html#ae1a42c38612bd84f74f4fed10049b99ca78db931fe8b95e52799bc47e7889753a">EXTSTS_UDPPKT</a>) {
<a name="l01712"></a>01712                         <a class="code" href="classNet_1_1UdpPtr.html">UdpPtr</a> udp(ip);
<a name="l01713"></a>01713                         <span class="keywordflow">if</span> (udp) {
<a name="l01714"></a>01714                             udp-&gt;sum(0);
<a name="l01715"></a>01715                             udp-&gt;sum(<a class="code" href="namespaceNet.html#a5ec87e377d6c9fd11933ed008df58af2">cksum</a>(udp));
<a name="l01716"></a>01716                             <a class="code" href="classEtherDevice.html#aefeac9de1e6ede671dbbb5efc3eaa844">txUdpChecksums</a>++;
<a name="l01717"></a>01717                         } <span class="keywordflow">else</span> {
<a name="l01718"></a>01718                             <a class="code" href="namespaceDebug.html#a3a24898e3ca48ef89e2029ab6e43665c">Debug::breakpoint</a>();
<a name="l01719"></a>01719                             <a class="code" href="base_2misc_8hh.html#abb243c15dfbeedf4ae64aa213f4f18c7">warn_once</a>(<span class="stringliteral">&quot;UDPPKT set, but not UDP!\n&quot;</span>);
<a name="l01720"></a>01720                         }
<a name="l01721"></a>01721                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (extsts &amp; <a class="code" href="ns__gige__reg_8h.html#ae1a42c38612bd84f74f4fed10049b99cac48a048c05d531f1dab7941c76d5eec0">EXTSTS_TCPPKT</a>) {
<a name="l01722"></a>01722                         <a class="code" href="classNet_1_1TcpPtr.html">TcpPtr</a> <a class="code" href="namespaceiGbReg_1_1TxdOp.html#aff380643c92de5f84ae7d6675820723c">tcp</a>(ip);
<a name="l01723"></a>01723                         <span class="keywordflow">if</span> (tcp) {
<a name="l01724"></a>01724                             tcp-&gt;sum(0);
<a name="l01725"></a>01725                             tcp-&gt;sum(<a class="code" href="namespaceNet.html#a5ec87e377d6c9fd11933ed008df58af2">cksum</a>(tcp));
<a name="l01726"></a>01726                             <a class="code" href="classEtherDevice.html#a269c1095e07975f5e1f8ce043ba9b073">txTcpChecksums</a>++;
<a name="l01727"></a>01727                         } <span class="keywordflow">else</span> {
<a name="l01728"></a>01728                             <a class="code" href="namespaceDebug.html#a3a24898e3ca48ef89e2029ab6e43665c">Debug::breakpoint</a>();
<a name="l01729"></a>01729                             <a class="code" href="base_2misc_8hh.html#abb243c15dfbeedf4ae64aa213f4f18c7">warn_once</a>(<span class="stringliteral">&quot;TCPPKT set, but not UDP!\n&quot;</span>);
<a name="l01730"></a>01730                         }
<a name="l01731"></a>01731                     }
<a name="l01732"></a>01732                     <span class="keywordflow">if</span> (extsts &amp; <a class="code" href="ns__gige__reg_8h.html#ae1a42c38612bd84f74f4fed10049b99caf9e14fc213538916905634ee98a748ec">EXTSTS_IPPKT</a>) {
<a name="l01733"></a>01733                         <span class="keywordflow">if</span> (ip) {
<a name="l01734"></a>01734                             ip-&gt;sum(0);
<a name="l01735"></a>01735                             ip-&gt;sum(<a class="code" href="namespaceNet.html#a5ec87e377d6c9fd11933ed008df58af2">cksum</a>(ip));
<a name="l01736"></a>01736                             <a class="code" href="classEtherDevice.html#a3c7383c5bcf750d544a59ece87090dd1">txIpChecksums</a>++;
<a name="l01737"></a>01737                         } <span class="keywordflow">else</span> {
<a name="l01738"></a>01738                             <a class="code" href="namespaceDebug.html#a3a24898e3ca48ef89e2029ab6e43665c">Debug::breakpoint</a>();
<a name="l01739"></a>01739                             <a class="code" href="base_2misc_8hh.html#abb243c15dfbeedf4ae64aa213f4f18c7">warn_once</a>(<span class="stringliteral">&quot;IPPKT set, but not UDP!\n&quot;</span>);
<a name="l01740"></a>01740                         }
<a name="l01741"></a>01741                     }
<a name="l01742"></a>01742                 }
<a name="l01743"></a>01743 
<a name="l01744"></a>01744                 <a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a>-&gt;length = <a class="code" href="classNSGigE.html#a83d14ec681383903f0a29949bdb99019">txPacketBufPtr</a> - <a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a>-&gt;<a class="code" href="classRefCountingPtr.html#a6b357f8b956e6421ef12211897528b6d" title="The stored pointer.">data</a>;
<a name="l01745"></a>01745                 <span class="comment">// this is just because the receive can&#39;t handle a</span>
<a name="l01746"></a>01746                 <span class="comment">// packet bigger want to make sure</span>
<a name="l01747"></a>01747                 <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a>-&gt;length &gt; 1514)
<a name="l01748"></a>01748                     <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;transmit packet too large, %s &gt; 1514\n&quot;</span>,
<a name="l01749"></a>01749                           <a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a>-&gt;length);
<a name="l01750"></a>01750 
<a name="l01751"></a>01751 <span class="preprocessor">#ifndef NDEBUG</span>
<a name="l01752"></a>01752 <span class="preprocessor"></span>                <span class="keywordtype">bool</span> success =
<a name="l01753"></a>01753 <span class="preprocessor">#endif</span>
<a name="l01754"></a>01754 <span class="preprocessor"></span>                    <a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#a701330089d5bd938c0c87cc45f4ae08c">push</a>(<a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a>);
<a name="l01755"></a>01755                 assert(success);
<a name="l01756"></a>01756 
<a name="l01757"></a>01757                 <span class="comment">/*</span>
<a name="l01758"></a>01758 <span class="comment">                 * this following section is not tqo spec, but</span>
<a name="l01759"></a>01759 <span class="comment">                 * functionally shouldn&#39;t be any different.  normally,</span>
<a name="l01760"></a>01760 <span class="comment">                 * the chip will wait til the transmit has occurred</span>
<a name="l01761"></a>01761 <span class="comment">                 * before writing back the descriptor because it has</span>
<a name="l01762"></a>01762 <span class="comment">                 * to wait to see that it was successfully transmitted</span>
<a name="l01763"></a>01763 <span class="comment">                 * to decide whether to set CMDSTS_OK or not.</span>
<a name="l01764"></a>01764 <span class="comment">                 * however, in the simulator since it is always</span>
<a name="l01765"></a>01765 <span class="comment">                 * successfully transmitted, and writing it exactly to</span>
<a name="l01766"></a>01766 <span class="comment">                 * spec would complicate the code, we just do it here</span>
<a name="l01767"></a>01767 <span class="comment">                 */</span>
<a name="l01768"></a>01768 
<a name="l01769"></a>01769                 cmdsts &amp;= ~CMDSTS_OWN;
<a name="l01770"></a>01770                 cmdsts |= CMDSTS_OK;
<a name="l01771"></a>01771 
<a name="l01772"></a>01772                 <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetDesc,
<a name="l01773"></a>01773                         <span class="stringliteral">&quot;txDesc writeback: cmdsts=%08x extsts=%08x\n&quot;</span>,
<a name="l01774"></a>01774                         cmdsts, extsts);
<a name="l01775"></a>01775 
<a name="l01776"></a>01776                 <a class="code" href="classNSGigE.html#a01a9ee317b5a21b068b10e6c66c9703b">txDmaFree</a> = <a class="code" href="classNSGigE.html#ad58dedc82d60f8fbeec43fbe43f3a726">dmaDescFree</a>;
<a name="l01777"></a>01777                 <a class="code" href="classNSGigE.html#a4b78f3a978843d16fb8a930d2d810e2b">txDmaAddr</a> = <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acff64aa194acd44f476d4a1f741203e1">txdp</a> &amp; 0x3fffffff;
<a name="l01778"></a>01778                 <a class="code" href="classNSGigE.html#a4ee4e63250e8c724e3354702dc1fb5cb">txDmaData</a> = &amp;cmdsts;
<a name="l01779"></a>01779                 <span class="keywordflow">if</span> (is64bit) {
<a name="l01780"></a>01780                     <a class="code" href="classNSGigE.html#a4b78f3a978843d16fb8a930d2d810e2b">txDmaAddr</a> += offsetof(<a class="code" href="structns__desc64.html">ns_desc64</a>, cmdsts);
<a name="l01781"></a>01781                     <a class="code" href="classNSGigE.html#af6ecb02dc9ebe79715a1b1dff7976096">txDmaLen</a> =
<a name="l01782"></a>01782                         <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>.<a class="code" href="structns__desc64.html#a436fe4aab8750c7e98c059b512549c05">cmdsts</a>) + <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>.<a class="code" href="structns__desc64.html#ac0dc609d94bcdf47d8a87cc00321a531">extsts</a>);
<a name="l01783"></a>01783                 } <span class="keywordflow">else</span> {
<a name="l01784"></a>01784                     <a class="code" href="classNSGigE.html#a4b78f3a978843d16fb8a930d2d810e2b">txDmaAddr</a> += offsetof(<a class="code" href="structns__desc32.html">ns_desc32</a>, cmdsts);
<a name="l01785"></a>01785                     <a class="code" href="classNSGigE.html#af6ecb02dc9ebe79715a1b1dff7976096">txDmaLen</a> =
<a name="l01786"></a>01786                         <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>.<a class="code" href="structns__desc32.html#a3e24fd8f58ccd00550375969412d4915">cmdsts</a>) + <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>.<a class="code" href="structns__desc32.html#a0bb874ccd5bfb9f31b6e6be18f544ada">extsts</a>);
<a name="l01787"></a>01787                 }
<a name="l01788"></a>01788 
<a name="l01789"></a>01789                 <a class="code" href="classEtherDevice.html#a8b6394c8b73bfa13584ad19efea1cf3b">descDmaWrites</a>++;
<a name="l01790"></a>01790                 <a class="code" href="classEtherDevice.html#a420150292014de18928cd238ddd47985">descDmaWrBytes</a> += <a class="code" href="classNSGigE.html#af6ecb02dc9ebe79715a1b1dff7976096">txDmaLen</a>;
<a name="l01791"></a>01791 
<a name="l01792"></a>01792                 <a class="code" href="classNSGigE.html#a60efe7cad4f7197b11b413f06cb4777d" title="Retransmit event.">transmit</a>();
<a name="l01793"></a>01793                 <a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a> = 0;
<a name="l01794"></a>01794 
<a name="l01795"></a>01795                 <span class="keywordflow">if</span> (!<a class="code" href="classNSGigE.html#ac12794e1d7747b59b28f474813e42b6f">txEnable</a>) {
<a name="l01796"></a>01796                     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;halting TX state machine\n&quot;</span>);
<a name="l01797"></a>01797                     txState = txIdle;
<a name="l01798"></a>01798                     <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01799"></a>01799                 } <span class="keywordflow">else</span>
<a name="l01800"></a>01800                     txState = txAdvance;
<a name="l01801"></a>01801 
<a name="l01802"></a>01802                 <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a31cb1112372e413cf5206f8f3e0b2b7d">doTxDmaWrite</a>())
<a name="l01803"></a>01803                     <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01804"></a>01804             }
<a name="l01805"></a>01805         } <span class="keywordflow">else</span> {
<a name="l01806"></a>01806             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;this descriptor isn&#39;t done yet\n&quot;</span>);
<a name="l01807"></a>01807             <span class="keywordflow">if</span> (!<a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#aabcece1c025f33b553d2e33dcaa6dcb9">full</a>()) {
<a name="l01808"></a>01808                 txState = txFragRead;
<a name="l01809"></a>01809 
<a name="l01810"></a>01810                 <span class="comment">/*</span>
<a name="l01811"></a>01811 <span class="comment">                 * The number of bytes transferred is either whatever</span>
<a name="l01812"></a>01812 <span class="comment">                 * is left in the descriptor (txDescCnt), or if there</span>
<a name="l01813"></a>01813 <span class="comment">                 * is not enough room in the fifo, just whatever room</span>
<a name="l01814"></a>01814 <span class="comment">                 * is left in the fifo</span>
<a name="l01815"></a>01815 <span class="comment">                 */</span>
<a name="l01816"></a>01816                 <a class="code" href="classNSGigE.html#a6dbadea5aab7bf664049c0519f9f1a16">txXferLen</a> = min&lt;uint32_t&gt;(<a class="code" href="classNSGigE.html#a66ca0e897397c87dc5c667ab26d5bafe" title="count of bytes remaining in the current descriptor">txDescCnt</a>, <a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#a5abf953b4c5e2ef51cdb1045424d3214">avail</a>());
<a name="l01817"></a>01817 
<a name="l01818"></a>01818                 <a class="code" href="classNSGigE.html#a4b78f3a978843d16fb8a930d2d810e2b">txDmaAddr</a> = <a class="code" href="classNSGigE.html#a35898de98a734b7d95c842ea88e88b46" title="ptr to the next byte in the current fragment">txFragPtr</a> &amp; 0x3fffffff;
<a name="l01819"></a>01819                 <a class="code" href="classNSGigE.html#a4ee4e63250e8c724e3354702dc1fb5cb">txDmaData</a> = <a class="code" href="classNSGigE.html#a83d14ec681383903f0a29949bdb99019">txPacketBufPtr</a>;
<a name="l01820"></a>01820                 <a class="code" href="classNSGigE.html#af6ecb02dc9ebe79715a1b1dff7976096">txDmaLen</a> = <a class="code" href="classNSGigE.html#a6dbadea5aab7bf664049c0519f9f1a16">txXferLen</a>;
<a name="l01821"></a>01821                 <a class="code" href="classNSGigE.html#a01a9ee317b5a21b068b10e6c66c9703b">txDmaFree</a> = <a class="code" href="classNSGigE.html#af8f66ce4f5331cfd458ee5e85a176892">dmaDataFree</a>;
<a name="l01822"></a>01822 
<a name="l01823"></a>01823                 <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a00e372ccb15b7f8384eb2b42b116c669">doTxDmaRead</a>())
<a name="l01824"></a>01824                     <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01825"></a>01825             } <span class="keywordflow">else</span> {
<a name="l01826"></a>01826                 txState = txFifoBlock;
<a name="l01827"></a>01827                 <a class="code" href="classNSGigE.html#a60efe7cad4f7197b11b413f06cb4777d" title="Retransmit event.">transmit</a>();
<a name="l01828"></a>01828 
<a name="l01829"></a>01829                 <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01830"></a>01830             }
<a name="l01831"></a>01831 
<a name="l01832"></a>01832         }
<a name="l01833"></a>01833         <span class="keywordflow">break</span>;
<a name="l01834"></a>01834 
<a name="l01835"></a>01835       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#a96770da20ac1781f03a08eaed5d8fdcda172866ef26c190dcb72860ee3f0af21c">txFragRead</a>:
<a name="l01836"></a>01836         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> != <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa6d0e755f71150562d9034139967941f">dmaIdle</a>)
<a name="l01837"></a>01837             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01838"></a>01838 
<a name="l01839"></a>01839         <a class="code" href="classNSGigE.html#a83d14ec681383903f0a29949bdb99019">txPacketBufPtr</a> += <a class="code" href="classNSGigE.html#a6dbadea5aab7bf664049c0519f9f1a16">txXferLen</a>;
<a name="l01840"></a>01840         <a class="code" href="classNSGigE.html#a35898de98a734b7d95c842ea88e88b46" title="ptr to the next byte in the current fragment">txFragPtr</a> += <a class="code" href="classNSGigE.html#a6dbadea5aab7bf664049c0519f9f1a16">txXferLen</a>;
<a name="l01841"></a>01841         <a class="code" href="classNSGigE.html#a66ca0e897397c87dc5c667ab26d5bafe" title="count of bytes remaining in the current descriptor">txDescCnt</a> -= <a class="code" href="classNSGigE.html#a6dbadea5aab7bf664049c0519f9f1a16">txXferLen</a>;
<a name="l01842"></a>01842         <a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#a3d89dde16b5a8e9674cc3de3a0706423">reserve</a>(<a class="code" href="classNSGigE.html#a6dbadea5aab7bf664049c0519f9f1a16">txXferLen</a>);
<a name="l01843"></a>01843 
<a name="l01844"></a>01844         txState = txFifoBlock;
<a name="l01845"></a>01845         <span class="keywordflow">break</span>;
<a name="l01846"></a>01846 
<a name="l01847"></a>01847       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#a96770da20ac1781f03a08eaed5d8fdcda9c54f11e96a5b9205120e798408fddcb">txDescWrite</a>:
<a name="l01848"></a>01848         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> != <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa6d0e755f71150562d9034139967941f">dmaIdle</a>)
<a name="l01849"></a>01849             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01850"></a>01850 
<a name="l01851"></a>01851         <span class="keywordflow">if</span> (cmdsts &amp; <a class="code" href="ns__gige__reg_8h.html#ab03e8c6ba2b8e57cbbe1c6f0421c5641a785068b01144b680a5155d09e73fd1bc">CMDSTS_INTR</a>)
<a name="l01852"></a>01852             <a class="code" href="classNSGigE.html#a6d9924c69c46eeb592083661da9012e6" title="Interrupt management.">devIntrPost</a>(<a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84ae1c46578010d906b4e30793d8a9f8bab">ISR_TXDESC</a>);
<a name="l01853"></a>01853 
<a name="l01854"></a>01854         <span class="keywordflow">if</span> (!<a class="code" href="classNSGigE.html#ac12794e1d7747b59b28f474813e42b6f">txEnable</a>) {
<a name="l01855"></a>01855             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;halting TX state machine\n&quot;</span>);
<a name="l01856"></a>01856             txState = txIdle;
<a name="l01857"></a>01857             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01858"></a>01858         } <span class="keywordflow">else</span>
<a name="l01859"></a>01859             txState = txAdvance;
<a name="l01860"></a>01860         <span class="keywordflow">break</span>;
<a name="l01861"></a>01861 
<a name="l01862"></a>01862       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#a96770da20ac1781f03a08eaed5d8fdcdae0a258f9313b222daff6cdee9dd8fbd1">txAdvance</a>:
<a name="l01863"></a>01863         <span class="keywordflow">if</span> (link == 0) {
<a name="l01864"></a>01864             <a class="code" href="classNSGigE.html#a6d9924c69c46eeb592083661da9012e6" title="Interrupt management.">devIntrPost</a>(<a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84ae4a5db36871c2a3322b708854515dafe">ISR_TXIDLE</a>);
<a name="l01865"></a>01865             txState = txIdle;
<a name="l01866"></a>01866             <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01867"></a>01867         } <span class="keywordflow">else</span> {
<a name="l01868"></a>01868             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> != <a class="code" href="classNSGigE.html#a3d46af061e9cc9281b0854346942f432aa6d0e755f71150562d9034139967941f">dmaIdle</a>)
<a name="l01869"></a>01869                 <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01870"></a>01870             txState = txDescRead;
<a name="l01871"></a>01871             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acff64aa194acd44f476d4a1f741203e1">txdp</a> = link;
<a name="l01872"></a>01872             <a class="code" href="classNSGigE.html#a42daaa387f54470e251759d4f42aed8a" title="Current Transmit Descriptor Done.">CTDD</a> = <span class="keyword">false</span>;
<a name="l01873"></a>01873 
<a name="l01874"></a>01874             <a class="code" href="classNSGigE.html#a4b78f3a978843d16fb8a930d2d810e2b">txDmaAddr</a> = link &amp; 0x3fffffff;
<a name="l01875"></a>01875             <a class="code" href="classNSGigE.html#a4ee4e63250e8c724e3354702dc1fb5cb">txDmaData</a> = is64bit ? (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a> : (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>;
<a name="l01876"></a>01876             <a class="code" href="classNSGigE.html#af6ecb02dc9ebe79715a1b1dff7976096">txDmaLen</a> = is64bit ? <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>) : <span class="keyword">sizeof</span>(<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>);
<a name="l01877"></a>01877             <a class="code" href="classNSGigE.html#a01a9ee317b5a21b068b10e6c66c9703b">txDmaFree</a> = <a class="code" href="classNSGigE.html#ad58dedc82d60f8fbeec43fbe43f3a726">dmaDescFree</a>;
<a name="l01878"></a>01878 
<a name="l01879"></a>01879             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a00e372ccb15b7f8384eb2b42b116c669">doTxDmaRead</a>())
<a name="l01880"></a>01880                 <span class="keywordflow">goto</span> <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>;
<a name="l01881"></a>01881         }
<a name="l01882"></a>01882         <span class="keywordflow">break</span>;
<a name="l01883"></a>01883 
<a name="l01884"></a>01884       <span class="keywordflow">default</span>:
<a name="l01885"></a>01885         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;invalid state&quot;</span>);
<a name="l01886"></a>01886     }
<a name="l01887"></a>01887 
<a name="l01888"></a>01888     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;entering next txState=%s\n&quot;</span>,
<a name="l01889"></a>01889             <a class="code" href="ns__gige_8cc.html#ae072bc5252468e83d34f7c497ad3ce71">NsTxStateStrings</a>[txState]);
<a name="l01890"></a>01890     <span class="keywordflow">goto</span> next;
<a name="l01891"></a>01891 
<a name="l01892"></a>01892   <a class="code" href="namespaceX86ISA.html#a1d7b1aefeb0ba5e276e1e6379cfda554">exit</a>:
<a name="l01896"></a>01896     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(EthernetSM, <span class="stringliteral">&quot;tx state machine exited txState=%s\n&quot;</span>,
<a name="l01897"></a>01897             <a class="code" href="ns__gige_8cc.html#ae072bc5252468e83d34f7c497ad3ce71">NsTxStateStrings</a>[txState]);
<a name="l01898"></a>01898 
<a name="l01899"></a>01899     <span class="keywordflow">if</span> (!<a class="code" href="classNSGigE.html#a0de5118baed8d3fd18adffccf5a0f2c2">txKickEvent</a>.<a class="code" href="classEvent.html#a36bdc2ee73215ed7670a7bfc0f25ab8b" title="Determine if the current event is scheduled.">scheduled</a>())
<a name="l01900"></a>01900         <a class="code" href="classEventManager.html#a749a10828b2dd5017a2582960d04e400">schedule</a>(<a class="code" href="classNSGigE.html#a0de5118baed8d3fd18adffccf5a0f2c2">txKickEvent</a>, <a class="code" href="classNSGigE.html#a571a3c7d12873ad3fa81db8a488459e2">txKickTick</a>);
<a name="l01901"></a>01901 }
<a name="l01902"></a>01902 
<a name="l01907"></a>01907 <span class="keywordtype">void</span>
<a name="l01908"></a><a class="code" href="classNSGigE.html#afc5f2bab586db986f68ed1cab571d6d3">01908</a> <a class="code" href="classNSGigE.html#afc5f2bab586db986f68ed1cab571d6d3" title="Advance the EEPROM state machine Called on rising edge of EEPROM clock bit in MEAR.">NSGigE::eepromKick</a>()
<a name="l01909"></a>01909 {
<a name="l01910"></a>01910     <span class="keywordflow">switch</span> (<a class="code" href="classNSGigE.html#a2ba8f255a9f234fb035d7ecab71fbd5b" title="EEPROM State Machine.">eepromState</a>) {
<a name="l01911"></a>01911 
<a name="l01912"></a>01912       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#a29047a41cc9174b59a0386bca41c23baafe67e51c840a7cc45e51a39b06a7b9f6">eepromStart</a>:
<a name="l01913"></a>01913 
<a name="l01914"></a>01914         <span class="comment">// Wait for start bit</span>
<a name="l01915"></a>01915         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49e054c501a5a1f8d1fa342999a6c4e8">mear</a> &amp; <a class="code" href="ns__gige__reg_8h.html#a09f9907a9a0297b5b40995a25b5f1daeacc79e439eeff02726e7c1d58ce6b8dc6">MEAR_EEDI</a>) {
<a name="l01916"></a>01916             <span class="comment">// Set up to get 2 opcode bits</span>
<a name="l01917"></a>01917             <a class="code" href="classNSGigE.html#a2ba8f255a9f234fb035d7ecab71fbd5b" title="EEPROM State Machine.">eepromState</a> = eepromGetOpcode;
<a name="l01918"></a>01918             <a class="code" href="classNSGigE.html#a6dd44dfbafe9f23f312213aaebf44087">eepromBitsToRx</a> = 2;
<a name="l01919"></a>01919             <a class="code" href="classNSGigE.html#a0082d4a5f70dbcf4f2fc78d06e9e1a66">eepromOpcode</a> = 0;
<a name="l01920"></a>01920         }
<a name="l01921"></a>01921         <span class="keywordflow">break</span>;
<a name="l01922"></a>01922 
<a name="l01923"></a>01923       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#a29047a41cc9174b59a0386bca41c23baaa718c17fe9ce1568f7d371e63e186fca">eepromGetOpcode</a>:
<a name="l01924"></a>01924         <a class="code" href="classNSGigE.html#a0082d4a5f70dbcf4f2fc78d06e9e1a66">eepromOpcode</a> &lt;&lt;= 1;
<a name="l01925"></a>01925         <a class="code" href="classNSGigE.html#a0082d4a5f70dbcf4f2fc78d06e9e1a66">eepromOpcode</a> += (<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49e054c501a5a1f8d1fa342999a6c4e8">mear</a> &amp; MEAR_EEDI) ? 1 : 0;
<a name="l01926"></a>01926         --<a class="code" href="classNSGigE.html#a6dd44dfbafe9f23f312213aaebf44087">eepromBitsToRx</a>;
<a name="l01927"></a>01927 
<a name="l01928"></a>01928         <span class="comment">// Done getting opcode</span>
<a name="l01929"></a>01929         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a6dd44dfbafe9f23f312213aaebf44087">eepromBitsToRx</a> == 0) {
<a name="l01930"></a>01930             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a0082d4a5f70dbcf4f2fc78d06e9e1a66">eepromOpcode</a> != <a class="code" href="ns__gige_8hh.html#a93964da128d1f6ec065f0d049a6ee86a">EEPROM_READ</a>)
<a name="l01931"></a>01931                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;only EEPROM reads are implemented!&quot;</span>);
<a name="l01932"></a>01932 
<a name="l01933"></a>01933             <span class="comment">// Set up to get address</span>
<a name="l01934"></a>01934             <a class="code" href="classNSGigE.html#a2ba8f255a9f234fb035d7ecab71fbd5b" title="EEPROM State Machine.">eepromState</a> = eepromGetAddress;
<a name="l01935"></a>01935             <a class="code" href="classNSGigE.html#a6dd44dfbafe9f23f312213aaebf44087">eepromBitsToRx</a> = 6;
<a name="l01936"></a>01936             <a class="code" href="classNSGigE.html#af5dcc8ba2acecdeb2b1551e9427fd35c">eepromAddress</a> = 0;
<a name="l01937"></a>01937         }
<a name="l01938"></a>01938         <span class="keywordflow">break</span>;
<a name="l01939"></a>01939 
<a name="l01940"></a>01940       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#a29047a41cc9174b59a0386bca41c23baac526648bbca5523175c907e5de5f95a5">eepromGetAddress</a>:
<a name="l01941"></a>01941         <a class="code" href="classNSGigE.html#af5dcc8ba2acecdeb2b1551e9427fd35c">eepromAddress</a> &lt;&lt;= 1;
<a name="l01942"></a>01942         <a class="code" href="classNSGigE.html#af5dcc8ba2acecdeb2b1551e9427fd35c">eepromAddress</a> += (<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49e054c501a5a1f8d1fa342999a6c4e8">mear</a> &amp; MEAR_EEDI) ? 1 : 0;
<a name="l01943"></a>01943         --<a class="code" href="classNSGigE.html#a6dd44dfbafe9f23f312213aaebf44087">eepromBitsToRx</a>;
<a name="l01944"></a>01944 
<a name="l01945"></a>01945         <span class="comment">// Done getting address</span>
<a name="l01946"></a>01946         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a6dd44dfbafe9f23f312213aaebf44087">eepromBitsToRx</a> == 0) {
<a name="l01947"></a>01947 
<a name="l01948"></a>01948             <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#af5dcc8ba2acecdeb2b1551e9427fd35c">eepromAddress</a> &gt;= <a class="code" href="ns__gige_8hh.html#adb0e1024d46141c966014951f5b1e5c8">EEPROM_SIZE</a>)
<a name="l01949"></a>01949                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;EEPROM read access out of range!&quot;</span>);
<a name="l01950"></a>01950 
<a name="l01951"></a>01951             <span class="keywordflow">switch</span> (<a class="code" href="classNSGigE.html#af5dcc8ba2acecdeb2b1551e9427fd35c">eepromAddress</a>) {
<a name="l01952"></a>01952 
<a name="l01953"></a>01953               <span class="keywordflow">case</span> <a class="code" href="ns__gige_8hh.html#a04ace9703bc38e08ebc513308e810472">EEPROM_PMATCH2_ADDR</a>:
<a name="l01954"></a>01954                 <a class="code" href="classNSGigE.html#a096d1d19ffc19d115d248cff8886ae01">eepromData</a> = <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[5];
<a name="l01955"></a>01955                 <a class="code" href="classNSGigE.html#a096d1d19ffc19d115d248cff8886ae01">eepromData</a> &lt;&lt;= 8;
<a name="l01956"></a>01956                 <a class="code" href="classNSGigE.html#a096d1d19ffc19d115d248cff8886ae01">eepromData</a> += <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[4];
<a name="l01957"></a>01957                 <span class="keywordflow">break</span>;
<a name="l01958"></a>01958 
<a name="l01959"></a>01959               <span class="keywordflow">case</span> <a class="code" href="ns__gige_8hh.html#aa5de04551e0949c15f9b84774373f1d8">EEPROM_PMATCH1_ADDR</a>:
<a name="l01960"></a>01960                 <a class="code" href="classNSGigE.html#a096d1d19ffc19d115d248cff8886ae01">eepromData</a> = <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[3];
<a name="l01961"></a>01961                 <a class="code" href="classNSGigE.html#a096d1d19ffc19d115d248cff8886ae01">eepromData</a> &lt;&lt;= 8;
<a name="l01962"></a>01962                 <a class="code" href="classNSGigE.html#a096d1d19ffc19d115d248cff8886ae01">eepromData</a> += <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[2];
<a name="l01963"></a>01963                 <span class="keywordflow">break</span>;
<a name="l01964"></a>01964 
<a name="l01965"></a>01965               <span class="keywordflow">case</span> <a class="code" href="ns__gige_8hh.html#acac34df6d31e87d4ae3e715f42bd770d">EEPROM_PMATCH0_ADDR</a>:
<a name="l01966"></a>01966                 <a class="code" href="classNSGigE.html#a096d1d19ffc19d115d248cff8886ae01">eepromData</a> = <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[1];
<a name="l01967"></a>01967                 <a class="code" href="classNSGigE.html#a096d1d19ffc19d115d248cff8886ae01">eepromData</a> &lt;&lt;= 8;
<a name="l01968"></a>01968                 <a class="code" href="classNSGigE.html#a096d1d19ffc19d115d248cff8886ae01">eepromData</a> += <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>[0];
<a name="l01969"></a>01969                 <span class="keywordflow">break</span>;
<a name="l01970"></a>01970 
<a name="l01971"></a>01971               <span class="keywordflow">default</span>:
<a name="l01972"></a>01972                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;FreeBSD driver only uses EEPROM to read PMATCH!&quot;</span>);
<a name="l01973"></a>01973             }
<a name="l01974"></a>01974             <span class="comment">// Set up to read data</span>
<a name="l01975"></a>01975             <a class="code" href="classNSGigE.html#a2ba8f255a9f234fb035d7ecab71fbd5b" title="EEPROM State Machine.">eepromState</a> = eepromRead;
<a name="l01976"></a>01976             <a class="code" href="classNSGigE.html#a6dd44dfbafe9f23f312213aaebf44087">eepromBitsToRx</a> = 16;
<a name="l01977"></a>01977 
<a name="l01978"></a>01978             <span class="comment">// Clear data in bit</span>
<a name="l01979"></a>01979             <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49e054c501a5a1f8d1fa342999a6c4e8">mear</a> &amp;= ~MEAR_EEDI;
<a name="l01980"></a>01980         }
<a name="l01981"></a>01981         <span class="keywordflow">break</span>;
<a name="l01982"></a>01982 
<a name="l01983"></a>01983       <span class="keywordflow">case</span> <a class="code" href="classNSGigE.html#a29047a41cc9174b59a0386bca41c23baa1a4b17286c4666df3d35394eb205ee20">eepromRead</a>:
<a name="l01984"></a>01984         <span class="comment">// Clear Data Out bit</span>
<a name="l01985"></a>01985         <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49e054c501a5a1f8d1fa342999a6c4e8">mear</a> &amp;= ~MEAR_EEDO;
<a name="l01986"></a>01986         <span class="comment">// Set bit to value of current EEPROM bit</span>
<a name="l01987"></a>01987         <a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49e054c501a5a1f8d1fa342999a6c4e8">mear</a> |= (<a class="code" href="classNSGigE.html#a096d1d19ffc19d115d248cff8886ae01">eepromData</a> &amp; 0x8000) ? <a class="code" href="ns__gige__reg_8h.html#a09f9907a9a0297b5b40995a25b5f1daea1384a0511be6f1d59a01983ca90e0c94">MEAR_EEDO</a> : 0x0;
<a name="l01988"></a>01988 
<a name="l01989"></a>01989         <a class="code" href="classNSGigE.html#a096d1d19ffc19d115d248cff8886ae01">eepromData</a> &lt;&lt;= 1;
<a name="l01990"></a>01990         --<a class="code" href="classNSGigE.html#a6dd44dfbafe9f23f312213aaebf44087">eepromBitsToRx</a>;
<a name="l01991"></a>01991 
<a name="l01992"></a>01992         <span class="comment">// All done</span>
<a name="l01993"></a>01993         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a6dd44dfbafe9f23f312213aaebf44087">eepromBitsToRx</a> == 0) {
<a name="l01994"></a>01994             <a class="code" href="classNSGigE.html#a2ba8f255a9f234fb035d7ecab71fbd5b" title="EEPROM State Machine.">eepromState</a> = eepromStart;
<a name="l01995"></a>01995         }
<a name="l01996"></a>01996         <span class="keywordflow">break</span>;
<a name="l01997"></a>01997 
<a name="l01998"></a>01998       <span class="keywordflow">default</span>:
<a name="l01999"></a>01999         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;invalid EEPROM state&quot;</span>);
<a name="l02000"></a>02000     }
<a name="l02001"></a>02001 
<a name="l02002"></a>02002 }
<a name="l02003"></a>02003 
<a name="l02004"></a>02004 <span class="keywordtype">void</span>
<a name="l02005"></a><a class="code" href="classNSGigE.html#acabb9bd950683617598ab9de86e96fff">02005</a> <a class="code" href="classNSGigE.html#acabb9bd950683617598ab9de86e96fff">NSGigE::transferDone</a>()
<a name="l02006"></a>02006 {
<a name="l02007"></a>02007     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#aa4dbf488d04bc18c8c388595869a5d17">empty</a>()) {
<a name="l02008"></a>02008         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet, <span class="stringliteral">&quot;transfer complete: txFifo empty...nothing to do\n&quot;</span>);
<a name="l02009"></a>02009         <span class="keywordflow">return</span>;
<a name="l02010"></a>02010     }
<a name="l02011"></a>02011 
<a name="l02012"></a>02012     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet, <span class="stringliteral">&quot;transfer complete: data in txFifo...schedule xmit\n&quot;</span>);
<a name="l02013"></a>02013 
<a name="l02014"></a>02014     <a class="code" href="classEventManager.html#a766c5f955dfa1609696955f075492687">reschedule</a>(<a class="code" href="classNSGigE.html#a12950bf2b9b52611e65f9411f221d1f5">txEvent</a>, <a class="code" href="classClockedObject.html#a7c1f64c925f158530be84323a503dbb7" title="Determine the tick when a cycle begins, by default the current one, but the argument also enables the...">clockEdge</a>(<a class="code" href="classCycles.html" title="Cycles is a wrapper class for representing cycle counts, i.e.">Cycles</a>(1)), <span class="keyword">true</span>);
<a name="l02015"></a>02015 }
<a name="l02016"></a>02016 
<a name="l02017"></a>02017 <span class="keywordtype">bool</span>
<a name="l02018"></a><a class="code" href="classNSGigE.html#a844a3c6b4c3463e4a7f3adc74a6cc396">02018</a> <a class="code" href="classNSGigE.html#a844a3c6b4c3463e4a7f3adc74a6cc396">NSGigE::rxFilter</a>(<span class="keyword">const</span> <a class="code" href="classRefCountingPtr.html">EthPacketPtr</a> &amp;packet)
<a name="l02019"></a>02019 {
<a name="l02020"></a>02020     <a class="code" href="classNet_1_1EthPtr.html">EthPtr</a> eth = packet;
<a name="l02021"></a>02021     <span class="keywordtype">bool</span> drop = <span class="keyword">true</span>;
<a name="l02022"></a>02022     <span class="keywordtype">string</span> <a class="code" href="namespaceX86ISA.html#abd6d20afe8f06aa5708282b98f926658">type</a>;
<a name="l02023"></a>02023 
<a name="l02024"></a>02024     <span class="keyword">const</span> <a class="code" href="structNet_1_1EthAddr.html">EthAddr</a> &amp;dst = eth-&gt;dst();
<a name="l02025"></a>02025     <span class="keywordflow">if</span> (dst.<a class="code" href="structNet_1_1EthAddr.html#a5699fc1cb150090212dd660a786b1b17">unicast</a>()) {
<a name="l02026"></a>02026         <span class="comment">// If we&#39;re accepting all unicast addresses</span>
<a name="l02027"></a>02027         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a402a74038f39b5a1551dfd137e9876d5">acceptUnicast</a>)
<a name="l02028"></a>02028             drop = <span class="keyword">false</span>;
<a name="l02029"></a>02029 
<a name="l02030"></a>02030         <span class="comment">// If we make a perfect match</span>
<a name="l02031"></a>02031         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#acc0f2bddaadb14d655d6f6e33a85b077">acceptPerfect</a> &amp;&amp; dst == <a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>)
<a name="l02032"></a>02032             drop = <span class="keyword">false</span>;
<a name="l02033"></a>02033 
<a name="l02034"></a>02034         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a0097dd413d75e23e9b2c24d5b9b86657">acceptArp</a> &amp;&amp; eth-&gt;type() == ETH_TYPE_ARP)
<a name="l02035"></a>02035             drop = <span class="keyword">false</span>;
<a name="l02036"></a>02036 
<a name="l02037"></a>02037     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dst.<a class="code" href="structNet_1_1EthAddr.html#a8a161654fa9208e504feb355b0c2e5d0">broadcast</a>()) {
<a name="l02038"></a>02038         <span class="comment">// if we&#39;re accepting broadcasts</span>
<a name="l02039"></a>02039         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#afe19d30d3ec62ef1a129e5ecd5e8ea1e">acceptBroadcast</a>)
<a name="l02040"></a>02040             drop = <span class="keyword">false</span>;
<a name="l02041"></a>02041 
<a name="l02042"></a>02042     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dst.<a class="code" href="structNet_1_1EthAddr.html#aadf7534cd04b204b63f936a239df4481">multicast</a>()) {
<a name="l02043"></a>02043         <span class="comment">// if we&#39;re accepting all multicasts</span>
<a name="l02044"></a>02044         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a3d4914b10c5606a632c550251ef3079b">acceptMulticast</a>)
<a name="l02045"></a>02045             drop = <span class="keyword">false</span>;
<a name="l02046"></a>02046 
<a name="l02047"></a>02047         <span class="comment">// Multicast hashing faked - all packets accepted</span>
<a name="l02048"></a>02048         <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a1d87be28edf16677e019a3015fed059e">multicastHashEnable</a>)
<a name="l02049"></a>02049             drop = <span class="keyword">false</span>;
<a name="l02050"></a>02050     }
<a name="l02051"></a>02051 
<a name="l02052"></a>02052     <span class="keywordflow">if</span> (drop) {
<a name="l02053"></a>02053         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet, <span class="stringliteral">&quot;rxFilter drop\n&quot;</span>);
<a name="l02054"></a>02054         <a class="code" href="trace_8hh.html#a556faf39d3fa9f7db5f344487ddbb397">DDUMP</a>(EthernetData, packet-&gt;<a class="code" href="classRefCountingPtr.html#a6b357f8b956e6421ef12211897528b6d" title="The stored pointer.">data</a>, packet-&gt;length);
<a name="l02055"></a>02055     }
<a name="l02056"></a>02056 
<a name="l02057"></a>02057     <span class="keywordflow">return</span> drop;
<a name="l02058"></a>02058 }
<a name="l02059"></a>02059 
<a name="l02060"></a>02060 <span class="keywordtype">bool</span>
<a name="l02061"></a><a class="code" href="classNSGigE.html#ae4e031e70d7657af252dcde31248b479">02061</a> <a class="code" href="classNSGigE.html#ae4e031e70d7657af252dcde31248b479">NSGigE::recvPacket</a>(<a class="code" href="classRefCountingPtr.html">EthPacketPtr</a> packet)
<a name="l02062"></a>02062 {
<a name="l02063"></a>02063     <a class="code" href="classEtherDevice.html#afe5b8a7cb1ab4d0e25c58102fb13ca8e">rxBytes</a> += packet-&gt;length;
<a name="l02064"></a>02064     <a class="code" href="classEtherDevice.html#a2f8e70cb709879302685be328170e6e2">rxPackets</a>++;
<a name="l02065"></a>02065 
<a name="l02066"></a>02066     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet, <span class="stringliteral">&quot;Receiving packet from wire, rxFifoAvail=%d\n&quot;</span>,
<a name="l02067"></a>02067             <a class="code" href="classNSGigE.html#a6767f0e97ec4877c56c24b7a41e6d71d">rxFifo</a>.<a class="code" href="classPacketFifo.html#a5abf953b4c5e2ef51cdb1045424d3214">avail</a>());
<a name="l02068"></a>02068 
<a name="l02069"></a>02069     <span class="keywordflow">if</span> (!<a class="code" href="classNSGigE.html#abd3ee6dd80adc02a83aabb691332a92d">rxEnable</a>) {
<a name="l02070"></a>02070         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet, <span class="stringliteral">&quot;receive disabled...packet dropped\n&quot;</span>);
<a name="l02071"></a>02071         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02072"></a>02072     }
<a name="l02073"></a>02073 
<a name="l02074"></a>02074     <span class="keywordflow">if</span> (!<a class="code" href="classNSGigE.html#af13268cbb1795582c363a211ff17a604" title="receive address filter">rxFilterEnable</a>) {
<a name="l02075"></a>02075         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet,
<a name="l02076"></a>02076             <span class="stringliteral">&quot;receive packet filtering disabled . . . packet dropped\n&quot;</span>);
<a name="l02077"></a>02077         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02078"></a>02078     }
<a name="l02079"></a>02079 
<a name="l02080"></a>02080     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a844a3c6b4c3463e4a7f3adc74a6cc396">rxFilter</a>(packet)) {
<a name="l02081"></a>02081         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet, <span class="stringliteral">&quot;packet filtered...dropped\n&quot;</span>);
<a name="l02082"></a>02082         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02083"></a>02083     }
<a name="l02084"></a>02084 
<a name="l02085"></a>02085     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a6767f0e97ec4877c56c24b7a41e6d71d">rxFifo</a>.<a class="code" href="classPacketFifo.html#a5abf953b4c5e2ef51cdb1045424d3214">avail</a>() &lt; packet-&gt;length) {
<a name="l02086"></a>02086 <span class="preprocessor">#if TRACING_ON</span>
<a name="l02087"></a>02087 <span class="preprocessor"></span>        <a class="code" href="classNet_1_1IpPtr.html">IpPtr</a> <a class="code" href="namespaceiGbReg_1_1TxdOp.html#a95c40243f7e4760653e10ce95673f381">ip</a>(packet);
<a name="l02088"></a>02088         <a class="code" href="classNet_1_1TcpPtr.html">TcpPtr</a> <a class="code" href="namespaceiGbReg_1_1TxdOp.html#aff380643c92de5f84ae7d6675820723c">tcp</a>(ip);
<a name="l02089"></a>02089         <span class="keywordflow">if</span> (ip) {
<a name="l02090"></a>02090             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet,
<a name="l02091"></a>02091                     <span class="stringliteral">&quot;packet won&#39;t fit in receive buffer...pkt ID %d dropped\n&quot;</span>,
<a name="l02092"></a>02092                     ip-&gt;id());
<a name="l02093"></a>02093             <span class="keywordflow">if</span> (tcp) {
<a name="l02094"></a>02094                 <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Ethernet, <span class="stringliteral">&quot;Seq=%d\n&quot;</span>, tcp-&gt;seq());
<a name="l02095"></a>02095             }
<a name="l02096"></a>02096         }
<a name="l02097"></a>02097 <span class="preprocessor">#endif</span>
<a name="l02098"></a>02098 <span class="preprocessor"></span>        <a class="code" href="classEtherDevice.html#a4dac57af9fce4db2a23d84098c02a41c">droppedPackets</a>++;
<a name="l02099"></a>02099         <a class="code" href="classNSGigE.html#a6d9924c69c46eeb592083661da9012e6" title="Interrupt management.">devIntrPost</a>(<a class="code" href="ns__gige__reg_8h.html#a668aef21a307b29f9e4f857fab5d5e84a7a0ca7d152b841a977e536dfea2f74b8">ISR_RXORN</a>);
<a name="l02100"></a>02100         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02101"></a>02101     }
<a name="l02102"></a>02102 
<a name="l02103"></a>02103     <a class="code" href="classNSGigE.html#a6767f0e97ec4877c56c24b7a41e6d71d">rxFifo</a>.<a class="code" href="classPacketFifo.html#a701330089d5bd938c0c87cc45f4ae08c">push</a>(packet);
<a name="l02104"></a>02104 
<a name="l02105"></a>02105     <a class="code" href="classNSGigE.html#aec2097dcddfbd9263ce8cfd2fd11c474">rxKick</a>();
<a name="l02106"></a>02106     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02107"></a>02107 }
<a name="l02108"></a>02108 
<a name="l02109"></a>02109 
<a name="l02110"></a>02110 <span class="keywordtype">void</span>
<a name="l02111"></a><a class="code" href="classNSGigE.html#aa964a077971a24053b3c187594c30cb6">02111</a> <a class="code" href="classNSGigE.html#aa964a077971a24053b3c187594c30cb6" title="Resume execution after a successful drain.">NSGigE::drainResume</a>()
<a name="l02112"></a>02112 {
<a name="l02113"></a>02113     <a class="code" href="classNSGigE.html#aa964a077971a24053b3c187594c30cb6" title="Resume execution after a successful drain.">Drainable::drainResume</a>();
<a name="l02114"></a>02114 
<a name="l02115"></a>02115     <span class="comment">// During drain we could have left the state machines in a waiting state and</span>
<a name="l02116"></a>02116     <span class="comment">// they wouldn&#39;t get out until some other event occured to kick them.</span>
<a name="l02117"></a>02117     <span class="comment">// This way they&#39;ll get out immediately</span>
<a name="l02118"></a>02118     <a class="code" href="classNSGigE.html#ac37bda95e09a290e343ef80fc3fc9e2b">txKick</a>();
<a name="l02119"></a>02119     <a class="code" href="classNSGigE.html#aec2097dcddfbd9263ce8cfd2fd11c474">rxKick</a>();
<a name="l02120"></a>02120 }
<a name="l02121"></a>02121 
<a name="l02122"></a>02122 
<a name="l02123"></a>02123 <span class="comment">//=====================================================================</span>
<a name="l02124"></a>02124 <span class="comment">//</span>
<a name="l02125"></a>02125 <span class="comment">//</span>
<a name="l02126"></a>02126 <span class="keywordtype">void</span>
<a name="l02127"></a>02127 <a class="code" href="classNSGigE.html#ac974f439cf2658c6602cc4a396633d03" title="Serialize this object to the given output stream.">NSGigE::serialize</a>(ostream &amp;<a class="code" href="namespaceX86ISA.html#aea9fbab71662ba06cf536e05edfaaad1">os</a>)
<a name="l02128"></a>02128 {
<a name="l02129"></a>02129     <span class="comment">// Serialize the PciDev base class</span>
<a name="l02130"></a>02130     <a class="code" href="classNSGigE.html#ac974f439cf2658c6602cc4a396633d03" title="Serialize this object to the given output stream.">PciDev::serialize</a>(os);
<a name="l02131"></a>02131 
<a name="l02132"></a>02132     <span class="comment">/*</span>
<a name="l02133"></a>02133 <span class="comment">     * Finalize any DMA events now.</span>
<a name="l02134"></a>02134 <span class="comment">     */</span>
<a name="l02135"></a>02135     <span class="comment">// @todo will mem system save pending dma?</span>
<a name="l02136"></a>02136 
<a name="l02137"></a>02137     <span class="comment">/*</span>
<a name="l02138"></a>02138 <span class="comment">     * Serialize the device registers</span>
<a name="l02139"></a>02139 <span class="comment">     */</span>
<a name="l02140"></a>02140     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a9600015476b774b3442165cf61f29ad9">command</a>);
<a name="l02141"></a>02141     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a7b90dafdbf78c3094e26e3b445a45118">config</a>);
<a name="l02142"></a>02142     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49e054c501a5a1f8d1fa342999a6c4e8">mear</a>);
<a name="l02143"></a>02143     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a32d4c8c44c00b5b1d6fc66568f24fee0">ptscr</a>);
<a name="l02144"></a>02144     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a>);
<a name="l02145"></a>02145     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a>);
<a name="l02146"></a>02146     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#af82b628490afa00a40d0296a35f8ca80">ier</a>);
<a name="l02147"></a>02147     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2c267f1982b8c6826b03fe00f7631397">ihr</a>);
<a name="l02148"></a>02148     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acff64aa194acd44f476d4a1f741203e1">txdp</a>);
<a name="l02149"></a>02149     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#ae4b6bf5e002d832cbb70312510f7d537">txdp_hi</a>);
<a name="l02150"></a>02150     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acf32d2fcfab30be47767f1531f75a2cc">txcfg</a>);
<a name="l02151"></a>02151     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49fbb19ec37ec570701899609ae22cd6">gpior</a>);
<a name="l02152"></a>02152     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2174f997477d58985b12c3a059d38bf8">rxdp</a>);
<a name="l02153"></a>02153     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a5c2e9f02a7b391d4e117630478ad11b9">rxdp_hi</a>);
<a name="l02154"></a>02154     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a725ebce5e39e17777f38adc25d8c71f5">rxcfg</a>);
<a name="l02155"></a>02155     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2041e1c015742a4bd93e1160b2a995a2">pqcr</a>);
<a name="l02156"></a>02156     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a7cca9c6177ccc42f5f38b91e19f4df38">wcsr</a>);
<a name="l02157"></a>02157     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a956e3bb62b522823287435d048a75059">pcr</a>);
<a name="l02158"></a>02158     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a525ccc417f2173ef149f5e84cc8dbe61">rfcr</a>);
<a name="l02159"></a>02159     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#ab0ebbd837ee7f7471bfa439c802eceb9">rfdr</a>);
<a name="l02160"></a>02160     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#abef81a0ada42cd949d77552b57c58532">brar</a>);
<a name="l02161"></a>02161     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#af5ed12427079db279ea25c970662de08">brdr</a>);
<a name="l02162"></a>02162     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a210ef455baf3b7a9c577d2fef3757c85">srr</a>);
<a name="l02163"></a>02163     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a28bad330789b6511f93e3b8f8ec3c4e3">mibc</a>);
<a name="l02164"></a>02164     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#aac2bbec11b4590f8b2eb1583c147e2ee">vrcr</a>);
<a name="l02165"></a>02165     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#ad97af13deb1a5c24f449f538b0bf695d">vtcr</a>);
<a name="l02166"></a>02166     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a74ae9c0bdd32efa2efc9dcca19d8437d">vdr</a>);
<a name="l02167"></a>02167     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#ae9c8447eb409d13a9d0e404caa921374">ccsr</a>);
<a name="l02168"></a>02168     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a9113118d642b41d2aad8c551514759af">tbicr</a>);
<a name="l02169"></a>02169     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2eee77294a95ae2e2f5652c3abbf2922">tbisr</a>);
<a name="l02170"></a>02170     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a639aecec1e7fed4b0cb5dbcfbcdbed56">tanar</a>);
<a name="l02171"></a>02171     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a52c74bd6cb93b3bbc7f4a7c4ad66e60e">tanlpar</a>);
<a name="l02172"></a>02172     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a71e889615b767822bbeb1d497ed2fa74">taner</a>);
<a name="l02173"></a>02173     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a73c04ab08a0f39d76d90dd9f60464b6f">tesr</a>);
<a name="l02174"></a>02174 
<a name="l02175"></a>02175     <a class="code" href="serialize_8hh.html#a9aa03522128bc19a3bc0294501226f8b">SERIALIZE_ARRAY</a>(<a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>, ETH_ADDR_LEN);
<a name="l02176"></a>02176     <a class="code" href="serialize_8hh.html#a9aa03522128bc19a3bc0294501226f8b">SERIALIZE_ARRAY</a>(<a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#a260603c4f6a5b5f188f9c26bbf136bad" title="for hash table memory.">filterHash</a>, <a class="code" href="ns__gige_8hh.html#a7d7c3db3667c7110b37292d81dc81362">FHASH_SIZE</a>);
<a name="l02177"></a>02177 
<a name="l02178"></a>02178     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a06cd8c902dcbd8093c38d803009db49d" title="pci settings">ioEnable</a>);
<a name="l02179"></a>02179 
<a name="l02180"></a>02180     <span class="comment">/*</span>
<a name="l02181"></a>02181 <span class="comment">     * Serialize the data Fifos</span>
<a name="l02182"></a>02182 <span class="comment">     */</span>
<a name="l02183"></a>02183     <a class="code" href="classNSGigE.html#a6767f0e97ec4877c56c24b7a41e6d71d">rxFifo</a>.<a class="code" href="classPacketFifo.html#ad9e262b830aa9a2f26dd47c7b34763fb" title="Serialization stuff.">serialize</a>(<span class="stringliteral">&quot;rxFifo&quot;</span>, os);
<a name="l02184"></a>02184     <a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#ad9e262b830aa9a2f26dd47c7b34763fb" title="Serialization stuff.">serialize</a>(<span class="stringliteral">&quot;txFifo&quot;</span>, os);
<a name="l02185"></a>02185 
<a name="l02186"></a>02186     <span class="comment">/*</span>
<a name="l02187"></a>02187 <span class="comment">     * Serialize the various helper variables</span>
<a name="l02188"></a>02188 <span class="comment">     */</span>
<a name="l02189"></a>02189     <span class="keywordtype">bool</span> txPacketExists = <a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a>;
<a name="l02190"></a>02190     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(txPacketExists);
<a name="l02191"></a>02191     <span class="keywordflow">if</span> (txPacketExists) {
<a name="l02192"></a>02192         <a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a>-&gt;length = <a class="code" href="classNSGigE.html#a83d14ec681383903f0a29949bdb99019">txPacketBufPtr</a> - <a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a>-&gt;<a class="code" href="classRefCountingPtr.html#a6b357f8b956e6421ef12211897528b6d" title="The stored pointer.">data</a>;
<a name="l02193"></a>02193         <a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a>-&gt;serialize(<span class="stringliteral">&quot;txPacket&quot;</span>, os);
<a name="l02194"></a>02194         <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> txPktBufPtr = (uint32_t) (<a class="code" href="classNSGigE.html#a83d14ec681383903f0a29949bdb99019">txPacketBufPtr</a> - <a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a>-&gt;<a class="code" href="classRefCountingPtr.html#a6b357f8b956e6421ef12211897528b6d" title="The stored pointer.">data</a>);
<a name="l02195"></a>02195         <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(txPktBufPtr);
<a name="l02196"></a>02196     }
<a name="l02197"></a>02197 
<a name="l02198"></a>02198     <span class="keywordtype">bool</span> rxPacketExists = <a class="code" href="classNSGigE.html#a0ef842e4e509199950b7fcc341259980">rxPacket</a>;
<a name="l02199"></a>02199     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(rxPacketExists);
<a name="l02200"></a>02200     <span class="keywordflow">if</span> (rxPacketExists) {
<a name="l02201"></a>02201         <a class="code" href="classNSGigE.html#a0ef842e4e509199950b7fcc341259980">rxPacket</a>-&gt;serialize(<span class="stringliteral">&quot;rxPacket&quot;</span>, os);
<a name="l02202"></a>02202         <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> rxPktBufPtr = (uint32_t) (<a class="code" href="classNSGigE.html#af777184a7b069629f67818b9025adc15">rxPacketBufPtr</a> - <a class="code" href="classNSGigE.html#a0ef842e4e509199950b7fcc341259980">rxPacket</a>-&gt;<a class="code" href="classRefCountingPtr.html#a6b357f8b956e6421ef12211897528b6d" title="The stored pointer.">data</a>);
<a name="l02203"></a>02203         <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(rxPktBufPtr);
<a name="l02204"></a>02204     }
<a name="l02205"></a>02205 
<a name="l02206"></a>02206     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a6dbadea5aab7bf664049c0519f9f1a16">txXferLen</a>);
<a name="l02207"></a>02207     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a0c8ab45b8e570a013b671d8952ec1193">rxXferLen</a>);
<a name="l02208"></a>02208 
<a name="l02209"></a>02209     <span class="comment">/*</span>
<a name="l02210"></a>02210 <span class="comment">     * Serialize Cached Descriptors</span>
<a name="l02211"></a>02211 <span class="comment">     */</span>
<a name="l02212"></a>02212     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>.<a class="code" href="structns__desc64.html#ab8f1bd57eea3d30c7df8f5ecf33f7b7d">link</a>);
<a name="l02213"></a>02213     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>.<a class="code" href="structns__desc64.html#a5eeef802e303dbc13955b0dd997352ab">bufptr</a>);
<a name="l02214"></a>02214     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>.<a class="code" href="structns__desc64.html#a436fe4aab8750c7e98c059b512549c05">cmdsts</a>);
<a name="l02215"></a>02215     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>.<a class="code" href="structns__desc64.html#ac0dc609d94bcdf47d8a87cc00321a531">extsts</a>);
<a name="l02216"></a>02216     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>.<a class="code" href="structns__desc64.html#ab8f1bd57eea3d30c7df8f5ecf33f7b7d">link</a>);
<a name="l02217"></a>02217     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>.<a class="code" href="structns__desc64.html#a5eeef802e303dbc13955b0dd997352ab">bufptr</a>);
<a name="l02218"></a>02218     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>.<a class="code" href="structns__desc64.html#a436fe4aab8750c7e98c059b512549c05">cmdsts</a>);
<a name="l02219"></a>02219     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>.<a class="code" href="structns__desc64.html#ac0dc609d94bcdf47d8a87cc00321a531">extsts</a>);
<a name="l02220"></a>02220     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>.<a class="code" href="structns__desc32.html#acf6b169af8584eaeeafbfdec9b7a2bf1">link</a>);
<a name="l02221"></a>02221     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>.<a class="code" href="structns__desc32.html#a0a47a3d5c0183ab5cd6567ee7d89ea32">bufptr</a>);
<a name="l02222"></a>02222     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>.<a class="code" href="structns__desc32.html#a3e24fd8f58ccd00550375969412d4915">cmdsts</a>);
<a name="l02223"></a>02223     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>.<a class="code" href="structns__desc32.html#a0bb874ccd5bfb9f31b6e6be18f544ada">extsts</a>);
<a name="l02224"></a>02224     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>.<a class="code" href="structns__desc32.html#acf6b169af8584eaeeafbfdec9b7a2bf1">link</a>);
<a name="l02225"></a>02225     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>.<a class="code" href="structns__desc32.html#a0a47a3d5c0183ab5cd6567ee7d89ea32">bufptr</a>);
<a name="l02226"></a>02226     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>.<a class="code" href="structns__desc32.html#a3e24fd8f58ccd00550375969412d4915">cmdsts</a>);
<a name="l02227"></a>02227     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>.<a class="code" href="structns__desc32.html#a0bb874ccd5bfb9f31b6e6be18f544ada">extsts</a>);
<a name="l02228"></a>02228     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#af6f500f63b3d9787299aa4a4fcccb103">extstsEnable</a>);
<a name="l02229"></a>02229 
<a name="l02230"></a>02230     <span class="comment">/*</span>
<a name="l02231"></a>02231 <span class="comment">     * Serialize tx state machine</span>
<a name="l02232"></a>02232 <span class="comment">     */</span>
<a name="l02233"></a>02233     <span class="keywordtype">int</span> <a class="code" href="classNSGigE.html#ab9b31ecee249b2c50ef0ce8de53a9f63">txState</a> = this-&gt;txState;
<a name="l02234"></a>02234     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(txState);
<a name="l02235"></a>02235     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ac12794e1d7747b59b28f474813e42b6f">txEnable</a>);
<a name="l02236"></a>02236     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a42daaa387f54470e251759d4f42aed8a" title="Current Transmit Descriptor Done.">CTDD</a>);
<a name="l02237"></a>02237     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a35898de98a734b7d95c842ea88e88b46" title="ptr to the next byte in the current fragment">txFragPtr</a>);
<a name="l02238"></a>02238     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a66ca0e897397c87dc5c667ab26d5bafe" title="count of bytes remaining in the current descriptor">txDescCnt</a>);
<a name="l02239"></a>02239     <span class="keywordtype">int</span> <a class="code" href="classNSGigE.html#a875ad3add57179c9900701a92779a084">txDmaState</a> = this-&gt;txDmaState;
<a name="l02240"></a>02240     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(txDmaState);
<a name="l02241"></a>02241     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a571a3c7d12873ad3fa81db8a488459e2">txKickTick</a>);
<a name="l02242"></a>02242 
<a name="l02243"></a>02243     <span class="comment">/*</span>
<a name="l02244"></a>02244 <span class="comment">     * Serialize rx state machine</span>
<a name="l02245"></a>02245 <span class="comment">     */</span>
<a name="l02246"></a>02246     <span class="keywordtype">int</span> <a class="code" href="classNSGigE.html#a73d1c398c20206c6e6d40fface8f73f9" title="rx State Machine">rxState</a> = this-&gt;rxState;
<a name="l02247"></a>02247     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(rxState);
<a name="l02248"></a>02248     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#abd3ee6dd80adc02a83aabb691332a92d">rxEnable</a>);
<a name="l02249"></a>02249     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a47964f2eddd257dd82a72a49e07e2952" title="Current Receive Descriptor Done.">CRDD</a>);
<a name="l02250"></a>02250     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a3fb29961f0bc18f17040d87f2d8c6d62" title="num of bytes in the current packet being drained from rxDataFifo">rxPktBytes</a>);
<a name="l02251"></a>02251     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a5bf18fd3cabd4a420f540760525da581" title="ptr to the next byte in current fragment">rxFragPtr</a>);
<a name="l02252"></a>02252     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#adc888bffd26d4e89da0ff44e9b82095c" title="count of bytes remaining in the current descriptor">rxDescCnt</a>);
<a name="l02253"></a>02253     <span class="keywordtype">int</span> <a class="code" href="classNSGigE.html#a322fe82d1029e9eee7d27fc92641bf1c">rxDmaState</a> = this-&gt;rxDmaState;
<a name="l02254"></a>02254     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(rxDmaState);
<a name="l02255"></a>02255     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aa7d7349c084992d2d9ba6f3db2f0dfb6">rxKickTick</a>);
<a name="l02256"></a>02256 
<a name="l02257"></a>02257     <span class="comment">/*</span>
<a name="l02258"></a>02258 <span class="comment">     * Serialize EEPROM state machine</span>
<a name="l02259"></a>02259 <span class="comment">     */</span>
<a name="l02260"></a>02260     <span class="keywordtype">int</span> <a class="code" href="classNSGigE.html#a2ba8f255a9f234fb035d7ecab71fbd5b" title="EEPROM State Machine.">eepromState</a> = this-&gt;eepromState;
<a name="l02261"></a>02261     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(eepromState);
<a name="l02262"></a>02262     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ac1aa342b2168049136febe69fdb7dae0">eepromClk</a>);
<a name="l02263"></a>02263     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a6dd44dfbafe9f23f312213aaebf44087">eepromBitsToRx</a>);
<a name="l02264"></a>02264     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a0082d4a5f70dbcf4f2fc78d06e9e1a66">eepromOpcode</a>);
<a name="l02265"></a>02265     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#af5dcc8ba2acecdeb2b1551e9427fd35c">eepromAddress</a>);
<a name="l02266"></a>02266     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a096d1d19ffc19d115d248cff8886ae01">eepromData</a>);
<a name="l02267"></a>02267 
<a name="l02268"></a>02268     <span class="comment">/*</span>
<a name="l02269"></a>02269 <span class="comment">     * If there&#39;s a pending transmit, store the time so we can</span>
<a name="l02270"></a>02270 <span class="comment">     * reschedule it later</span>
<a name="l02271"></a>02271 <span class="comment">     */</span>
<a name="l02272"></a>02272     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> transmitTick = <a class="code" href="classNSGigE.html#a12950bf2b9b52611e65f9411f221d1f5">txEvent</a>.<a class="code" href="classEvent.html#a36bdc2ee73215ed7670a7bfc0f25ab8b" title="Determine if the current event is scheduled.">scheduled</a>() ? <a class="code" href="classNSGigE.html#a12950bf2b9b52611e65f9411f221d1f5">txEvent</a>.<a class="code" href="classEvent.html#a3ff737aa0692f1ea9b8dd232778f2fcb" title="Get the time that the event is scheduled.">when</a>() - <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>() : 0;
<a name="l02273"></a>02273     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(transmitTick);
<a name="l02274"></a>02274 
<a name="l02275"></a>02275     <span class="comment">/*</span>
<a name="l02276"></a>02276 <span class="comment">     * receive address filter settings</span>
<a name="l02277"></a>02277 <span class="comment">     */</span>
<a name="l02278"></a>02278     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#af13268cbb1795582c363a211ff17a604" title="receive address filter">rxFilterEnable</a>);
<a name="l02279"></a>02279     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#afe19d30d3ec62ef1a129e5ecd5e8ea1e">acceptBroadcast</a>);
<a name="l02280"></a>02280     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a3d4914b10c5606a632c550251ef3079b">acceptMulticast</a>);
<a name="l02281"></a>02281     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a402a74038f39b5a1551dfd137e9876d5">acceptUnicast</a>);
<a name="l02282"></a>02282     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#acc0f2bddaadb14d655d6f6e33a85b077">acceptPerfect</a>);
<a name="l02283"></a>02283     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a0097dd413d75e23e9b2c24d5b9b86657">acceptArp</a>);
<a name="l02284"></a>02284     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a1d87be28edf16677e019a3015fed059e">multicastHashEnable</a>);
<a name="l02285"></a>02285 
<a name="l02286"></a>02286     <span class="comment">/*</span>
<a name="l02287"></a>02287 <span class="comment">     * Keep track of pending interrupt status.</span>
<a name="l02288"></a>02288 <span class="comment">     */</span>
<a name="l02289"></a>02289     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a2929b39dcabc4b8384a72cb035dd307b">intrTick</a>);
<a name="l02290"></a>02290     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#af3381915c8c18105505516cc4795d3f1">cpuPendingIntr</a>);
<a name="l02291"></a>02291     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> intrEventTick = 0;
<a name="l02292"></a>02292     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a9a347760a0cc3d9ffa531314af40bf06">intrEvent</a>)
<a name="l02293"></a>02293         intrEventTick = <a class="code" href="classNSGigE.html#a9a347760a0cc3d9ffa531314af40bf06">intrEvent</a>-&gt;<a class="code" href="classEvent.html#a3ff737aa0692f1ea9b8dd232778f2fcb" title="Get the time that the event is scheduled.">when</a>();
<a name="l02294"></a>02294     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(intrEventTick);
<a name="l02295"></a>02295 
<a name="l02296"></a>02296 }
<a name="l02297"></a>02297 
<a name="l02298"></a>02298 <span class="keywordtype">void</span>
<a name="l02299"></a><a class="code" href="classNSGigE.html#ae9fa99034c3c2624840370638b57e66d">02299</a> <a class="code" href="classNSGigE.html#ae9fa99034c3c2624840370638b57e66d" title="Reconstruct the state of this object from a checkpoint.">NSGigE::unserialize</a>(<a class="code" href="classCheckpoint.html">Checkpoint</a> *cp, <span class="keyword">const</span> std::string &amp;section)
<a name="l02300"></a>02300 {
<a name="l02301"></a>02301     <span class="comment">// Unserialize the PciDev base class</span>
<a name="l02302"></a>02302     <a class="code" href="classNSGigE.html#ae9fa99034c3c2624840370638b57e66d" title="Reconstruct the state of this object from a checkpoint.">PciDev::unserialize</a>(cp, section);
<a name="l02303"></a>02303 
<a name="l02304"></a>02304     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a9600015476b774b3442165cf61f29ad9">command</a>);
<a name="l02305"></a>02305     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a7b90dafdbf78c3094e26e3b445a45118">config</a>);
<a name="l02306"></a>02306     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49e054c501a5a1f8d1fa342999a6c4e8">mear</a>);
<a name="l02307"></a>02307     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a32d4c8c44c00b5b1d6fc66568f24fee0">ptscr</a>);
<a name="l02308"></a>02308     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a69080883a6175fafc9167083c569b11f">isr</a>);
<a name="l02309"></a>02309     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acddcf1a513b8accb6d5c33e0edf39efe">imr</a>);
<a name="l02310"></a>02310     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#af82b628490afa00a40d0296a35f8ca80">ier</a>);
<a name="l02311"></a>02311     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2c267f1982b8c6826b03fe00f7631397">ihr</a>);
<a name="l02312"></a>02312     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acff64aa194acd44f476d4a1f741203e1">txdp</a>);
<a name="l02313"></a>02313     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#ae4b6bf5e002d832cbb70312510f7d537">txdp_hi</a>);
<a name="l02314"></a>02314     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#acf32d2fcfab30be47767f1531f75a2cc">txcfg</a>);
<a name="l02315"></a>02315     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a49fbb19ec37ec570701899609ae22cd6">gpior</a>);
<a name="l02316"></a>02316     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2174f997477d58985b12c3a059d38bf8">rxdp</a>);
<a name="l02317"></a>02317     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a5c2e9f02a7b391d4e117630478ad11b9">rxdp_hi</a>);
<a name="l02318"></a>02318     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a725ebce5e39e17777f38adc25d8c71f5">rxcfg</a>);
<a name="l02319"></a>02319     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2041e1c015742a4bd93e1160b2a995a2">pqcr</a>);
<a name="l02320"></a>02320     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a7cca9c6177ccc42f5f38b91e19f4df38">wcsr</a>);
<a name="l02321"></a>02321     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a956e3bb62b522823287435d048a75059">pcr</a>);
<a name="l02322"></a>02322     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a525ccc417f2173ef149f5e84cc8dbe61">rfcr</a>);
<a name="l02323"></a>02323     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#ab0ebbd837ee7f7471bfa439c802eceb9">rfdr</a>);
<a name="l02324"></a>02324     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#abef81a0ada42cd949d77552b57c58532">brar</a>);
<a name="l02325"></a>02325     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#af5ed12427079db279ea25c970662de08">brdr</a>);
<a name="l02326"></a>02326     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a210ef455baf3b7a9c577d2fef3757c85">srr</a>);
<a name="l02327"></a>02327     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a28bad330789b6511f93e3b8f8ec3c4e3">mibc</a>);
<a name="l02328"></a>02328     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#aac2bbec11b4590f8b2eb1583c147e2ee">vrcr</a>);
<a name="l02329"></a>02329     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#ad97af13deb1a5c24f449f538b0bf695d">vtcr</a>);
<a name="l02330"></a>02330     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a74ae9c0bdd32efa2efc9dcca19d8437d">vdr</a>);
<a name="l02331"></a>02331     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#ae9c8447eb409d13a9d0e404caa921374">ccsr</a>);
<a name="l02332"></a>02332     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a9113118d642b41d2aad8c551514759af">tbicr</a>);
<a name="l02333"></a>02333     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a2eee77294a95ae2e2f5652c3abbf2922">tbisr</a>);
<a name="l02334"></a>02334     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a639aecec1e7fed4b0cb5dbcfbcdbed56">tanar</a>);
<a name="l02335"></a>02335     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a52c74bd6cb93b3bbc7f4a7c4ad66e60e">tanlpar</a>);
<a name="l02336"></a>02336     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a71e889615b767822bbeb1d497ed2fa74">taner</a>);
<a name="l02337"></a>02337     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aac665a5be0a85f93d35fe3b57ad223ca" title="device register file">regs</a>.<a class="code" href="structdp__regs.html#a73c04ab08a0f39d76d90dd9f60464b6f">tesr</a>);
<a name="l02338"></a>02338 
<a name="l02339"></a>02339     <a class="code" href="serialize_8hh.html#a8de12bf68d0f92f7ab8585820607932e">UNSERIALIZE_ARRAY</a>(<a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#af43ad58249cf9a138a966951383b7c4d" title="for perfect match memory.">perfectMatch</a>, ETH_ADDR_LEN);
<a name="l02340"></a>02340     <a class="code" href="serialize_8hh.html#a8de12bf68d0f92f7ab8585820607932e">UNSERIALIZE_ARRAY</a>(<a class="code" href="classNSGigE.html#a91091b5b3f76fd5f420fbb11d188a17a">rom</a>.<a class="code" href="structdp__rom.html#a260603c4f6a5b5f188f9c26bbf136bad" title="for hash table memory.">filterHash</a>, <a class="code" href="ns__gige_8hh.html#a7d7c3db3667c7110b37292d81dc81362">FHASH_SIZE</a>);
<a name="l02341"></a>02341 
<a name="l02342"></a>02342     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a06cd8c902dcbd8093c38d803009db49d" title="pci settings">ioEnable</a>);
<a name="l02343"></a>02343 
<a name="l02344"></a>02344     <span class="comment">/*</span>
<a name="l02345"></a>02345 <span class="comment">     * unserialize the data fifos</span>
<a name="l02346"></a>02346 <span class="comment">     */</span>
<a name="l02347"></a>02347     <a class="code" href="classNSGigE.html#a6767f0e97ec4877c56c24b7a41e6d71d">rxFifo</a>.<a class="code" href="classPacketFifo.html#aeef26656cf88d146e92d318ca36c3aaf">unserialize</a>(<span class="stringliteral">&quot;rxFifo&quot;</span>, cp, section);
<a name="l02348"></a>02348     <a class="code" href="classNSGigE.html#a6f21443979a998c6f63cfbb2744e11fb">txFifo</a>.<a class="code" href="classPacketFifo.html#aeef26656cf88d146e92d318ca36c3aaf">unserialize</a>(<span class="stringliteral">&quot;txFifo&quot;</span>, cp, section);
<a name="l02349"></a>02349 
<a name="l02350"></a>02350     <span class="comment">/*</span>
<a name="l02351"></a>02351 <span class="comment">     * unserialize the various helper variables</span>
<a name="l02352"></a>02352 <span class="comment">     */</span>
<a name="l02353"></a>02353     <span class="keywordtype">bool</span> txPacketExists;
<a name="l02354"></a>02354     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(txPacketExists);
<a name="l02355"></a>02355     <span class="keywordflow">if</span> (txPacketExists) {
<a name="l02356"></a>02356         <a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a> = <span class="keyword">new</span> <a class="code" href="classEthPacketData.html">EthPacketData</a>(16384);
<a name="l02357"></a>02357         <a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a>-&gt;unserialize(<span class="stringliteral">&quot;txPacket&quot;</span>, cp, section);
<a name="l02358"></a>02358         <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> txPktBufPtr;
<a name="l02359"></a>02359         <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(txPktBufPtr);
<a name="l02360"></a>02360         <a class="code" href="classNSGigE.html#a83d14ec681383903f0a29949bdb99019">txPacketBufPtr</a> = (uint8_t *) <a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a>-&gt;<a class="code" href="classRefCountingPtr.html#a6b357f8b956e6421ef12211897528b6d" title="The stored pointer.">data</a> + txPktBufPtr;
<a name="l02361"></a>02361     } <span class="keywordflow">else</span>
<a name="l02362"></a>02362         <a class="code" href="classNSGigE.html#a6a7a3ee10a75a5d3863a54944c89328b" title="various helper vars">txPacket</a> = 0;
<a name="l02363"></a>02363 
<a name="l02364"></a>02364     <span class="keywordtype">bool</span> rxPacketExists;
<a name="l02365"></a>02365     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(rxPacketExists);
<a name="l02366"></a>02366     <a class="code" href="classNSGigE.html#a0ef842e4e509199950b7fcc341259980">rxPacket</a> = 0;
<a name="l02367"></a>02367     <span class="keywordflow">if</span> (rxPacketExists) {
<a name="l02368"></a>02368         <a class="code" href="classNSGigE.html#a0ef842e4e509199950b7fcc341259980">rxPacket</a> = <span class="keyword">new</span> <a class="code" href="classEthPacketData.html">EthPacketData</a>(16384);
<a name="l02369"></a>02369         <a class="code" href="classNSGigE.html#a0ef842e4e509199950b7fcc341259980">rxPacket</a>-&gt;unserialize(<span class="stringliteral">&quot;rxPacket&quot;</span>, cp, section);
<a name="l02370"></a>02370         <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> rxPktBufPtr;
<a name="l02371"></a>02371         <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(rxPktBufPtr);
<a name="l02372"></a>02372         <a class="code" href="classNSGigE.html#af777184a7b069629f67818b9025adc15">rxPacketBufPtr</a> = (uint8_t *) <a class="code" href="classNSGigE.html#a0ef842e4e509199950b7fcc341259980">rxPacket</a>-&gt;<a class="code" href="classRefCountingPtr.html#a6b357f8b956e6421ef12211897528b6d" title="The stored pointer.">data</a> + rxPktBufPtr;
<a name="l02373"></a>02373     } <span class="keywordflow">else</span>
<a name="l02374"></a>02374         <a class="code" href="classNSGigE.html#a0ef842e4e509199950b7fcc341259980">rxPacket</a> = 0;
<a name="l02375"></a>02375 
<a name="l02376"></a>02376     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a6dbadea5aab7bf664049c0519f9f1a16">txXferLen</a>);
<a name="l02377"></a>02377     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a0c8ab45b8e570a013b671d8952ec1193">rxXferLen</a>);
<a name="l02378"></a>02378 
<a name="l02379"></a>02379     <span class="comment">/*</span>
<a name="l02380"></a>02380 <span class="comment">     * Unserialize Cached Descriptors</span>
<a name="l02381"></a>02381 <span class="comment">     */</span>
<a name="l02382"></a>02382     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>.<a class="code" href="structns__desc64.html#ab8f1bd57eea3d30c7df8f5ecf33f7b7d">link</a>);
<a name="l02383"></a>02383     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>.<a class="code" href="structns__desc64.html#a5eeef802e303dbc13955b0dd997352ab">bufptr</a>);
<a name="l02384"></a>02384     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>.<a class="code" href="structns__desc64.html#a436fe4aab8750c7e98c059b512549c05">cmdsts</a>);
<a name="l02385"></a>02385     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ab1cec503d3a00a4bf8ae8d64c0588bc9">rxDesc64</a>.<a class="code" href="structns__desc64.html#ac0dc609d94bcdf47d8a87cc00321a531">extsts</a>);
<a name="l02386"></a>02386     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>.<a class="code" href="structns__desc64.html#ab8f1bd57eea3d30c7df8f5ecf33f7b7d">link</a>);
<a name="l02387"></a>02387     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>.<a class="code" href="structns__desc64.html#a5eeef802e303dbc13955b0dd997352ab">bufptr</a>);
<a name="l02388"></a>02388     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>.<a class="code" href="structns__desc64.html#a436fe4aab8750c7e98c059b512549c05">cmdsts</a>);
<a name="l02389"></a>02389     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a82ebea05c8d9162388dbfb4d195f941f">txDesc64</a>.<a class="code" href="structns__desc64.html#ac0dc609d94bcdf47d8a87cc00321a531">extsts</a>);
<a name="l02390"></a>02390     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>.<a class="code" href="structns__desc32.html#acf6b169af8584eaeeafbfdec9b7a2bf1">link</a>);
<a name="l02391"></a>02391     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>.<a class="code" href="structns__desc32.html#a0a47a3d5c0183ab5cd6567ee7d89ea32">bufptr</a>);
<a name="l02392"></a>02392     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>.<a class="code" href="structns__desc32.html#a3e24fd8f58ccd00550375969412d4915">cmdsts</a>);
<a name="l02393"></a>02393     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ad215859267b46c842583fddfadaec0ae">rxDesc32</a>.<a class="code" href="structns__desc32.html#a0bb874ccd5bfb9f31b6e6be18f544ada">extsts</a>);
<a name="l02394"></a>02394     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>.<a class="code" href="structns__desc32.html#acf6b169af8584eaeeafbfdec9b7a2bf1">link</a>);
<a name="l02395"></a>02395     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>.<a class="code" href="structns__desc32.html#a0a47a3d5c0183ab5cd6567ee7d89ea32">bufptr</a>);
<a name="l02396"></a>02396     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>.<a class="code" href="structns__desc32.html#a3e24fd8f58ccd00550375969412d4915">cmdsts</a>);
<a name="l02397"></a>02397     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a3dd29444bb02b8d14e902dee59077f70" title="DescCaches.">txDesc32</a>.<a class="code" href="structns__desc32.html#a0bb874ccd5bfb9f31b6e6be18f544ada">extsts</a>);
<a name="l02398"></a>02398     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#af6f500f63b3d9787299aa4a4fcccb103">extstsEnable</a>);
<a name="l02399"></a>02399 
<a name="l02400"></a>02400     <span class="comment">/*</span>
<a name="l02401"></a>02401 <span class="comment">     * unserialize tx state machine</span>
<a name="l02402"></a>02402 <span class="comment">     */</span>
<a name="l02403"></a>02403     <span class="keywordtype">int</span> txState;
<a name="l02404"></a>02404     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(txState);
<a name="l02405"></a>02405     this-&gt;txState = (TxState) txState;
<a name="l02406"></a>02406     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ac12794e1d7747b59b28f474813e42b6f">txEnable</a>);
<a name="l02407"></a>02407     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a42daaa387f54470e251759d4f42aed8a" title="Current Transmit Descriptor Done.">CTDD</a>);
<a name="l02408"></a>02408     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a35898de98a734b7d95c842ea88e88b46" title="ptr to the next byte in the current fragment">txFragPtr</a>);
<a name="l02409"></a>02409     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a66ca0e897397c87dc5c667ab26d5bafe" title="count of bytes remaining in the current descriptor">txDescCnt</a>);
<a name="l02410"></a>02410     <span class="keywordtype">int</span> txDmaState;
<a name="l02411"></a>02411     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(txDmaState);
<a name="l02412"></a>02412     this-&gt;txDmaState = (DmaState) txDmaState;
<a name="l02413"></a>02413     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a571a3c7d12873ad3fa81db8a488459e2">txKickTick</a>);
<a name="l02414"></a>02414     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#a571a3c7d12873ad3fa81db8a488459e2">txKickTick</a>)
<a name="l02415"></a>02415         <a class="code" href="classEventManager.html#a749a10828b2dd5017a2582960d04e400">schedule</a>(<a class="code" href="classNSGigE.html#a0de5118baed8d3fd18adffccf5a0f2c2">txKickEvent</a>, <a class="code" href="classNSGigE.html#a571a3c7d12873ad3fa81db8a488459e2">txKickTick</a>);
<a name="l02416"></a>02416 
<a name="l02417"></a>02417     <span class="comment">/*</span>
<a name="l02418"></a>02418 <span class="comment">     * unserialize rx state machine</span>
<a name="l02419"></a>02419 <span class="comment">     */</span>
<a name="l02420"></a>02420     <span class="keywordtype">int</span> rxState;
<a name="l02421"></a>02421     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(rxState);
<a name="l02422"></a>02422     this-&gt;rxState = (RxState) rxState;
<a name="l02423"></a>02423     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#abd3ee6dd80adc02a83aabb691332a92d">rxEnable</a>);
<a name="l02424"></a>02424     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a47964f2eddd257dd82a72a49e07e2952" title="Current Receive Descriptor Done.">CRDD</a>);
<a name="l02425"></a>02425     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a3fb29961f0bc18f17040d87f2d8c6d62" title="num of bytes in the current packet being drained from rxDataFifo">rxPktBytes</a>);
<a name="l02426"></a>02426     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a5bf18fd3cabd4a420f540760525da581" title="ptr to the next byte in current fragment">rxFragPtr</a>);
<a name="l02427"></a>02427     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#adc888bffd26d4e89da0ff44e9b82095c" title="count of bytes remaining in the current descriptor">rxDescCnt</a>);
<a name="l02428"></a>02428     <span class="keywordtype">int</span> rxDmaState;
<a name="l02429"></a>02429     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(rxDmaState);
<a name="l02430"></a>02430     this-&gt;rxDmaState = (DmaState) rxDmaState;
<a name="l02431"></a>02431     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#aa7d7349c084992d2d9ba6f3db2f0dfb6">rxKickTick</a>);
<a name="l02432"></a>02432     <span class="keywordflow">if</span> (<a class="code" href="classNSGigE.html#aa7d7349c084992d2d9ba6f3db2f0dfb6">rxKickTick</a>)
<a name="l02433"></a>02433         <a class="code" href="classEventManager.html#a749a10828b2dd5017a2582960d04e400">schedule</a>(<a class="code" href="classNSGigE.html#ab2e7c701035b1897012b8a4ba62b6ff4">rxKickEvent</a>, <a class="code" href="classNSGigE.html#aa7d7349c084992d2d9ba6f3db2f0dfb6">rxKickTick</a>);
<a name="l02434"></a>02434 
<a name="l02435"></a>02435     <span class="comment">/*</span>
<a name="l02436"></a>02436 <span class="comment">     * Unserialize EEPROM state machine</span>
<a name="l02437"></a>02437 <span class="comment">     */</span>
<a name="l02438"></a>02438     <span class="keywordtype">int</span> eepromState;
<a name="l02439"></a>02439     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(eepromState);
<a name="l02440"></a>02440     this-&gt;eepromState = (EEPROMState) eepromState;
<a name="l02441"></a>02441     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#ac1aa342b2168049136febe69fdb7dae0">eepromClk</a>);
<a name="l02442"></a>02442     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a6dd44dfbafe9f23f312213aaebf44087">eepromBitsToRx</a>);
<a name="l02443"></a>02443     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a0082d4a5f70dbcf4f2fc78d06e9e1a66">eepromOpcode</a>);
<a name="l02444"></a>02444     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#af5dcc8ba2acecdeb2b1551e9427fd35c">eepromAddress</a>);
<a name="l02445"></a>02445     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a096d1d19ffc19d115d248cff8886ae01">eepromData</a>);
<a name="l02446"></a>02446 
<a name="l02447"></a>02447     <span class="comment">/*</span>
<a name="l02448"></a>02448 <span class="comment">     * If there&#39;s a pending transmit, reschedule it now</span>
<a name="l02449"></a>02449 <span class="comment">     */</span>
<a name="l02450"></a>02450     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> transmitTick;
<a name="l02451"></a>02451     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(transmitTick);
<a name="l02452"></a>02452     <span class="keywordflow">if</span> (transmitTick)
<a name="l02453"></a>02453         <a class="code" href="classEventManager.html#a749a10828b2dd5017a2582960d04e400">schedule</a>(<a class="code" href="classNSGigE.html#a12950bf2b9b52611e65f9411f221d1f5">txEvent</a>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>() + transmitTick);
<a name="l02454"></a>02454 
<a name="l02455"></a>02455     <span class="comment">/*</span>
<a name="l02456"></a>02456 <span class="comment">     * unserialize receive address filter settings</span>
<a name="l02457"></a>02457 <span class="comment">     */</span>
<a name="l02458"></a>02458     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#af13268cbb1795582c363a211ff17a604" title="receive address filter">rxFilterEnable</a>);
<a name="l02459"></a>02459     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#afe19d30d3ec62ef1a129e5ecd5e8ea1e">acceptBroadcast</a>);
<a name="l02460"></a>02460     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a3d4914b10c5606a632c550251ef3079b">acceptMulticast</a>);
<a name="l02461"></a>02461     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a402a74038f39b5a1551dfd137e9876d5">acceptUnicast</a>);
<a name="l02462"></a>02462     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#acc0f2bddaadb14d655d6f6e33a85b077">acceptPerfect</a>);
<a name="l02463"></a>02463     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a0097dd413d75e23e9b2c24d5b9b86657">acceptArp</a>);
<a name="l02464"></a>02464     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a1d87be28edf16677e019a3015fed059e">multicastHashEnable</a>);
<a name="l02465"></a>02465 
<a name="l02466"></a>02466     <span class="comment">/*</span>
<a name="l02467"></a>02467 <span class="comment">     * Keep track of pending interrupt status.</span>
<a name="l02468"></a>02468 <span class="comment">     */</span>
<a name="l02469"></a>02469     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#a2929b39dcabc4b8384a72cb035dd307b">intrTick</a>);
<a name="l02470"></a>02470     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classNSGigE.html#af3381915c8c18105505516cc4795d3f1">cpuPendingIntr</a>);
<a name="l02471"></a>02471     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> intrEventTick;
<a name="l02472"></a>02472     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(intrEventTick);
<a name="l02473"></a>02473     <span class="keywordflow">if</span> (intrEventTick) {
<a name="l02474"></a>02474         <a class="code" href="classNSGigE.html#a9a347760a0cc3d9ffa531314af40bf06">intrEvent</a> = <span class="keyword">new</span> <a class="code" href="classNSGigE.html#a162c36c6f7535681982e5652221af901">IntrEvent</a>(<span class="keyword">this</span>, <span class="keyword">true</span>);
<a name="l02475"></a>02475         <a class="code" href="classEventManager.html#a749a10828b2dd5017a2582960d04e400">schedule</a>(<a class="code" href="classNSGigE.html#a9a347760a0cc3d9ffa531314af40bf06">intrEvent</a>, intrEventTick);
<a name="l02476"></a>02476     }
<a name="l02477"></a>02477 }
<a name="l02478"></a>02478 
<a name="l02479"></a>02479 <a class="code" href="classNSGigE.html" title="NS DP83820 Ethernet device model.">NSGigE</a> *
<a name="l02480"></a>02480 NSGigEParams::create()
<a name="l02481"></a>02481 {
<a name="l02482"></a>02482     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classNSGigE.html#a1247657d1e66bf8126b4203053ad34c9">NSGigE</a>(<span class="keyword">this</span>);
<a name="l02483"></a>02483 }
</pre></div></div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"><address style="align: right;"><small>
Generated on Sun Apr 7 2013 18:16:36 for gem5 by <a href="http://www.doxygen.org/index.html"> doxygen</a> 1.7.1</small></address>

</body>
</html>
