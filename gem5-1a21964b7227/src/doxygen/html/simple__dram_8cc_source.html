<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>gem5: mem/simple_dram.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>mem/simple_dram.cc</h1>  </div>
</div>
<div class="contents">
<a href="simple__dram_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2010-2012 ARM Limited</span>
<a name="l00003"></a>00003 <span class="comment"> * All rights reserved</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * The license below extends only to copyright in the software and shall</span>
<a name="l00006"></a>00006 <span class="comment"> * not be construed as granting a license to any other intellectual</span>
<a name="l00007"></a>00007 <span class="comment"> * property including but not limited to intellectual property relating</span>
<a name="l00008"></a>00008 <span class="comment"> * to a hardware implementation of the functionality of the software</span>
<a name="l00009"></a>00009 <span class="comment"> * licensed hereunder.  You may use the software subject to the license</span>
<a name="l00010"></a>00010 <span class="comment"> * terms below provided that you ensure that this notice is replicated</span>
<a name="l00011"></a>00011 <span class="comment"> * unmodified and in its entirety in all distributions of the software,</span>
<a name="l00012"></a>00012 <span class="comment"> * modified or unmodified, in source code or in binary form.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00015"></a>00015 <span class="comment"> * modification, are permitted provided that the following conditions are</span>
<a name="l00016"></a>00016 <span class="comment"> * met: redistributions of source code must retain the above copyright</span>
<a name="l00017"></a>00017 <span class="comment"> * notice, this list of conditions and the following disclaimer;</span>
<a name="l00018"></a>00018 <span class="comment"> * redistributions in binary form must reproduce the above copyright</span>
<a name="l00019"></a>00019 <span class="comment"> * notice, this list of conditions and the following disclaimer in the</span>
<a name="l00020"></a>00020 <span class="comment"> * documentation and/or other materials provided with the distribution;</span>
<a name="l00021"></a>00021 <span class="comment"> * neither the name of the copyright holders nor the names of its</span>
<a name="l00022"></a>00022 <span class="comment"> * contributors may be used to endorse or promote products derived from</span>
<a name="l00023"></a>00023 <span class="comment"> * this software without specific prior written permission.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00026"></a>00026 <span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00027"></a>00027 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00028"></a>00028 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00029"></a>00029 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00030"></a>00030 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00031"></a>00031 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00032"></a>00032 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00033"></a>00033 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00034"></a>00034 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00035"></a>00035 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00036"></a>00036 <span class="comment"> *</span>
<a name="l00037"></a>00037 <span class="comment"> * Authors: Andreas Hansson</span>
<a name="l00038"></a>00038 <span class="comment"> *          Ani Udipi</span>
<a name="l00039"></a>00039 <span class="comment"> */</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="trace_8hh.html">base/trace.hh</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;debug/Drain.hh&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;debug/DRAM.hh&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;debug/DRAMWR.hh&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="simple__dram_8hh.html" title="SimpleDRAM declaration.">mem/simple_dram.hh</a>&quot;</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="keyword">using namespace </span>std;
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="classSimpleDRAM.html#a5aded1bfa310510d0f2e0164f8ffefa5">00049</a> <a class="code" href="classSimpleDRAM.html#a5aded1bfa310510d0f2e0164f8ffefa5">SimpleDRAM::SimpleDRAM</a>(<span class="keyword">const</span> SimpleDRAMParams* <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>) :
<a name="l00050"></a>00050     <a class="code" href="classAbstractMemory.html" title="An abstract memory represents a contiguous block of physical memory, with an associated address range...">AbstractMemory</a>(p),
<a name="l00051"></a>00051     port(<a class="code" href="trace_8hh.html#a166fa10b86d8faa127fb7c78191e3e60">name</a>() + <span class="stringliteral">&quot;.port&quot;</span>, *this),
<a name="l00052"></a>00052     retryRdReq(false), retryWrReq(false),
<a name="l00053"></a>00053     rowHitFlag(false), stopReads(false), actTicks(p-&gt;activation_limit, 0),
<a name="l00054"></a>00054     writeEvent(this), respondEvent(this),
<a name="l00055"></a>00055     refreshEvent(this), nextReqEvent(this), drainManager(NULL),
<a name="l00056"></a>00056     bytesPerCacheLine(0),
<a name="l00057"></a>00057     linesPerRowBuffer(p-&gt;lines_per_rowbuffer),
<a name="l00058"></a>00058     ranksPerChannel(p-&gt;ranks_per_channel),
<a name="l00059"></a>00059     banksPerRank(p-&gt;banks_per_rank), channels(p-&gt;channels), rowsPerBank(0),
<a name="l00060"></a>00060     readBufferSize(p-&gt;read_buffer_size),
<a name="l00061"></a>00061     writeBufferSize(p-&gt;write_buffer_size),
<a name="l00062"></a>00062     writeThresholdPerc(p-&gt;write_thresh_perc),
<a name="l00063"></a>00063     tWTR(p-&gt;tWTR), tBURST(p-&gt;tBURST),
<a name="l00064"></a>00064     tRCD(p-&gt;tRCD), tCL(p-&gt;tCL), tRP(p-&gt;tRP),
<a name="l00065"></a>00065     tRFC(p-&gt;tRFC), tREFI(p-&gt;tREFI),
<a name="l00066"></a>00066     tXAW(p-&gt;tXAW), activationLimit(p-&gt;activation_limit),
<a name="l00067"></a>00067     memSchedPolicy(p-&gt;mem_sched_policy), addrMapping(p-&gt;addr_mapping),
<a name="l00068"></a>00068     pageMgmt(p-&gt;page_policy),
<a name="l00069"></a>00069     busBusyUntil(0), writeStartTime(0),
<a name="l00070"></a>00070     prevArrival(0), numReqs(0)
<a name="l00071"></a>00071 {
<a name="l00072"></a>00072     <span class="comment">// create the bank states based on the dimensions of the ranks and</span>
<a name="l00073"></a>00073     <span class="comment">// banks</span>
<a name="l00074"></a>00074     <a class="code" href="classSimpleDRAM.html#af6d821da9435a1a82265fd1e180becc8" title="Multi-dimensional vector of banks, first dimension is ranks, second is bank.">banks</a>.resize(<a class="code" href="classSimpleDRAM.html#a59dd3867633d6a508faa5a14a0926376">ranksPerChannel</a>);
<a name="l00075"></a>00075     <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespaceArmISA.html#a21f7b327cbedf079597394ec2c3f2a6d">c</a> = 0; <a class="code" href="namespaceArmISA.html#a21f7b327cbedf079597394ec2c3f2a6d">c</a> &lt; <a class="code" href="classSimpleDRAM.html#a59dd3867633d6a508faa5a14a0926376">ranksPerChannel</a>; ++<a class="code" href="namespaceArmISA.html#a21f7b327cbedf079597394ec2c3f2a6d">c</a>) {
<a name="l00076"></a>00076         <a class="code" href="classSimpleDRAM.html#af6d821da9435a1a82265fd1e180becc8" title="Multi-dimensional vector of banks, first dimension is ranks, second is bank.">banks</a>[<a class="code" href="namespaceArmISA.html#a21f7b327cbedf079597394ec2c3f2a6d">c</a>].resize(<a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a>);
<a name="l00077"></a>00077     }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     <span class="comment">// round the write threshold percent to a whole number of entries</span>
<a name="l00080"></a>00080     <span class="comment">// in the buffer</span>
<a name="l00081"></a>00081     <a class="code" href="classSimpleDRAM.html#a4d0cd8d9801602f3e59033c71cb5fa54">writeThreshold</a> = <a class="code" href="classSimpleDRAM.html#a249b9d7a954f943f6f2556a1fe9cb7b7">writeBufferSize</a> * <a class="code" href="classSimpleDRAM.html#ae997240436599d1ddca6620dcfe32f9e">writeThresholdPerc</a> / 100.0;
<a name="l00082"></a>00082 }
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 <span class="keywordtype">void</span>
<a name="l00085"></a><a class="code" href="classSimpleDRAM.html#a0d3c0147cbb9ef1da26a4ba7020d7771">00085</a> <a class="code" href="classSimpleDRAM.html#a0d3c0147cbb9ef1da26a4ba7020d7771" title="init() is called after all C++ SimObjects have been created and all ports are connected.">SimpleDRAM::init</a>()
<a name="l00086"></a>00086 {
<a name="l00087"></a>00087     <span class="keywordflow">if</span> (!<a class="code" href="classSimpleDRAM.html#aa90269cc4d8251534062632d549fea1f" title="Our incoming port, for a multi-ported controller add a crossbar in front of it.">port</a>.<a class="code" href="classBaseSlavePort.html#abcc0500ed927088c400b25abecae5c8c">isConnected</a>()) {
<a name="l00088"></a>00088         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;SimpleDRAM %s is unconnected!\n&quot;</span>, <a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>());
<a name="l00089"></a>00089     } <span class="keywordflow">else</span> {
<a name="l00090"></a>00090         <a class="code" href="classSimpleDRAM.html#aa90269cc4d8251534062632d549fea1f" title="Our incoming port, for a multi-ported controller add a crossbar in front of it.">port</a>.<a class="code" href="classSlavePort.html#a335e5649623f9976259f34aa10bbebdd" title="Called by the owner to send a range change.">sendRangeChange</a>();
<a name="l00091"></a>00091     }
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     <span class="comment">// get the burst size from the connected port as it is currently</span>
<a name="l00094"></a>00094     <span class="comment">// assumed to be equal to the cache line size</span>
<a name="l00095"></a>00095     <a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a> = <a class="code" href="classSimpleDRAM.html#aa90269cc4d8251534062632d549fea1f" title="Our incoming port, for a multi-ported controller add a crossbar in front of it.">port</a>.<a class="code" href="classSlavePort.html#aece22172715bfd4bee3ac317888ddde9" title="Called by the associated device if it wishes to find out the blocksize of the device on attached to t...">peerBlockSize</a>();
<a name="l00096"></a>00096 
<a name="l00097"></a>00097     <span class="comment">// we could deal with plenty options here, but for now do a quick</span>
<a name="l00098"></a>00098     <span class="comment">// sanity check</span>
<a name="l00099"></a>00099     <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a> != 64 &amp;&amp; <a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a> != 32)
<a name="l00100"></a>00100         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unexpected burst size %d&quot;</span>, <a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a>);
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     <span class="comment">// determine the rows per bank by looking at the total capacity</span>
<a name="l00103"></a>00103     uint64_t capacity = <a class="code" href="base_2types_8hh.html#adcc3cf526a71c0dfaae020d432c78b83" title="uint64_t constant">ULL</a>(1) &lt;&lt; <a class="code" href="intmath_8hh.html#a0ec4eaea50888f737b803dc9427614bf">ceilLog2</a>(<a class="code" href="classAbstractMemory.html#ac59f603c2428f8cdb228997baa5b9768" title="Get the memory size.">AbstractMemory::size</a>());
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Memory capacity %lld (%lld) bytes\n&quot;</span>, capacity,
<a name="l00106"></a>00106             <a class="code" href="classAbstractMemory.html#ac59f603c2428f8cdb228997baa5b9768" title="Get the memory size.">AbstractMemory::size</a>());
<a name="l00107"></a>00107     <a class="code" href="classSimpleDRAM.html#a45d8955f120c436ebbd2ab55b29cf731">rowsPerBank</a> = capacity / (<a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a> * <a class="code" href="classSimpleDRAM.html#a631354beefc514baca4477d795ab59b5">linesPerRowBuffer</a> *
<a name="l00108"></a>00108                               <a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a> * <a class="code" href="classSimpleDRAM.html#a59dd3867633d6a508faa5a14a0926376">ranksPerChannel</a>);
<a name="l00109"></a>00109 
<a name="l00110"></a>00110     <span class="keywordflow">if</span> (<a class="code" href="classAbstractMemory.html#a461dae592dd96034616faabf931d2fdf">range</a>.<a class="code" href="classAddrRange.html#a14afd5b81ec02effb3b2a9100b3611e7" title="Determine if the range is interleaved or not.">interleaved</a>()) {
<a name="l00111"></a>00111         <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a39c50789d115aee7035049c2862e7f1a">channels</a> != <a class="code" href="classAbstractMemory.html#a461dae592dd96034616faabf931d2fdf">range</a>.<a class="code" href="classAddrRange.html#add428312a9dced4977bbdb36a988e2bf" title="Determine the number of interleaved address stripes this range is part of.">stripes</a>())
<a name="l00112"></a>00112             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;%s has %d interleaved address stripes but %d channel(s)\n&quot;</span>,
<a name="l00113"></a>00113                   <a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>(), <a class="code" href="classAbstractMemory.html#a461dae592dd96034616faabf931d2fdf">range</a>.<a class="code" href="classAddrRange.html#add428312a9dced4977bbdb36a988e2bf" title="Determine the number of interleaved address stripes this range is part of.">stripes</a>(), <a class="code" href="classSimpleDRAM.html#a39c50789d115aee7035049c2862e7f1a">channels</a>);
<a name="l00114"></a>00114 
<a name="l00115"></a>00115         <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a6358b64577b8328e023d0fb8f8d8dacc">addrMapping</a> == Enums::openmap) {
<a name="l00116"></a>00116             <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a> * <a class="code" href="classSimpleDRAM.html#a631354beefc514baca4477d795ab59b5">linesPerRowBuffer</a> !=
<a name="l00117"></a>00117                 <a class="code" href="classAbstractMemory.html#a461dae592dd96034616faabf931d2fdf">range</a>.<a class="code" href="classAddrRange.html#aab600318c0d3d5922c518f7691410b93" title="Determing the interleaving granularity of the range.">granularity</a>()) {
<a name="l00118"></a>00118                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Interleaving of %s doesn&#39;t match open address map\n&quot;</span>,
<a name="l00119"></a>00119                       <a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>());
<a name="l00120"></a>00120             }
<a name="l00121"></a>00121         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a6358b64577b8328e023d0fb8f8d8dacc">addrMapping</a> == Enums::closemap) {
<a name="l00122"></a>00122             <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a> != <a class="code" href="classAbstractMemory.html#a461dae592dd96034616faabf931d2fdf">range</a>.<a class="code" href="classAddrRange.html#aab600318c0d3d5922c518f7691410b93" title="Determing the interleaving granularity of the range.">granularity</a>())
<a name="l00123"></a>00123                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Interleaving of %s doesn&#39;t match closed address map\n&quot;</span>,
<a name="l00124"></a>00124                       <a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>());
<a name="l00125"></a>00125         }
<a name="l00126"></a>00126     }
<a name="l00127"></a>00127 }
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 <span class="keywordtype">void</span>
<a name="l00130"></a><a class="code" href="classSimpleDRAM.html#ac12c23977edf258ed93ec6a8b4feadbf">00130</a> <a class="code" href="classSimpleDRAM.html#ac12c23977edf258ed93ec6a8b4feadbf" title="startup() is the final initialization call before simulation.">SimpleDRAM::startup</a>()
<a name="l00131"></a>00131 {
<a name="l00132"></a>00132     <span class="comment">// print the configuration of the controller</span>
<a name="l00133"></a>00133     <a class="code" href="classSimpleDRAM.html#a64d6b9efd719af9ac5714be8e5904007">printParams</a>();
<a name="l00134"></a>00134 
<a name="l00135"></a>00135     <span class="comment">// kick off the refresh</span>
<a name="l00136"></a>00136     <a class="code" href="classEventManager.html#a749a10828b2dd5017a2582960d04e400">schedule</a>(<a class="code" href="classSimpleDRAM.html#ab47d4b5fbdbc35f3b3142693d57ef549">refreshEvent</a>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>() + <a class="code" href="classSimpleDRAM.html#afbc72654a5c306d321bae5c5617cbee4">tREFI</a>);
<a name="l00137"></a>00137 }
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a>
<a name="l00140"></a><a class="code" href="classSimpleDRAM.html#a660f4b4c86708c1acf4cba0593362aaa">00140</a> <a class="code" href="classSimpleDRAM.html#a660f4b4c86708c1acf4cba0593362aaa">SimpleDRAM::recvAtomic</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt)
<a name="l00141"></a>00141 {
<a name="l00142"></a>00142     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;recvAtomic: %s 0x%x\n&quot;</span>, pkt-&gt;<a class="code" href="classPacket.html#a50fa8e54b8b71b0d6879307680517697" title="Return the string name of the cmd field (for debugging and tracing).">cmdString</a>(), pkt-&gt;<a class="code" href="classPacket.html#a1c04785186ba5aa70a40cac9b2bfc86e">getAddr</a>());
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <span class="comment">// do the actual memory access and turn the packet into a response</span>
<a name="l00145"></a>00145     <a class="code" href="classAbstractMemory.html#a4f8bf048c846bef573325f47a0603b09" title="Perform an untimed memory access and update all the state (e.g.">access</a>(pkt);
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> latency = 0;
<a name="l00148"></a>00148     <span class="keywordflow">if</span> (!pkt-&gt;<a class="code" href="classPacket.html#a27ed6fc8c4baa6d6aaeaee8aa743fca5">memInhibitAsserted</a>() &amp;&amp; pkt-&gt;<a class="code" href="classPacket.html#a9f23402c9a7438f2edab83d028f58d3b">hasData</a>()) {
<a name="l00149"></a>00149         <span class="comment">// this value is not supposed to be accurate, just enough to</span>
<a name="l00150"></a>00150         <span class="comment">// keep things going, mimic a closed page</span>
<a name="l00151"></a>00151         latency = <a class="code" href="classSimpleDRAM.html#ad0629e1f3d27f13c661c80f48d5be2d8">tRP</a> + <a class="code" href="classSimpleDRAM.html#a80c334c459a055c74baec86aa8cb34e0">tRCD</a> + <a class="code" href="classSimpleDRAM.html#aac0d0316cd00cc9f58902fa3f635c2a5">tCL</a>;
<a name="l00152"></a>00152     }
<a name="l00153"></a>00153     <span class="keywordflow">return</span> latency;
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 <span class="keywordtype">bool</span>
<a name="l00157"></a><a class="code" href="classSimpleDRAM.html#a8b109c42b80b49d5770d23b0ef6839d6">00157</a> <a class="code" href="classSimpleDRAM.html#a8b109c42b80b49d5770d23b0ef6839d6" title="Check if the read queue has room for more entries.">SimpleDRAM::readQueueFull</a>()<span class="keyword"> const</span>
<a name="l00158"></a>00158 <span class="keyword"></span>{
<a name="l00159"></a>00159     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Read queue limit %d current size %d\n&quot;</span>,
<a name="l00160"></a>00160             <a class="code" href="classSimpleDRAM.html#a9c2f74f4d1b4f265456240efce92640b">readBufferSize</a>, <a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.size() + <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.size());
<a name="l00161"></a>00161 
<a name="l00162"></a>00162     <span class="keywordflow">return</span> (<a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.size() + <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.size()) == <a class="code" href="classSimpleDRAM.html#a9c2f74f4d1b4f265456240efce92640b">readBufferSize</a>;
<a name="l00163"></a>00163 }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="keywordtype">bool</span>
<a name="l00166"></a><a class="code" href="classSimpleDRAM.html#acbb7fece4d4f3b182e9308b788725fc4">00166</a> <a class="code" href="classSimpleDRAM.html#acbb7fece4d4f3b182e9308b788725fc4" title="Check if the write queue has room for more entries.">SimpleDRAM::writeQueueFull</a>()<span class="keyword"> const</span>
<a name="l00167"></a>00167 <span class="keyword"></span>{
<a name="l00168"></a>00168     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Write queue limit %d current size %d\n&quot;</span>,
<a name="l00169"></a>00169             <a class="code" href="classSimpleDRAM.html#a249b9d7a954f943f6f2556a1fe9cb7b7">writeBufferSize</a>, <a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.size());
<a name="l00170"></a>00170     <span class="keywordflow">return</span> <a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.size() == <a class="code" href="classSimpleDRAM.html#a249b9d7a954f943f6f2556a1fe9cb7b7">writeBufferSize</a>;
<a name="l00171"></a>00171 }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 <a class="code" href="classSimpleDRAM_1_1DRAMPacket.html" title="A DRAM packet stores packets along with the timestamp of when the packet entered the queue...">SimpleDRAM::DRAMPacket</a>*
<a name="l00174"></a><a class="code" href="classSimpleDRAM.html#a6c27bc2ec09efdc6abd871835e0110f9">00174</a> <a class="code" href="classSimpleDRAM.html#a6c27bc2ec09efdc6abd871835e0110f9" title="Address decoder to figure out physical mapping onto ranks, banks, and rows.">SimpleDRAM::decodeAddr</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt)
<a name="l00175"></a>00175 {
<a name="l00176"></a>00176     <span class="comment">// decode the address based on the address mapping scheme</span>
<a name="l00177"></a>00177     <span class="comment">//</span>
<a name="l00178"></a>00178     <span class="comment">// with R, C, B and K denoting rank, column, bank and rank,</span>
<a name="l00179"></a>00179     <span class="comment">// respectively, and going from MSB to LSB, the two schemes are</span>
<a name="l00180"></a>00180     <span class="comment">// RKBC (openmap) and RCKB (closedmap)</span>
<a name="l00181"></a>00181     uint8_t rank;
<a name="l00182"></a>00182     uint16_t bank;
<a name="l00183"></a>00183     uint16_t row;
<a name="l00184"></a>00184 
<a name="l00185"></a>00185     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> <a class="code" href="namespaceX86ISA.html#a79b5c08c190167d17c9b9b3fd40112f6">addr</a> = pkt-&gt;<a class="code" href="classPacket.html#a1c04785186ba5aa70a40cac9b2bfc86e">getAddr</a>();
<a name="l00186"></a>00186 
<a name="l00187"></a>00187     <span class="comment">// truncate the address to the access granularity</span>
<a name="l00188"></a>00188     addr = addr / <a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a>;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     <span class="comment">// we have removed the lowest order address bits that denote the</span>
<a name="l00191"></a>00191     <span class="comment">// position within the cache line, proceed and select the</span>
<a name="l00192"></a>00192     <span class="comment">// appropriate bits for bank, rank and row (no column address is</span>
<a name="l00193"></a>00193     <span class="comment">// needed)</span>
<a name="l00194"></a>00194     <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a6358b64577b8328e023d0fb8f8d8dacc">addrMapping</a> == Enums::openmap) {
<a name="l00195"></a>00195         <span class="comment">// the lowest order bits denote the column to ensure that</span>
<a name="l00196"></a>00196         <span class="comment">// sequential cache lines occupy the same row</span>
<a name="l00197"></a>00197         addr = addr / <a class="code" href="classSimpleDRAM.html#a631354beefc514baca4477d795ab59b5">linesPerRowBuffer</a>;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199         <span class="comment">// take out the channel part of the address, note that this has</span>
<a name="l00200"></a>00200         <span class="comment">// to match with how accesses are interleaved between the</span>
<a name="l00201"></a>00201         <span class="comment">// controllers in the address mapping</span>
<a name="l00202"></a>00202         addr = addr / <a class="code" href="classSimpleDRAM.html#a39c50789d115aee7035049c2862e7f1a">channels</a>;
<a name="l00203"></a>00203 
<a name="l00204"></a>00204         <span class="comment">// after the column bits, we get the bank bits to interleave</span>
<a name="l00205"></a>00205         <span class="comment">// over the banks</span>
<a name="l00206"></a>00206         bank = addr % <a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a>;
<a name="l00207"></a>00207         addr = addr / <a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a>;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209         <span class="comment">// after the bank, we get the rank bits which thus interleaves</span>
<a name="l00210"></a>00210         <span class="comment">// over the ranks</span>
<a name="l00211"></a>00211         rank = addr % <a class="code" href="classSimpleDRAM.html#a59dd3867633d6a508faa5a14a0926376">ranksPerChannel</a>;
<a name="l00212"></a>00212         addr = addr / <a class="code" href="classSimpleDRAM.html#a59dd3867633d6a508faa5a14a0926376">ranksPerChannel</a>;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214         <span class="comment">// lastly, get the row bits</span>
<a name="l00215"></a>00215         row = addr % <a class="code" href="classSimpleDRAM.html#a45d8955f120c436ebbd2ab55b29cf731">rowsPerBank</a>;
<a name="l00216"></a>00216         addr = addr / <a class="code" href="classSimpleDRAM.html#a45d8955f120c436ebbd2ab55b29cf731">rowsPerBank</a>;
<a name="l00217"></a>00217     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a6358b64577b8328e023d0fb8f8d8dacc">addrMapping</a> == Enums::closemap) {
<a name="l00218"></a>00218         <span class="comment">// optimise for closed page mode and utilise maximum</span>
<a name="l00219"></a>00219         <span class="comment">// parallelism of the DRAM (at the cost of power)</span>
<a name="l00220"></a>00220 
<a name="l00221"></a>00221         <span class="comment">// take out the channel part of the address, not that this has</span>
<a name="l00222"></a>00222         <span class="comment">// to match with how accesses are interleaved between the</span>
<a name="l00223"></a>00223         <span class="comment">// controllers in the address mapping</span>
<a name="l00224"></a>00224         addr = addr / <a class="code" href="classSimpleDRAM.html#a39c50789d115aee7035049c2862e7f1a">channels</a>;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226         <span class="comment">// start with the bank bits, as this provides the maximum</span>
<a name="l00227"></a>00227         <span class="comment">// opportunity for parallelism between requests</span>
<a name="l00228"></a>00228         bank = addr % <a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a>;
<a name="l00229"></a>00229         addr = addr / <a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a>;
<a name="l00230"></a>00230 
<a name="l00231"></a>00231         <span class="comment">// next get the rank bits</span>
<a name="l00232"></a>00232         rank = addr % <a class="code" href="classSimpleDRAM.html#a59dd3867633d6a508faa5a14a0926376">ranksPerChannel</a>;
<a name="l00233"></a>00233         addr = addr / <a class="code" href="classSimpleDRAM.html#a59dd3867633d6a508faa5a14a0926376">ranksPerChannel</a>;
<a name="l00234"></a>00234 
<a name="l00235"></a>00235         <span class="comment">// next the column bits which we do not need to keep track of</span>
<a name="l00236"></a>00236         <span class="comment">// and simply skip past</span>
<a name="l00237"></a>00237         addr = addr / <a class="code" href="classSimpleDRAM.html#a631354beefc514baca4477d795ab59b5">linesPerRowBuffer</a>;
<a name="l00238"></a>00238 
<a name="l00239"></a>00239         <span class="comment">// lastly, get the row bits</span>
<a name="l00240"></a>00240         row = addr % <a class="code" href="classSimpleDRAM.html#a45d8955f120c436ebbd2ab55b29cf731">rowsPerBank</a>;
<a name="l00241"></a>00241         addr = addr / <a class="code" href="classSimpleDRAM.html#a45d8955f120c436ebbd2ab55b29cf731">rowsPerBank</a>;
<a name="l00242"></a>00242     } <span class="keywordflow">else</span>
<a name="l00243"></a>00243         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unknown address mapping policy chosen!&quot;</span>);
<a name="l00244"></a>00244 
<a name="l00245"></a>00245     assert(rank &lt; <a class="code" href="classSimpleDRAM.html#a59dd3867633d6a508faa5a14a0926376">ranksPerChannel</a>);
<a name="l00246"></a>00246     assert(bank &lt; <a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a>);
<a name="l00247"></a>00247     assert(row &lt; <a class="code" href="classSimpleDRAM.html#a45d8955f120c436ebbd2ab55b29cf731">rowsPerBank</a>);
<a name="l00248"></a>00248 
<a name="l00249"></a>00249     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Address: %lld Rank %d Bank %d Row %d\n&quot;</span>,
<a name="l00250"></a>00250             pkt-&gt;<a class="code" href="classPacket.html#a1c04785186ba5aa70a40cac9b2bfc86e">getAddr</a>(), rank, bank, row);
<a name="l00251"></a>00251 
<a name="l00252"></a>00252     <span class="comment">// create the corresponding DRAM packet with the entry time and</span>
<a name="l00253"></a>00253     <span class="comment">// ready time set to the current tick, the latter will be updated</span>
<a name="l00254"></a>00254     <span class="comment">// later</span>
<a name="l00255"></a>00255     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classSimpleDRAM_1_1DRAMPacket.html" title="A DRAM packet stores packets along with the timestamp of when the packet entered the queue...">DRAMPacket</a>(pkt, rank, bank, row, pkt-&gt;<a class="code" href="classPacket.html#a1c04785186ba5aa70a40cac9b2bfc86e">getAddr</a>(),
<a name="l00256"></a>00256                           <a class="code" href="classSimpleDRAM.html#af6d821da9435a1a82265fd1e180becc8" title="Multi-dimensional vector of banks, first dimension is ranks, second is bank.">banks</a>[rank][bank]);
<a name="l00257"></a>00257 }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 <span class="keywordtype">void</span>
<a name="l00260"></a><a class="code" href="classSimpleDRAM.html#ad41783bc2de170b32e31da2df472c67c">00260</a> <a class="code" href="classSimpleDRAM.html#ad41783bc2de170b32e31da2df472c67c" title="When a new read comes in, first check if the write q has a pending request to the same address...">SimpleDRAM::addToReadQueue</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt)
<a name="l00261"></a>00261 {
<a name="l00262"></a>00262     <span class="comment">// only add to the read queue here. whenever the request is</span>
<a name="l00263"></a>00263     <span class="comment">// eventually done, set the readyTime, and call schedule()</span>
<a name="l00264"></a>00264     assert(!pkt-&gt;<a class="code" href="classPacket.html#a2bfee2cdcdfd22a227f0254b7dd56249">isWrite</a>());
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <span class="comment">// First check write buffer to see if the data is already at</span>
<a name="l00267"></a>00267     <span class="comment">// the controller</span>
<a name="l00268"></a>00268     <a class="code" href="classstd_1_1list.html" title="STL list class.">list&lt;DRAMPacket*&gt;::const_iterator</a> <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>;
<a name="l00269"></a>00269     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> <a class="code" href="namespaceX86ISA.html#a79b5c08c190167d17c9b9b3fd40112f6">addr</a> = pkt-&gt;<a class="code" href="classPacket.html#a1c04785186ba5aa70a40cac9b2bfc86e">getAddr</a>();
<a name="l00270"></a>00270 
<a name="l00271"></a>00271     <span class="comment">// @todo: add size check</span>
<a name="l00272"></a>00272     <span class="keywordflow">for</span> (i = <a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.begin(); i != <a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.end(); ++i) {
<a name="l00273"></a>00273         <span class="keywordflow">if</span> ((*i)-&gt;addr == addr){
<a name="l00274"></a>00274             <a class="code" href="classSimpleDRAM.html#acbfa17d79d4392737d91a4d490e77008">servicedByWrQ</a>++;
<a name="l00275"></a>00275             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Read to %lld serviced by write queue\n&quot;</span>, addr);
<a name="l00276"></a>00276             <a class="code" href="classSimpleDRAM.html#a26c6b81e5560eb19eec95ccd56d25245" title="Number of total bytes read from this memory.">bytesRead</a> += <a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a>;
<a name="l00277"></a>00277             <a class="code" href="classSimpleDRAM.html#a81712e0ad4e89e4a615e94f566f1af88">bytesConsumedRd</a> += pkt-&gt;<a class="code" href="classPacket.html#ad7c96bd8cd06acddebb3a373b37e6e59">getSize</a>();
<a name="l00278"></a>00278             <a class="code" href="classSimpleDRAM.html#abba090ae9bfbbc119456be4ed00e475f" title="When a packet reaches its &amp;quot;readyTime&amp;quot; in the response Q, use the &amp;quot;access()&amp;quot; metho...">accessAndRespond</a>(pkt);
<a name="l00279"></a>00279             <span class="keywordflow">return</span>;
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281     }
<a name="l00282"></a>00282 
<a name="l00283"></a>00283     <a class="code" href="classSimpleDRAM_1_1DRAMPacket.html" title="A DRAM packet stores packets along with the timestamp of when the packet entered the queue...">DRAMPacket</a>* dram_pkt = <a class="code" href="classSimpleDRAM.html#a6c27bc2ec09efdc6abd871835e0110f9" title="Address decoder to figure out physical mapping onto ranks, banks, and rows.">decodeAddr</a>(pkt);
<a name="l00284"></a>00284 
<a name="l00285"></a>00285     assert(<a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.size() + <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.size() &lt; <a class="code" href="classSimpleDRAM.html#a9c2f74f4d1b4f265456240efce92640b">readBufferSize</a>);
<a name="l00286"></a>00286     <a class="code" href="classSimpleDRAM.html#a398c24403923fff12db3a084dbcddbc6">rdQLenPdf</a>[<a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.size() + <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.size()]++;
<a name="l00287"></a>00287 
<a name="l00288"></a>00288     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Adding to read queue\n&quot;</span>);
<a name="l00289"></a>00289 
<a name="l00290"></a>00290     <a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.push_back(dram_pkt);
<a name="l00291"></a>00291 
<a name="l00292"></a>00292     <span class="comment">// Update stats</span>
<a name="l00293"></a>00293     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> bank_id = <a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a> * dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#a73f74968e7e908a586bba1f5abb1fd9f" title="Will be populated by address decoder.">rank</a> + dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#a9a12afb8709141ce4cab600889883095">bank</a>;
<a name="l00294"></a>00294     assert(bank_id &lt; <a class="code" href="classSimpleDRAM.html#a59dd3867633d6a508faa5a14a0926376">ranksPerChannel</a> * <a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a>);
<a name="l00295"></a>00295     <a class="code" href="classSimpleDRAM.html#af12d12b7695f3b136955eecc33bd8445">perBankRdReqs</a>[bank_id]++;
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <a class="code" href="classSimpleDRAM.html#acd2e45b866c1773a4a0a4c49bfd8bfb1">avgRdQLen</a> = <a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.size() + <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.size();
<a name="l00298"></a>00298 
<a name="l00299"></a>00299     <span class="comment">// If we are not already scheduled to get the read request out of</span>
<a name="l00300"></a>00300     <span class="comment">// the queue, do so now</span>
<a name="l00301"></a>00301     <span class="keywordflow">if</span> (!<a class="code" href="classSimpleDRAM.html#ab97036fa64672c136bed9c688379a0e7">nextReqEvent</a>.<a class="code" href="classEvent.html#a36bdc2ee73215ed7670a7bfc0f25ab8b" title="Determine if the current event is scheduled.">scheduled</a>() &amp;&amp; !<a class="code" href="classSimpleDRAM.html#a2bd3fc4adfd452ec82f941f3b7a6aa5b" title="Use this flag to shutoff reads, i.e.">stopReads</a>) {
<a name="l00302"></a>00302         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Request scheduled immediately\n&quot;</span>);
<a name="l00303"></a>00303         <a class="code" href="classEventManager.html#a749a10828b2dd5017a2582960d04e400">schedule</a>(<a class="code" href="classSimpleDRAM.html#ab97036fa64672c136bed9c688379a0e7">nextReqEvent</a>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>());
<a name="l00304"></a>00304     }
<a name="l00305"></a>00305 }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307 <span class="keywordtype">void</span>
<a name="l00308"></a><a class="code" href="classSimpleDRAM.html#a5c2804c82bfe567d616b9835879aa643">00308</a> <a class="code" href="classSimpleDRAM.html#a5c2804c82bfe567d616b9835879aa643" title="Bunch of things requires to setup &amp;quot;events&amp;quot; in gem5 When event &amp;quot;writeEvent&amp;quot; occurs...">SimpleDRAM::processWriteEvent</a>()
<a name="l00309"></a>00309 {
<a name="l00310"></a>00310     assert(!<a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.empty());
<a name="l00311"></a>00311     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> numWritesThisTime = 0;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAMWR, <span class="stringliteral">&quot;Beginning DRAM Writes\n&quot;</span>);
<a name="l00314"></a>00314     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> temp1 M5_VAR_USED = std::max(<a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>(), <a class="code" href="classSimpleDRAM.html#a3bf3033ac0b7c67a52a23ad874b5be99" title="Till when has the main data bus been spoken for already?">busBusyUntil</a>);
<a name="l00315"></a>00315     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> temp2 M5_VAR_USED = std::max(<a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>(), <a class="code" href="classSimpleDRAM.html#afc6c64be6511b0ff885c94126815edeb" title="Looking at all banks, determine the moment in time when they are all free.">maxBankFreeAt</a>());
<a name="l00316"></a>00316 
<a name="l00317"></a>00317     <span class="comment">// @todo: are there any dangers with the untimed while loop?</span>
<a name="l00318"></a>00318     <span class="keywordflow">while</span> (!<a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.empty()) {
<a name="l00319"></a>00319         <span class="keywordflow">if</span> (numWritesThisTime &gt; <a class="code" href="classSimpleDRAM.html#a4d0cd8d9801602f3e59033c71cb5fa54">writeThreshold</a>) {
<a name="l00320"></a>00320             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAMWR, <span class="stringliteral">&quot;Hit write threshold %d\n&quot;</span>, <a class="code" href="classSimpleDRAM.html#a4d0cd8d9801602f3e59033c71cb5fa54">writeThreshold</a>);
<a name="l00321"></a>00321             <span class="keywordflow">break</span>;
<a name="l00322"></a>00322         }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324         <a class="code" href="classSimpleDRAM.html#a4917fd173b7830e1248a0ef810c067db" title="Scheduling policy within the write queue.">chooseNextWrite</a>();
<a name="l00325"></a>00325         <a class="code" href="classSimpleDRAM_1_1DRAMPacket.html" title="A DRAM packet stores packets along with the timestamp of when the packet entered the queue...">DRAMPacket</a>* dram_pkt = <a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.front();
<a name="l00326"></a>00326         <span class="comment">// What&#39;s the earliest the request can be put on the bus</span>
<a name="l00327"></a>00327         <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> schedTime = std::max(<a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>(), <a class="code" href="classSimpleDRAM.html#a3bf3033ac0b7c67a52a23ad874b5be99" title="Till when has the main data bus been spoken for already?">busBusyUntil</a>);
<a name="l00328"></a>00328 
<a name="l00329"></a>00329         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAMWR, <span class="stringliteral">&quot;Asking for latency estimate at %lld\n&quot;</span>,
<a name="l00330"></a>00330                 schedTime + <a class="code" href="classSimpleDRAM.html#a381ed669fde257c0afa5a2beed3f424c">tBURST</a>);
<a name="l00331"></a>00331 
<a name="l00332"></a>00332         <a class="code" href="classstd_1_1pair.html" title="STL pair class.">pair&lt;Tick, Tick&gt;</a> lat = <a class="code" href="classSimpleDRAM.html#a3e4caeb9902fce58f6c80a75f041f01f" title="Looks at the state of the banks, channels, row buffer hits etc to estimate how long a request will ta...">estimateLatency</a>(dram_pkt, schedTime + <a class="code" href="classSimpleDRAM.html#a381ed669fde257c0afa5a2beed3f424c">tBURST</a>);
<a name="l00333"></a>00333         <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> accessLat = lat.second;
<a name="l00334"></a>00334 
<a name="l00335"></a>00335         <span class="comment">// look at the rowHitFlag set by estimateLatency</span>
<a name="l00336"></a>00336         <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a77ca67b57437837a74ce27cc58def940" title="Remember that a row buffer hit occured.">rowHitFlag</a>)
<a name="l00337"></a>00337             <a class="code" href="classSimpleDRAM.html#a3a0d7330437cbd682557a72b24d7d70f">writeRowHits</a>++;
<a name="l00338"></a>00338 
<a name="l00339"></a>00339         <a class="code" href="classSimpleDRAM_1_1Bank.html" title="A basic class to track the bank state indirectly via times &amp;quot;freeAt&amp;quot; and &amp;quot;tRASDoneAt&amp;qu...">Bank</a>&amp; bank = dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#a8f6e3015fcdd22ebaa2379a2cdb6ac57">bank_ref</a>;
<a name="l00340"></a>00340 
<a name="l00341"></a>00341         <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a18acf8ab471fa8af4a30bf42b59d15e7">pageMgmt</a> == Enums::open) {
<a name="l00342"></a>00342             bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#adc16d64ec6bd73b4f0e89967b77344c0">openRow</a> = dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#aae697c3e52307856f727d5624249d7b6">row</a>;
<a name="l00343"></a>00343             bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a> = schedTime + <a class="code" href="classSimpleDRAM.html#a381ed669fde257c0afa5a2beed3f424c">tBURST</a> + std::max(accessLat, <a class="code" href="classSimpleDRAM.html#aac0d0316cd00cc9f58902fa3f635c2a5">tCL</a>);
<a name="l00344"></a>00344             <a class="code" href="classSimpleDRAM.html#a3bf3033ac0b7c67a52a23ad874b5be99" title="Till when has the main data bus been spoken for already?">busBusyUntil</a> = bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a> - <a class="code" href="classSimpleDRAM.html#aac0d0316cd00cc9f58902fa3f635c2a5">tCL</a>;
<a name="l00345"></a>00345 
<a name="l00346"></a>00346             <span class="keywordflow">if</span> (!<a class="code" href="classSimpleDRAM.html#a77ca67b57437837a74ce27cc58def940" title="Remember that a row buffer hit occured.">rowHitFlag</a>) {
<a name="l00347"></a>00347                 bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acf0078aa6a63c8472f52620fb0fb7919">tRASDoneAt</a> = bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a> + <a class="code" href="classSimpleDRAM.html#ad0629e1f3d27f13c661c80f48d5be2d8">tRP</a>;
<a name="l00348"></a>00348                 <a class="code" href="classSimpleDRAM.html#a073941f1352a2b81df897605b32bf436" title="Keep track of when row activations happen, in order to enforce the maximum number of activations in t...">recordActivate</a>(bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a> - <a class="code" href="classSimpleDRAM.html#aac0d0316cd00cc9f58902fa3f635c2a5">tCL</a> - <a class="code" href="classSimpleDRAM.html#a80c334c459a055c74baec86aa8cb34e0">tRCD</a>);
<a name="l00349"></a>00349                 <a class="code" href="classSimpleDRAM.html#a3bf3033ac0b7c67a52a23ad874b5be99" title="Till when has the main data bus been spoken for already?">busBusyUntil</a> = bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a> - <a class="code" href="classSimpleDRAM.html#aac0d0316cd00cc9f58902fa3f635c2a5">tCL</a> - <a class="code" href="classSimpleDRAM.html#a80c334c459a055c74baec86aa8cb34e0">tRCD</a>;
<a name="l00350"></a>00350             }
<a name="l00351"></a>00351         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a18acf8ab471fa8af4a30bf42b59d15e7">pageMgmt</a> == Enums::close) {
<a name="l00352"></a>00352             bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a> = schedTime + <a class="code" href="classSimpleDRAM.html#a381ed669fde257c0afa5a2beed3f424c">tBURST</a> + accessLat + <a class="code" href="classSimpleDRAM.html#ad0629e1f3d27f13c661c80f48d5be2d8">tRP</a> + <a class="code" href="classSimpleDRAM.html#ad0629e1f3d27f13c661c80f48d5be2d8">tRP</a>;
<a name="l00353"></a>00353             <span class="comment">// Work backwards from bank.freeAt to determine activate time</span>
<a name="l00354"></a>00354             <a class="code" href="classSimpleDRAM.html#a073941f1352a2b81df897605b32bf436" title="Keep track of when row activations happen, in order to enforce the maximum number of activations in t...">recordActivate</a>(bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a> - tRP - tRP - <a class="code" href="classSimpleDRAM.html#aac0d0316cd00cc9f58902fa3f635c2a5">tCL</a> - <a class="code" href="classSimpleDRAM.html#a80c334c459a055c74baec86aa8cb34e0">tRCD</a>);
<a name="l00355"></a>00355             <a class="code" href="classSimpleDRAM.html#a3bf3033ac0b7c67a52a23ad874b5be99" title="Till when has the main data bus been spoken for already?">busBusyUntil</a> = bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a> - tRP - tRP - <a class="code" href="classSimpleDRAM.html#aac0d0316cd00cc9f58902fa3f635c2a5">tCL</a> - <a class="code" href="classSimpleDRAM.html#a80c334c459a055c74baec86aa8cb34e0">tRCD</a>;
<a name="l00356"></a>00356             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAMWR, <span class="stringliteral">&quot;processWriteEvent::bank.freeAt for &quot;</span>
<a name="l00357"></a>00357                     <span class="stringliteral">&quot;banks_id %d is %lld\n&quot;</span>,
<a name="l00358"></a>00358                     dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#a73f74968e7e908a586bba1f5abb1fd9f" title="Will be populated by address decoder.">rank</a> * <a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a> + dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#a9a12afb8709141ce4cab600889883095">bank</a>,
<a name="l00359"></a>00359                     bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a>);
<a name="l00360"></a>00360         } <span class="keywordflow">else</span>
<a name="l00361"></a>00361             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unknown page management policy chosen\n&quot;</span>);
<a name="l00362"></a>00362 
<a name="l00363"></a>00363         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAMWR, <span class="stringliteral">&quot;Done writing to address %lld\n&quot;</span>, dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#ae588f4b8c92a931529275e8672c22197">addr</a>);
<a name="l00364"></a>00364 
<a name="l00365"></a>00365         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAMWR, <span class="stringliteral">&quot;schedtime is %lld, tBURST is %lld, &quot;</span>
<a name="l00366"></a>00366                 <span class="stringliteral">&quot;busbusyuntil is %lld\n&quot;</span>,
<a name="l00367"></a>00367                 schedTime, <a class="code" href="classSimpleDRAM.html#a381ed669fde257c0afa5a2beed3f424c">tBURST</a>, <a class="code" href="classSimpleDRAM.html#a3bf3033ac0b7c67a52a23ad874b5be99" title="Till when has the main data bus been spoken for already?">busBusyUntil</a>);
<a name="l00368"></a>00368 
<a name="l00369"></a>00369         <a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.pop_front();
<a name="l00370"></a>00370         <span class="keyword">delete</span> dram_pkt;
<a name="l00371"></a>00371 
<a name="l00372"></a>00372         numWritesThisTime++;
<a name="l00373"></a>00373     }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAMWR, <span class="stringliteral">&quot;Completed %d writes, bus busy for %lld ticks,&quot;</span>\
<a name="l00376"></a>00376             <span class="stringliteral">&quot;banks busy for %lld ticks\n&quot;</span>, numWritesThisTime,
<a name="l00377"></a>00377             <a class="code" href="classSimpleDRAM.html#a3bf3033ac0b7c67a52a23ad874b5be99" title="Till when has the main data bus been spoken for already?">busBusyUntil</a> - temp1, <a class="code" href="classSimpleDRAM.html#afc6c64be6511b0ff885c94126815edeb" title="Looking at all banks, determine the moment in time when they are all free.">maxBankFreeAt</a>() - temp2);
<a name="l00378"></a>00378 
<a name="l00379"></a>00379     <span class="comment">// Update stats</span>
<a name="l00380"></a>00380     <a class="code" href="classSimpleDRAM.html#abcd9119cf56e69c0afb1ea8af8ed20a3">avgWrQLen</a> = <a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.size();
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     <span class="comment">// turn the bus back around for reads again</span>
<a name="l00383"></a>00383     <a class="code" href="classSimpleDRAM.html#a3bf3033ac0b7c67a52a23ad874b5be99" title="Till when has the main data bus been spoken for already?">busBusyUntil</a> += <a class="code" href="classSimpleDRAM.html#a91c6fbff88cd8d385c697f8bdef81f97" title="Basic memory timing parameters initialized based on parameter values.">tWTR</a>;
<a name="l00384"></a>00384     <a class="code" href="classSimpleDRAM.html#a2bd3fc4adfd452ec82f941f3b7a6aa5b" title="Use this flag to shutoff reads, i.e.">stopReads</a> = <span class="keyword">false</span>;
<a name="l00385"></a>00385 
<a name="l00386"></a>00386     <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a6c23789298bbacb7460f2707534baa3c">retryWrReq</a>) {
<a name="l00387"></a>00387         <a class="code" href="classSimpleDRAM.html#a6c23789298bbacb7460f2707534baa3c">retryWrReq</a> = <span class="keyword">false</span>;
<a name="l00388"></a>00388         <a class="code" href="classSimpleDRAM.html#aa90269cc4d8251534062632d549fea1f" title="Our incoming port, for a multi-ported controller add a crossbar in front of it.">port</a>.<a class="code" href="classSlavePort.html#ae8927738694b0576ee6a37c73d2fafb9" title="Send a retry to the master port that previously attempted a sendTimingReq or sendTimingSnoopResp to t...">sendRetry</a>();
<a name="l00389"></a>00389     }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391     <span class="comment">// if there is nothing left in any queue, signal a drain</span>
<a name="l00392"></a>00392     <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.empty() &amp;&amp; <a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.empty() &amp;&amp;
<a name="l00393"></a>00393         <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.empty () &amp;&amp; <a class="code" href="classSimpleDRAM.html#a7f19a31acafa04e74429afc8d193417a" title="If we need to drain, keep the drain manager around until we&amp;#39;re done here.">drainManager</a>) {
<a name="l00394"></a>00394         <a class="code" href="classSimpleDRAM.html#a7f19a31acafa04e74429afc8d193417a" title="If we need to drain, keep the drain manager around until we&amp;#39;re done here.">drainManager</a>-&gt;<a class="code" href="classDrainManager.html#abd134e8277be09e702b63f36f6ee31d0" title="Notify the DrainManager that a Drainable object has finished draining.">signalDrainDone</a>();
<a name="l00395"></a>00395         <a class="code" href="classSimpleDRAM.html#a7f19a31acafa04e74429afc8d193417a" title="If we need to drain, keep the drain manager around until we&amp;#39;re done here.">drainManager</a> = NULL;
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397 
<a name="l00398"></a>00398     <span class="comment">// Once you&#39;re done emptying the write queue, check if there&#39;s</span>
<a name="l00399"></a>00399     <span class="comment">// anything in the read queue, and call schedule if required. The</span>
<a name="l00400"></a>00400     <span class="comment">// retry above could already have caused it to be scheduled, so</span>
<a name="l00401"></a>00401     <span class="comment">// first check</span>
<a name="l00402"></a>00402     <span class="keywordflow">if</span> (!<a class="code" href="classSimpleDRAM.html#ab97036fa64672c136bed9c688379a0e7">nextReqEvent</a>.<a class="code" href="classEvent.html#a36bdc2ee73215ed7670a7bfc0f25ab8b" title="Determine if the current event is scheduled.">scheduled</a>())
<a name="l00403"></a>00403         <a class="code" href="classEventManager.html#a749a10828b2dd5017a2582960d04e400">schedule</a>(<a class="code" href="classSimpleDRAM.html#ab97036fa64672c136bed9c688379a0e7">nextReqEvent</a>, <a class="code" href="classSimpleDRAM.html#a3bf3033ac0b7c67a52a23ad874b5be99" title="Till when has the main data bus been spoken for already?">busBusyUntil</a>);
<a name="l00404"></a>00404 }
<a name="l00405"></a>00405 
<a name="l00406"></a>00406 <span class="keywordtype">void</span>
<a name="l00407"></a><a class="code" href="classSimpleDRAM.html#ade766fbbdfe2c5158da38cd60517f5c0">00407</a> <a class="code" href="classSimpleDRAM.html#ade766fbbdfe2c5158da38cd60517f5c0" title="Check when the channel is free to turnaround, add turnaround delay and schedule a whole bunch of writ...">SimpleDRAM::triggerWrites</a>()
<a name="l00408"></a>00408 {
<a name="l00409"></a>00409     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Writes triggered at %lld\n&quot;</span>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>());
<a name="l00410"></a>00410     <span class="comment">// Flag variable to stop any more read scheduling</span>
<a name="l00411"></a>00411     <a class="code" href="classSimpleDRAM.html#a2bd3fc4adfd452ec82f941f3b7a6aa5b" title="Use this flag to shutoff reads, i.e.">stopReads</a> = <span class="keyword">true</span>;
<a name="l00412"></a>00412 
<a name="l00413"></a>00413     <a class="code" href="classSimpleDRAM.html#aba715f3ccf2ed6879548750b1be49983">writeStartTime</a> = std::max(<a class="code" href="classSimpleDRAM.html#a3bf3033ac0b7c67a52a23ad874b5be99" title="Till when has the main data bus been spoken for already?">busBusyUntil</a>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>()) + <a class="code" href="classSimpleDRAM.html#a91c6fbff88cd8d385c697f8bdef81f97" title="Basic memory timing parameters initialized based on parameter values.">tWTR</a>;
<a name="l00414"></a>00414 
<a name="l00415"></a>00415     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Writes scheduled at %lld\n&quot;</span>, <a class="code" href="classSimpleDRAM.html#aba715f3ccf2ed6879548750b1be49983">writeStartTime</a>);
<a name="l00416"></a>00416 
<a name="l00417"></a>00417     assert(<a class="code" href="classSimpleDRAM.html#aba715f3ccf2ed6879548750b1be49983">writeStartTime</a> &gt;= <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>());
<a name="l00418"></a>00418     assert(!<a class="code" href="classSimpleDRAM.html#a75cd7692e5fd260e2199db5778455050">writeEvent</a>.<a class="code" href="classEvent.html#a36bdc2ee73215ed7670a7bfc0f25ab8b" title="Determine if the current event is scheduled.">scheduled</a>());
<a name="l00419"></a>00419     <a class="code" href="classEventManager.html#a749a10828b2dd5017a2582960d04e400">schedule</a>(<a class="code" href="classSimpleDRAM.html#a75cd7692e5fd260e2199db5778455050">writeEvent</a>, <a class="code" href="classSimpleDRAM.html#aba715f3ccf2ed6879548750b1be49983">writeStartTime</a>);
<a name="l00420"></a>00420 }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 <span class="keywordtype">void</span>
<a name="l00423"></a><a class="code" href="classSimpleDRAM.html#a3253c7d691cc5a06ae879b7d8df11095">00423</a> <a class="code" href="classSimpleDRAM.html#a3253c7d691cc5a06ae879b7d8df11095" title="Decode the incoming pkt, create a dram_pkt and push to the back of the write queue.">SimpleDRAM::addToWriteQueue</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt)
<a name="l00424"></a>00424 {
<a name="l00425"></a>00425     <span class="comment">// only add to the write queue here. whenever the request is</span>
<a name="l00426"></a>00426     <span class="comment">// eventually done, set the readyTime, and call schedule()</span>
<a name="l00427"></a>00427     assert(pkt-&gt;<a class="code" href="classPacket.html#a2bfee2cdcdfd22a227f0254b7dd56249">isWrite</a>());
<a name="l00428"></a>00428 
<a name="l00429"></a>00429     <a class="code" href="classSimpleDRAM_1_1DRAMPacket.html" title="A DRAM packet stores packets along with the timestamp of when the packet entered the queue...">DRAMPacket</a>* dram_pkt = <a class="code" href="classSimpleDRAM.html#a6c27bc2ec09efdc6abd871835e0110f9" title="Address decoder to figure out physical mapping onto ranks, banks, and rows.">decodeAddr</a>(pkt);
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     assert(<a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.size() &lt; <a class="code" href="classSimpleDRAM.html#a249b9d7a954f943f6f2556a1fe9cb7b7">writeBufferSize</a>);
<a name="l00432"></a>00432     <a class="code" href="classSimpleDRAM.html#a2823472ffc90b6cf3d253c9925f96009">wrQLenPdf</a>[<a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.size()]++;
<a name="l00433"></a>00433 
<a name="l00434"></a>00434     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Adding to write queue\n&quot;</span>);
<a name="l00435"></a>00435 
<a name="l00436"></a>00436     <a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.push_back(dram_pkt);
<a name="l00437"></a>00437 
<a name="l00438"></a>00438     <span class="comment">// Update stats</span>
<a name="l00439"></a>00439     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> bank_id = <a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a> * dram_pkt-&gt;rank + dram_pkt-&gt;bank;
<a name="l00440"></a>00440     assert(bank_id &lt; <a class="code" href="classSimpleDRAM.html#a59dd3867633d6a508faa5a14a0926376">ranksPerChannel</a> * <a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a>);
<a name="l00441"></a>00441     <a class="code" href="classSimpleDRAM.html#a9fc0de9d7f3e27c86400d1218ec16d07">perBankWrReqs</a>[bank_id]++;
<a name="l00442"></a>00442 
<a name="l00443"></a>00443     <a class="code" href="classSimpleDRAM.html#abcd9119cf56e69c0afb1ea8af8ed20a3">avgWrQLen</a> = <a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.size();
<a name="l00444"></a>00444 
<a name="l00445"></a>00445     <span class="comment">// we do not wait for the writes to be send to the actual memory,</span>
<a name="l00446"></a>00446     <span class="comment">// but instead take responsibility for the consistency here and</span>
<a name="l00447"></a>00447     <span class="comment">// snoop the write queue for any upcoming reads</span>
<a name="l00448"></a>00448 
<a name="l00449"></a>00449     <a class="code" href="classSimpleDRAM.html#a78ca6a8ffac2ade6a2404321346d7fbc">bytesConsumedWr</a> += pkt-&gt;<a class="code" href="classPacket.html#ad7c96bd8cd06acddebb3a373b37e6e59">getSize</a>();
<a name="l00450"></a>00450     <a class="code" href="classSimpleDRAM.html#a5d761acdbc052be18565695d2b07cb06" title="Number of bytes written to this memory.">bytesWritten</a> += <a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a>;
<a name="l00451"></a>00451     <a class="code" href="classSimpleDRAM.html#abba090ae9bfbbc119456be4ed00e475f" title="When a packet reaches its &amp;quot;readyTime&amp;quot; in the response Q, use the &amp;quot;access()&amp;quot; metho...">accessAndRespond</a>(pkt);
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     <span class="comment">// If your write buffer is starting to fill up, drain it!</span>
<a name="l00454"></a>00454     <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.size() &gt; <a class="code" href="classSimpleDRAM.html#a4d0cd8d9801602f3e59033c71cb5fa54">writeThreshold</a> &amp;&amp; !<a class="code" href="classSimpleDRAM.html#a2bd3fc4adfd452ec82f941f3b7a6aa5b" title="Use this flag to shutoff reads, i.e.">stopReads</a>){
<a name="l00455"></a>00455         <a class="code" href="classSimpleDRAM.html#ade766fbbdfe2c5158da38cd60517f5c0" title="Check when the channel is free to turnaround, add turnaround delay and schedule a whole bunch of writ...">triggerWrites</a>();
<a name="l00456"></a>00456     }
<a name="l00457"></a>00457 }
<a name="l00458"></a>00458 
<a name="l00459"></a>00459 <span class="keywordtype">void</span>
<a name="l00460"></a><a class="code" href="classSimpleDRAM.html#a64d6b9efd719af9ac5714be8e5904007">00460</a> <a class="code" href="classSimpleDRAM.html#a64d6b9efd719af9ac5714be8e5904007">SimpleDRAM::printParams</a>()<span class="keyword"> const</span>
<a name="l00461"></a>00461 <span class="keyword"></span>{
<a name="l00462"></a>00462     <span class="comment">// Sanity check print of important parameters</span>
<a name="l00463"></a>00463     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM,
<a name="l00464"></a>00464             <span class="stringliteral">&quot;Memory controller %s physical organization\n&quot;</span>      \
<a name="l00465"></a>00465             <span class="stringliteral">&quot;Bytes per cacheline  %d\n&quot;</span>                         \
<a name="l00466"></a>00466             <span class="stringliteral">&quot;Lines per row buffer %d\n&quot;</span>                         \
<a name="l00467"></a>00467             <span class="stringliteral">&quot;Rows  per bank       %d\n&quot;</span>                         \
<a name="l00468"></a>00468             <span class="stringliteral">&quot;Banks per rank       %d\n&quot;</span>                         \
<a name="l00469"></a>00469             <span class="stringliteral">&quot;Ranks per channel    %d\n&quot;</span>                         \
<a name="l00470"></a>00470             <span class="stringliteral">&quot;Total mem capacity   %u\n&quot;</span>,
<a name="l00471"></a>00471             <a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>(), <a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a>, <a class="code" href="classSimpleDRAM.html#a631354beefc514baca4477d795ab59b5">linesPerRowBuffer</a>, <a class="code" href="classSimpleDRAM.html#a45d8955f120c436ebbd2ab55b29cf731">rowsPerBank</a>,
<a name="l00472"></a>00472             <a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a>, <a class="code" href="classSimpleDRAM.html#a59dd3867633d6a508faa5a14a0926376">ranksPerChannel</a>, <a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a> *
<a name="l00473"></a>00473             <a class="code" href="classSimpleDRAM.html#a631354beefc514baca4477d795ab59b5">linesPerRowBuffer</a> * <a class="code" href="classSimpleDRAM.html#a45d8955f120c436ebbd2ab55b29cf731">rowsPerBank</a> * <a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a> * <a class="code" href="classSimpleDRAM.html#a59dd3867633d6a508faa5a14a0926376">ranksPerChannel</a>);
<a name="l00474"></a>00474 
<a name="l00475"></a>00475     <span class="keywordtype">string</span> scheduler =  <a class="code" href="classSimpleDRAM.html#aeb1275a37543979044cec0391571f076" title="Memory controller configuration initialized based on parameter values.">memSchedPolicy</a> == Enums::fcfs ? <span class="stringliteral">&quot;FCFS&quot;</span> : <span class="stringliteral">&quot;FR-FCFS&quot;</span>;
<a name="l00476"></a>00476     <span class="keywordtype">string</span> address_mapping = <a class="code" href="classSimpleDRAM.html#a6358b64577b8328e023d0fb8f8d8dacc">addrMapping</a> == Enums::openmap ? <span class="stringliteral">&quot;OPENMAP&quot;</span> :
<a name="l00477"></a>00477         <span class="stringliteral">&quot;CLOSEMAP&quot;</span>;
<a name="l00478"></a>00478     <span class="keywordtype">string</span> page_policy = <a class="code" href="classSimpleDRAM.html#a18acf8ab471fa8af4a30bf42b59d15e7">pageMgmt</a> == Enums::open ? <span class="stringliteral">&quot;OPEN&quot;</span> : <span class="stringliteral">&quot;CLOSE&quot;</span>;
<a name="l00479"></a>00479 
<a name="l00480"></a>00480     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM,
<a name="l00481"></a>00481             <span class="stringliteral">&quot;Memory controller %s characteristics\n&quot;</span>    \
<a name="l00482"></a>00482             <span class="stringliteral">&quot;Read buffer size     %d\n&quot;</span>                 \
<a name="l00483"></a>00483             <span class="stringliteral">&quot;Write buffer size    %d\n&quot;</span>                 \
<a name="l00484"></a>00484             <span class="stringliteral">&quot;Write buffer thresh  %d\n&quot;</span>                 \
<a name="l00485"></a>00485             <span class="stringliteral">&quot;Scheduler            %s\n&quot;</span>                 \
<a name="l00486"></a>00486             <span class="stringliteral">&quot;Address mapping      %s\n&quot;</span>                 \
<a name="l00487"></a>00487             <span class="stringliteral">&quot;Page policy          %s\n&quot;</span>,
<a name="l00488"></a>00488             <a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>(), <a class="code" href="classSimpleDRAM.html#a9c2f74f4d1b4f265456240efce92640b">readBufferSize</a>, <a class="code" href="classSimpleDRAM.html#a249b9d7a954f943f6f2556a1fe9cb7b7">writeBufferSize</a>, <a class="code" href="classSimpleDRAM.html#a4d0cd8d9801602f3e59033c71cb5fa54">writeThreshold</a>,
<a name="l00489"></a>00489             scheduler, address_mapping, page_policy);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Memory controller %s timing specs\n&quot;</span> \
<a name="l00492"></a>00492             <span class="stringliteral">&quot;tRCD      %d ticks\n&quot;</span>                        \
<a name="l00493"></a>00493             <span class="stringliteral">&quot;tCL       %d ticks\n&quot;</span>                        \
<a name="l00494"></a>00494             <span class="stringliteral">&quot;tRP       %d ticks\n&quot;</span>                        \
<a name="l00495"></a>00495             <span class="stringliteral">&quot;tBURST    %d ticks\n&quot;</span>                        \
<a name="l00496"></a>00496             <span class="stringliteral">&quot;tRFC      %d ticks\n&quot;</span>                        \
<a name="l00497"></a>00497             <span class="stringliteral">&quot;tREFI     %d ticks\n&quot;</span>                        \
<a name="l00498"></a>00498             <span class="stringliteral">&quot;tWTR      %d ticks\n&quot;</span>                        \
<a name="l00499"></a>00499             <span class="stringliteral">&quot;tXAW (%d) %d ticks\n&quot;</span>,
<a name="l00500"></a>00500             <a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>(), <a class="code" href="classSimpleDRAM.html#a80c334c459a055c74baec86aa8cb34e0">tRCD</a>, <a class="code" href="classSimpleDRAM.html#aac0d0316cd00cc9f58902fa3f635c2a5">tCL</a>, <a class="code" href="classSimpleDRAM.html#ad0629e1f3d27f13c661c80f48d5be2d8">tRP</a>, <a class="code" href="classSimpleDRAM.html#a381ed669fde257c0afa5a2beed3f424c">tBURST</a>, <a class="code" href="classSimpleDRAM.html#a55c083eaefc6de4bebeaf71e45fa17df">tRFC</a>, <a class="code" href="classSimpleDRAM.html#afbc72654a5c306d321bae5c5617cbee4">tREFI</a>, <a class="code" href="classSimpleDRAM.html#a91c6fbff88cd8d385c697f8bdef81f97" title="Basic memory timing parameters initialized based on parameter values.">tWTR</a>,
<a name="l00501"></a>00501             <a class="code" href="classSimpleDRAM.html#a1aae8e15c7f6e8f0bb229c49b4d0e0f4">activationLimit</a>, <a class="code" href="classSimpleDRAM.html#a8c9310dcd25ea56bcd3695bf96f1c205">tXAW</a>);
<a name="l00502"></a>00502 }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504 <span class="keywordtype">void</span>
<a name="l00505"></a><a class="code" href="classSimpleDRAM.html#a37e0d74675e2e8c645cc9b4931531dfc">00505</a> <a class="code" href="classSimpleDRAM.html#a37e0d74675e2e8c645cc9b4931531dfc">SimpleDRAM::printQs</a>()<span class="keyword"> const </span>{
<a name="l00506"></a>00506 
<a name="l00507"></a>00507     <a class="code" href="classstd_1_1list.html" title="STL list class.">list&lt;DRAMPacket*&gt;::const_iterator</a> <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>;
<a name="l00508"></a>00508 
<a name="l00509"></a>00509     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;===READ QUEUE===\n\n&quot;</span>);
<a name="l00510"></a>00510     <span class="keywordflow">for</span> (i = <a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.begin() ;  i != <a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.end() ; ++i) {
<a name="l00511"></a>00511         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Read %lu\n&quot;</span>, (*i)-&gt;addr);
<a name="l00512"></a>00512     }
<a name="l00513"></a>00513     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;\n===RESP QUEUE===\n\n&quot;</span>);
<a name="l00514"></a>00514     <span class="keywordflow">for</span> (i = <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.begin() ;  i != <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.end() ; ++i) {
<a name="l00515"></a>00515         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Response %lu\n&quot;</span>, (*i)-&gt;addr);
<a name="l00516"></a>00516     }
<a name="l00517"></a>00517     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;\n===WRITE QUEUE===\n\n&quot;</span>);
<a name="l00518"></a>00518     <span class="keywordflow">for</span> (i = <a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.begin() ;  i != <a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.end() ; ++i) {
<a name="l00519"></a>00519         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Write %lu\n&quot;</span>, (*i)-&gt;addr);
<a name="l00520"></a>00520     }
<a name="l00521"></a>00521 }
<a name="l00522"></a>00522 
<a name="l00523"></a>00523 <span class="keywordtype">bool</span>
<a name="l00524"></a><a class="code" href="classSimpleDRAM.html#a98f08912f834f5cf6b6a9b3c0500c9ee">00524</a> <a class="code" href="classSimpleDRAM.html#a98f08912f834f5cf6b6a9b3c0500c9ee">SimpleDRAM::recvTimingReq</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt)
<a name="l00525"></a>00525 {
<a name="l00528"></a>00528     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#a7329cbd3da39e27c5b311899bac95a04">x</a> = 0; <a class="code" href="namespaceX86ISA.html#a7329cbd3da39e27c5b311899bac95a04">x</a> &lt; <a class="code" href="classSimpleDRAM.html#a2eda69e0d145bd2b87e5d32c6635d5f2">pendingDelete</a>.size(); <a class="code" href="namespaceX86ISA.html#a7329cbd3da39e27c5b311899bac95a04">x</a>++)
<a name="l00529"></a>00529         <span class="keyword">delete</span> <a class="code" href="classSimpleDRAM.html#a2eda69e0d145bd2b87e5d32c6635d5f2">pendingDelete</a>[<a class="code" href="namespaceX86ISA.html#a7329cbd3da39e27c5b311899bac95a04">x</a>];
<a name="l00530"></a>00530     <a class="code" href="classSimpleDRAM.html#a2eda69e0d145bd2b87e5d32c6635d5f2">pendingDelete</a>.clear();
<a name="l00531"></a>00531 
<a name="l00532"></a>00532     <span class="comment">// This is where we enter from the outside world</span>
<a name="l00533"></a>00533     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;recvTimingReq: request %s addr %lld size %d\n&quot;</span>,
<a name="l00534"></a>00534             pkt-&gt;<a class="code" href="classPacket.html#a50fa8e54b8b71b0d6879307680517697" title="Return the string name of the cmd field (for debugging and tracing).">cmdString</a>(),pkt-&gt;<a class="code" href="classPacket.html#a1c04785186ba5aa70a40cac9b2bfc86e">getAddr</a>(), pkt-&gt;<a class="code" href="classPacket.html#ad7c96bd8cd06acddebb3a373b37e6e59">getSize</a>());
<a name="l00535"></a>00535 
<a name="l00536"></a>00536     <span class="comment">// simply drop inhibited packets for now</span>
<a name="l00537"></a>00537     <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#a27ed6fc8c4baa6d6aaeaee8aa743fca5">memInhibitAsserted</a>()) {
<a name="l00538"></a>00538         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM,<span class="stringliteral">&quot;Inhibited packet -- Dropping it now\n&quot;</span>);
<a name="l00539"></a>00539         <a class="code" href="classSimpleDRAM.html#a2eda69e0d145bd2b87e5d32c6635d5f2">pendingDelete</a>.push_back(pkt);
<a name="l00540"></a>00540         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543    <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#ad7c96bd8cd06acddebb3a373b37e6e59">getSize</a>() == <a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a>)
<a name="l00544"></a>00544        <a class="code" href="classSimpleDRAM.html#a4e7383918a9c0873208527805c2612aa">cpuReqs</a>++;
<a name="l00545"></a>00545 
<a name="l00546"></a>00546    <span class="comment">// Every million accesses, print the state of the queues</span>
<a name="l00547"></a>00547    <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#adb2acbbb5f3a1360242f3154f311a681">numReqs</a> % 1000000 == 0)
<a name="l00548"></a>00548        <a class="code" href="classSimpleDRAM.html#a37e0d74675e2e8c645cc9b4931531dfc">printQs</a>();
<a name="l00549"></a>00549 
<a name="l00550"></a>00550     <span class="comment">// Calc avg gap between requests</span>
<a name="l00551"></a>00551     <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a2ae634545318b4cfd0937f4da1c5dd31">prevArrival</a> != 0) {
<a name="l00552"></a>00552         <a class="code" href="classSimpleDRAM.html#af5d5975cd57903602b400d816de1ebf8">totGap</a> += <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>() - <a class="code" href="classSimpleDRAM.html#a2ae634545318b4cfd0937f4da1c5dd31">prevArrival</a>;
<a name="l00553"></a>00553     }
<a name="l00554"></a>00554     <a class="code" href="classSimpleDRAM.html#a2ae634545318b4cfd0937f4da1c5dd31">prevArrival</a> = <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>();
<a name="l00555"></a>00555 
<a name="l00556"></a>00556     <span class="keywordtype">unsigned</span> <a class="code" href="classAbstractMemory.html#ac59f603c2428f8cdb228997baa5b9768" title="Get the memory size.">size</a> = pkt-&gt;<a class="code" href="classPacket.html#ad7c96bd8cd06acddebb3a373b37e6e59">getSize</a>();
<a name="l00557"></a>00557     <span class="keywordflow">if</span> (size &gt; <a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a>)
<a name="l00558"></a>00558         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Request size %d is greater than burst size %d&quot;</span>,
<a name="l00559"></a>00559               size, <a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a>);
<a name="l00560"></a>00560 
<a name="l00561"></a>00561     <span class="comment">// check local buffers and do not accept if full</span>
<a name="l00562"></a>00562     <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#ad7fd7ab0e95007d1c6232b231482c6fa">isRead</a>()) {
<a name="l00563"></a>00563         assert(size != 0);
<a name="l00564"></a>00564         <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a8b109c42b80b49d5770d23b0ef6839d6" title="Check if the read queue has room for more entries.">readQueueFull</a>()) {
<a name="l00565"></a>00565             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Read queue full, not accepting\n&quot;</span>);
<a name="l00566"></a>00566             <span class="comment">// remember that we have to retry this port</span>
<a name="l00567"></a>00567             <a class="code" href="classSimpleDRAM.html#a755fde0e27ccc390e7e4ee9976d6f569" title="Remember if we have to retry a request when available.">retryRdReq</a> = <span class="keyword">true</span>;
<a name="l00568"></a>00568             <a class="code" href="classSimpleDRAM.html#a01bd5e359149b1a9cdb2de7d2b31ef00">numRdRetry</a>++;
<a name="l00569"></a>00569             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00570"></a>00570         } <span class="keywordflow">else</span> {
<a name="l00571"></a>00571             <a class="code" href="classSimpleDRAM.html#a4bfbc13e98d39c4c30907c498a75268b">readPktSize</a>[<a class="code" href="intmath_8hh.html#a0ec4eaea50888f737b803dc9427614bf">ceilLog2</a>(size)]++;
<a name="l00572"></a>00572             <a class="code" href="classSimpleDRAM.html#ad41783bc2de170b32e31da2df472c67c" title="When a new read comes in, first check if the write q has a pending request to the same address...">addToReadQueue</a>(pkt);
<a name="l00573"></a>00573             <a class="code" href="classSimpleDRAM.html#a9f8678c47f9685ef893e06a63e8d66c7">readReqs</a>++;
<a name="l00574"></a>00574             <a class="code" href="classSimpleDRAM.html#adb2acbbb5f3a1360242f3154f311a681">numReqs</a>++;
<a name="l00575"></a>00575         }
<a name="l00576"></a>00576     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#a2bfee2cdcdfd22a227f0254b7dd56249">isWrite</a>()) {
<a name="l00577"></a>00577         assert(size != 0);
<a name="l00578"></a>00578         <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#acbb7fece4d4f3b182e9308b788725fc4" title="Check if the write queue has room for more entries.">writeQueueFull</a>()) {
<a name="l00579"></a>00579             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Write queue full, not accepting\n&quot;</span>);
<a name="l00580"></a>00580             <span class="comment">// remember that we have to retry this port</span>
<a name="l00581"></a>00581             <a class="code" href="classSimpleDRAM.html#a6c23789298bbacb7460f2707534baa3c">retryWrReq</a> = <span class="keyword">true</span>;
<a name="l00582"></a>00582             <a class="code" href="classSimpleDRAM.html#a70cd7963b363db2551314a64f363463b">numWrRetry</a>++;
<a name="l00583"></a>00583             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00584"></a>00584         } <span class="keywordflow">else</span> {
<a name="l00585"></a>00585             <a class="code" href="classSimpleDRAM.html#ac1114b50d0ac6e4979216b14d9e5d267">writePktSize</a>[<a class="code" href="intmath_8hh.html#a0ec4eaea50888f737b803dc9427614bf">ceilLog2</a>(size)]++;
<a name="l00586"></a>00586             <a class="code" href="classSimpleDRAM.html#a3253c7d691cc5a06ae879b7d8df11095" title="Decode the incoming pkt, create a dram_pkt and push to the back of the write queue.">addToWriteQueue</a>(pkt);
<a name="l00587"></a>00587             <a class="code" href="classSimpleDRAM.html#afe812808d0a071f663e107f9d8ea3ec1">writeReqs</a>++;
<a name="l00588"></a>00588             <a class="code" href="classSimpleDRAM.html#adb2acbbb5f3a1360242f3154f311a681">numReqs</a>++;
<a name="l00589"></a>00589         }
<a name="l00590"></a>00590     } <span class="keywordflow">else</span> {
<a name="l00591"></a>00591         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM,<span class="stringliteral">&quot;Neither read nor write, ignore timing\n&quot;</span>);
<a name="l00592"></a>00592         <a class="code" href="classSimpleDRAM.html#a05b87deab64ad93377e8c2b96c2254f1">neitherReadNorWrite</a>++;
<a name="l00593"></a>00593         <a class="code" href="classSimpleDRAM.html#abba090ae9bfbbc119456be4ed00e475f" title="When a packet reaches its &amp;quot;readyTime&amp;quot; in the response Q, use the &amp;quot;access()&amp;quot; metho...">accessAndRespond</a>(pkt);
<a name="l00594"></a>00594     }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596     <a class="code" href="classSimpleDRAM.html#a755fde0e27ccc390e7e4ee9976d6f569" title="Remember if we have to retry a request when available.">retryRdReq</a> = <span class="keyword">false</span>;
<a name="l00597"></a>00597     <a class="code" href="classSimpleDRAM.html#a6c23789298bbacb7460f2707534baa3c">retryWrReq</a> = <span class="keyword">false</span>;
<a name="l00598"></a>00598     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00599"></a>00599 }
<a name="l00600"></a>00600 
<a name="l00601"></a>00601 <span class="keywordtype">void</span>
<a name="l00602"></a><a class="code" href="classSimpleDRAM.html#a3444b6e87aa97697d9a6712fe87dbae2">00602</a> <a class="code" href="classSimpleDRAM.html#a3444b6e87aa97697d9a6712fe87dbae2">SimpleDRAM::processRespondEvent</a>()
<a name="l00603"></a>00603 {
<a name="l00604"></a>00604     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM,
<a name="l00605"></a>00605             <span class="stringliteral">&quot;processRespondEvent(): Some req has reached its readyTime\n&quot;</span>);
<a name="l00606"></a>00606 
<a name="l00607"></a>00607      <a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt = <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.front()-&gt;pkt;
<a name="l00608"></a>00608 
<a name="l00609"></a>00609      <span class="comment">// Actually responds to the requestor</span>
<a name="l00610"></a>00610      <a class="code" href="classSimpleDRAM.html#a81712e0ad4e89e4a615e94f566f1af88">bytesConsumedRd</a> += pkt-&gt;<a class="code" href="classPacket.html#ad7c96bd8cd06acddebb3a373b37e6e59">getSize</a>();
<a name="l00611"></a>00611      <a class="code" href="classSimpleDRAM.html#a26c6b81e5560eb19eec95ccd56d25245" title="Number of total bytes read from this memory.">bytesRead</a> += <a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a>;
<a name="l00612"></a>00612      <a class="code" href="classSimpleDRAM.html#abba090ae9bfbbc119456be4ed00e475f" title="When a packet reaches its &amp;quot;readyTime&amp;quot; in the response Q, use the &amp;quot;access()&amp;quot; metho...">accessAndRespond</a>(pkt);
<a name="l00613"></a>00613 
<a name="l00614"></a>00614      <span class="keyword">delete</span> <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.front();
<a name="l00615"></a>00615      <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.pop_front();
<a name="l00616"></a>00616 
<a name="l00617"></a>00617      <span class="comment">// Update stats</span>
<a name="l00618"></a>00618      <a class="code" href="classSimpleDRAM.html#acd2e45b866c1773a4a0a4c49bfd8bfb1">avgRdQLen</a> = <a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.size() + <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.size();
<a name="l00619"></a>00619 
<a name="l00620"></a>00620      <span class="keywordflow">if</span> (!<a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.empty()) {
<a name="l00621"></a>00621          assert(<a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.front()-&gt;readyTime &gt;= <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>());
<a name="l00622"></a>00622          assert(!<a class="code" href="classSimpleDRAM.html#a596d6d8395cae17cea2db27b0b59680d">respondEvent</a>.<a class="code" href="classEvent.html#a36bdc2ee73215ed7670a7bfc0f25ab8b" title="Determine if the current event is scheduled.">scheduled</a>());
<a name="l00623"></a>00623          <a class="code" href="classEventManager.html#a749a10828b2dd5017a2582960d04e400">schedule</a>(<a class="code" href="classSimpleDRAM.html#a596d6d8395cae17cea2db27b0b59680d">respondEvent</a>, <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.front()-&gt;readyTime);
<a name="l00624"></a>00624      } <span class="keywordflow">else</span> {
<a name="l00625"></a>00625          <span class="comment">// if there is nothing left in any queue, signal a drain</span>
<a name="l00626"></a>00626          <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.empty() &amp;&amp; <a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.empty() &amp;&amp;
<a name="l00627"></a>00627              <a class="code" href="classSimpleDRAM.html#a7f19a31acafa04e74429afc8d193417a" title="If we need to drain, keep the drain manager around until we&amp;#39;re done here.">drainManager</a>) {
<a name="l00628"></a>00628              <a class="code" href="classSimpleDRAM.html#a7f19a31acafa04e74429afc8d193417a" title="If we need to drain, keep the drain manager around until we&amp;#39;re done here.">drainManager</a>-&gt;<a class="code" href="classDrainManager.html#abd134e8277be09e702b63f36f6ee31d0" title="Notify the DrainManager that a Drainable object has finished draining.">signalDrainDone</a>();
<a name="l00629"></a>00629              <a class="code" href="classSimpleDRAM.html#a7f19a31acafa04e74429afc8d193417a" title="If we need to drain, keep the drain manager around until we&amp;#39;re done here.">drainManager</a> = NULL;
<a name="l00630"></a>00630          }
<a name="l00631"></a>00631      }
<a name="l00632"></a>00632 
<a name="l00633"></a>00633      <span class="comment">// We have made a location in the queue available at this point,</span>
<a name="l00634"></a>00634      <span class="comment">// so if there is a read that was forced to wait, retry now</span>
<a name="l00635"></a>00635      <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a755fde0e27ccc390e7e4ee9976d6f569" title="Remember if we have to retry a request when available.">retryRdReq</a>) {
<a name="l00636"></a>00636          <a class="code" href="classSimpleDRAM.html#a755fde0e27ccc390e7e4ee9976d6f569" title="Remember if we have to retry a request when available.">retryRdReq</a> = <span class="keyword">false</span>;
<a name="l00637"></a>00637          <a class="code" href="classSimpleDRAM.html#aa90269cc4d8251534062632d549fea1f" title="Our incoming port, for a multi-ported controller add a crossbar in front of it.">port</a>.<a class="code" href="classSlavePort.html#ae8927738694b0576ee6a37c73d2fafb9" title="Send a retry to the master port that previously attempted a sendTimingReq or sendTimingSnoopResp to t...">sendRetry</a>();
<a name="l00638"></a>00638      }
<a name="l00639"></a>00639 }
<a name="l00640"></a>00640 
<a name="l00641"></a>00641 <span class="keywordtype">void</span>
<a name="l00642"></a><a class="code" href="classSimpleDRAM.html#a4917fd173b7830e1248a0ef810c067db">00642</a> <a class="code" href="classSimpleDRAM.html#a4917fd173b7830e1248a0ef810c067db" title="Scheduling policy within the write queue.">SimpleDRAM::chooseNextWrite</a>()
<a name="l00643"></a>00643 {
<a name="l00644"></a>00644     <span class="comment">// This method does the arbitration between write requests. The</span>
<a name="l00645"></a>00645     <span class="comment">// chosen packet is simply moved to the head of the write</span>
<a name="l00646"></a>00646     <span class="comment">// queue. The other methods know that this is the place to</span>
<a name="l00647"></a>00647     <span class="comment">// look. For example, with FCFS, this method does nothing</span>
<a name="l00648"></a>00648     assert(!<a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.empty());
<a name="l00649"></a>00649 
<a name="l00650"></a>00650     <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.size() == 1) {
<a name="l00651"></a>00651         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAMWR, <span class="stringliteral">&quot;Single write request, nothing to do\n&quot;</span>);
<a name="l00652"></a>00652         <span class="keywordflow">return</span>;
<a name="l00653"></a>00653     }
<a name="l00654"></a>00654 
<a name="l00655"></a>00655     <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#aeb1275a37543979044cec0391571f076" title="Memory controller configuration initialized based on parameter values.">memSchedPolicy</a> == Enums::fcfs) {
<a name="l00656"></a>00656         <span class="comment">// Do nothing, since the correct request is already head</span>
<a name="l00657"></a>00657     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#aeb1275a37543979044cec0391571f076" title="Memory controller configuration initialized based on parameter values.">memSchedPolicy</a> == Enums::frfcfs) {
<a name="l00658"></a>00658         <a class="code" href="classstd_1_1list.html" title="STL list class.">list&lt;DRAMPacket*&gt;::iterator</a> <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> = <a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.begin();
<a name="l00659"></a>00659         <span class="keywordtype">bool</span> foundRowHit = <span class="keyword">false</span>;
<a name="l00660"></a>00660         <span class="keywordflow">while</span> (!foundRowHit &amp;&amp; i != <a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.end()) {
<a name="l00661"></a>00661             <a class="code" href="classSimpleDRAM_1_1DRAMPacket.html" title="A DRAM packet stores packets along with the timestamp of when the packet entered the queue...">DRAMPacket</a>* dram_pkt = *i;
<a name="l00662"></a>00662             <span class="keyword">const</span> <a class="code" href="classSimpleDRAM_1_1Bank.html" title="A basic class to track the bank state indirectly via times &amp;quot;freeAt&amp;quot; and &amp;quot;tRASDoneAt&amp;qu...">Bank</a>&amp; bank = dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#a8f6e3015fcdd22ebaa2379a2cdb6ac57">bank_ref</a>;
<a name="l00663"></a>00663             <span class="keywordflow">if</span> (bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#adc16d64ec6bd73b4f0e89967b77344c0">openRow</a> == dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#aae697c3e52307856f727d5624249d7b6">row</a>) { <span class="comment">//FR part</span>
<a name="l00664"></a>00664                 <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAMWR, <span class="stringliteral">&quot;Write row buffer hit\n&quot;</span>);
<a name="l00665"></a>00665                 <a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.erase(i);
<a name="l00666"></a>00666                 <a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.push_front(dram_pkt);
<a name="l00667"></a>00667                 foundRowHit = <span class="keyword">true</span>;
<a name="l00668"></a>00668             } <span class="keywordflow">else</span> { <span class="comment">//FCFS part</span>
<a name="l00669"></a>00669                 ;
<a name="l00670"></a>00670             }
<a name="l00671"></a>00671             ++i;
<a name="l00672"></a>00672         }
<a name="l00673"></a>00673     } <span class="keywordflow">else</span>
<a name="l00674"></a>00674         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;No scheduling policy chosen\n&quot;</span>);
<a name="l00675"></a>00675 
<a name="l00676"></a>00676     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAMWR, <span class="stringliteral">&quot;Selected next write request\n&quot;</span>);
<a name="l00677"></a>00677 }
<a name="l00678"></a>00678 
<a name="l00679"></a>00679 <span class="keywordtype">bool</span>
<a name="l00680"></a><a class="code" href="classSimpleDRAM.html#af88fc5afc4fb4c701d7391411942e642">00680</a> <a class="code" href="classSimpleDRAM.html#af88fc5afc4fb4c701d7391411942e642" title="The memory schduler/arbiter - picks which read request needs to go next, based on the specified polic...">SimpleDRAM::chooseNextRead</a>()
<a name="l00681"></a>00681 {
<a name="l00682"></a>00682     <span class="comment">// This method does the arbitration between read requests. The</span>
<a name="l00683"></a>00683     <span class="comment">// chosen packet is simply moved to the head of the queue. The</span>
<a name="l00684"></a>00684     <span class="comment">// other methods know that this is the place to look. For example,</span>
<a name="l00685"></a>00685     <span class="comment">// with FCFS, this method does nothing</span>
<a name="l00686"></a>00686     <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.empty()) {
<a name="l00687"></a>00687         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;No read request to select\n&quot;</span>);
<a name="l00688"></a>00688         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00689"></a>00689     }
<a name="l00690"></a>00690 
<a name="l00691"></a>00691     <span class="comment">// If there is only one request then there is nothing left to do</span>
<a name="l00692"></a>00692     <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.size() == 1)
<a name="l00693"></a>00693         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00694"></a>00694 
<a name="l00695"></a>00695     <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#aeb1275a37543979044cec0391571f076" title="Memory controller configuration initialized based on parameter values.">memSchedPolicy</a> == Enums::fcfs) {
<a name="l00696"></a>00696         <span class="comment">// Do nothing, since the request to serve is already the first</span>
<a name="l00697"></a>00697         <span class="comment">// one in the read queue</span>
<a name="l00698"></a>00698     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#aeb1275a37543979044cec0391571f076" title="Memory controller configuration initialized based on parameter values.">memSchedPolicy</a> == Enums::frfcfs) {
<a name="l00699"></a>00699         <span class="keywordflow">for</span> (<a class="code" href="classstd_1_1list.html" title="STL list class.">list&lt;DRAMPacket*&gt;::iterator</a> <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> = <a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.begin();
<a name="l00700"></a>00700              <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> != <a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.end() ; ++<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>) {
<a name="l00701"></a>00701             <a class="code" href="classSimpleDRAM_1_1DRAMPacket.html" title="A DRAM packet stores packets along with the timestamp of when the packet entered the queue...">DRAMPacket</a>* dram_pkt = *<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>;
<a name="l00702"></a>00702             <span class="keyword">const</span> <a class="code" href="classSimpleDRAM_1_1Bank.html" title="A basic class to track the bank state indirectly via times &amp;quot;freeAt&amp;quot; and &amp;quot;tRASDoneAt&amp;qu...">Bank</a>&amp; bank = dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#a8f6e3015fcdd22ebaa2379a2cdb6ac57">bank_ref</a>;
<a name="l00703"></a>00703             <span class="comment">// Check if it is a row hit</span>
<a name="l00704"></a>00704             <span class="keywordflow">if</span> (bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#adc16d64ec6bd73b4f0e89967b77344c0">openRow</a> == dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#aae697c3e52307856f727d5624249d7b6">row</a>) { <span class="comment">//FR part</span>
<a name="l00705"></a>00705                 <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Row buffer hit\n&quot;</span>);
<a name="l00706"></a>00706                 <a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.erase(<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>);
<a name="l00707"></a>00707                 <a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.push_front(dram_pkt);
<a name="l00708"></a>00708                 <span class="keywordflow">break</span>;
<a name="l00709"></a>00709             } <span class="keywordflow">else</span> { <span class="comment">//FCFS part</span>
<a name="l00710"></a>00710                 ;
<a name="l00711"></a>00711             }
<a name="l00712"></a>00712         }
<a name="l00713"></a>00713     } <span class="keywordflow">else</span>
<a name="l00714"></a>00714         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;No scheduling policy chosen!\n&quot;</span>);
<a name="l00715"></a>00715 
<a name="l00716"></a>00716     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Selected next read request\n&quot;</span>);
<a name="l00717"></a>00717     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00718"></a>00718 }
<a name="l00719"></a>00719 
<a name="l00720"></a>00720 <span class="keywordtype">void</span>
<a name="l00721"></a><a class="code" href="classSimpleDRAM.html#abba090ae9bfbbc119456be4ed00e475f">00721</a> <a class="code" href="classSimpleDRAM.html#abba090ae9bfbbc119456be4ed00e475f" title="When a packet reaches its &amp;quot;readyTime&amp;quot; in the response Q, use the &amp;quot;access()&amp;quot; metho...">SimpleDRAM::accessAndRespond</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt)
<a name="l00722"></a>00722 {
<a name="l00723"></a>00723     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Responding to Address %lld.. &quot;</span>,pkt-&gt;<a class="code" href="classPacket.html#a1c04785186ba5aa70a40cac9b2bfc86e">getAddr</a>());
<a name="l00724"></a>00724 
<a name="l00725"></a>00725     <span class="keywordtype">bool</span> needsResponse = pkt-&gt;<a class="code" href="classPacket.html#a3eafb3dde5f57c16f684862aff8da0b3">needsResponse</a>();
<a name="l00726"></a>00726     <span class="comment">// do the actual memory access which also turns the packet into a</span>
<a name="l00727"></a>00727     <span class="comment">// response</span>
<a name="l00728"></a>00728     <a class="code" href="classAbstractMemory.html#a4f8bf048c846bef573325f47a0603b09" title="Perform an untimed memory access and update all the state (e.g.">access</a>(pkt);
<a name="l00729"></a>00729 
<a name="l00730"></a>00730     <span class="comment">// turn packet around to go back to requester if response expected</span>
<a name="l00731"></a>00731     <span class="keywordflow">if</span> (needsResponse) {
<a name="l00732"></a>00732         <span class="comment">// access already turned the packet into a response</span>
<a name="l00733"></a>00733         assert(pkt-&gt;<a class="code" href="classPacket.html#ae55f4c38bf6367f308c935cb833027ee">isResponse</a>());
<a name="l00734"></a>00734 
<a name="l00735"></a>00735         <span class="comment">// @todo someone should pay for this</span>
<a name="l00736"></a>00736         pkt-&gt;<a class="code" href="classPacket.html#a72da3f227887b6d8d316421c92a27108" title="The extra delay from seeing the packet until the first word is transmitted by the bus that provided i...">busFirstWordDelay</a> = pkt-&gt;<a class="code" href="classPacket.html#a1630a79f0fc7ddf0ee957f23ec25dfde" title="The extra delay from seeing the packet until the last word is transmitted by the bus that provided it...">busLastWordDelay</a> = 0;
<a name="l00737"></a>00737 
<a name="l00738"></a>00738         <span class="comment">// queue the packet in the response queue to be sent out the</span>
<a name="l00739"></a>00739         <span class="comment">// next tick</span>
<a name="l00740"></a>00740         <a class="code" href="classSimpleDRAM.html#aa90269cc4d8251534062632d549fea1f" title="Our incoming port, for a multi-ported controller add a crossbar in front of it.">port</a>.<a class="code" href="classQueuedSlavePort.html#a99f59dcf30fb949b9c2ff72928e23a97" title="Schedule the sending of a timing response.">schedTimingResp</a>(pkt, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>() + 1);
<a name="l00741"></a>00741     } <span class="keywordflow">else</span> {
<a name="l00742"></a>00742     }
<a name="l00743"></a>00743 
<a name="l00744"></a>00744     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Done\n&quot;</span>);
<a name="l00745"></a>00745 
<a name="l00746"></a>00746     <span class="keywordflow">return</span>;
<a name="l00747"></a>00747 }
<a name="l00748"></a>00748 
<a name="l00749"></a>00749 <a class="code" href="classstd_1_1pair.html" title="STL pair class.">pair&lt;Tick, Tick&gt;</a>
<a name="l00750"></a><a class="code" href="classSimpleDRAM.html#a3e4caeb9902fce58f6c80a75f041f01f">00750</a> <a class="code" href="classSimpleDRAM.html#a3e4caeb9902fce58f6c80a75f041f01f" title="Looks at the state of the banks, channels, row buffer hits etc to estimate how long a request will ta...">SimpleDRAM::estimateLatency</a>(<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html" title="A DRAM packet stores packets along with the timestamp of when the packet entered the queue...">DRAMPacket</a>* dram_pkt, <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> inTime)
<a name="l00751"></a>00751 {
<a name="l00752"></a>00752     <span class="comment">// If a request reaches a bank at tick &#39;inTime&#39;, how much time</span>
<a name="l00753"></a>00753     <span class="comment">// *after* that does it take to finish the request, depending</span>
<a name="l00754"></a>00754     <span class="comment">// on bank status and page open policy. Note that this method</span>
<a name="l00755"></a>00755     <span class="comment">// considers only the time taken for the actual read or write</span>
<a name="l00756"></a>00756     <span class="comment">// to complete, NOT any additional time thereafter for tRAS or</span>
<a name="l00757"></a>00757     <span class="comment">// tRP.</span>
<a name="l00758"></a>00758     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> accLat = 0;
<a name="l00759"></a>00759     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> bankLat = 0;
<a name="l00760"></a>00760     <a class="code" href="classSimpleDRAM.html#a77ca67b57437837a74ce27cc58def940" title="Remember that a row buffer hit occured.">rowHitFlag</a> = <span class="keyword">false</span>;
<a name="l00761"></a>00761 
<a name="l00762"></a>00762     <span class="keyword">const</span> <a class="code" href="classSimpleDRAM_1_1Bank.html" title="A basic class to track the bank state indirectly via times &amp;quot;freeAt&amp;quot; and &amp;quot;tRASDoneAt&amp;qu...">Bank</a>&amp; bank = dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#a8f6e3015fcdd22ebaa2379a2cdb6ac57">bank_ref</a>;
<a name="l00763"></a>00763     <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a18acf8ab471fa8af4a30bf42b59d15e7">pageMgmt</a> == Enums::open) { <span class="comment">// open-page policy</span>
<a name="l00764"></a>00764         <span class="keywordflow">if</span> (bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#adc16d64ec6bd73b4f0e89967b77344c0">openRow</a> == dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#aae697c3e52307856f727d5624249d7b6">row</a>) {
<a name="l00765"></a>00765             <span class="comment">// When we have a row-buffer hit,</span>
<a name="l00766"></a>00766             <span class="comment">// we don&#39;t care about tRAS having expired or not,</span>
<a name="l00767"></a>00767             <span class="comment">// but do care about bank being free for access</span>
<a name="l00768"></a>00768             <a class="code" href="classSimpleDRAM.html#a77ca67b57437837a74ce27cc58def940" title="Remember that a row buffer hit occured.">rowHitFlag</a> = <span class="keyword">true</span>;
<a name="l00769"></a>00769 
<a name="l00770"></a>00770             <span class="keywordflow">if</span> (bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a> &lt; inTime) {
<a name="l00771"></a>00771                <span class="comment">// CAS latency only</span>
<a name="l00772"></a>00772                accLat += <a class="code" href="classSimpleDRAM.html#aac0d0316cd00cc9f58902fa3f635c2a5">tCL</a>;
<a name="l00773"></a>00773                bankLat += <a class="code" href="classSimpleDRAM.html#aac0d0316cd00cc9f58902fa3f635c2a5">tCL</a>;
<a name="l00774"></a>00774             } <span class="keywordflow">else</span> {
<a name="l00775"></a>00775                 accLat += 0;
<a name="l00776"></a>00776                 bankLat += 0;
<a name="l00777"></a>00777             }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779         } <span class="keywordflow">else</span> {
<a name="l00780"></a>00780             <span class="comment">// Row-buffer miss, need to close existing row</span>
<a name="l00781"></a>00781             <span class="comment">// once tRAS has expired, then open the new one,</span>
<a name="l00782"></a>00782             <span class="comment">// then add cas latency.</span>
<a name="l00783"></a>00783             <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> freeTime = std::max(bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acf0078aa6a63c8472f52620fb0fb7919">tRASDoneAt</a>, bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a>);
<a name="l00784"></a>00784 
<a name="l00785"></a>00785             <span class="keywordflow">if</span> (freeTime &gt; inTime)
<a name="l00786"></a>00786                accLat += freeTime - inTime;
<a name="l00787"></a>00787 
<a name="l00788"></a>00788             accLat += <a class="code" href="classSimpleDRAM.html#ad0629e1f3d27f13c661c80f48d5be2d8">tRP</a> + <a class="code" href="classSimpleDRAM.html#a80c334c459a055c74baec86aa8cb34e0">tRCD</a> + <a class="code" href="classSimpleDRAM.html#aac0d0316cd00cc9f58902fa3f635c2a5">tCL</a>;
<a name="l00789"></a>00789             bankLat += <a class="code" href="classSimpleDRAM.html#ad0629e1f3d27f13c661c80f48d5be2d8">tRP</a> + <a class="code" href="classSimpleDRAM.html#a80c334c459a055c74baec86aa8cb34e0">tRCD</a> + tCL;
<a name="l00790"></a>00790         }
<a name="l00791"></a>00791     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a18acf8ab471fa8af4a30bf42b59d15e7">pageMgmt</a> == Enums::close) {
<a name="l00792"></a>00792         <span class="comment">// With a close page policy, no notion of</span>
<a name="l00793"></a>00793         <span class="comment">// bank.tRASDoneAt</span>
<a name="l00794"></a>00794         <span class="keywordflow">if</span> (bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a> &gt; inTime)
<a name="l00795"></a>00795             accLat += bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a> - inTime;
<a name="l00796"></a>00796 
<a name="l00797"></a>00797         <span class="comment">// page already closed, simply open the row, and</span>
<a name="l00798"></a>00798         <span class="comment">// add cas latency</span>
<a name="l00799"></a>00799         accLat += <a class="code" href="classSimpleDRAM.html#a80c334c459a055c74baec86aa8cb34e0">tRCD</a> + <a class="code" href="classSimpleDRAM.html#aac0d0316cd00cc9f58902fa3f635c2a5">tCL</a>;
<a name="l00800"></a>00800         bankLat += <a class="code" href="classSimpleDRAM.html#a80c334c459a055c74baec86aa8cb34e0">tRCD</a> + tCL;
<a name="l00801"></a>00801     } <span class="keywordflow">else</span>
<a name="l00802"></a>00802         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;No page management policy chosen\n&quot;</span>);
<a name="l00803"></a>00803 
<a name="l00804"></a>00804     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Returning &lt; %lld, %lld &gt; from estimateLatency()\n&quot;</span>,
<a name="l00805"></a>00805             bankLat, accLat);
<a name="l00806"></a>00806 
<a name="l00807"></a>00807     <span class="keywordflow">return</span> make_pair(bankLat, accLat);
<a name="l00808"></a>00808 }
<a name="l00809"></a>00809 
<a name="l00810"></a>00810 <span class="keywordtype">void</span>
<a name="l00811"></a><a class="code" href="classSimpleDRAM.html#ab0104043cb5b37705f17cc1396c00cee">00811</a> <a class="code" href="classSimpleDRAM.html#ab0104043cb5b37705f17cc1396c00cee">SimpleDRAM::processNextReqEvent</a>()
<a name="l00812"></a>00812 {
<a name="l00813"></a>00813     <a class="code" href="classSimpleDRAM.html#a8af67944364c39b49923fb825f98493b" title="Calls chooseNextReq() to pick the right request, then calls doDRAMAccess on that request in order to ...">scheduleNextReq</a>();
<a name="l00814"></a>00814 }
<a name="l00815"></a>00815 
<a name="l00816"></a>00816 <span class="keywordtype">void</span>
<a name="l00817"></a><a class="code" href="classSimpleDRAM.html#a073941f1352a2b81df897605b32bf436">00817</a> <a class="code" href="classSimpleDRAM.html#a073941f1352a2b81df897605b32bf436" title="Keep track of when row activations happen, in order to enforce the maximum number of activations in t...">SimpleDRAM::recordActivate</a>(<a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> act_tick)
<a name="l00818"></a>00818 {
<a name="l00819"></a>00819     assert(<a class="code" href="classSimpleDRAM.html#aa7f2767d03e2d354370662e08dbd9f13" title="List to keep track of activate ticks.">actTicks</a>.size() == <a class="code" href="classSimpleDRAM.html#a1aae8e15c7f6e8f0bb229c49b4d0e0f4">activationLimit</a>);
<a name="l00820"></a>00820 
<a name="l00821"></a>00821     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Activate at tick %d\n&quot;</span>, act_tick);
<a name="l00822"></a>00822 
<a name="l00823"></a>00823     <span class="comment">// sanity check</span>
<a name="l00824"></a>00824     <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#aa7f2767d03e2d354370662e08dbd9f13" title="List to keep track of activate ticks.">actTicks</a>.back() &amp;&amp; (act_tick - <a class="code" href="classSimpleDRAM.html#aa7f2767d03e2d354370662e08dbd9f13" title="List to keep track of activate ticks.">actTicks</a>.back()) &lt; <a class="code" href="classSimpleDRAM.html#a8c9310dcd25ea56bcd3695bf96f1c205">tXAW</a>) {
<a name="l00825"></a>00825         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Got %d activates in window %d (%d - %d) which is smaller &quot;</span>
<a name="l00826"></a>00826               <span class="stringliteral">&quot;than %d\n&quot;</span>, <a class="code" href="classSimpleDRAM.html#a1aae8e15c7f6e8f0bb229c49b4d0e0f4">activationLimit</a>, act_tick - <a class="code" href="classSimpleDRAM.html#aa7f2767d03e2d354370662e08dbd9f13" title="List to keep track of activate ticks.">actTicks</a>.back(),
<a name="l00827"></a>00827               act_tick, <a class="code" href="classSimpleDRAM.html#aa7f2767d03e2d354370662e08dbd9f13" title="List to keep track of activate ticks.">actTicks</a>.back(), <a class="code" href="classSimpleDRAM.html#a8c9310dcd25ea56bcd3695bf96f1c205">tXAW</a>);
<a name="l00828"></a>00828     }
<a name="l00829"></a>00829 
<a name="l00830"></a>00830     <span class="comment">// shift the times used for the book keeping, the last element</span>
<a name="l00831"></a>00831     <span class="comment">// (highest index) is the oldest one and hence the lowest value</span>
<a name="l00832"></a>00832     <a class="code" href="classSimpleDRAM.html#aa7f2767d03e2d354370662e08dbd9f13" title="List to keep track of activate ticks.">actTicks</a>.pop_back();
<a name="l00833"></a>00833 
<a name="l00834"></a>00834     <span class="comment">// record an new activation (in the future)</span>
<a name="l00835"></a>00835     <a class="code" href="classSimpleDRAM.html#aa7f2767d03e2d354370662e08dbd9f13" title="List to keep track of activate ticks.">actTicks</a>.push_front(act_tick);
<a name="l00836"></a>00836 
<a name="l00837"></a>00837     <span class="comment">// cannot activate more than X times in time window tXAW, push the</span>
<a name="l00838"></a>00838     <span class="comment">// next one (the X + 1&#39;st activate) to be tXAW away from the</span>
<a name="l00839"></a>00839     <span class="comment">// oldest in our window of X</span>
<a name="l00840"></a>00840     <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#aa7f2767d03e2d354370662e08dbd9f13" title="List to keep track of activate ticks.">actTicks</a>.back() &amp;&amp; (act_tick - <a class="code" href="classSimpleDRAM.html#aa7f2767d03e2d354370662e08dbd9f13" title="List to keep track of activate ticks.">actTicks</a>.back()) &lt; <a class="code" href="classSimpleDRAM.html#a8c9310dcd25ea56bcd3695bf96f1c205">tXAW</a>) {
<a name="l00841"></a>00841         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Enforcing tXAW with X = %d, next activate no earlier &quot;</span>
<a name="l00842"></a>00842                 <span class="stringliteral">&quot;than %d\n&quot;</span>, <a class="code" href="classSimpleDRAM.html#a1aae8e15c7f6e8f0bb229c49b4d0e0f4">activationLimit</a>, <a class="code" href="classSimpleDRAM.html#aa7f2767d03e2d354370662e08dbd9f13" title="List to keep track of activate ticks.">actTicks</a>.back() + <a class="code" href="classSimpleDRAM.html#a8c9310dcd25ea56bcd3695bf96f1c205">tXAW</a>);
<a name="l00843"></a>00843         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> = 0; <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> &lt; <a class="code" href="classSimpleDRAM.html#a59dd3867633d6a508faa5a14a0926376">ranksPerChannel</a>; <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>++)
<a name="l00844"></a>00844             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#ac843bf7761bca8cf5315375942a0c25b">j</a> = 0; <a class="code" href="namespaceArmISA.html#ac843bf7761bca8cf5315375942a0c25b">j</a> &lt; <a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a>; <a class="code" href="namespaceArmISA.html#ac843bf7761bca8cf5315375942a0c25b">j</a>++)
<a name="l00845"></a>00845                 <span class="comment">// next activate must not happen before end of window</span>
<a name="l00846"></a>00846                 <a class="code" href="classSimpleDRAM.html#af6d821da9435a1a82265fd1e180becc8" title="Multi-dimensional vector of banks, first dimension is ranks, second is bank.">banks</a>[<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>][<a class="code" href="namespaceArmISA.html#ac843bf7761bca8cf5315375942a0c25b">j</a>].freeAt = std::max(<a class="code" href="classSimpleDRAM.html#af6d821da9435a1a82265fd1e180becc8" title="Multi-dimensional vector of banks, first dimension is ranks, second is bank.">banks</a>[<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>][<a class="code" href="namespaceArmISA.html#ac843bf7761bca8cf5315375942a0c25b">j</a>].freeAt,
<a name="l00847"></a>00847                                               <a class="code" href="classSimpleDRAM.html#aa7f2767d03e2d354370662e08dbd9f13" title="List to keep track of activate ticks.">actTicks</a>.back() + <a class="code" href="classSimpleDRAM.html#a8c9310dcd25ea56bcd3695bf96f1c205">tXAW</a>);
<a name="l00848"></a>00848     }
<a name="l00849"></a>00849 }
<a name="l00850"></a>00850 
<a name="l00851"></a>00851 <span class="keywordtype">void</span>
<a name="l00852"></a><a class="code" href="classSimpleDRAM.html#ae4207a15ff411423c6279328150a991b">00852</a> <a class="code" href="classSimpleDRAM.html#ae4207a15ff411423c6279328150a991b" title="Actually do the DRAM access - figure out the latency it will take to service the req based on bank st...">SimpleDRAM::doDRAMAccess</a>(<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html" title="A DRAM packet stores packets along with the timestamp of when the packet entered the queue...">DRAMPacket</a>* dram_pkt)
<a name="l00853"></a>00853 {
<a name="l00854"></a>00854 
<a name="l00855"></a>00855     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Timing access to addr %lld, rank/bank/row %d %d %d\n&quot;</span>,
<a name="l00856"></a>00856             dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#ae588f4b8c92a931529275e8672c22197">addr</a>, dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#a73f74968e7e908a586bba1f5abb1fd9f" title="Will be populated by address decoder.">rank</a>, dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#a9a12afb8709141ce4cab600889883095">bank</a>, dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#aae697c3e52307856f727d5624249d7b6">row</a>);
<a name="l00857"></a>00857 
<a name="l00858"></a>00858     <span class="comment">// estimate the bank and access latency</span>
<a name="l00859"></a>00859     <a class="code" href="classstd_1_1pair.html" title="STL pair class.">pair&lt;Tick, Tick&gt;</a> lat = <a class="code" href="classSimpleDRAM.html#a3e4caeb9902fce58f6c80a75f041f01f" title="Looks at the state of the banks, channels, row buffer hits etc to estimate how long a request will ta...">estimateLatency</a>(dram_pkt, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>());
<a name="l00860"></a>00860     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> bankLat = lat.first;
<a name="l00861"></a>00861     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> accessLat = lat.second;
<a name="l00862"></a>00862 
<a name="l00863"></a>00863     <span class="comment">// This request was woken up at this time based on a prior call</span>
<a name="l00864"></a>00864     <span class="comment">// to estimateLatency(). However, between then and now, both the</span>
<a name="l00865"></a>00865     <span class="comment">// accessLatency and/or busBusyUntil may have changed. We need</span>
<a name="l00866"></a>00866     <span class="comment">// to correct for that.</span>
<a name="l00867"></a>00867 
<a name="l00868"></a>00868     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> addDelay = (<a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>() + accessLat &lt; <a class="code" href="classSimpleDRAM.html#a3bf3033ac0b7c67a52a23ad874b5be99" title="Till when has the main data bus been spoken for already?">busBusyUntil</a>) ?
<a name="l00869"></a>00869         <a class="code" href="classSimpleDRAM.html#a3bf3033ac0b7c67a52a23ad874b5be99" title="Till when has the main data bus been spoken for already?">busBusyUntil</a> - (<a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>() + accessLat) : 0;
<a name="l00870"></a>00870 
<a name="l00871"></a>00871     <a class="code" href="classSimpleDRAM_1_1Bank.html" title="A basic class to track the bank state indirectly via times &amp;quot;freeAt&amp;quot; and &amp;quot;tRASDoneAt&amp;qu...">Bank</a>&amp; bank = dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#a8f6e3015fcdd22ebaa2379a2cdb6ac57">bank_ref</a>;
<a name="l00872"></a>00872 
<a name="l00873"></a>00873     <span class="comment">// Update bank state</span>
<a name="l00874"></a>00874     <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a18acf8ab471fa8af4a30bf42b59d15e7">pageMgmt</a> == Enums::open) {
<a name="l00875"></a>00875         bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#adc16d64ec6bd73b4f0e89967b77344c0">openRow</a> = dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#aae697c3e52307856f727d5624249d7b6">row</a>;
<a name="l00876"></a>00876         bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a> = <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>() + addDelay + accessLat;
<a name="l00877"></a>00877         <span class="comment">// If you activated a new row do to this access, the next access</span>
<a name="l00878"></a>00878         <span class="comment">// will have to respect tRAS for this bank. Assume tRAS ~= 3 * tRP.</span>
<a name="l00879"></a>00879         <span class="comment">// Also need to account for t_XAW</span>
<a name="l00880"></a>00880         <span class="keywordflow">if</span> (!<a class="code" href="classSimpleDRAM.html#a77ca67b57437837a74ce27cc58def940" title="Remember that a row buffer hit occured.">rowHitFlag</a>) {
<a name="l00881"></a>00881             bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acf0078aa6a63c8472f52620fb0fb7919">tRASDoneAt</a> = bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a> + <a class="code" href="classSimpleDRAM.html#ad0629e1f3d27f13c661c80f48d5be2d8">tRP</a>;
<a name="l00882"></a>00882             <a class="code" href="classSimpleDRAM.html#a073941f1352a2b81df897605b32bf436" title="Keep track of when row activations happen, in order to enforce the maximum number of activations in t...">recordActivate</a>(bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a> - <a class="code" href="classSimpleDRAM.html#aac0d0316cd00cc9f58902fa3f635c2a5">tCL</a> - <a class="code" href="classSimpleDRAM.html#a80c334c459a055c74baec86aa8cb34e0">tRCD</a>); <span class="comment">//since this is open page,</span>
<a name="l00883"></a>00883                                                       <span class="comment">//no tRP by default</span>
<a name="l00884"></a>00884         }
<a name="l00885"></a>00885     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a18acf8ab471fa8af4a30bf42b59d15e7">pageMgmt</a> == Enums::close) { <span class="comment">// accounting for tRAS also</span>
<a name="l00886"></a>00886         <span class="comment">// assuming that tRAS ~= 3 * tRP, and tRC ~= 4 * tRP, as is common</span>
<a name="l00887"></a>00887         <span class="comment">// (refer Jacob/Ng/Wang and Micron datasheets)</span>
<a name="l00888"></a>00888         bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a> = <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>() + addDelay + accessLat + <a class="code" href="classSimpleDRAM.html#ad0629e1f3d27f13c661c80f48d5be2d8">tRP</a> + <a class="code" href="classSimpleDRAM.html#ad0629e1f3d27f13c661c80f48d5be2d8">tRP</a>;
<a name="l00889"></a>00889         <a class="code" href="classSimpleDRAM.html#a073941f1352a2b81df897605b32bf436" title="Keep track of when row activations happen, in order to enforce the maximum number of activations in t...">recordActivate</a>(bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a> - tRP - tRP - <a class="code" href="classSimpleDRAM.html#aac0d0316cd00cc9f58902fa3f635c2a5">tCL</a> - <a class="code" href="classSimpleDRAM.html#a80c334c459a055c74baec86aa8cb34e0">tRCD</a>); <span class="comment">//essentially (freeAt - tRC)</span>
<a name="l00890"></a>00890         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM,<span class="stringliteral">&quot;doDRAMAccess::bank.freeAt is %lld\n&quot;</span>,bank.<a class="code" href="classSimpleDRAM_1_1Bank.html#acc07b11313eb95e32e0d343fc37d534f">freeAt</a>);
<a name="l00891"></a>00891     } <span class="keywordflow">else</span>
<a name="l00892"></a>00892         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;No page management policy chosen\n&quot;</span>);
<a name="l00893"></a>00893 
<a name="l00894"></a>00894     <span class="comment">// Update request parameters</span>
<a name="l00895"></a>00895     dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#af62013f44d41f8ef5f46c3d36c0df4e9" title="When will request leave the controller.">readyTime</a> = <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>() + addDelay + accessLat + <a class="code" href="classSimpleDRAM.html#a381ed669fde257c0afa5a2beed3f424c">tBURST</a>;
<a name="l00896"></a>00896 
<a name="l00897"></a>00897 
<a name="l00898"></a>00898     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Req %lld: curtick is %lld accessLat is %d &quot;</span> \
<a name="l00899"></a>00899                   <span class="stringliteral">&quot;readytime is %lld busbusyuntil is %lld. &quot;</span> \
<a name="l00900"></a>00900                   <span class="stringliteral">&quot;Scheduling at readyTime\n&quot;</span>, dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#ae588f4b8c92a931529275e8672c22197">addr</a>,
<a name="l00901"></a>00901                    <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>(), accessLat, dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#af62013f44d41f8ef5f46c3d36c0df4e9" title="When will request leave the controller.">readyTime</a>, <a class="code" href="classSimpleDRAM.html#a3bf3033ac0b7c67a52a23ad874b5be99" title="Till when has the main data bus been spoken for already?">busBusyUntil</a>);
<a name="l00902"></a>00902 
<a name="l00903"></a>00903     <span class="comment">// Make sure requests are not overlapping on the databus</span>
<a name="l00904"></a>00904     assert (dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#af62013f44d41f8ef5f46c3d36c0df4e9" title="When will request leave the controller.">readyTime</a> - <a class="code" href="classSimpleDRAM.html#a3bf3033ac0b7c67a52a23ad874b5be99" title="Till when has the main data bus been spoken for already?">busBusyUntil</a> &gt;= tBURST);
<a name="l00905"></a>00905 
<a name="l00906"></a>00906     <span class="comment">// Update bus state</span>
<a name="l00907"></a>00907     <a class="code" href="classSimpleDRAM.html#a3bf3033ac0b7c67a52a23ad874b5be99" title="Till when has the main data bus been spoken for already?">busBusyUntil</a> = dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#af62013f44d41f8ef5f46c3d36c0df4e9" title="When will request leave the controller.">readyTime</a>;
<a name="l00908"></a>00908 
<a name="l00909"></a>00909     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM,<span class="stringliteral">&quot;Access time is %lld\n&quot;</span>,
<a name="l00910"></a>00910             dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#af62013f44d41f8ef5f46c3d36c0df4e9" title="When will request leave the controller.">readyTime</a> - dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#aeb497e26cb4ed1dfd29d79a8e04bdb48" title="When did request enter the controller.">entryTime</a>);
<a name="l00911"></a>00911 
<a name="l00912"></a>00912     <span class="comment">// Update stats</span>
<a name="l00913"></a>00913     <a class="code" href="classSimpleDRAM.html#a3104a833ebb8771b71bf978673981df4">totMemAccLat</a> += dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#af62013f44d41f8ef5f46c3d36c0df4e9" title="When will request leave the controller.">readyTime</a> - dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#aeb497e26cb4ed1dfd29d79a8e04bdb48" title="When did request enter the controller.">entryTime</a>;
<a name="l00914"></a>00914     <a class="code" href="classSimpleDRAM.html#a27e91038df7d68d5c2af7f992ff8aa5c">totBankLat</a> += bankLat;
<a name="l00915"></a>00915     <a class="code" href="classSimpleDRAM.html#adb38a3e48f39c879fe49ead1cf76ac10">totBusLat</a> += tBURST;
<a name="l00916"></a>00916     <a class="code" href="classSimpleDRAM.html#afb8099d6b2d992632d0601d04d1fe6fa">totQLat</a> += dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#af62013f44d41f8ef5f46c3d36c0df4e9" title="When will request leave the controller.">readyTime</a> - dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#aeb497e26cb4ed1dfd29d79a8e04bdb48" title="When did request enter the controller.">entryTime</a> - bankLat - tBURST;
<a name="l00917"></a>00917 
<a name="l00918"></a>00918     <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a77ca67b57437837a74ce27cc58def940" title="Remember that a row buffer hit occured.">rowHitFlag</a>)
<a name="l00919"></a>00919         <a class="code" href="classSimpleDRAM.html#a46d78d06ba20a930ca5d445b5157502d">readRowHits</a>++;
<a name="l00920"></a>00920 
<a name="l00921"></a>00921     <span class="comment">// At this point we&#39;re done dealing with the request</span>
<a name="l00922"></a>00922     <span class="comment">// It will be moved to a separate response queue with a</span>
<a name="l00923"></a>00923     <span class="comment">// correct readyTime, and eventually be sent back at that</span>
<a name="l00924"></a>00924     <span class="comment">//time</span>
<a name="l00925"></a>00925     <a class="code" href="classSimpleDRAM.html#a38b54d7ce30d32e27380348d1a38f69b" title="Move the request at the head of the read queue to the response queue, sorting by readyTime. If it is the only packet in the response queue, schedule a respond event to send it back to the outside world.">moveToRespQ</a>();
<a name="l00926"></a>00926 
<a name="l00927"></a>00927     <span class="comment">// The absolute soonest you have to start thinking about the</span>
<a name="l00928"></a>00928     <span class="comment">// next request is the longest access time that can occur before</span>
<a name="l00929"></a>00929     <span class="comment">// busBusyUntil. Assuming you need to meet tRAS, then precharge,</span>
<a name="l00930"></a>00930     <span class="comment">// open a new row, and access, it is ~4*tRCD.</span>
<a name="l00931"></a>00931 
<a name="l00932"></a>00932 
<a name="l00933"></a>00933     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> newTime = (<a class="code" href="classSimpleDRAM.html#a3bf3033ac0b7c67a52a23ad874b5be99" title="Till when has the main data bus been spoken for already?">busBusyUntil</a> &gt; 4 * <a class="code" href="classSimpleDRAM.html#a80c334c459a055c74baec86aa8cb34e0">tRCD</a>) ?
<a name="l00934"></a>00934                    std::max(<a class="code" href="classSimpleDRAM.html#a3bf3033ac0b7c67a52a23ad874b5be99" title="Till when has the main data bus been spoken for already?">busBusyUntil</a> - 4 * <a class="code" href="classSimpleDRAM.html#a80c334c459a055c74baec86aa8cb34e0">tRCD</a>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>()) :
<a name="l00935"></a>00935                    <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>();
<a name="l00936"></a>00936 
<a name="l00937"></a>00937     <span class="keywordflow">if</span> (!<a class="code" href="classSimpleDRAM.html#ab97036fa64672c136bed9c688379a0e7">nextReqEvent</a>.<a class="code" href="classEvent.html#a36bdc2ee73215ed7670a7bfc0f25ab8b" title="Determine if the current event is scheduled.">scheduled</a>() &amp;&amp; !<a class="code" href="classSimpleDRAM.html#a2bd3fc4adfd452ec82f941f3b7a6aa5b" title="Use this flag to shutoff reads, i.e.">stopReads</a>){
<a name="l00938"></a>00938         <a class="code" href="classEventManager.html#a749a10828b2dd5017a2582960d04e400">schedule</a>(<a class="code" href="classSimpleDRAM.html#ab97036fa64672c136bed9c688379a0e7">nextReqEvent</a>, newTime);
<a name="l00939"></a>00939     } <span class="keywordflow">else</span> {
<a name="l00940"></a>00940         <span class="keywordflow">if</span> (newTime &lt; <a class="code" href="classSimpleDRAM.html#ab97036fa64672c136bed9c688379a0e7">nextReqEvent</a>.<a class="code" href="classEvent.html#a3ff737aa0692f1ea9b8dd232778f2fcb" title="Get the time that the event is scheduled.">when</a>())
<a name="l00941"></a>00941             <a class="code" href="classEventManager.html#a766c5f955dfa1609696955f075492687">reschedule</a>(<a class="code" href="classSimpleDRAM.html#ab97036fa64672c136bed9c688379a0e7">nextReqEvent</a>, newTime);
<a name="l00942"></a>00942     }
<a name="l00943"></a>00943 
<a name="l00944"></a>00944 
<a name="l00945"></a>00945 }
<a name="l00946"></a>00946 
<a name="l00947"></a>00947 <span class="keywordtype">void</span>
<a name="l00948"></a><a class="code" href="classSimpleDRAM.html#a38b54d7ce30d32e27380348d1a38f69b">00948</a> <a class="code" href="classSimpleDRAM.html#a38b54d7ce30d32e27380348d1a38f69b" title="Move the request at the head of the read queue to the response queue, sorting by readyTime. If it is the only packet in the response queue, schedule a respond event to send it back to the outside world.">SimpleDRAM::moveToRespQ</a>()
<a name="l00949"></a>00949 {
<a name="l00950"></a>00950     <span class="comment">// Remove from read queue</span>
<a name="l00951"></a>00951     <a class="code" href="classSimpleDRAM_1_1DRAMPacket.html" title="A DRAM packet stores packets along with the timestamp of when the packet entered the queue...">DRAMPacket</a>* dram_pkt = <a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.front();
<a name="l00952"></a>00952     <a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.pop_front();
<a name="l00953"></a>00953 
<a name="l00954"></a>00954     <span class="comment">// Insert into response queue sorted by readyTime</span>
<a name="l00955"></a>00955     <span class="comment">// It will be sent back to the requestor at its</span>
<a name="l00956"></a>00956     <span class="comment">// readyTime</span>
<a name="l00957"></a>00957     <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.empty()) {
<a name="l00958"></a>00958         <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.push_front(dram_pkt);
<a name="l00959"></a>00959         assert(!<a class="code" href="classSimpleDRAM.html#a596d6d8395cae17cea2db27b0b59680d">respondEvent</a>.<a class="code" href="classEvent.html#a36bdc2ee73215ed7670a7bfc0f25ab8b" title="Determine if the current event is scheduled.">scheduled</a>());
<a name="l00960"></a>00960         assert(dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#af62013f44d41f8ef5f46c3d36c0df4e9" title="When will request leave the controller.">readyTime</a> &gt;= <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>());
<a name="l00961"></a>00961         <a class="code" href="classEventManager.html#a749a10828b2dd5017a2582960d04e400">schedule</a>(<a class="code" href="classSimpleDRAM.html#a596d6d8395cae17cea2db27b0b59680d">respondEvent</a>, dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#af62013f44d41f8ef5f46c3d36c0df4e9" title="When will request leave the controller.">readyTime</a>);
<a name="l00962"></a>00962     } <span class="keywordflow">else</span> {
<a name="l00963"></a>00963         <span class="keywordtype">bool</span> done = <span class="keyword">false</span>;
<a name="l00964"></a>00964         <a class="code" href="classstd_1_1list.html" title="STL list class.">list&lt;DRAMPacket*&gt;::iterator</a> <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> = <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.begin();
<a name="l00965"></a>00965         <span class="keywordflow">while</span> (!done &amp;&amp; i != <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.end()) {
<a name="l00966"></a>00966             <span class="keywordflow">if</span> ((*i)-&gt;readyTime &gt; dram_pkt-&gt;<a class="code" href="classSimpleDRAM_1_1DRAMPacket.html#af62013f44d41f8ef5f46c3d36c0df4e9" title="When will request leave the controller.">readyTime</a>) {
<a name="l00967"></a>00967                 <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.insert(i, dram_pkt);
<a name="l00968"></a>00968                 done = <span class="keyword">true</span>;
<a name="l00969"></a>00969             }
<a name="l00970"></a>00970             ++i;
<a name="l00971"></a>00971         }
<a name="l00972"></a>00972 
<a name="l00973"></a>00973         <span class="keywordflow">if</span> (!done)
<a name="l00974"></a>00974             <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.push_back(dram_pkt);
<a name="l00975"></a>00975 
<a name="l00976"></a>00976         assert(<a class="code" href="classSimpleDRAM.html#a596d6d8395cae17cea2db27b0b59680d">respondEvent</a>.<a class="code" href="classEvent.html#a36bdc2ee73215ed7670a7bfc0f25ab8b" title="Determine if the current event is scheduled.">scheduled</a>());
<a name="l00977"></a>00977 
<a name="l00978"></a>00978         <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.front()-&gt;readyTime &lt; <a class="code" href="classSimpleDRAM.html#a596d6d8395cae17cea2db27b0b59680d">respondEvent</a>.<a class="code" href="classEvent.html#a3ff737aa0692f1ea9b8dd232778f2fcb" title="Get the time that the event is scheduled.">when</a>()) {
<a name="l00979"></a>00979             assert(<a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.front()-&gt;readyTime &gt;= <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>());
<a name="l00980"></a>00980             <a class="code" href="classEventManager.html#a766c5f955dfa1609696955f075492687">reschedule</a>(<a class="code" href="classSimpleDRAM.html#a596d6d8395cae17cea2db27b0b59680d">respondEvent</a>, <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.front()-&gt;readyTime);
<a name="l00981"></a>00981         }
<a name="l00982"></a>00982     }
<a name="l00983"></a>00983 }
<a name="l00984"></a>00984 
<a name="l00985"></a>00985 <span class="keywordtype">void</span>
<a name="l00986"></a><a class="code" href="classSimpleDRAM.html#a8af67944364c39b49923fb825f98493b">00986</a> <a class="code" href="classSimpleDRAM.html#a8af67944364c39b49923fb825f98493b" title="Calls chooseNextReq() to pick the right request, then calls doDRAMAccess on that request in order to ...">SimpleDRAM::scheduleNextReq</a>()
<a name="l00987"></a>00987 {
<a name="l00988"></a>00988     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Reached scheduleNextReq()\n&quot;</span>);
<a name="l00989"></a>00989 
<a name="l00990"></a>00990     <span class="comment">// Figure out which read request goes next, and move it to the</span>
<a name="l00991"></a>00991     <span class="comment">// front of the read queue</span>
<a name="l00992"></a>00992     <span class="keywordflow">if</span> (!<a class="code" href="classSimpleDRAM.html#af88fc5afc4fb4c701d7391411942e642" title="The memory schduler/arbiter - picks which read request needs to go next, based on the specified polic...">chooseNextRead</a>()) {
<a name="l00993"></a>00993         <span class="comment">// In the case there is no read request to go next, see if we</span>
<a name="l00994"></a>00994         <span class="comment">// are asked to drain, and if so trigger writes, this also</span>
<a name="l00995"></a>00995         <span class="comment">// ensures that if we hit the write limit we will do this</span>
<a name="l00996"></a>00996         <span class="comment">// multiple times until we are completely drained</span>
<a name="l00997"></a>00997         <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#a7f19a31acafa04e74429afc8d193417a" title="If we need to drain, keep the drain manager around until we&amp;#39;re done here.">drainManager</a> &amp;&amp; !<a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.empty() &amp;&amp; !<a class="code" href="classSimpleDRAM.html#a75cd7692e5fd260e2199db5778455050">writeEvent</a>.<a class="code" href="classEvent.html#a36bdc2ee73215ed7670a7bfc0f25ab8b" title="Determine if the current event is scheduled.">scheduled</a>())
<a name="l00998"></a>00998             <a class="code" href="classSimpleDRAM.html#ade766fbbdfe2c5158da38cd60517f5c0" title="Check when the channel is free to turnaround, add turnaround delay and schedule a whole bunch of writ...">triggerWrites</a>();
<a name="l00999"></a>00999     } <span class="keywordflow">else</span> {
<a name="l01000"></a>01000         <a class="code" href="classSimpleDRAM.html#ae4207a15ff411423c6279328150a991b" title="Actually do the DRAM access - figure out the latency it will take to service the req based on bank st...">doDRAMAccess</a>(<a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.front());
<a name="l01001"></a>01001     }
<a name="l01002"></a>01002 }
<a name="l01003"></a>01003 
<a name="l01004"></a>01004 <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a>
<a name="l01005"></a><a class="code" href="classSimpleDRAM.html#afc6c64be6511b0ff885c94126815edeb">01005</a> <a class="code" href="classSimpleDRAM.html#afc6c64be6511b0ff885c94126815edeb" title="Looking at all banks, determine the moment in time when they are all free.">SimpleDRAM::maxBankFreeAt</a>()<span class="keyword"> const</span>
<a name="l01006"></a>01006 <span class="keyword"></span>{
<a name="l01007"></a>01007     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> banksFree = 0;
<a name="l01008"></a>01008 
<a name="l01009"></a>01009     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> = 0; <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> &lt; <a class="code" href="classSimpleDRAM.html#a59dd3867633d6a508faa5a14a0926376">ranksPerChannel</a>; <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>++)
<a name="l01010"></a>01010         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#ac843bf7761bca8cf5315375942a0c25b">j</a> = 0; <a class="code" href="namespaceArmISA.html#ac843bf7761bca8cf5315375942a0c25b">j</a> &lt; <a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a>; <a class="code" href="namespaceArmISA.html#ac843bf7761bca8cf5315375942a0c25b">j</a>++)
<a name="l01011"></a>01011             banksFree = std::max(<a class="code" href="classSimpleDRAM.html#af6d821da9435a1a82265fd1e180becc8" title="Multi-dimensional vector of banks, first dimension is ranks, second is bank.">banks</a>[<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>][<a class="code" href="namespaceArmISA.html#ac843bf7761bca8cf5315375942a0c25b">j</a>].freeAt, banksFree);
<a name="l01012"></a>01012 
<a name="l01013"></a>01013     <span class="keywordflow">return</span> banksFree;
<a name="l01014"></a>01014 }
<a name="l01015"></a>01015 
<a name="l01016"></a>01016 <span class="keywordtype">void</span>
<a name="l01017"></a><a class="code" href="classSimpleDRAM.html#aeb564f7768075f80b755729a8447d584">01017</a> <a class="code" href="classSimpleDRAM.html#aeb564f7768075f80b755729a8447d584">SimpleDRAM::processRefreshEvent</a>()
<a name="l01018"></a>01018 {
<a name="l01019"></a>01019     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DRAM, <span class="stringliteral">&quot;Refreshing at tick %ld\n&quot;</span>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>());
<a name="l01020"></a>01020 
<a name="l01021"></a>01021     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a> banksFree = std::max(<a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>(), <a class="code" href="classSimpleDRAM.html#afc6c64be6511b0ff885c94126815edeb" title="Looking at all banks, determine the moment in time when they are all free.">maxBankFreeAt</a>()) + <a class="code" href="classSimpleDRAM.html#a55c083eaefc6de4bebeaf71e45fa17df">tRFC</a>;
<a name="l01022"></a>01022 
<a name="l01023"></a>01023     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> = 0; <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> &lt; <a class="code" href="classSimpleDRAM.html#a59dd3867633d6a508faa5a14a0926376">ranksPerChannel</a>; <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>++)
<a name="l01024"></a>01024         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#ac843bf7761bca8cf5315375942a0c25b">j</a> = 0; <a class="code" href="namespaceArmISA.html#ac843bf7761bca8cf5315375942a0c25b">j</a> &lt; <a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a>; <a class="code" href="namespaceArmISA.html#ac843bf7761bca8cf5315375942a0c25b">j</a>++)
<a name="l01025"></a>01025             <a class="code" href="classSimpleDRAM.html#af6d821da9435a1a82265fd1e180becc8" title="Multi-dimensional vector of banks, first dimension is ranks, second is bank.">banks</a>[<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>][<a class="code" href="namespaceArmISA.html#ac843bf7761bca8cf5315375942a0c25b">j</a>].freeAt = banksFree;
<a name="l01026"></a>01026 
<a name="l01027"></a>01027     <a class="code" href="classEventManager.html#a749a10828b2dd5017a2582960d04e400">schedule</a>(<a class="code" href="classSimpleDRAM.html#ab47d4b5fbdbc35f3b3142693d57ef549">refreshEvent</a>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The current simulated tick.">curTick</a>() + <a class="code" href="classSimpleDRAM.html#afbc72654a5c306d321bae5c5617cbee4">tREFI</a>);
<a name="l01028"></a>01028 }
<a name="l01029"></a>01029 
<a name="l01030"></a>01030 <span class="keywordtype">void</span>
<a name="l01031"></a><a class="code" href="classSimpleDRAM.html#a33e079af809e99cfd3af86d7773edbe4">01031</a> <a class="code" href="classSimpleDRAM.html#a33e079af809e99cfd3af86d7773edbe4" title="Register Statistics.">SimpleDRAM::regStats</a>()
<a name="l01032"></a>01032 {
<a name="l01033"></a>01033     <span class="keyword">using namespace </span>Stats;
<a name="l01034"></a>01034 
<a name="l01035"></a>01035     <a class="code" href="classSimpleDRAM.html#a33e079af809e99cfd3af86d7773edbe4" title="Register Statistics.">AbstractMemory::regStats</a>();
<a name="l01036"></a>01036 
<a name="l01037"></a>01037     <a class="code" href="classSimpleDRAM.html#a9f8678c47f9685ef893e06a63e8d66c7">readReqs</a>
<a name="l01038"></a>01038         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.readReqs&quot;</span>)
<a name="l01039"></a>01039         .desc(<span class="stringliteral">&quot;Total number of read requests seen&quot;</span>);
<a name="l01040"></a>01040 
<a name="l01041"></a>01041     <a class="code" href="classSimpleDRAM.html#afe812808d0a071f663e107f9d8ea3ec1">writeReqs</a>
<a name="l01042"></a>01042         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.writeReqs&quot;</span>)
<a name="l01043"></a>01043         .desc(<span class="stringliteral">&quot;Total number of write requests seen&quot;</span>);
<a name="l01044"></a>01044 
<a name="l01045"></a>01045     <a class="code" href="classSimpleDRAM.html#acbfa17d79d4392737d91a4d490e77008">servicedByWrQ</a>
<a name="l01046"></a>01046         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.servicedByWrQ&quot;</span>)
<a name="l01047"></a>01047         .desc(<span class="stringliteral">&quot;Number of read reqs serviced by write Q&quot;</span>);
<a name="l01048"></a>01048 
<a name="l01049"></a>01049     <a class="code" href="classSimpleDRAM.html#a4e7383918a9c0873208527805c2612aa">cpuReqs</a>
<a name="l01050"></a>01050         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.cpureqs&quot;</span>)
<a name="l01051"></a>01051         .desc(<span class="stringliteral">&quot;Reqs generatd by CPU via cache - shady&quot;</span>);
<a name="l01052"></a>01052 
<a name="l01053"></a>01053     <a class="code" href="classSimpleDRAM.html#a05b87deab64ad93377e8c2b96c2254f1">neitherReadNorWrite</a>
<a name="l01054"></a>01054         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.neitherReadNorWrite&quot;</span>)
<a name="l01055"></a>01055         .desc(<span class="stringliteral">&quot;Reqs where no action is needed&quot;</span>);
<a name="l01056"></a>01056 
<a name="l01057"></a>01057     <a class="code" href="classSimpleDRAM.html#af12d12b7695f3b136955eecc33bd8445">perBankRdReqs</a>
<a name="l01058"></a>01058         .<a class="code" href="classStats_1_1VectorBase.html#ada7b4d1605ccdfba6975aa1025b861a2" title="Set this vector to have the given size.">init</a>(<a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a> * <a class="code" href="classSimpleDRAM.html#a59dd3867633d6a508faa5a14a0926376">ranksPerChannel</a>)
<a name="l01059"></a>01059         .name(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.perBankRdReqs&quot;</span>)
<a name="l01060"></a>01060         .desc(<span class="stringliteral">&quot;Track reads on a per bank basis&quot;</span>);
<a name="l01061"></a>01061 
<a name="l01062"></a>01062     <a class="code" href="classSimpleDRAM.html#a9fc0de9d7f3e27c86400d1218ec16d07">perBankWrReqs</a>
<a name="l01063"></a>01063         .<a class="code" href="classStats_1_1VectorBase.html#ada7b4d1605ccdfba6975aa1025b861a2" title="Set this vector to have the given size.">init</a>(<a class="code" href="classSimpleDRAM.html#abf8ff2b6c49d8531a9ba353e82456111">banksPerRank</a> * ranksPerChannel)
<a name="l01064"></a>01064         .name(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.perBankWrReqs&quot;</span>)
<a name="l01065"></a>01065         .desc(<span class="stringliteral">&quot;Track writes on a per bank basis&quot;</span>);
<a name="l01066"></a>01066 
<a name="l01067"></a>01067     <a class="code" href="classSimpleDRAM.html#acd2e45b866c1773a4a0a4c49bfd8bfb1">avgRdQLen</a>
<a name="l01068"></a>01068         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.avgRdQLen&quot;</span>)
<a name="l01069"></a>01069         .desc(<span class="stringliteral">&quot;Average read queue length over time&quot;</span>)
<a name="l01070"></a>01070         .precision(2);
<a name="l01071"></a>01071 
<a name="l01072"></a>01072     <a class="code" href="classSimpleDRAM.html#abcd9119cf56e69c0afb1ea8af8ed20a3">avgWrQLen</a>
<a name="l01073"></a>01073         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.avgWrQLen&quot;</span>)
<a name="l01074"></a>01074         .desc(<span class="stringliteral">&quot;Average write queue length over time&quot;</span>)
<a name="l01075"></a>01075         .precision(2);
<a name="l01076"></a>01076 
<a name="l01077"></a>01077     <a class="code" href="classSimpleDRAM.html#afb8099d6b2d992632d0601d04d1fe6fa">totQLat</a>
<a name="l01078"></a>01078         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.totQLat&quot;</span>)
<a name="l01079"></a>01079         .desc(<span class="stringliteral">&quot;Total cycles spent in queuing delays&quot;</span>);
<a name="l01080"></a>01080 
<a name="l01081"></a>01081     <a class="code" href="classSimpleDRAM.html#a27e91038df7d68d5c2af7f992ff8aa5c">totBankLat</a>
<a name="l01082"></a>01082         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.totBankLat&quot;</span>)
<a name="l01083"></a>01083         .desc(<span class="stringliteral">&quot;Total cycles spent in bank access&quot;</span>);
<a name="l01084"></a>01084 
<a name="l01085"></a>01085     <a class="code" href="classSimpleDRAM.html#adb38a3e48f39c879fe49ead1cf76ac10">totBusLat</a>
<a name="l01086"></a>01086         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.totBusLat&quot;</span>)
<a name="l01087"></a>01087         .desc(<span class="stringliteral">&quot;Total cycles spent in databus access&quot;</span>);
<a name="l01088"></a>01088 
<a name="l01089"></a>01089     <a class="code" href="classSimpleDRAM.html#a3104a833ebb8771b71bf978673981df4">totMemAccLat</a>
<a name="l01090"></a>01090         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.totMemAccLat&quot;</span>)
<a name="l01091"></a>01091         .desc(<span class="stringliteral">&quot;Sum of mem lat for all requests&quot;</span>);
<a name="l01092"></a>01092 
<a name="l01093"></a>01093     <a class="code" href="classSimpleDRAM.html#a8792dedc867d7c8d31bbb31c8c7c9d79">avgQLat</a>
<a name="l01094"></a>01094         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.avgQLat&quot;</span>)
<a name="l01095"></a>01095         .desc(<span class="stringliteral">&quot;Average queueing delay per request&quot;</span>)
<a name="l01096"></a>01096         .precision(2);
<a name="l01097"></a>01097 
<a name="l01098"></a>01098     <a class="code" href="classSimpleDRAM.html#a8792dedc867d7c8d31bbb31c8c7c9d79">avgQLat</a> = <a class="code" href="classSimpleDRAM.html#afb8099d6b2d992632d0601d04d1fe6fa">totQLat</a> / (<a class="code" href="classSimpleDRAM.html#a9f8678c47f9685ef893e06a63e8d66c7">readReqs</a> - <a class="code" href="classSimpleDRAM.html#acbfa17d79d4392737d91a4d490e77008">servicedByWrQ</a>);
<a name="l01099"></a>01099 
<a name="l01100"></a>01100     <a class="code" href="classSimpleDRAM.html#a5bc31517c43eb77410295f331a13c612">avgBankLat</a>
<a name="l01101"></a>01101         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.avgBankLat&quot;</span>)
<a name="l01102"></a>01102         .desc(<span class="stringliteral">&quot;Average bank access latency per request&quot;</span>)
<a name="l01103"></a>01103         .precision(2);
<a name="l01104"></a>01104 
<a name="l01105"></a>01105     <a class="code" href="classSimpleDRAM.html#a5bc31517c43eb77410295f331a13c612">avgBankLat</a> = <a class="code" href="classSimpleDRAM.html#a27e91038df7d68d5c2af7f992ff8aa5c">totBankLat</a> / (<a class="code" href="classSimpleDRAM.html#a9f8678c47f9685ef893e06a63e8d66c7">readReqs</a> - <a class="code" href="classSimpleDRAM.html#acbfa17d79d4392737d91a4d490e77008">servicedByWrQ</a>);
<a name="l01106"></a>01106 
<a name="l01107"></a>01107     <a class="code" href="classSimpleDRAM.html#a70665c0f353feca03f0a41cb4ed5c3a4">avgBusLat</a>
<a name="l01108"></a>01108         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.avgBusLat&quot;</span>)
<a name="l01109"></a>01109         .desc(<span class="stringliteral">&quot;Average bus latency per request&quot;</span>)
<a name="l01110"></a>01110         .precision(2);
<a name="l01111"></a>01111 
<a name="l01112"></a>01112     <a class="code" href="classSimpleDRAM.html#a70665c0f353feca03f0a41cb4ed5c3a4">avgBusLat</a> = <a class="code" href="classSimpleDRAM.html#adb38a3e48f39c879fe49ead1cf76ac10">totBusLat</a> / (<a class="code" href="classSimpleDRAM.html#a9f8678c47f9685ef893e06a63e8d66c7">readReqs</a> - <a class="code" href="classSimpleDRAM.html#acbfa17d79d4392737d91a4d490e77008">servicedByWrQ</a>);
<a name="l01113"></a>01113 
<a name="l01114"></a>01114     <a class="code" href="classSimpleDRAM.html#af501d0e7e4cf4dafbbe70e38b7ef9f46">avgMemAccLat</a>
<a name="l01115"></a>01115         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.avgMemAccLat&quot;</span>)
<a name="l01116"></a>01116         .desc(<span class="stringliteral">&quot;Average memory access latency&quot;</span>)
<a name="l01117"></a>01117         .precision(2);
<a name="l01118"></a>01118 
<a name="l01119"></a>01119     <a class="code" href="classSimpleDRAM.html#af501d0e7e4cf4dafbbe70e38b7ef9f46">avgMemAccLat</a> = <a class="code" href="classSimpleDRAM.html#a3104a833ebb8771b71bf978673981df4">totMemAccLat</a> / (<a class="code" href="classSimpleDRAM.html#a9f8678c47f9685ef893e06a63e8d66c7">readReqs</a> - <a class="code" href="classSimpleDRAM.html#acbfa17d79d4392737d91a4d490e77008">servicedByWrQ</a>);
<a name="l01120"></a>01120 
<a name="l01121"></a>01121     <a class="code" href="classSimpleDRAM.html#a01bd5e359149b1a9cdb2de7d2b31ef00">numRdRetry</a>
<a name="l01122"></a>01122         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.numRdRetry&quot;</span>)
<a name="l01123"></a>01123         .desc(<span class="stringliteral">&quot;Number of times rd buffer was full causing retry&quot;</span>);
<a name="l01124"></a>01124 
<a name="l01125"></a>01125     <a class="code" href="classSimpleDRAM.html#a70cd7963b363db2551314a64f363463b">numWrRetry</a>
<a name="l01126"></a>01126         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.numWrRetry&quot;</span>)
<a name="l01127"></a>01127         .desc(<span class="stringliteral">&quot;Number of times wr buffer was full causing retry&quot;</span>);
<a name="l01128"></a>01128 
<a name="l01129"></a>01129     <a class="code" href="classSimpleDRAM.html#a46d78d06ba20a930ca5d445b5157502d">readRowHits</a>
<a name="l01130"></a>01130         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.readRowHits&quot;</span>)
<a name="l01131"></a>01131         .desc(<span class="stringliteral">&quot;Number of row buffer hits during reads&quot;</span>);
<a name="l01132"></a>01132 
<a name="l01133"></a>01133     <a class="code" href="classSimpleDRAM.html#a3a0d7330437cbd682557a72b24d7d70f">writeRowHits</a>
<a name="l01134"></a>01134         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.writeRowHits&quot;</span>)
<a name="l01135"></a>01135         .desc(<span class="stringliteral">&quot;Number of row buffer hits during writes&quot;</span>);
<a name="l01136"></a>01136 
<a name="l01137"></a>01137     <a class="code" href="classSimpleDRAM.html#a186ca7efd278a4475624e6221a8a8cbe">readRowHitRate</a>
<a name="l01138"></a>01138         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.readRowHitRate&quot;</span>)
<a name="l01139"></a>01139         .desc(<span class="stringliteral">&quot;Row buffer hit rate for reads&quot;</span>)
<a name="l01140"></a>01140         .precision(2);
<a name="l01141"></a>01141 
<a name="l01142"></a>01142     <a class="code" href="classSimpleDRAM.html#a186ca7efd278a4475624e6221a8a8cbe">readRowHitRate</a> = (<a class="code" href="classSimpleDRAM.html#a46d78d06ba20a930ca5d445b5157502d">readRowHits</a> / (<a class="code" href="classSimpleDRAM.html#a9f8678c47f9685ef893e06a63e8d66c7">readReqs</a> - <a class="code" href="classSimpleDRAM.html#acbfa17d79d4392737d91a4d490e77008">servicedByWrQ</a>)) * 100;
<a name="l01143"></a>01143 
<a name="l01144"></a>01144     <a class="code" href="classSimpleDRAM.html#aef7455951bbaa92bf46956164b0707bc">writeRowHitRate</a>
<a name="l01145"></a>01145         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.writeRowHitRate&quot;</span>)
<a name="l01146"></a>01146         .desc(<span class="stringliteral">&quot;Row buffer hit rate for writes&quot;</span>)
<a name="l01147"></a>01147         .precision(2);
<a name="l01148"></a>01148 
<a name="l01149"></a>01149     <a class="code" href="classSimpleDRAM.html#aef7455951bbaa92bf46956164b0707bc">writeRowHitRate</a> = (<a class="code" href="classSimpleDRAM.html#a3a0d7330437cbd682557a72b24d7d70f">writeRowHits</a> / <a class="code" href="classSimpleDRAM.html#afe812808d0a071f663e107f9d8ea3ec1">writeReqs</a>) * 100;
<a name="l01150"></a>01150 
<a name="l01151"></a>01151     <a class="code" href="classSimpleDRAM.html#a4bfbc13e98d39c4c30907c498a75268b">readPktSize</a>
<a name="l01152"></a>01152         .<a class="code" href="classStats_1_1VectorBase.html#ada7b4d1605ccdfba6975aa1025b861a2" title="Set this vector to have the given size.">init</a>(<a class="code" href="intmath_8hh.html#a0ec4eaea50888f737b803dc9427614bf">ceilLog2</a>(<a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a>) + 1)
<a name="l01153"></a>01153         .name(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.readPktSize&quot;</span>)
<a name="l01154"></a>01154         .desc(<span class="stringliteral">&quot;Categorize read packet sizes&quot;</span>);
<a name="l01155"></a>01155 
<a name="l01156"></a>01156      <a class="code" href="classSimpleDRAM.html#ac1114b50d0ac6e4979216b14d9e5d267">writePktSize</a>
<a name="l01157"></a>01157         .<a class="code" href="classStats_1_1VectorBase.html#ada7b4d1605ccdfba6975aa1025b861a2" title="Set this vector to have the given size.">init</a>(<a class="code" href="intmath_8hh.html#a0ec4eaea50888f737b803dc9427614bf">ceilLog2</a>(<a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a>) + 1)
<a name="l01158"></a>01158         .name(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.writePktSize&quot;</span>)
<a name="l01159"></a>01159         .desc(<span class="stringliteral">&quot;Categorize write packet sizes&quot;</span>);
<a name="l01160"></a>01160 
<a name="l01161"></a>01161      <a class="code" href="classSimpleDRAM.html#a398c24403923fff12db3a084dbcddbc6">rdQLenPdf</a>
<a name="l01162"></a>01162         .<a class="code" href="classStats_1_1VectorBase.html#ada7b4d1605ccdfba6975aa1025b861a2" title="Set this vector to have the given size.">init</a>(<a class="code" href="classSimpleDRAM.html#a9c2f74f4d1b4f265456240efce92640b">readBufferSize</a>)
<a name="l01163"></a>01163         .name(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.rdQLenPdf&quot;</span>)
<a name="l01164"></a>01164         .desc(<span class="stringliteral">&quot;What read queue length does an incoming req see&quot;</span>);
<a name="l01165"></a>01165 
<a name="l01166"></a>01166      <a class="code" href="classSimpleDRAM.html#a2823472ffc90b6cf3d253c9925f96009">wrQLenPdf</a>
<a name="l01167"></a>01167         .<a class="code" href="classStats_1_1VectorBase.html#ada7b4d1605ccdfba6975aa1025b861a2" title="Set this vector to have the given size.">init</a>(<a class="code" href="classSimpleDRAM.html#a249b9d7a954f943f6f2556a1fe9cb7b7">writeBufferSize</a>)
<a name="l01168"></a>01168         .name(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.wrQLenPdf&quot;</span>)
<a name="l01169"></a>01169         .desc(<span class="stringliteral">&quot;What write queue length does an incoming req see&quot;</span>);
<a name="l01170"></a>01170 
<a name="l01171"></a>01171 
<a name="l01172"></a>01172     <a class="code" href="classSimpleDRAM.html#a26c6b81e5560eb19eec95ccd56d25245" title="Number of total bytes read from this memory.">bytesRead</a>
<a name="l01173"></a>01173         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.bytesRead&quot;</span>)
<a name="l01174"></a>01174         .desc(<span class="stringliteral">&quot;Total number of bytes read from memory&quot;</span>);
<a name="l01175"></a>01175 
<a name="l01176"></a>01176     <a class="code" href="classSimpleDRAM.html#a5d761acdbc052be18565695d2b07cb06" title="Number of bytes written to this memory.">bytesWritten</a>
<a name="l01177"></a>01177         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.bytesWritten&quot;</span>)
<a name="l01178"></a>01178         .desc(<span class="stringliteral">&quot;Total number of bytes written to memory&quot;</span>);
<a name="l01179"></a>01179 
<a name="l01180"></a>01180     <a class="code" href="classSimpleDRAM.html#a81712e0ad4e89e4a615e94f566f1af88">bytesConsumedRd</a>
<a name="l01181"></a>01181         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.bytesConsumedRd&quot;</span>)
<a name="l01182"></a>01182         .desc(<span class="stringliteral">&quot;bytesRead derated as per pkt-&gt;getSize()&quot;</span>);
<a name="l01183"></a>01183 
<a name="l01184"></a>01184     <a class="code" href="classSimpleDRAM.html#a78ca6a8ffac2ade6a2404321346d7fbc">bytesConsumedWr</a>
<a name="l01185"></a>01185         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.bytesConsumedWr&quot;</span>)
<a name="l01186"></a>01186         .desc(<span class="stringliteral">&quot;bytesWritten derated as per pkt-&gt;getSize()&quot;</span>);
<a name="l01187"></a>01187 
<a name="l01188"></a>01188     <a class="code" href="classSimpleDRAM.html#aff2632773e1c6fe3b351297773c1a113">avgRdBW</a>
<a name="l01189"></a>01189         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.avgRdBW&quot;</span>)
<a name="l01190"></a>01190         .desc(<span class="stringliteral">&quot;Average achieved read bandwidth in MB/s&quot;</span>)
<a name="l01191"></a>01191         .precision(2);
<a name="l01192"></a>01192 
<a name="l01193"></a>01193     <a class="code" href="classSimpleDRAM.html#aff2632773e1c6fe3b351297773c1a113">avgRdBW</a> = (<a class="code" href="classSimpleDRAM.html#a26c6b81e5560eb19eec95ccd56d25245" title="Number of total bytes read from this memory.">bytesRead</a> / 1000000) / <a class="code" href="stat__control_8cc.html#aaad77dbb4162ef5a66c24dcd1ce256d0">simSeconds</a>;
<a name="l01194"></a>01194 
<a name="l01195"></a>01195     <a class="code" href="classSimpleDRAM.html#ada178492672dee2a45a405971e19e50d">avgWrBW</a>
<a name="l01196"></a>01196         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.avgWrBW&quot;</span>)
<a name="l01197"></a>01197         .desc(<span class="stringliteral">&quot;Average achieved write bandwidth in MB/s&quot;</span>)
<a name="l01198"></a>01198         .precision(2);
<a name="l01199"></a>01199 
<a name="l01200"></a>01200     <a class="code" href="classSimpleDRAM.html#ada178492672dee2a45a405971e19e50d">avgWrBW</a> = (<a class="code" href="classSimpleDRAM.html#a5d761acdbc052be18565695d2b07cb06" title="Number of bytes written to this memory.">bytesWritten</a> / 1000000) / <a class="code" href="stat__control_8cc.html#aaad77dbb4162ef5a66c24dcd1ce256d0">simSeconds</a>;
<a name="l01201"></a>01201 
<a name="l01202"></a>01202     <a class="code" href="classSimpleDRAM.html#ab8fc374c6e1ad2fc00d0ef45aebd3149">avgConsumedRdBW</a>
<a name="l01203"></a>01203         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.avgConsumedRdBW&quot;</span>)
<a name="l01204"></a>01204         .desc(<span class="stringliteral">&quot;Average consumed read bandwidth in MB/s&quot;</span>)
<a name="l01205"></a>01205         .precision(2);
<a name="l01206"></a>01206 
<a name="l01207"></a>01207     <a class="code" href="classSimpleDRAM.html#ab8fc374c6e1ad2fc00d0ef45aebd3149">avgConsumedRdBW</a> = (<a class="code" href="classSimpleDRAM.html#a81712e0ad4e89e4a615e94f566f1af88">bytesConsumedRd</a> / 1000000) / <a class="code" href="stat__control_8cc.html#aaad77dbb4162ef5a66c24dcd1ce256d0">simSeconds</a>;
<a name="l01208"></a>01208 
<a name="l01209"></a>01209     <a class="code" href="classSimpleDRAM.html#ac17c17046b82622fba2e3a138dad7f75">avgConsumedWrBW</a>
<a name="l01210"></a>01210         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.avgConsumedWrBW&quot;</span>)
<a name="l01211"></a>01211         .desc(<span class="stringliteral">&quot;Average consumed write bandwidth in MB/s&quot;</span>)
<a name="l01212"></a>01212         .precision(2);
<a name="l01213"></a>01213 
<a name="l01214"></a>01214     <a class="code" href="classSimpleDRAM.html#ac17c17046b82622fba2e3a138dad7f75">avgConsumedWrBW</a> = (<a class="code" href="classSimpleDRAM.html#a78ca6a8ffac2ade6a2404321346d7fbc">bytesConsumedWr</a> / 1000000) / <a class="code" href="stat__control_8cc.html#aaad77dbb4162ef5a66c24dcd1ce256d0">simSeconds</a>;
<a name="l01215"></a>01215 
<a name="l01216"></a>01216     <a class="code" href="classSimpleDRAM.html#adeeee11c6133b30ce3ed033c44559a3f">peakBW</a>
<a name="l01217"></a>01217         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.peakBW&quot;</span>)
<a name="l01218"></a>01218         .desc(<span class="stringliteral">&quot;Theoretical peak bandwidth in MB/s&quot;</span>)
<a name="l01219"></a>01219         .precision(2);
<a name="l01220"></a>01220 
<a name="l01221"></a>01221     <a class="code" href="classSimpleDRAM.html#adeeee11c6133b30ce3ed033c44559a3f">peakBW</a> = (<a class="code" href="namespaceSimClock.html#a3e914c4cb1e00a7287962713e374d17a" title="The simulated frequency of curTick(). (In ticks per second).">SimClock::Frequency</a> / <a class="code" href="classSimpleDRAM.html#a381ed669fde257c0afa5a2beed3f424c">tBURST</a>) * <a class="code" href="classSimpleDRAM.html#a935ef3ac66156b7e9fd019f66459b8b7" title="The following are basic design parameters of the memory controller, and are initialized based on para...">bytesPerCacheLine</a> / 1000000;
<a name="l01222"></a>01222 
<a name="l01223"></a>01223     <a class="code" href="classSimpleDRAM.html#a2925b5b4e0c6cbe17b7a59a80c6606a0">busUtil</a>
<a name="l01224"></a>01224         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.busUtil&quot;</span>)
<a name="l01225"></a>01225         .desc(<span class="stringliteral">&quot;Data bus utilization in percentage&quot;</span>)
<a name="l01226"></a>01226         .precision(2);
<a name="l01227"></a>01227 
<a name="l01228"></a>01228     <a class="code" href="classSimpleDRAM.html#a2925b5b4e0c6cbe17b7a59a80c6606a0">busUtil</a> = (<a class="code" href="classSimpleDRAM.html#aff2632773e1c6fe3b351297773c1a113">avgRdBW</a> + <a class="code" href="classSimpleDRAM.html#ada178492672dee2a45a405971e19e50d">avgWrBW</a>) / <a class="code" href="classSimpleDRAM.html#adeeee11c6133b30ce3ed033c44559a3f">peakBW</a> * 100;
<a name="l01229"></a>01229 
<a name="l01230"></a>01230     <a class="code" href="classSimpleDRAM.html#af5d5975cd57903602b400d816de1ebf8">totGap</a>
<a name="l01231"></a>01231         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.totGap&quot;</span>)
<a name="l01232"></a>01232         .desc(<span class="stringliteral">&quot;Total gap between requests&quot;</span>);
<a name="l01233"></a>01233 
<a name="l01234"></a>01234     <a class="code" href="classSimpleDRAM.html#a537e029c6daada7f00a7ce5e203f57de">avgGap</a>
<a name="l01235"></a>01235         .<a class="code" href="classStats_1_1DataWrap.html#a8f6effeadf113613c8e96c732bef7228" title="Set the name and marks this stat to print at the end of simulation.">name</a>(<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>() + <span class="stringliteral">&quot;.avgGap&quot;</span>)
<a name="l01236"></a>01236         .desc(<span class="stringliteral">&quot;Average gap between requests&quot;</span>)
<a name="l01237"></a>01237         .precision(2);
<a name="l01238"></a>01238 
<a name="l01239"></a>01239     <a class="code" href="classSimpleDRAM.html#a537e029c6daada7f00a7ce5e203f57de">avgGap</a> = <a class="code" href="classSimpleDRAM.html#af5d5975cd57903602b400d816de1ebf8">totGap</a> / (<a class="code" href="classSimpleDRAM.html#a9f8678c47f9685ef893e06a63e8d66c7">readReqs</a> + <a class="code" href="classSimpleDRAM.html#afe812808d0a071f663e107f9d8ea3ec1">writeReqs</a>);
<a name="l01240"></a>01240 }
<a name="l01241"></a>01241 
<a name="l01242"></a>01242 <span class="keywordtype">void</span>
<a name="l01243"></a><a class="code" href="classSimpleDRAM.html#ae2475e535edc9fd579a8037390edfdbd">01243</a> <a class="code" href="classSimpleDRAM.html#ae2475e535edc9fd579a8037390edfdbd">SimpleDRAM::recvFunctional</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt)
<a name="l01244"></a>01244 {
<a name="l01245"></a>01245     <span class="comment">// rely on the abstract memory</span>
<a name="l01246"></a>01246     <a class="code" href="classAbstractMemory.html#acb2ca48dbe8f541907b3827feeb292d5" title="Perform an untimed memory read or write without changing anything but the memory itself.">functionalAccess</a>(pkt);
<a name="l01247"></a>01247 }
<a name="l01248"></a>01248 
<a name="l01249"></a>01249 <a class="code" href="classBaseSlavePort.html" title="A BaseSlavePort is a protocol-agnostic slave port, responsible only for the structural connection to ...">BaseSlavePort</a>&amp;
<a name="l01250"></a>01250 <a class="code" href="classSimpleDRAM.html#a08e88562837a2db58a44ffefd90656a7" title="Get a slave port with a given name and index.">SimpleDRAM::getSlavePort</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;if_name, <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e" title="Port index/ID type, and a symbolic name for an invalid port id.">PortID</a> idx)
<a name="l01251"></a>01251 {
<a name="l01252"></a>01252     <span class="keywordflow">if</span> (if_name != <span class="stringliteral">&quot;port&quot;</span>) {
<a name="l01253"></a>01253         <span class="keywordflow">return</span> <a class="code" href="classSimpleDRAM.html#a08e88562837a2db58a44ffefd90656a7" title="Get a slave port with a given name and index.">MemObject::getSlavePort</a>(if_name, idx);
<a name="l01254"></a>01254     } <span class="keywordflow">else</span> {
<a name="l01255"></a>01255         <span class="keywordflow">return</span> <a class="code" href="classSimpleDRAM.html#aa90269cc4d8251534062632d549fea1f" title="Our incoming port, for a multi-ported controller add a crossbar in front of it.">port</a>;
<a name="l01256"></a>01256     }
<a name="l01257"></a>01257 }
<a name="l01258"></a>01258 
<a name="l01259"></a>01259 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l01260"></a><a class="code" href="classSimpleDRAM.html#a810ad0d9365d52f212f236b2634ea637">01260</a> <a class="code" href="classSimpleDRAM.html#a810ad0d9365d52f212f236b2634ea637" title="Provide a default implementation of the drain interface that simply returns 0 (draining completed) an...">SimpleDRAM::drain</a>(<a class="code" href="classDrainManager.html" title="This class coordinates draining of a System.">DrainManager</a> *<a class="code" href="namespaceMipsISA.html#afed89bf85db8c823833a4921f0b24ac8">dm</a>)
<a name="l01261"></a>01261 {
<a name="l01262"></a>01262     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#a749793fafee6c9c40af6247a89e054ac">count</a> = <a class="code" href="classSimpleDRAM.html#aa90269cc4d8251534062632d549fea1f" title="Our incoming port, for a multi-ported controller add a crossbar in front of it.">port</a>.<a class="code" href="classQueuedSlavePort.html#a86b3526181124e25a7f42c1c2027d1ec">drain</a>(dm);
<a name="l01263"></a>01263 
<a name="l01264"></a>01264     <span class="comment">// if there is anything in any of our internal queues, keep track</span>
<a name="l01265"></a>01265     <span class="comment">// of that as well</span>
<a name="l01266"></a>01266     <span class="keywordflow">if</span> (!(<a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.empty() &amp;&amp; <a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.empty() &amp;&amp;
<a name="l01267"></a>01267           <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.empty())) {
<a name="l01268"></a>01268         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Drain, <span class="stringliteral">&quot;DRAM controller not drained, write: %d, read: %d,&quot;</span>
<a name="l01269"></a>01269                 <span class="stringliteral">&quot; resp: %d\n&quot;</span>, <a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.size(), <a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.size(),
<a name="l01270"></a>01270                 <a class="code" href="classSimpleDRAM.html#a97c14c5a40066f5315521b08489e091b" title="Response queue where read packets wait after we&amp;#39;re done working with them, but it&amp;#39;s not time ...">respQueue</a>.size());
<a name="l01271"></a>01271         ++count;
<a name="l01272"></a>01272         <a class="code" href="classSimpleDRAM.html#a7f19a31acafa04e74429afc8d193417a" title="If we need to drain, keep the drain manager around until we&amp;#39;re done here.">drainManager</a> = dm;
<a name="l01273"></a>01273         <span class="comment">// the only part that is not drained automatically over time</span>
<a name="l01274"></a>01274         <span class="comment">// is the write queue, thus trigger writes if there are any</span>
<a name="l01275"></a>01275         <span class="comment">// waiting and no reads waiting, otherwise wait until the</span>
<a name="l01276"></a>01276         <span class="comment">// reads are done</span>
<a name="l01277"></a>01277         <span class="keywordflow">if</span> (<a class="code" href="classSimpleDRAM.html#adccc7859b0db2f31ddd5a55a63c3e7eb" title="The controller&amp;#39;s main read and write queues.">readQueue</a>.empty() &amp;&amp; !<a class="code" href="classSimpleDRAM.html#aec55c79bf91b2f2a8e57b3735b0d16ad">writeQueue</a>.empty() &amp;&amp;
<a name="l01278"></a>01278             !<a class="code" href="classSimpleDRAM.html#a75cd7692e5fd260e2199db5778455050">writeEvent</a>.<a class="code" href="classEvent.html#a36bdc2ee73215ed7670a7bfc0f25ab8b" title="Determine if the current event is scheduled.">scheduled</a>())
<a name="l01279"></a>01279             <a class="code" href="classSimpleDRAM.html#ade766fbbdfe2c5158da38cd60517f5c0" title="Check when the channel is free to turnaround, add turnaround delay and schedule a whole bunch of writ...">triggerWrites</a>();
<a name="l01280"></a>01280     }
<a name="l01281"></a>01281 
<a name="l01282"></a>01282     <span class="keywordflow">if</span> (count)
<a name="l01283"></a>01283         <a class="code" href="classDrainable.html#afce7a34e1fcacc71267a947a3feb941b">setDrainState</a>(<a class="code" href="classDrainable.html#a6173416423af6af1bfe17262be40b5ffabd11bb9d2e9941029e08925c2a151162" title="Running normally.">Drainable::Draining</a>);
<a name="l01284"></a>01284     <span class="keywordflow">else</span>
<a name="l01285"></a>01285         <a class="code" href="classDrainable.html#afce7a34e1fcacc71267a947a3feb941b">setDrainState</a>(<a class="code" href="classDrainable.html#a6173416423af6af1bfe17262be40b5ffad08d746efca2f68aeb28f73f94237603" title="Draining buffers pending serialization/handover.">Drainable::Drained</a>);
<a name="l01286"></a>01286     <span class="keywordflow">return</span> count;
<a name="l01287"></a>01287 }
<a name="l01288"></a>01288 
<a name="l01289"></a><a class="code" href="classSimpleDRAM_1_1MemoryPort.html#ae300cbd14479fe232d88d6688476ffb5">01289</a> <a class="code" href="classSimpleDRAM_1_1MemoryPort.html#ae300cbd14479fe232d88d6688476ffb5">SimpleDRAM::MemoryPort::MemoryPort</a>(<span class="keyword">const</span> std::string&amp; <a class="code" href="trace_8hh.html#a166fa10b86d8faa127fb7c78191e3e60">name</a>, <a class="code" href="classSimpleDRAM.html" title="The simple DRAM is a basic single-channel memory controller aiming to mimic a high-level DRAM control...">SimpleDRAM</a>&amp; _memory)
<a name="l01290"></a>01290     : <a class="code" href="classQueuedSlavePort.html" title="A queued port is a port that has an infinite queue for outgoing packets and thus decouples the module...">QueuedSlavePort</a>(name, &amp;_memory, queue), queue(_memory, *this),
<a name="l01291"></a>01291       memory(_memory)
<a name="l01292"></a>01292 { }
<a name="l01293"></a>01293 
<a name="l01294"></a>01294 <a class="code" href="classstd_1_1list.html">AddrRangeList</a>
<a name="l01295"></a><a class="code" href="classSimpleDRAM_1_1MemoryPort.html#a1f27f9a22506a6025555bcce39bd1b25">01295</a> <a class="code" href="classSimpleDRAM_1_1MemoryPort.html#a1f27f9a22506a6025555bcce39bd1b25" title="Get a list of the non-overlapping address ranges the owner is responsible for.">SimpleDRAM::MemoryPort::getAddrRanges</a>()<span class="keyword"> const</span>
<a name="l01296"></a>01296 <span class="keyword"></span>{
<a name="l01297"></a>01297     <a class="code" href="classstd_1_1list.html">AddrRangeList</a> ranges;
<a name="l01298"></a>01298     ranges.push_back(<a class="code" href="classSimpleDRAM_1_1MemoryPort.html#aefa51f77c55267b6024b24c921b05360">memory</a>.<a class="code" href="classAbstractMemory.html#a8cc7718cf94a14b1bad6ae24d7859cd8" title="Get the address range.">getAddrRange</a>());
<a name="l01299"></a>01299     <span class="keywordflow">return</span> ranges;
<a name="l01300"></a>01300 }
<a name="l01301"></a>01301 
<a name="l01302"></a>01302 <span class="keywordtype">void</span>
<a name="l01303"></a><a class="code" href="classSimpleDRAM_1_1MemoryPort.html#a0432107dcbdabcf04862238c9df22672">01303</a> <a class="code" href="classSimpleDRAM.html#ae2475e535edc9fd579a8037390edfdbd">SimpleDRAM::MemoryPort::recvFunctional</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt)
<a name="l01304"></a>01304 {
<a name="l01305"></a>01305     pkt-&gt;<a class="code" href="classPacket.html#abf1a177ee6ddce59da49869cfeecc7bc" title="Push label for PrintReq (safe to call unconditionally).">pushLabel</a>(<a class="code" href="classSimpleDRAM_1_1MemoryPort.html#aefa51f77c55267b6024b24c921b05360">memory</a>.<a class="code" href="classSimObject.html#a96c36bff06d98deb79d09e93652667ae">name</a>());
<a name="l01306"></a>01306 
<a name="l01307"></a>01307     <span class="keywordflow">if</span> (!<a class="code" href="classSimpleDRAM_1_1MemoryPort.html#af481b31eb9e672dffcad7c55a4ee2c76" title="Packet queue used to store outgoing requests and responses.">queue</a>.<a class="code" href="classPacketQueue.html#a231440b37742d6f80eef490016020c5d" title="Check the list of buffered packets against the supplied functional request.">checkFunctional</a>(pkt)) {
<a name="l01308"></a>01308         <span class="comment">// Default implementation of SimpleTimingPort::recvFunctional()</span>
<a name="l01309"></a>01309         <span class="comment">// calls recvAtomic() and throws away the latency; we can save a</span>
<a name="l01310"></a>01310         <span class="comment">// little here by just not calculating the latency.</span>
<a name="l01311"></a>01311         <a class="code" href="classSimpleDRAM_1_1MemoryPort.html#aefa51f77c55267b6024b24c921b05360">memory</a>.<a class="code" href="classSimpleDRAM.html#ae2475e535edc9fd579a8037390edfdbd">recvFunctional</a>(pkt);
<a name="l01312"></a>01312     }
<a name="l01313"></a>01313 
<a name="l01314"></a>01314     pkt-&gt;<a class="code" href="classPacket.html#ad28d4bd566aee12a370dc9180e064bea" title="Pop label for PrintReq (safe to call unconditionally).">popLabel</a>();
<a name="l01315"></a>01315 }
<a name="l01316"></a>01316 
<a name="l01317"></a>01317 <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643" title="Tick count type.">Tick</a>
<a name="l01318"></a><a class="code" href="classSimpleDRAM_1_1MemoryPort.html#a1c266e6e1ddd9dc70c3c258327833b9b">01318</a> <a class="code" href="classSimpleDRAM.html#a660f4b4c86708c1acf4cba0593362aaa">SimpleDRAM::MemoryPort::recvAtomic</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt)
<a name="l01319"></a>01319 {
<a name="l01320"></a>01320     <span class="keywordflow">return</span> <a class="code" href="classSimpleDRAM_1_1MemoryPort.html#aefa51f77c55267b6024b24c921b05360">memory</a>.<a class="code" href="classSimpleDRAM.html#a660f4b4c86708c1acf4cba0593362aaa">recvAtomic</a>(pkt);
<a name="l01321"></a>01321 }
<a name="l01322"></a>01322 
<a name="l01323"></a>01323 <span class="keywordtype">bool</span>
<a name="l01324"></a><a class="code" href="classSimpleDRAM_1_1MemoryPort.html#ac6cf1b4778c93bdd0266a981cb67b109">01324</a> <a class="code" href="classSimpleDRAM.html#a98f08912f834f5cf6b6a9b3c0500c9ee">SimpleDRAM::MemoryPort::recvTimingReq</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt)
<a name="l01325"></a>01325 {
<a name="l01326"></a>01326     <span class="comment">// pass it to the memory controller</span>
<a name="l01327"></a>01327     <span class="keywordflow">return</span> <a class="code" href="classSimpleDRAM_1_1MemoryPort.html#aefa51f77c55267b6024b24c921b05360">memory</a>.<a class="code" href="classSimpleDRAM.html#a98f08912f834f5cf6b6a9b3c0500c9ee">recvTimingReq</a>(pkt);
<a name="l01328"></a>01328 }
<a name="l01329"></a>01329 
<a name="l01330"></a>01330 <a class="code" href="classSimpleDRAM.html" title="The simple DRAM is a basic single-channel memory controller aiming to mimic a high-level DRAM control...">SimpleDRAM</a>*
<a name="l01331"></a>01331 <a class="code" href="classSerializable.html#a68726f5d7b8d0ed986338a2d09cdf720">SimpleDRAMParams::create</a>()
<a name="l01332"></a>01332 {
<a name="l01333"></a>01333     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classSimpleDRAM.html#a5aded1bfa310510d0f2e0164f8ffefa5">SimpleDRAM</a>(<span class="keyword">this</span>);
<a name="l01334"></a>01334 }
</pre></div></div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"><address style="align: right;"><small>
Generated on Sun Apr 7 2013 18:16:51 for gem5 by <a href="http://www.doxygen.org/index.html"> doxygen</a> 1.7.1</small></address>

</body>
</html>
