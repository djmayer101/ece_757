<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>gem5: arch/arm/table_walker.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>arch/arm/table_walker.cc</h1>  </div>
</div>
<div class="contents">
<a href="table__walker_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2010 ARM Limited</span>
<a name="l00003"></a>00003 <span class="comment"> * All rights reserved</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * The license below extends only to copyright in the software and shall</span>
<a name="l00006"></a>00006 <span class="comment"> * not be construed as granting a license to any other intellectual</span>
<a name="l00007"></a>00007 <span class="comment"> * property including but not limited to intellectual property relating</span>
<a name="l00008"></a>00008 <span class="comment"> * to a hardware implementation of the functionality of the software</span>
<a name="l00009"></a>00009 <span class="comment"> * licensed hereunder.  You may use the software subject to the license</span>
<a name="l00010"></a>00010 <span class="comment"> * terms below provided that you ensure that this notice is replicated</span>
<a name="l00011"></a>00011 <span class="comment"> * unmodified and in its entirety in all distributions of the software,</span>
<a name="l00012"></a>00012 <span class="comment"> * modified or unmodified, in source code or in binary form.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00015"></a>00015 <span class="comment"> * modification, are permitted provided that the following conditions are</span>
<a name="l00016"></a>00016 <span class="comment"> * met: redistributions of source code must retain the above copyright</span>
<a name="l00017"></a>00017 <span class="comment"> * notice, this list of conditions and the following disclaimer;</span>
<a name="l00018"></a>00018 <span class="comment"> * redistributions in binary form must reproduce the above copyright</span>
<a name="l00019"></a>00019 <span class="comment"> * notice, this list of conditions and the following disclaimer in the</span>
<a name="l00020"></a>00020 <span class="comment"> * documentation and/or other materials provided with the distribution;</span>
<a name="l00021"></a>00021 <span class="comment"> * neither the name of the copyright holders nor the names of its</span>
<a name="l00022"></a>00022 <span class="comment"> * contributors may be used to endorse or promote products derived from</span>
<a name="l00023"></a>00023 <span class="comment"> * this software without specific prior written permission.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00026"></a>00026 <span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00027"></a>00027 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00028"></a>00028 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00029"></a>00029 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00030"></a>00030 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00031"></a>00031 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00032"></a>00032 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00033"></a>00033 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00034"></a>00034 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00035"></a>00035 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00036"></a>00036 <span class="comment"> *</span>
<a name="l00037"></a>00037 <span class="comment"> * Authors: Ali Saidi</span>
<a name="l00038"></a>00038 <span class="comment"> */</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="arch_2arm_2faults_8hh.html">arch/arm/faults.hh</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="table__walker_8hh.html">arch/arm/table_walker.hh</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="arch_2arm_2tlb_8hh.html">arch/arm/tlb.hh</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="cpu_2base_8hh.html">cpu/base.hh</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="thread__context_8hh.html">cpu/thread_context.hh</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;debug/Checkpoint.hh&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;debug/Drain.hh&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;debug/TLB.hh&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;debug/TLBVerbose.hh&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="sim_2system_8hh.html">sim/system.hh</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="keyword">using namespace </span>ArmISA;
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="classArmISA_1_1TableWalker.html#a02cd4b4e18665ec3040b85b14909f188">00053</a> <a class="code" href="classArmISA_1_1TableWalker.html#a02cd4b4e18665ec3040b85b14909f188">TableWalker::TableWalker</a>(<span class="keyword">const</span> <a class="code" href="classArmISA_1_1TableWalker.html#a3b2be5104d208dfc88c665a809daffbd">Params</a> *<a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>)
<a name="l00054"></a>00054     : <a class="code" href="classMemObject.html" title="The MemObject class extends the ClockedObject with accessor functions to get its master and slave por...">MemObject</a>(p), port(this, params()-&gt;sys), drainManager(NULL),
<a name="l00055"></a>00055       tlb(NULL), currState(NULL), pending(false),
<a name="l00056"></a>00056       masterId(p-&gt;sys-&gt;getMasterId(<a class="code" href="trace_8hh.html#a166fa10b86d8faa127fb7c78191e3e60">name</a>())),
<a name="l00057"></a>00057       numSquashable(p-&gt;num_squash_per_cycle),
<a name="l00058"></a>00058       doL1DescEvent(this), doL2DescEvent(this), doProcessEvent(this)
<a name="l00059"></a>00059 {
<a name="l00060"></a>00060     <a class="code" href="classArmISA_1_1TableWalker.html#ab9278936d08e5d5f5c1c665381cffdfa" title="Cached copy of the sctlr as it existed when translation began.">sctlr</a> = 0;
<a name="l00061"></a>00061 }
<a name="l00062"></a>00062 
<a name="l00063"></a><a class="code" href="classArmISA_1_1TableWalker.html#a3ca683e66e9e7eb272f7bd8ee352ae9e">00063</a> <a class="code" href="classArmISA_1_1TableWalker.html#a3ca683e66e9e7eb272f7bd8ee352ae9e">TableWalker::~TableWalker</a>()
<a name="l00064"></a>00064 {
<a name="l00065"></a>00065     ;
<a name="l00066"></a>00066 }
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="keywordtype">void</span>
<a name="l00069"></a><a class="code" href="classArmISA_1_1TableWalker.html#acdaa6d4fc9977fca69259dae4c2bc231">00069</a> <a class="code" href="classArmISA_1_1TableWalker.html#acdaa6d4fc9977fca69259dae4c2bc231" title="Checks if all state is cleared and if so, completes drain.">TableWalker::completeDrain</a>()
<a name="l00070"></a>00070 {
<a name="l00071"></a>00071     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a37311bb24ffdd4debc5cf6eb93a5154f" title="If we&amp;#39;re draining keep the drain event around until we&amp;#39;re drained.">drainManager</a> &amp;&amp; <a class="code" href="classArmISA_1_1TableWalker.html#a0e4b6ea16cbb0abdc3e0aa26f9abd196" title="Queue of requests that need processing first level translation.">stateQueueL1</a>.empty() &amp;&amp; <a class="code" href="classArmISA_1_1TableWalker.html#a0872d112c40a4f8c916d1347610d9b7e" title="Queue of requests that have passed first level translation and require an additional level...">stateQueueL2</a>.empty() &amp;&amp;
<a name="l00072"></a>00072         <a class="code" href="classArmISA_1_1TableWalker.html#a1d69cdeafea580d10df3404277dadb34" title="Queue of requests that have passed are waiting because the walker is currently busy.">pendingQueue</a>.empty()) {
<a name="l00073"></a>00073         <a class="code" href="classDrainable.html#afce7a34e1fcacc71267a947a3feb941b">setDrainState</a>(<a class="code" href="classDrainable.html#a6173416423af6af1bfe17262be40b5ffad08d746efca2f68aeb28f73f94237603" title="Draining buffers pending serialization/handover.">Drainable::Drained</a>);
<a name="l00074"></a>00074         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Drain, <span class="stringliteral">&quot;TableWalker done draining, processing drain event\n&quot;</span>);
<a name="l00075"></a>00075         <a class="code" href="classArmISA_1_1TableWalker.html#a37311bb24ffdd4debc5cf6eb93a5154f" title="If we&amp;#39;re draining keep the drain event around until we&amp;#39;re drained.">drainManager</a>-&gt;<a class="code" href="classDrainManager.html#abd134e8277be09e702b63f36f6ee31d0" title="Notify the DrainManager that a Drainable object has finished draining.">signalDrainDone</a>();
<a name="l00076"></a>00076         <a class="code" href="classArmISA_1_1TableWalker.html#a37311bb24ffdd4debc5cf6eb93a5154f" title="If we&amp;#39;re draining keep the drain event around until we&amp;#39;re drained.">drainManager</a> = NULL;
<a name="l00077"></a>00077     }
<a name="l00078"></a>00078 }
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00081"></a><a class="code" href="classArmISA_1_1TableWalker.html#a27f379100b5713f9ccc49b3680dcc68f">00081</a> <a class="code" href="classArmISA_1_1TableWalker.html#a27f379100b5713f9ccc49b3680dcc68f" title="Provide a default implementation of the drain interface that simply returns 0 (draining completed) an...">TableWalker::drain</a>(<a class="code" href="classDrainManager.html" title="This class coordinates draining of a System.">DrainManager</a> *<a class="code" href="namespaceMipsISA.html#afed89bf85db8c823833a4921f0b24ac8">dm</a>)
<a name="l00082"></a>00082 {
<a name="l00083"></a>00083     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#a749793fafee6c9c40af6247a89e054ac">count</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a4fed328b3a8f0218a10135c43c305923" title="Port to issue translation requests from.">port</a>.<a class="code" href="classDmaPort.html#a4b32fa5eddee7eab3af628f9504aa3de">drain</a>(dm);
<a name="l00084"></a>00084 
<a name="l00085"></a>00085     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a0e4b6ea16cbb0abdc3e0aa26f9abd196" title="Queue of requests that need processing first level translation.">stateQueueL1</a>.empty() &amp;&amp; <a class="code" href="classArmISA_1_1TableWalker.html#a0872d112c40a4f8c916d1347610d9b7e" title="Queue of requests that have passed first level translation and require an additional level...">stateQueueL2</a>.empty() &amp;&amp;
<a name="l00086"></a>00086         <a class="code" href="classArmISA_1_1TableWalker.html#a1d69cdeafea580d10df3404277dadb34" title="Queue of requests that have passed are waiting because the walker is currently busy.">pendingQueue</a>.empty()) {
<a name="l00087"></a>00087         <a class="code" href="classDrainable.html#afce7a34e1fcacc71267a947a3feb941b">setDrainState</a>(<a class="code" href="classDrainable.html#a6173416423af6af1bfe17262be40b5ffad08d746efca2f68aeb28f73f94237603" title="Draining buffers pending serialization/handover.">Drainable::Drained</a>);
<a name="l00088"></a>00088         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Drain, <span class="stringliteral">&quot;TableWalker free, no need to drain\n&quot;</span>);
<a name="l00089"></a>00089 
<a name="l00090"></a>00090         <span class="comment">// table walker is drained, but its ports may still need to be drained</span>
<a name="l00091"></a>00091         <span class="keywordflow">return</span> count;
<a name="l00092"></a>00092     } <span class="keywordflow">else</span> {
<a name="l00093"></a>00093         <a class="code" href="classArmISA_1_1TableWalker.html#a37311bb24ffdd4debc5cf6eb93a5154f" title="If we&amp;#39;re draining keep the drain event around until we&amp;#39;re drained.">drainManager</a> = dm;
<a name="l00094"></a>00094         <a class="code" href="classDrainable.html#afce7a34e1fcacc71267a947a3feb941b">setDrainState</a>(<a class="code" href="classDrainable.html#a6173416423af6af1bfe17262be40b5ffabd11bb9d2e9941029e08925c2a151162" title="Running normally.">Drainable::Draining</a>);
<a name="l00095"></a>00095         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Drain, <span class="stringliteral">&quot;TableWalker not drained\n&quot;</span>);
<a name="l00096"></a>00096 
<a name="l00097"></a>00097         <span class="comment">// return port drain count plus the table walker itself needs to drain</span>
<a name="l00098"></a>00098         <span class="keywordflow">return</span> count + 1;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100     }
<a name="l00101"></a>00101 }
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="keywordtype">void</span>
<a name="l00104"></a><a class="code" href="classArmISA_1_1TableWalker.html#adcb443adaf08ad0f617d82ea1cfb7b13">00104</a> <a class="code" href="classArmISA_1_1TableWalker.html#adcb443adaf08ad0f617d82ea1cfb7b13" title="Resume execution after a successful drain.">TableWalker::drainResume</a>()
<a name="l00105"></a>00105 {
<a name="l00106"></a>00106     <a class="code" href="classArmISA_1_1TableWalker.html#adcb443adaf08ad0f617d82ea1cfb7b13" title="Resume execution after a successful drain.">Drainable::drainResume</a>();
<a name="l00107"></a>00107     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#af51fb6dbf8bd65a03ee99295e3e88e5a">params</a>()-&gt;sys-&gt;isTimingMode() &amp;&amp; <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>) {
<a name="l00108"></a>00108         <span class="keyword">delete</span> <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>;
<a name="l00109"></a>00109         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a> = NULL;
<a name="l00110"></a>00110     }
<a name="l00111"></a>00111 }
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 <a class="code" href="classBaseMasterPort.html" title="A BaseMasterPort is a protocol-agnostic master port, responsible only for the structural connection t...">BaseMasterPort</a>&amp;
<a name="l00114"></a><a class="code" href="classArmISA_1_1TableWalker.html#a6309d0630a4780981a86ef64e6e38d5a">00114</a> <a class="code" href="classArmISA_1_1TableWalker.html#a6309d0630a4780981a86ef64e6e38d5a" title="Get a master port with a given name and index.">TableWalker::getMasterPort</a>(<span class="keyword">const</span> std::string &amp;if_name, <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e" title="Port index/ID type, and a symbolic name for an invalid port id.">PortID</a> idx)
<a name="l00115"></a>00115 {
<a name="l00116"></a>00116     <span class="keywordflow">if</span> (if_name == <span class="stringliteral">&quot;port&quot;</span>) {
<a name="l00117"></a>00117         <span class="keywordflow">return</span> <a class="code" href="classArmISA_1_1TableWalker.html#a4fed328b3a8f0218a10135c43c305923" title="Port to issue translation requests from.">port</a>;
<a name="l00118"></a>00118     }
<a name="l00119"></a>00119     <span class="keywordflow">return</span> <a class="code" href="classArmISA_1_1TableWalker.html#a6309d0630a4780981a86ef64e6e38d5a" title="Get a master port with a given name and index.">MemObject::getMasterPort</a>(if_name, idx);
<a name="l00120"></a>00120 }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <a class="code" href="classRefCountingPtr.html">Fault</a>
<a name="l00123"></a><a class="code" href="classArmISA_1_1TableWalker.html#a4ffb799a82b7f43404997776e3a80d5f">00123</a> <a class="code" href="classArmISA_1_1TableWalker.html#a4ffb799a82b7f43404997776e3a80d5f">TableWalker::walk</a>(<a class="code" href="classRequest.html">RequestPtr</a> _req, <a class="code" href="classThreadContext.html" title="ThreadContext is the external interface to all thread state for anything outside of the CPU...">ThreadContext</a> *_tc, uint8_t _cid, <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585e">TLB::Mode</a> _mode,
<a name="l00124"></a>00124             <a class="code" href="classBaseTLB_1_1Translation.html">TLB::Translation</a> *_trans, <span class="keywordtype">bool</span> _timing, <span class="keywordtype">bool</span> _functional)
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126     assert(!(_functional &amp;&amp; _timing));
<a name="l00127"></a>00127     <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>) {
<a name="l00128"></a>00128         <span class="comment">// For atomic mode, a new WalkerState instance should be only created</span>
<a name="l00129"></a>00129         <span class="comment">// once per TLB. For timing mode, a new instance is generated for every</span>
<a name="l00130"></a>00130         <span class="comment">// TLB miss.</span>
<a name="l00131"></a>00131         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;creating new instance of WalkerState\n&quot;</span>);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a> = <span class="keyword">new</span> <a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html">WalkerState</a>();
<a name="l00134"></a>00134         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#af33df964bfcd262756a6506d04c83f0f">tableWalker</a> = <span class="keyword">this</span>;
<a name="l00135"></a>00135     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (_timing) {
<a name="l00136"></a>00136         <span class="comment">// This is a translation that was completed and then faulted again</span>
<a name="l00137"></a>00137         <span class="comment">// because some underlying parameters that affect the translation</span>
<a name="l00138"></a>00138         <span class="comment">// changed out from under us (e.g. asid). It will either be a</span>
<a name="l00139"></a>00139         <span class="comment">// misprediction, in which case nothing will happen or we&#39;ll use</span>
<a name="l00140"></a>00140         <span class="comment">// this fault to re-execute the faulting instruction which should clean</span>
<a name="l00141"></a>00141         <span class="comment">// up everything.</span>
<a name="l00142"></a>00142         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a> == _req-&gt;<a class="code" href="classRequest.html#a10ed86026a55738f7b19b56733a21ab4" title="Accessor function for vaddr.">getVaddr</a>()) {
<a name="l00143"></a>00143             <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classReExec.html">ReExec</a>;
<a name="l00144"></a>00144         }
<a name="l00145"></a>00145         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;currState should always be empty in timing mode!\n&quot;</span>);
<a name="l00146"></a>00146     }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a> = _tc;
<a name="l00149"></a>00149     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aa455c2fc892a518452cdcf36392b0c10" title="Translation state for delayed requests.">transState</a> = _trans;
<a name="l00150"></a>00150     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a985777e9e2e19ee755bf90ba7ee80feb" title="Request that is currently being serviced.">req</a> = _req;
<a name="l00151"></a>00151     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9a3285b98abb97905cab17e5813b9bb4" title="The fault that we are going to return.">fault</a> = <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>;
<a name="l00152"></a>00152     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aa436516fc4868c89a0b37e57b3dc6280" title="Context ID that we&amp;#39;re servicing the request under.">contextId</a> = _cid;
<a name="l00153"></a>00153     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a8b74d27c4b9da72279366a59fe439ab9" title="If the mode is timing or atomic.">timing</a> = _timing;
<a name="l00154"></a>00154     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9b99c1a76d5c94dbf86ed86d8d9ef199" title="If the atomic mode should be functional.">functional</a> = _functional;
<a name="l00155"></a>00155     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#acd10de558e04ae7b38d0f62ae03207d0" title="Save mode for use in delayed response.">mode</a> = _mode;
<a name="l00156"></a>00156 
<a name="l00159"></a>00159     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a985777e9e2e19ee755bf90ba7ee80feb" title="Request that is currently being serviced.">req</a>-&gt;<a class="code" href="classRequest.html#a10ed86026a55738f7b19b56733a21ab4" title="Accessor function for vaddr.">getVaddr</a>();
<a name="l00160"></a>00160     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a74ffff2c23d9f21c4558d13d64c7521a" title="Cached copy of the sctlr as it existed when translation began.">sctlr</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>-&gt;<a class="code" href="classThreadContext.html#a49de25575586f1e9bb3c72c2c4178c72">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca540af25d1d321d1891bf4d9292c227c1">MISCREG_SCTLR</a>);
<a name="l00161"></a>00161     <a class="code" href="classArmISA_1_1TableWalker.html#ab9278936d08e5d5f5c1c665381cffdfa" title="Cached copy of the sctlr as it existed when translation began.">sctlr</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a74ffff2c23d9f21c4558d13d64c7521a" title="Cached copy of the sctlr as it existed when translation began.">sctlr</a>;
<a name="l00162"></a>00162     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a769a6d899c990819e3c43ea4b1d781a6" title="Width of the base address held in TTRB0.">N</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>-&gt;<a class="code" href="classThreadContext.html#a49de25575586f1e9bb3c72c2c4178c72">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5bfc9d84a913f4403092c34f4fdb68f0">MISCREG_TTBCR</a>);
<a name="l00163"></a>00163 
<a name="l00164"></a>00164     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a71d58b6d1688fddc963563c06bcc696d" title="If the access is a fetch (for execution, and no-exec) must be checked?">isFetch</a> = (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#acd10de558e04ae7b38d0f62ae03207d0" title="Save mode for use in delayed response.">mode</a> == TLB::Execute);
<a name="l00165"></a>00165     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#abd258da981e96d128733bbd4d792d748" title="If the access is a write.">isWrite</a> = (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#acd10de558e04ae7b38d0f62ae03207d0" title="Save mode for use in delayed response.">mode</a> == TLB::Write);
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a8b74d27c4b9da72279366a59fe439ab9" title="If the mode is timing or atomic.">timing</a>)
<a name="l00169"></a>00169         <span class="keywordflow">return</span> <a class="code" href="classArmISA_1_1TableWalker.html#a1db101af2ab8b50020b7c3e6463dd4d6">processWalk</a>();
<a name="l00170"></a>00170 
<a name="l00171"></a>00171     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a92a90a1491b52b1ee28754a4643b4b61" title="If a timing translation is currently in progress.">pending</a> || <a class="code" href="classArmISA_1_1TableWalker.html#a1d69cdeafea580d10df3404277dadb34" title="Queue of requests that have passed are waiting because the walker is currently busy.">pendingQueue</a>.size()) {
<a name="l00172"></a>00172         <a class="code" href="classArmISA_1_1TableWalker.html#a1d69cdeafea580d10df3404277dadb34" title="Queue of requests that have passed are waiting because the walker is currently busy.">pendingQueue</a>.push_back(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>);
<a name="l00173"></a>00173         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a> = NULL;
<a name="l00174"></a>00174     } <span class="keywordflow">else</span> {
<a name="l00175"></a>00175         <a class="code" href="classArmISA_1_1TableWalker.html#a92a90a1491b52b1ee28754a4643b4b61" title="If a timing translation is currently in progress.">pending</a> = <span class="keyword">true</span>;
<a name="l00176"></a>00176         <span class="keywordflow">return</span> <a class="code" href="classArmISA_1_1TableWalker.html#a1db101af2ab8b50020b7c3e6463dd4d6">processWalk</a>();
<a name="l00177"></a>00177     }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     <span class="keywordflow">return</span> <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>;
<a name="l00180"></a>00180 }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 <span class="keywordtype">void</span>
<a name="l00183"></a><a class="code" href="classArmISA_1_1TableWalker.html#aa3d7d3866bfa5510370230d811c026d7">00183</a> <a class="code" href="classArmISA_1_1TableWalker.html#aa3d7d3866bfa5510370230d811c026d7">TableWalker::processWalkWrapper</a>()
<a name="l00184"></a>00184 {
<a name="l00185"></a>00185     assert(!<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>);
<a name="l00186"></a>00186     assert(<a class="code" href="classArmISA_1_1TableWalker.html#a1d69cdeafea580d10df3404277dadb34" title="Queue of requests that have passed are waiting because the walker is currently busy.">pendingQueue</a>.size());
<a name="l00187"></a>00187     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a1d69cdeafea580d10df3404277dadb34" title="Queue of requests that have passed are waiting because the walker is currently busy.">pendingQueue</a>.front();
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <span class="comment">// Check if a previous walk filled this request already</span>
<a name="l00190"></a>00190     <a class="code" href="structArmISA_1_1TlbEntry.html">TlbEntry</a>* <a class="code" href="namespaceArmISA.html#ae42407f27ca903cf975736dddc9114fc">te</a> = <a class="code" href="classArmISA_1_1TableWalker.html#ab5e40ae9d1aa2bfb44a0984627bd9c83" title="TLB that is initiating these table walks.">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#a0881cb314223c0569ff19d263f831acd" title="Lookup an entry in the TLB.">lookup</a>(currState-&gt;vaddr, currState-&gt;contextId, <span class="keyword">true</span>);
<a name="l00191"></a>00191 
<a name="l00192"></a>00192     <span class="comment">// Check if we still need to have a walk for this request. If the requesting</span>
<a name="l00193"></a>00193     <span class="comment">// instruction has been squashed, or a previous walk has filled the TLB with</span>
<a name="l00194"></a>00194     <span class="comment">// a match, we just want to get rid of the walk. The latter could happen</span>
<a name="l00195"></a>00195     <span class="comment">// when there are multiple outstanding misses to a single page and a</span>
<a name="l00196"></a>00196     <span class="comment">// previous request has been successfully translated.</span>
<a name="l00197"></a>00197     <span class="keywordflow">if</span> (!currState-&gt;transState-&gt;squashed() &amp;&amp; !te) {
<a name="l00198"></a>00198         <span class="comment">// We&#39;ve got a valid request, lets process it</span>
<a name="l00199"></a>00199         <a class="code" href="classArmISA_1_1TableWalker.html#a92a90a1491b52b1ee28754a4643b4b61" title="If a timing translation is currently in progress.">pending</a> = <span class="keyword">true</span>;
<a name="l00200"></a>00200         <a class="code" href="classArmISA_1_1TableWalker.html#a1d69cdeafea580d10df3404277dadb34" title="Queue of requests that have passed are waiting because the walker is currently busy.">pendingQueue</a>.pop_front();
<a name="l00201"></a>00201         <a class="code" href="classArmISA_1_1TableWalker.html#a1db101af2ab8b50020b7c3e6463dd4d6">processWalk</a>();
<a name="l00202"></a>00202         <span class="keywordflow">return</span>;
<a name="l00203"></a>00203     }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     <span class="comment">// If the instruction that we were translating for has been</span>
<a name="l00207"></a>00207     <span class="comment">// squashed we shouldn&#39;t bother.</span>
<a name="l00208"></a>00208     <span class="keywordtype">unsigned</span> num_squashed = 0;
<a name="l00209"></a>00209     <a class="code" href="classThreadContext.html" title="ThreadContext is the external interface to all thread state for anything outside of the CPU...">ThreadContext</a> *tc = currState-&gt;tc;
<a name="l00210"></a>00210     <span class="keywordflow">while</span> ((num_squashed &lt; <a class="code" href="classArmISA_1_1TableWalker.html#ad5922a63560415237a9a125c337984b4" title="The number of walks belonging to squashed instructions that can be removed from the pendingQueue per ...">numSquashable</a>) &amp;&amp; currState &amp;&amp;
<a name="l00211"></a>00211            (currState-&gt;transState-&gt;squashed() || te)) {
<a name="l00212"></a>00212         <a class="code" href="classArmISA_1_1TableWalker.html#a1d69cdeafea580d10df3404277dadb34" title="Queue of requests that have passed are waiting because the walker is currently busy.">pendingQueue</a>.pop_front();
<a name="l00213"></a>00213         num_squashed++;
<a name="l00214"></a>00214 
<a name="l00215"></a>00215         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;Squashing table walk for address %#x\n&quot;</span>, currState-&gt;vaddr);
<a name="l00216"></a>00216 
<a name="l00217"></a>00217         <span class="keywordflow">if</span> (currState-&gt;transState-&gt;squashed()) {
<a name="l00218"></a>00218             <span class="comment">// finish the translation which will delete the translation object</span>
<a name="l00219"></a>00219             currState-&gt;transState-&gt;finish(<span class="keyword">new</span> <a class="code" href="classUnimpFault.html">UnimpFault</a>(<span class="stringliteral">&quot;Squashed Inst&quot;</span>),
<a name="l00220"></a>00220                     currState-&gt;req, currState-&gt;tc, currState-&gt;mode);
<a name="l00221"></a>00221         } <span class="keywordflow">else</span> {
<a name="l00222"></a>00222             <span class="comment">// translate the request now that we know it will work</span>
<a name="l00223"></a>00223             currState-&gt;fault = <a class="code" href="classArmISA_1_1TableWalker.html#ab5e40ae9d1aa2bfb44a0984627bd9c83" title="TLB that is initiating these table walks.">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#a6ef405dcaea3256b22a205e943f0e1fb">translateTiming</a>(currState-&gt;req, currState-&gt;tc,
<a name="l00224"></a>00224                                       currState-&gt;transState, currState-&gt;mode);
<a name="l00225"></a>00225         }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227         <span class="comment">// delete the current request</span>
<a name="l00228"></a>00228         <span class="keyword">delete</span> currState;
<a name="l00229"></a>00229 
<a name="l00230"></a>00230         <span class="comment">// peak at the next one</span>
<a name="l00231"></a>00231         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a1d69cdeafea580d10df3404277dadb34" title="Queue of requests that have passed are waiting because the walker is currently busy.">pendingQueue</a>.size()) {
<a name="l00232"></a>00232             currState = <a class="code" href="classArmISA_1_1TableWalker.html#a1d69cdeafea580d10df3404277dadb34" title="Queue of requests that have passed are waiting because the walker is currently busy.">pendingQueue</a>.front();
<a name="l00233"></a>00233             te = <a class="code" href="classArmISA_1_1TableWalker.html#ab5e40ae9d1aa2bfb44a0984627bd9c83" title="TLB that is initiating these table walks.">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#a0881cb314223c0569ff19d263f831acd" title="Lookup an entry in the TLB.">lookup</a>(currState-&gt;vaddr, currState-&gt;contextId, <span class="keyword">true</span>);
<a name="l00234"></a>00234         } <span class="keywordflow">else</span> {
<a name="l00235"></a>00235             <span class="comment">// Terminate the loop, nothing more to do</span>
<a name="l00236"></a>00236             currState = NULL;
<a name="l00237"></a>00237         }
<a name="l00238"></a>00238     }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240     <span class="comment">// if we&#39;ve still got pending translations schedule more work</span>
<a name="l00241"></a>00241     <a class="code" href="classArmISA_1_1TableWalker.html#af6aa809f66824c5afb7175630c630428">nextWalk</a>(tc);
<a name="l00242"></a>00242     currState = NULL;
<a name="l00243"></a>00243     <a class="code" href="classArmISA_1_1TableWalker.html#acdaa6d4fc9977fca69259dae4c2bc231" title="Checks if all state is cleared and if so, completes drain.">completeDrain</a>();
<a name="l00244"></a>00244 }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 <a class="code" href="classRefCountingPtr.html">Fault</a>
<a name="l00247"></a><a class="code" href="classArmISA_1_1TableWalker.html#a1db101af2ab8b50020b7c3e6463dd4d6">00247</a> <a class="code" href="classArmISA_1_1TableWalker.html#a1db101af2ab8b50020b7c3e6463dd4d6">TableWalker::processWalk</a>()
<a name="l00248"></a>00248 {
<a name="l00249"></a>00249     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> ttbr = 0;
<a name="l00250"></a>00250 
<a name="l00251"></a>00251     <span class="comment">// If translation isn&#39;t enabled, we shouldn&#39;t be here</span>
<a name="l00252"></a>00252     assert(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a74ffff2c23d9f21c4558d13d64c7521a" title="Cached copy of the sctlr as it existed when translation began.">sctlr</a>.m);
<a name="l00253"></a>00253 
<a name="l00254"></a>00254     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;Begining table walk for address %#x, TTBCR: %#x, bits:%#x\n&quot;</span>,
<a name="l00255"></a>00255             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a769a6d899c990819e3c43ea4b1d781a6" title="Width of the base address held in TTRB0.">N</a>, <a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4" title="Mask off the given bits in place like bits() but without shifting.">mbits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>, 31,
<a name="l00256"></a>00256             32-<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a769a6d899c990819e3c43ea4b1d781a6" title="Width of the base address held in TTRB0.">N</a>));
<a name="l00257"></a>00257 
<a name="l00258"></a>00258     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a769a6d899c990819e3c43ea4b1d781a6" title="Width of the base address held in TTRB0.">N</a> == 0 || !<a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4" title="Mask off the given bits in place like bits() but without shifting.">mbits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>, 31, 32-<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a769a6d899c990819e3c43ea4b1d781a6" title="Width of the base address held in TTRB0.">N</a>)) {
<a name="l00259"></a>00259         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - Selecting TTBR0\n&quot;</span>);
<a name="l00260"></a>00260         ttbr = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>-&gt;<a class="code" href="classThreadContext.html#a49de25575586f1e9bb3c72c2c4178c72">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6a636c5129391c23216bcea3bde6f0f8">MISCREG_TTBR0</a>);
<a name="l00261"></a>00261     } <span class="keywordflow">else</span> {
<a name="l00262"></a>00262         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - Selecting TTBR1\n&quot;</span>);
<a name="l00263"></a>00263         ttbr = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>-&gt;<a class="code" href="classThreadContext.html#a49de25575586f1e9bb3c72c2c4178c72">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac0d0e5ddda9dea55e2ae3223a5f1c9fc">MISCREG_TTBR1</a>);
<a name="l00264"></a>00264         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a769a6d899c990819e3c43ea4b1d781a6" title="Width of the base address held in TTRB0.">N</a> = 0;
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> l1desc_addr = <a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4" title="Mask off the given bits in place like bits() but without shifting.">mbits</a>(ttbr, 31, 14-<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a769a6d899c990819e3c43ea4b1d781a6" title="Width of the base address held in TTRB0.">N</a>) |
<a name="l00268"></a>00268                        (<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive) from &amp;#39;val&amp;#39; a...">bits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>,31-<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a769a6d899c990819e3c43ea4b1d781a6" title="Width of the base address held in TTRB0.">N</a>,20) &lt;&lt; 2);
<a name="l00269"></a>00269     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - Descriptor at address %#x\n&quot;</span>, l1desc_addr);
<a name="l00270"></a>00270 
<a name="l00271"></a>00271 
<a name="l00272"></a>00272     <span class="comment">// Trickbox address check</span>
<a name="l00273"></a>00273     <a class="code" href="classRefCountingPtr.html">Fault</a> <a class="code" href="namespaceArmISA.html#ac5e4ebb262ab83e8da8cd79b703af567">f</a>;
<a name="l00274"></a>00274     f = <a class="code" href="classArmISA_1_1TableWalker.html#ab5e40ae9d1aa2bfb44a0984627bd9c83" title="TLB that is initiating these table walks.">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#aced0d81da4830b2ccb2360c4f2d2710a">walkTrickBoxCheck</a>(l1desc_addr, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>, <span class="keyword">sizeof</span>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>),
<a name="l00275"></a>00275             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a71d58b6d1688fddc963563c06bcc696d" title="If the access is a fetch (for execution, and no-exec) must be checked?">isFetch</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#abd258da981e96d128733bbd4d792d748" title="If the access is a write.">isWrite</a>, 0, <span class="keyword">true</span>);
<a name="l00276"></a>00276     <span class="keywordflow">if</span> (f) {
<a name="l00277"></a>00277         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;Trickbox check caused fault on %#x\n&quot;</span>, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>);
<a name="l00278"></a>00278         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a8b74d27c4b9da72279366a59fe439ab9" title="If the mode is timing or atomic.">timing</a>) {
<a name="l00279"></a>00279             <a class="code" href="classArmISA_1_1TableWalker.html#a92a90a1491b52b1ee28754a4643b4b61" title="If a timing translation is currently in progress.">pending</a> = <span class="keyword">false</span>;
<a name="l00280"></a>00280             <a class="code" href="classArmISA_1_1TableWalker.html#af6aa809f66824c5afb7175630c630428">nextWalk</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>);
<a name="l00281"></a>00281             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a> = NULL;
<a name="l00282"></a>00282         } <span class="keywordflow">else</span> {
<a name="l00283"></a>00283             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a> = NULL;
<a name="l00284"></a>00284             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a985777e9e2e19ee755bf90ba7ee80feb" title="Request that is currently being serviced.">req</a> = NULL;
<a name="l00285"></a>00285         }
<a name="l00286"></a>00286         <span class="keywordflow">return</span> f;
<a name="l00287"></a>00287     }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     <a class="code" href="classFlags.html">Request::Flags</a> flag = 0;
<a name="l00290"></a>00290     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a74ffff2c23d9f21c4558d13d64c7521a" title="Cached copy of the sctlr as it existed when translation began.">sctlr</a>.c == 0) {
<a name="l00291"></a>00291         flag = <a class="code" href="classRequest.html#a33bf8c73df6e1a017daaa349ad9e98a1" title="The request is to an uncacheable address.">Request::UNCACHEABLE</a>;
<a name="l00292"></a>00292     }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a8b74d27c4b9da72279366a59fe439ab9" title="If the mode is timing or atomic.">timing</a>) {
<a name="l00295"></a>00295         <a class="code" href="classArmISA_1_1TableWalker.html#a4fed328b3a8f0218a10135c43c305923" title="Port to issue translation requests from.">port</a>.<a class="code" href="classDmaPort.html#a3201ee5c8e9eb266ed4945cfe859c998">dmaAction</a>(<a class="code" href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102aa21449f51bc9023b2dc730a7cd2cbf16">MemCmd::ReadReq</a>, l1desc_addr, <span class="keyword">sizeof</span>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>),
<a name="l00296"></a>00296                        &amp;<a class="code" href="classArmISA_1_1TableWalker.html#aa472f4c1719eb983121eaf70f380f5a0">doL1DescEvent</a>, (uint8_t*)&amp;<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a661e5c13d149a47c6b1be74125f5cc7a" title="The raw bits of the entry.">data</a>,
<a name="l00297"></a>00297                        <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>-&gt;<a class="code" href="classThreadContext.html#add24ea69a3c1a7862d25bec95f9bdc95">getCpuPtr</a>()-&gt;<a class="code" href="classClockedObject.html#a3f0850d695e3722cdd7d33bbaf3e5f43">clockPeriod</a>(), flag);
<a name="l00298"></a>00298         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;Adding to walker fifo: queue size before &quot;</span>
<a name="l00299"></a>00299                 <span class="stringliteral">&quot;adding: %d\n&quot;</span>,
<a name="l00300"></a>00300                 <a class="code" href="classArmISA_1_1TableWalker.html#a0e4b6ea16cbb0abdc3e0aa26f9abd196" title="Queue of requests that need processing first level translation.">stateQueueL1</a>.size());
<a name="l00301"></a>00301         <a class="code" href="classArmISA_1_1TableWalker.html#a0e4b6ea16cbb0abdc3e0aa26f9abd196" title="Queue of requests that need processing first level translation.">stateQueueL1</a>.push_back(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>);
<a name="l00302"></a>00302         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a> = NULL;
<a name="l00303"></a>00303     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9b99c1a76d5c94dbf86ed86d8d9ef199" title="If the atomic mode should be functional.">functional</a>) {
<a name="l00304"></a>00304         <a class="code" href="classArmISA_1_1TableWalker.html#a4fed328b3a8f0218a10135c43c305923" title="Port to issue translation requests from.">port</a>.<a class="code" href="classDmaPort.html#a3201ee5c8e9eb266ed4945cfe859c998">dmaAction</a>(<a class="code" href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102aa21449f51bc9023b2dc730a7cd2cbf16">MemCmd::ReadReq</a>, l1desc_addr, <span class="keyword">sizeof</span>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>),
<a name="l00305"></a>00305                        NULL, (uint8_t*)&amp;<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a661e5c13d149a47c6b1be74125f5cc7a" title="The raw bits of the entry.">data</a>,
<a name="l00306"></a>00306                        <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>-&gt;<a class="code" href="classThreadContext.html#add24ea69a3c1a7862d25bec95f9bdc95">getCpuPtr</a>()-&gt;<a class="code" href="classClockedObject.html#a3f0850d695e3722cdd7d33bbaf3e5f43">clockPeriod</a>(), flag);
<a name="l00307"></a>00307         <a class="code" href="classArmISA_1_1TableWalker.html#a6a5556160487c183ab7c8e3c0fea95e4">doL1Descriptor</a>();
<a name="l00308"></a>00308         f = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9a3285b98abb97905cab17e5813b9bb4" title="The fault that we are going to return.">fault</a>;
<a name="l00309"></a>00309     } <span class="keywordflow">else</span> {
<a name="l00310"></a>00310         <a class="code" href="classRequest.html">RequestPtr</a> req = <span class="keyword">new</span> <a class="code" href="classRequest.html">Request</a>(l1desc_addr, <span class="keyword">sizeof</span>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>), flag, <a class="code" href="classArmISA_1_1TableWalker.html#af713acb7dd4a6f042aa0c04fc880f7e1" title="Request id for requests generated by this walker.">masterId</a>);
<a name="l00311"></a>00311         <a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt = <span class="keyword">new</span> <a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">Packet</a>(req, <a class="code" href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102aa21449f51bc9023b2dc730a7cd2cbf16">MemCmd::ReadReq</a>);
<a name="l00312"></a>00312         pkt-&gt;<a class="code" href="classPacket.html#aa81ea5325a7aa403fa94f2d84f6f4236" title="Set the data pointer to the following value that should not be freed.">dataStatic</a>((uint8_t*)&amp;<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a661e5c13d149a47c6b1be74125f5cc7a" title="The raw bits of the entry.">data</a>);
<a name="l00313"></a>00313         <a class="code" href="classArmISA_1_1TableWalker.html#a4fed328b3a8f0218a10135c43c305923" title="Port to issue translation requests from.">port</a>.<a class="code" href="classMasterPort.html#a02b195a074185280154268143963df99" title="Send a functional request packet, where the data is instantly updated everywhere in the memory system...">sendFunctional</a>(pkt);
<a name="l00314"></a>00314         <a class="code" href="classArmISA_1_1TableWalker.html#a6a5556160487c183ab7c8e3c0fea95e4">doL1Descriptor</a>();
<a name="l00315"></a>00315         <span class="keyword">delete</span> req;
<a name="l00316"></a>00316         <span class="keyword">delete</span> pkt;
<a name="l00317"></a>00317         f = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9a3285b98abb97905cab17e5813b9bb4" title="The fault that we are going to return.">fault</a>;
<a name="l00318"></a>00318     }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     <span class="keywordflow">return</span> f;
<a name="l00321"></a>00321 }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323 <span class="keywordtype">void</span>
<a name="l00324"></a><a class="code" href="classArmISA_1_1TableWalker.html#afa86a1bbbfaf8b59231b9df1d1089539">00324</a> <a class="code" href="classArmISA_1_1TableWalker.html#afa86a1bbbfaf8b59231b9df1d1089539">TableWalker::memAttrs</a>(<a class="code" href="classThreadContext.html" title="ThreadContext is the external interface to all thread state for anything outside of the CPU...">ThreadContext</a> *tc, <a class="code" href="structArmISA_1_1TlbEntry.html">TlbEntry</a> &amp;<a class="code" href="namespaceArmISA.html#ae42407f27ca903cf975736dddc9114fc">te</a>, SCTLR sctlr,
<a name="l00325"></a>00325                       uint8_t texcb, <span class="keywordtype">bool</span> <a class="code" href="namespaceMipsISA.html#a36d11894e85e86352c6a5ddfd624fc7a">s</a>)
<a name="l00326"></a>00326 {
<a name="l00327"></a>00327     <span class="comment">// Note: tc and sctlr local variables are hiding tc and sctrl class</span>
<a name="l00328"></a>00328     <span class="comment">// variables</span>
<a name="l00329"></a>00329     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;memAttrs texcb:%d s:%d\n&quot;</span>, texcb, s);
<a name="l00330"></a>00330     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a0de098a8a1e8fe2c9c299979c722c03b">shareable</a> = <span class="keyword">false</span>; <span class="comment">// default value</span>
<a name="l00331"></a>00331     te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa48086307b7c0138fd5523586b237ce1">nonCacheable</a> = <span class="keyword">false</span>;
<a name="l00332"></a>00332     <span class="keywordtype">bool</span> outer_shareable = <span class="keyword">false</span>;
<a name="l00333"></a>00333     <span class="keywordflow">if</span> (sctlr.tre == 0 || ((sctlr.tre == 1) &amp;&amp; (sctlr.m == 0))) {
<a name="l00334"></a>00334         <span class="keywordflow">switch</span>(texcb) {
<a name="l00335"></a>00335           <span class="keywordflow">case</span> 0: <span class="comment">// Stongly-ordered</span>
<a name="l00336"></a>00336             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa48086307b7c0138fd5523586b237ce1">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l00337"></a>00337             te.<a class="code" href="structArmISA_1_1TlbEntry.html#af18922b22f7a395bfdfd8c5a56aa2efa">mtype</a> = TlbEntry::StronglyOrdered;
<a name="l00338"></a>00338             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a0de098a8a1e8fe2c9c299979c722c03b">shareable</a> = <span class="keyword">true</span>;
<a name="l00339"></a>00339             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aac52d187ca4ef523ffa9c09e99998a8f">innerAttrs</a> = 1;
<a name="l00340"></a>00340             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa8727837f6a8c6b89e4a529cd0355165">outerAttrs</a> = 0;
<a name="l00341"></a>00341             <span class="keywordflow">break</span>;
<a name="l00342"></a>00342           <span class="keywordflow">case</span> 1: <span class="comment">// Shareable Device</span>
<a name="l00343"></a>00343             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa48086307b7c0138fd5523586b237ce1">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l00344"></a>00344             te.<a class="code" href="structArmISA_1_1TlbEntry.html#af18922b22f7a395bfdfd8c5a56aa2efa">mtype</a> = TlbEntry::Device;
<a name="l00345"></a>00345             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a0de098a8a1e8fe2c9c299979c722c03b">shareable</a> = <span class="keyword">true</span>;
<a name="l00346"></a>00346             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aac52d187ca4ef523ffa9c09e99998a8f">innerAttrs</a> = 3;
<a name="l00347"></a>00347             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa8727837f6a8c6b89e4a529cd0355165">outerAttrs</a> = 0;
<a name="l00348"></a>00348             <span class="keywordflow">break</span>;
<a name="l00349"></a>00349           <span class="keywordflow">case</span> 2: <span class="comment">// Outer and Inner Write-Through, no Write-Allocate</span>
<a name="l00350"></a>00350             te.<a class="code" href="structArmISA_1_1TlbEntry.html#af18922b22f7a395bfdfd8c5a56aa2efa">mtype</a> = TlbEntry::Normal;
<a name="l00351"></a>00351             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a0de098a8a1e8fe2c9c299979c722c03b">shareable</a> = s;
<a name="l00352"></a>00352             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aac52d187ca4ef523ffa9c09e99998a8f">innerAttrs</a> = 6;
<a name="l00353"></a>00353             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa8727837f6a8c6b89e4a529cd0355165">outerAttrs</a> = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive) from &amp;#39;val&amp;#39; a...">bits</a>(texcb, 1, 0);
<a name="l00354"></a>00354             <span class="keywordflow">break</span>;
<a name="l00355"></a>00355           <span class="keywordflow">case</span> 3: <span class="comment">// Outer and Inner Write-Back, no Write-Allocate</span>
<a name="l00356"></a>00356             te.<a class="code" href="structArmISA_1_1TlbEntry.html#af18922b22f7a395bfdfd8c5a56aa2efa">mtype</a> = TlbEntry::Normal;
<a name="l00357"></a>00357             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a0de098a8a1e8fe2c9c299979c722c03b">shareable</a> = s;
<a name="l00358"></a>00358             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aac52d187ca4ef523ffa9c09e99998a8f">innerAttrs</a> = 7;
<a name="l00359"></a>00359             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa8727837f6a8c6b89e4a529cd0355165">outerAttrs</a> = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive) from &amp;#39;val&amp;#39; a...">bits</a>(texcb, 1, 0);
<a name="l00360"></a>00360             <span class="keywordflow">break</span>;
<a name="l00361"></a>00361           <span class="keywordflow">case</span> 4: <span class="comment">// Outer and Inner Non-cacheable</span>
<a name="l00362"></a>00362             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa48086307b7c0138fd5523586b237ce1">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l00363"></a>00363             te.<a class="code" href="structArmISA_1_1TlbEntry.html#af18922b22f7a395bfdfd8c5a56aa2efa">mtype</a> = TlbEntry::Normal;
<a name="l00364"></a>00364             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a0de098a8a1e8fe2c9c299979c722c03b">shareable</a> = s;
<a name="l00365"></a>00365             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aac52d187ca4ef523ffa9c09e99998a8f">innerAttrs</a> = 0;
<a name="l00366"></a>00366             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa8727837f6a8c6b89e4a529cd0355165">outerAttrs</a> = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive) from &amp;#39;val&amp;#39; a...">bits</a>(texcb, 1, 0);
<a name="l00367"></a>00367             <span class="keywordflow">break</span>;
<a name="l00368"></a>00368           <span class="keywordflow">case</span> 5: <span class="comment">// Reserved</span>
<a name="l00369"></a>00369             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Reserved texcb value!\n&quot;</span>);
<a name="l00370"></a>00370             <span class="keywordflow">break</span>;
<a name="l00371"></a>00371           <span class="keywordflow">case</span> 6: <span class="comment">// Implementation Defined</span>
<a name="l00372"></a>00372             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Implementation-defined texcb value!\n&quot;</span>);
<a name="l00373"></a>00373             <span class="keywordflow">break</span>;
<a name="l00374"></a>00374           <span class="keywordflow">case</span> 7: <span class="comment">// Outer and Inner Write-Back, Write-Allocate</span>
<a name="l00375"></a>00375             te.<a class="code" href="structArmISA_1_1TlbEntry.html#af18922b22f7a395bfdfd8c5a56aa2efa">mtype</a> = TlbEntry::Normal;
<a name="l00376"></a>00376             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a0de098a8a1e8fe2c9c299979c722c03b">shareable</a> = s;
<a name="l00377"></a>00377             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aac52d187ca4ef523ffa9c09e99998a8f">innerAttrs</a> = 5;
<a name="l00378"></a>00378             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa8727837f6a8c6b89e4a529cd0355165">outerAttrs</a> = 1;
<a name="l00379"></a>00379             <span class="keywordflow">break</span>;
<a name="l00380"></a>00380           <span class="keywordflow">case</span> 8: <span class="comment">// Non-shareable Device</span>
<a name="l00381"></a>00381             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa48086307b7c0138fd5523586b237ce1">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l00382"></a>00382             te.<a class="code" href="structArmISA_1_1TlbEntry.html#af18922b22f7a395bfdfd8c5a56aa2efa">mtype</a> = TlbEntry::Device;
<a name="l00383"></a>00383             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a0de098a8a1e8fe2c9c299979c722c03b">shareable</a> = <span class="keyword">false</span>;
<a name="l00384"></a>00384             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aac52d187ca4ef523ffa9c09e99998a8f">innerAttrs</a> = 3;
<a name="l00385"></a>00385             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa8727837f6a8c6b89e4a529cd0355165">outerAttrs</a> = 0;
<a name="l00386"></a>00386             <span class="keywordflow">break</span>;
<a name="l00387"></a>00387           <span class="keywordflow">case</span> 9 ... 15:  <span class="comment">// Reserved</span>
<a name="l00388"></a>00388             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Reserved texcb value!\n&quot;</span>);
<a name="l00389"></a>00389             <span class="keywordflow">break</span>;
<a name="l00390"></a>00390           <span class="keywordflow">case</span> 16 ... 31: <span class="comment">// Cacheable Memory</span>
<a name="l00391"></a>00391             te.<a class="code" href="structArmISA_1_1TlbEntry.html#af18922b22f7a395bfdfd8c5a56aa2efa">mtype</a> = TlbEntry::Normal;
<a name="l00392"></a>00392             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a0de098a8a1e8fe2c9c299979c722c03b">shareable</a> = s;
<a name="l00393"></a>00393             <span class="keywordflow">if</span> (<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive) from &amp;#39;val&amp;#39; a...">bits</a>(texcb, 1,0) == 0 || <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive) from &amp;#39;val&amp;#39; a...">bits</a>(texcb, 3,2) == 0)
<a name="l00394"></a>00394                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa48086307b7c0138fd5523586b237ce1">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l00395"></a>00395             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aac52d187ca4ef523ffa9c09e99998a8f">innerAttrs</a> = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive) from &amp;#39;val&amp;#39; a...">bits</a>(texcb, 1, 0);
<a name="l00396"></a>00396             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa8727837f6a8c6b89e4a529cd0355165">outerAttrs</a> = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive) from &amp;#39;val&amp;#39; a...">bits</a>(texcb, 3, 2);
<a name="l00397"></a>00397             <span class="keywordflow">break</span>;
<a name="l00398"></a>00398           <span class="keywordflow">default</span>:
<a name="l00399"></a>00399             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;More than 32 states for 5 bits?\n&quot;</span>);
<a name="l00400"></a>00400         }
<a name="l00401"></a>00401     } <span class="keywordflow">else</span> {
<a name="l00402"></a>00402         assert(tc);
<a name="l00403"></a>00403         PRRR prrr = tc-&gt;<a class="code" href="classThreadContext.html#a49de25575586f1e9bb3c72c2c4178c72">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca558657ebddea41bb1fc2cf61e725f6a9">MISCREG_PRRR</a>);
<a name="l00404"></a>00404         NMRR nmrr = tc-&gt;<a class="code" href="classThreadContext.html#a49de25575586f1e9bb3c72c2c4178c72">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac979e506d9ce19425eb582d6acd8cee0">MISCREG_NMRR</a>);
<a name="l00405"></a>00405         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;memAttrs PRRR:%08x NMRR:%08x\n&quot;</span>, prrr, nmrr);
<a name="l00406"></a>00406         uint8_t curr_tr = 0, curr_ir = 0, curr_or = 0;
<a name="l00407"></a>00407         <span class="keywordflow">switch</span>(<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive) from &amp;#39;val&amp;#39; a...">bits</a>(texcb, 2,0)) {
<a name="l00408"></a>00408           <span class="keywordflow">case</span> 0:
<a name="l00409"></a>00409             curr_tr = prrr.tr0;
<a name="l00410"></a>00410             curr_ir = nmrr.ir0;
<a name="l00411"></a>00411             curr_or = nmrr.or0;
<a name="l00412"></a>00412             outer_shareable = (prrr.nos0 == 0);
<a name="l00413"></a>00413             <span class="keywordflow">break</span>;
<a name="l00414"></a>00414           <span class="keywordflow">case</span> 1:
<a name="l00415"></a>00415             curr_tr = prrr.tr1;
<a name="l00416"></a>00416             curr_ir = nmrr.ir1;
<a name="l00417"></a>00417             curr_or = nmrr.or1;
<a name="l00418"></a>00418             outer_shareable = (prrr.nos1 == 0);
<a name="l00419"></a>00419             <span class="keywordflow">break</span>;
<a name="l00420"></a>00420           <span class="keywordflow">case</span> 2:
<a name="l00421"></a>00421             curr_tr = prrr.tr2;
<a name="l00422"></a>00422             curr_ir = nmrr.ir2;
<a name="l00423"></a>00423             curr_or = nmrr.or2;
<a name="l00424"></a>00424             outer_shareable = (prrr.nos2 == 0);
<a name="l00425"></a>00425             <span class="keywordflow">break</span>;
<a name="l00426"></a>00426           <span class="keywordflow">case</span> 3:
<a name="l00427"></a>00427             curr_tr = prrr.tr3;
<a name="l00428"></a>00428             curr_ir = nmrr.ir3;
<a name="l00429"></a>00429             curr_or = nmrr.or3;
<a name="l00430"></a>00430             outer_shareable = (prrr.nos3 == 0);
<a name="l00431"></a>00431             <span class="keywordflow">break</span>;
<a name="l00432"></a>00432           <span class="keywordflow">case</span> 4:
<a name="l00433"></a>00433             curr_tr = prrr.tr4;
<a name="l00434"></a>00434             curr_ir = nmrr.ir4;
<a name="l00435"></a>00435             curr_or = nmrr.or4;
<a name="l00436"></a>00436             outer_shareable = (prrr.nos4 == 0);
<a name="l00437"></a>00437             <span class="keywordflow">break</span>;
<a name="l00438"></a>00438           <span class="keywordflow">case</span> 5:
<a name="l00439"></a>00439             curr_tr = prrr.tr5;
<a name="l00440"></a>00440             curr_ir = nmrr.ir5;
<a name="l00441"></a>00441             curr_or = nmrr.or5;
<a name="l00442"></a>00442             outer_shareable = (prrr.nos5 == 0);
<a name="l00443"></a>00443             <span class="keywordflow">break</span>;
<a name="l00444"></a>00444           <span class="keywordflow">case</span> 6:
<a name="l00445"></a>00445             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Imp defined type\n&quot;</span>);
<a name="l00446"></a>00446           <span class="keywordflow">case</span> 7:
<a name="l00447"></a>00447             curr_tr = prrr.tr7;
<a name="l00448"></a>00448             curr_ir = nmrr.ir7;
<a name="l00449"></a>00449             curr_or = nmrr.or7;
<a name="l00450"></a>00450             outer_shareable = (prrr.nos7 == 0);
<a name="l00451"></a>00451             <span class="keywordflow">break</span>;
<a name="l00452"></a>00452         }
<a name="l00453"></a>00453 
<a name="l00454"></a>00454         <span class="keywordflow">switch</span>(curr_tr) {
<a name="l00455"></a>00455           <span class="keywordflow">case</span> 0:
<a name="l00456"></a>00456             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;StronglyOrdered\n&quot;</span>);
<a name="l00457"></a>00457             te.<a class="code" href="structArmISA_1_1TlbEntry.html#af18922b22f7a395bfdfd8c5a56aa2efa">mtype</a> = TlbEntry::StronglyOrdered;
<a name="l00458"></a>00458             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa48086307b7c0138fd5523586b237ce1">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l00459"></a>00459             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aac52d187ca4ef523ffa9c09e99998a8f">innerAttrs</a> = 1;
<a name="l00460"></a>00460             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa8727837f6a8c6b89e4a529cd0355165">outerAttrs</a> = 0;
<a name="l00461"></a>00461             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a0de098a8a1e8fe2c9c299979c722c03b">shareable</a> = <span class="keyword">true</span>;
<a name="l00462"></a>00462             <span class="keywordflow">break</span>;
<a name="l00463"></a>00463           <span class="keywordflow">case</span> 1:
<a name="l00464"></a>00464             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;Device ds1:%d ds0:%d s:%d\n&quot;</span>,
<a name="l00465"></a>00465                     prrr.ds1, prrr.ds0, s);
<a name="l00466"></a>00466             te.<a class="code" href="structArmISA_1_1TlbEntry.html#af18922b22f7a395bfdfd8c5a56aa2efa">mtype</a> = TlbEntry::Device;
<a name="l00467"></a>00467             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa48086307b7c0138fd5523586b237ce1">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l00468"></a>00468             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aac52d187ca4ef523ffa9c09e99998a8f">innerAttrs</a> = 3;
<a name="l00469"></a>00469             te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa8727837f6a8c6b89e4a529cd0355165">outerAttrs</a> = 0;
<a name="l00470"></a>00470             <span class="keywordflow">if</span> (prrr.ds1 &amp;&amp; s)
<a name="l00471"></a>00471                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a0de098a8a1e8fe2c9c299979c722c03b">shareable</a> = <span class="keyword">true</span>;
<a name="l00472"></a>00472             <span class="keywordflow">if</span> (prrr.ds0 &amp;&amp; !s)
<a name="l00473"></a>00473                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a0de098a8a1e8fe2c9c299979c722c03b">shareable</a> = <span class="keyword">true</span>;
<a name="l00474"></a>00474             <span class="keywordflow">break</span>;
<a name="l00475"></a>00475           <span class="keywordflow">case</span> 2:
<a name="l00476"></a>00476             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;Normal ns1:%d ns0:%d s:%d\n&quot;</span>,
<a name="l00477"></a>00477                     prrr.ns1, prrr.ns0, s);
<a name="l00478"></a>00478             te.<a class="code" href="structArmISA_1_1TlbEntry.html#af18922b22f7a395bfdfd8c5a56aa2efa">mtype</a> = TlbEntry::Normal;
<a name="l00479"></a>00479             <span class="keywordflow">if</span> (prrr.ns1 &amp;&amp; s)
<a name="l00480"></a>00480                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a0de098a8a1e8fe2c9c299979c722c03b">shareable</a> = <span class="keyword">true</span>;
<a name="l00481"></a>00481             <span class="keywordflow">if</span> (prrr.ns0 &amp;&amp; !s)
<a name="l00482"></a>00482                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a0de098a8a1e8fe2c9c299979c722c03b">shareable</a> = <span class="keyword">true</span>;
<a name="l00483"></a>00483             <span class="keywordflow">break</span>;
<a name="l00484"></a>00484           <span class="keywordflow">case</span> 3:
<a name="l00485"></a>00485             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Reserved type&quot;</span>);
<a name="l00486"></a>00486         }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488         <span class="keywordflow">if</span> (te.<a class="code" href="structArmISA_1_1TlbEntry.html#af18922b22f7a395bfdfd8c5a56aa2efa">mtype</a> == <a class="code" href="structArmISA_1_1TlbEntry.html#ad9413ba336df9efaa3b7cf641c81d605afdecdda891c91b6ea2be8d02c163c05e">TlbEntry::Normal</a>){
<a name="l00489"></a>00489             <span class="keywordflow">switch</span>(curr_ir) {
<a name="l00490"></a>00490               <span class="keywordflow">case</span> 0:
<a name="l00491"></a>00491                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa48086307b7c0138fd5523586b237ce1">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l00492"></a>00492                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#aac52d187ca4ef523ffa9c09e99998a8f">innerAttrs</a> = 0;
<a name="l00493"></a>00493                 <span class="keywordflow">break</span>;
<a name="l00494"></a>00494               <span class="keywordflow">case</span> 1:
<a name="l00495"></a>00495                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#aac52d187ca4ef523ffa9c09e99998a8f">innerAttrs</a> = 5;
<a name="l00496"></a>00496                 <span class="keywordflow">break</span>;
<a name="l00497"></a>00497               <span class="keywordflow">case</span> 2:
<a name="l00498"></a>00498                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#aac52d187ca4ef523ffa9c09e99998a8f">innerAttrs</a> = 6;
<a name="l00499"></a>00499                 <span class="keywordflow">break</span>;
<a name="l00500"></a>00500               <span class="keywordflow">case</span> 3:
<a name="l00501"></a>00501                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#aac52d187ca4ef523ffa9c09e99998a8f">innerAttrs</a> = 7;
<a name="l00502"></a>00502                 <span class="keywordflow">break</span>;
<a name="l00503"></a>00503             }
<a name="l00504"></a>00504 
<a name="l00505"></a>00505             <span class="keywordflow">switch</span>(curr_or) {
<a name="l00506"></a>00506               <span class="keywordflow">case</span> 0:
<a name="l00507"></a>00507                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa48086307b7c0138fd5523586b237ce1">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l00508"></a>00508                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa8727837f6a8c6b89e4a529cd0355165">outerAttrs</a> = 0;
<a name="l00509"></a>00509                 <span class="keywordflow">break</span>;
<a name="l00510"></a>00510               <span class="keywordflow">case</span> 1:
<a name="l00511"></a>00511                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa8727837f6a8c6b89e4a529cd0355165">outerAttrs</a> = 1;
<a name="l00512"></a>00512                 <span class="keywordflow">break</span>;
<a name="l00513"></a>00513               <span class="keywordflow">case</span> 2:
<a name="l00514"></a>00514                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa8727837f6a8c6b89e4a529cd0355165">outerAttrs</a> = 2;
<a name="l00515"></a>00515                 <span class="keywordflow">break</span>;
<a name="l00516"></a>00516               <span class="keywordflow">case</span> 3:
<a name="l00517"></a>00517                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa8727837f6a8c6b89e4a529cd0355165">outerAttrs</a> = 3;
<a name="l00518"></a>00518                 <span class="keywordflow">break</span>;
<a name="l00519"></a>00519             }
<a name="l00520"></a>00520         }
<a name="l00521"></a>00521     }
<a name="l00522"></a>00522     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;memAttrs: shareable: %d, innerAttrs: %d, \</span>
<a name="l00523"></a>00523 <span class="stringliteral">            outerAttrs: %d\n&quot;</span>,
<a name="l00524"></a>00524             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a0de098a8a1e8fe2c9c299979c722c03b">shareable</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#aac52d187ca4ef523ffa9c09e99998a8f">innerAttrs</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa8727837f6a8c6b89e4a529cd0355165">outerAttrs</a>);
<a name="l00525"></a>00525 
<a name="l00541"></a>00541     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4c6f86e4d0b6031738254d5e9e3de3c2">attributes</a> = (
<a name="l00542"></a>00542                 ((outer_shareable ? 0:1) &lt;&lt; 10) |
<a name="l00543"></a>00543                 <span class="comment">// TODO: NS Bit</span>
<a name="l00544"></a>00544                 ((te.<a class="code" href="structArmISA_1_1TlbEntry.html#a0de098a8a1e8fe2c9c299979c722c03b">shareable</a> ? 1:0) &lt;&lt; 7) |
<a name="l00545"></a>00545                 (te.<a class="code" href="structArmISA_1_1TlbEntry.html#aac52d187ca4ef523ffa9c09e99998a8f">innerAttrs</a> &lt;&lt; 4) |
<a name="l00546"></a>00546                 (te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa8727837f6a8c6b89e4a529cd0355165">outerAttrs</a> &lt;&lt; 2)
<a name="l00547"></a>00547                 <span class="comment">// TODO: Supersection bit</span>
<a name="l00548"></a>00548                 <span class="comment">// TODO: Fault bit</span>
<a name="l00549"></a>00549                 );
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 
<a name="l00552"></a>00552 }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 <span class="keywordtype">void</span>
<a name="l00555"></a><a class="code" href="classArmISA_1_1TableWalker.html#a6a5556160487c183ab7c8e3c0fea95e4">00555</a> <a class="code" href="classArmISA_1_1TableWalker.html#a6a5556160487c183ab7c8e3c0fea95e4">TableWalker::doL1Descriptor</a>()
<a name="l00556"></a>00556 {
<a name="l00557"></a>00557     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;L1 descriptor for %#x is %#x\n&quot;</span>,
<a name="l00558"></a>00558             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a661e5c13d149a47c6b1be74125f5cc7a" title="The raw bits of the entry.">data</a>);
<a name="l00559"></a>00559     <a class="code" href="structArmISA_1_1TlbEntry.html">TlbEntry</a> <a class="code" href="namespaceArmISA.html#ae42407f27ca903cf975736dddc9114fc">te</a>;
<a name="l00560"></a>00560 
<a name="l00561"></a>00561     <span class="keywordflow">switch</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a1ab80242a53e2a74a5498286281231e0">type</a>()) {
<a name="l00562"></a>00562       <span class="keywordflow">case</span> <a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#aa1ccbe8595c96910c2ef8ceb4dfedd9da2361752d3a5cb3330723ff87a2da7d22">L1Descriptor::Ignore</a>:
<a name="l00563"></a>00563       <span class="keywordflow">case</span> <a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#aa1ccbe8595c96910c2ef8ceb4dfedd9da5d9ed00ef5378c6f4920f78d1907ad51">L1Descriptor::Reserved</a>:
<a name="l00564"></a>00564         <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a8b74d27c4b9da72279366a59fe439ab9" title="If the mode is timing or atomic.">timing</a>) {
<a name="l00565"></a>00565             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a> = NULL;
<a name="l00566"></a>00566             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a985777e9e2e19ee755bf90ba7ee80feb" title="Request that is currently being serviced.">req</a> = NULL;
<a name="l00567"></a>00567         }
<a name="l00568"></a>00568         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;L1 Descriptor Reserved/Ignore, causing fault\n&quot;</span>);
<a name="l00569"></a>00569         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a71d58b6d1688fddc963563c06bcc696d" title="If the access is a fetch (for execution, and no-exec) must be checked?">isFetch</a>)
<a name="l00570"></a>00570             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9a3285b98abb97905cab17e5813b9bb4" title="The fault that we are going to return.">fault</a> =
<a name="l00571"></a>00571                 <span class="keyword">new</span> <a class="code" href="classArmISA_1_1PrefetchAbort.html">PrefetchAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>, <a class="code" href="classArmISA_1_1ArmFault.html#a39ec8a1ce23b2d1abc02ef524ef2df06a5d03f2c022a26d19baa116a401bc4bdb">ArmFault::Translation0</a>);
<a name="l00572"></a>00572         <span class="keywordflow">else</span>
<a name="l00573"></a>00573             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9a3285b98abb97905cab17e5813b9bb4" title="The fault that we are going to return.">fault</a> =
<a name="l00574"></a>00574                 <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>, 0, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#abd258da981e96d128733bbd4d792d748" title="If the access is a write.">isWrite</a>,
<a name="l00575"></a>00575                                   <a class="code" href="classArmISA_1_1ArmFault.html#a39ec8a1ce23b2d1abc02ef524ef2df06a5d03f2c022a26d19baa116a401bc4bdb">ArmFault::Translation0</a>);
<a name="l00576"></a>00576         <span class="keywordflow">return</span>;
<a name="l00577"></a>00577       <span class="keywordflow">case</span> <a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#aa1ccbe8595c96910c2ef8ceb4dfedd9da41c1e8c99aee4afa79a00e1fa173fcbf">L1Descriptor::Section</a>:
<a name="l00578"></a>00578         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a74ffff2c23d9f21c4558d13d64c7521a" title="Cached copy of the sctlr as it existed when translation began.">sctlr</a>.afe &amp;&amp; <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive) from &amp;#39;val&amp;#39; a...">bits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a4d15806a46141d33f58d7685e1cc07d8" title="Three bit access protection flags.">ap</a>(), 0) == 0) {
<a name="l00584"></a>00584             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9a3285b98abb97905cab17e5813b9bb4" title="The fault that we are going to return.">fault</a> = <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>,
<a name="l00585"></a>00585                                     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a3308c75dc514d755443bda443d769b59" title="Domain Client/Manager: ARM DDI 0406B: B3-31.">domain</a>(), <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#abd258da981e96d128733bbd4d792d748" title="If the access is a write.">isWrite</a>,
<a name="l00586"></a>00586                                     ArmFault::AccessFlag0);
<a name="l00587"></a>00587         }
<a name="l00588"></a>00588         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a2b1e30d9ad8f8606bbd251525faec4fc" title="Is the page a Supersection (16MB)?">supersection</a>()) {
<a name="l00589"></a>00589             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Haven&#39;t implemented supersections\n&quot;</span>);
<a name="l00590"></a>00590         }
<a name="l00591"></a>00591         te.<a class="code" href="structArmISA_1_1TlbEntry.html#afb996c55e70b44cd2d69669a4281037c">N</a> = 20;
<a name="l00592"></a>00592         te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4afe677a2787de7618c9ae0c7ac52d55">pfn</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a3d2b53f9ceed396c47bbe126ab9e05e0" title="Return the physical frame, bits shifted right.">pfn</a>();
<a name="l00593"></a>00593         te.<a class="code" href="structArmISA_1_1TlbEntry.html#a868dd527cef0bd3922b729e8662dbef5">size</a> = (1&lt;&lt;te.<a class="code" href="structArmISA_1_1TlbEntry.html#afb996c55e70b44cd2d69669a4281037c">N</a>) - 1;
<a name="l00594"></a>00594         te.<a class="code" href="structArmISA_1_1TlbEntry.html#a1025b4849b1a01fa997a2e90c9a51ac8">global</a> = !<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a984810155e1e7acfe26d6c86eb0998c6" title="Is the translation global (no asid used)?">global</a>();
<a name="l00595"></a>00595         te.<a class="code" href="structArmISA_1_1TlbEntry.html#aff27599d4e6fb38eedadb1180d78dd09">valid</a> = <span class="keyword">true</span>;
<a name="l00596"></a>00596         te.<a class="code" href="structArmISA_1_1TlbEntry.html#a975082bed51810d0cb2953d4e4361ccb">vpn</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a> &gt;&gt; te.<a class="code" href="structArmISA_1_1TlbEntry.html#afb996c55e70b44cd2d69669a4281037c">N</a>;
<a name="l00597"></a>00597         te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa3305a476552d55280c8d3294b74f8cd">sNp</a> = <span class="keyword">true</span>;
<a name="l00598"></a>00598         te.<a class="code" href="structArmISA_1_1TlbEntry.html#a63c7605dfb1cbdc03f2d2ba6d39c6488">xn</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#add055bc83f53fa5f56158e7a5091a092" title="Is the translation not allow execution?">xn</a>();
<a name="l00599"></a>00599         te.<a class="code" href="structArmISA_1_1TlbEntry.html#a7e7354fa4ecc350cd54e8f61d6dd2395">ap</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a4d15806a46141d33f58d7685e1cc07d8" title="Three bit access protection flags.">ap</a>();
<a name="l00600"></a>00600         te.<a class="code" href="structArmISA_1_1TlbEntry.html#a7ea0c3e4a3f52b274effda03c418d98c">domain</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a3308c75dc514d755443bda443d769b59" title="Domain Client/Manager: ARM DDI 0406B: B3-31.">domain</a>();
<a name="l00601"></a>00601         te.<a class="code" href="structArmISA_1_1TlbEntry.html#af9b7ed936e0f3c935eb9c19f169b218c">asid</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aa436516fc4868c89a0b37e57b3dc6280" title="Context ID that we&amp;#39;re servicing the request under.">contextId</a>;
<a name="l00602"></a>00602         <a class="code" href="classArmISA_1_1TableWalker.html#afa86a1bbbfaf8b59231b9df1d1089539">memAttrs</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>, te, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a74ffff2c23d9f21c4558d13d64c7521a" title="Cached copy of the sctlr as it existed when translation began.">sctlr</a>,
<a name="l00603"></a>00603                 <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a4f58e516d0116f7752f857374bcda341" title="Memory region attributes: ARM DDI 0406B: B3-32.">texcb</a>(), <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#aad0dd84dd95db0bffa6cd5fb911b26f1" title="If the section is shareable.">shareable</a>());
<a name="l00604"></a>00604 
<a name="l00605"></a>00605         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;Inserting Section Descriptor into TLB\n&quot;</span>);
<a name="l00606"></a>00606         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - N:%d pfn:%#x size: %#x global:%d valid: %d\n&quot;</span>,
<a name="l00607"></a>00607                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#afb996c55e70b44cd2d69669a4281037c">N</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4afe677a2787de7618c9ae0c7ac52d55">pfn</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#a868dd527cef0bd3922b729e8662dbef5">size</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#a1025b4849b1a01fa997a2e90c9a51ac8">global</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#aff27599d4e6fb38eedadb1180d78dd09">valid</a>);
<a name="l00608"></a>00608         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - vpn:%#x sNp: %d xn:%d ap:%d domain: %d asid:%d nc:%d\n&quot;</span>,
<a name="l00609"></a>00609                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a975082bed51810d0cb2953d4e4361ccb">vpn</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa3305a476552d55280c8d3294b74f8cd">sNp</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#a63c7605dfb1cbdc03f2d2ba6d39c6488">xn</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#a7e7354fa4ecc350cd54e8f61d6dd2395">ap</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#a7ea0c3e4a3f52b274effda03c418d98c">domain</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#af9b7ed936e0f3c935eb9c19f169b218c">asid</a>,
<a name="l00610"></a>00610                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa48086307b7c0138fd5523586b237ce1">nonCacheable</a>);
<a name="l00611"></a>00611         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - domain from l1 desc: %d data: %#x bits:%d\n&quot;</span>,
<a name="l00612"></a>00612                 <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a3308c75dc514d755443bda443d769b59" title="Domain Client/Manager: ARM DDI 0406B: B3-31.">domain</a>(), <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a661e5c13d149a47c6b1be74125f5cc7a" title="The raw bits of the entry.">data</a>,
<a name="l00613"></a>00613                 (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a661e5c13d149a47c6b1be74125f5cc7a" title="The raw bits of the entry.">data</a> &gt;&gt; 5) &amp; 0xF );
<a name="l00614"></a>00614 
<a name="l00615"></a>00615         <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a8b74d27c4b9da72279366a59fe439ab9" title="If the mode is timing or atomic.">timing</a>) {
<a name="l00616"></a>00616             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a> = NULL;
<a name="l00617"></a>00617             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a985777e9e2e19ee755bf90ba7ee80feb" title="Request that is currently being serviced.">req</a> = NULL;
<a name="l00618"></a>00618         }
<a name="l00619"></a>00619         <a class="code" href="classArmISA_1_1TableWalker.html#ab5e40ae9d1aa2bfb44a0984627bd9c83" title="TLB that is initiating these table walks.">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#a32a7397627c69aa473125fb40ea7beac">insert</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>, te);
<a name="l00620"></a>00620 
<a name="l00621"></a>00621         <span class="keywordflow">return</span>;
<a name="l00622"></a>00622       <span class="keywordflow">case</span> <a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#aa1ccbe8595c96910c2ef8ceb4dfedd9dabb225f992fcde43fb153724faed9893f">L1Descriptor::PageTable</a>:
<a name="l00623"></a>00623         <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> l2desc_addr;
<a name="l00624"></a>00624         l2desc_addr = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#afab0c95cead09c7691a42b773b282445" title="Address of L2 descriptor if it exists.">l2Addr</a>() |
<a name="l00625"></a>00625                       (<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive) from &amp;#39;val&amp;#39; a...">bits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>, 19,12) &lt;&lt; 2);
<a name="l00626"></a>00626         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;L1 descriptor points to page table at: %#x\n&quot;</span>,
<a name="l00627"></a>00627                 l2desc_addr);
<a name="l00628"></a>00628 
<a name="l00629"></a>00629         <span class="comment">// Trickbox address check</span>
<a name="l00630"></a>00630         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9a3285b98abb97905cab17e5813b9bb4" title="The fault that we are going to return.">fault</a> = <a class="code" href="classArmISA_1_1TableWalker.html#ab5e40ae9d1aa2bfb44a0984627bd9c83" title="TLB that is initiating these table walks.">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#aced0d81da4830b2ccb2360c4f2d2710a">walkTrickBoxCheck</a>(l2desc_addr, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>,
<a name="l00631"></a>00631                 <span class="keyword">sizeof</span>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>), <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a71d58b6d1688fddc963563c06bcc696d" title="If the access is a fetch (for execution, and no-exec) must be checked?">isFetch</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#abd258da981e96d128733bbd4d792d748" title="If the access is a write.">isWrite</a>,
<a name="l00632"></a>00632                 <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a3308c75dc514d755443bda443d769b59" title="Domain Client/Manager: ARM DDI 0406B: B3-31.">domain</a>(), <span class="keyword">false</span>);
<a name="l00633"></a>00633 
<a name="l00634"></a>00634         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9a3285b98abb97905cab17e5813b9bb4" title="The fault that we are going to return.">fault</a>) {
<a name="l00635"></a>00635             <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a8b74d27c4b9da72279366a59fe439ab9" title="If the mode is timing or atomic.">timing</a>) {
<a name="l00636"></a>00636                 <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a> = NULL;
<a name="l00637"></a>00637                 <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a985777e9e2e19ee755bf90ba7ee80feb" title="Request that is currently being serviced.">req</a> = NULL;
<a name="l00638"></a>00638             }
<a name="l00639"></a>00639             <span class="keywordflow">return</span>;
<a name="l00640"></a>00640         }
<a name="l00641"></a>00641 
<a name="l00642"></a>00642 
<a name="l00643"></a>00643         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a8b74d27c4b9da72279366a59fe439ab9" title="If the mode is timing or atomic.">timing</a>) {
<a name="l00644"></a>00644             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a000f388410d4df78117dfc7b117e8e5f" title="Whether L1/L2 descriptor response is delayed in timing mode.">delayed</a> = <span class="keyword">true</span>;
<a name="l00645"></a>00645             <a class="code" href="classArmISA_1_1TableWalker.html#a4fed328b3a8f0218a10135c43c305923" title="Port to issue translation requests from.">port</a>.<a class="code" href="classDmaPort.html#a3201ee5c8e9eb266ed4945cfe859c998">dmaAction</a>(<a class="code" href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102aa21449f51bc9023b2dc730a7cd2cbf16">MemCmd::ReadReq</a>, l2desc_addr, <span class="keyword">sizeof</span>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>),
<a name="l00646"></a>00646                            &amp;<a class="code" href="classArmISA_1_1TableWalker.html#a6743b05a4ac6529960de540f7ccc7e40">doL2DescEvent</a>, (uint8_t*)&amp;<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a35e500a72f5142773e4052a0d40ecace">l2Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L2Descriptor.html#afc9b62c28357155561b58f5705492d38" title="The raw bits of the entry.">data</a>,
<a name="l00647"></a>00647                            <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>-&gt;<a class="code" href="classThreadContext.html#add24ea69a3c1a7862d25bec95f9bdc95">getCpuPtr</a>()-&gt;<a class="code" href="classClockedObject.html#a3f0850d695e3722cdd7d33bbaf3e5f43">clockPeriod</a>());
<a name="l00648"></a>00648         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9b99c1a76d5c94dbf86ed86d8d9ef199" title="If the atomic mode should be functional.">functional</a>) {
<a name="l00649"></a>00649             <a class="code" href="classArmISA_1_1TableWalker.html#a4fed328b3a8f0218a10135c43c305923" title="Port to issue translation requests from.">port</a>.<a class="code" href="classDmaPort.html#a3201ee5c8e9eb266ed4945cfe859c998">dmaAction</a>(<a class="code" href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102aa21449f51bc9023b2dc730a7cd2cbf16">MemCmd::ReadReq</a>, l2desc_addr, <span class="keyword">sizeof</span>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>),
<a name="l00650"></a>00650                            NULL, (uint8_t*)&amp;<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a35e500a72f5142773e4052a0d40ecace">l2Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L2Descriptor.html#afc9b62c28357155561b58f5705492d38" title="The raw bits of the entry.">data</a>,
<a name="l00651"></a>00651                            <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>-&gt;<a class="code" href="classThreadContext.html#add24ea69a3c1a7862d25bec95f9bdc95">getCpuPtr</a>()-&gt;<a class="code" href="classClockedObject.html#a3f0850d695e3722cdd7d33bbaf3e5f43">clockPeriod</a>());
<a name="l00652"></a>00652             <a class="code" href="classArmISA_1_1TableWalker.html#aa10ffa418815a92e2a26e9a8bfea2251">doL2Descriptor</a>();
<a name="l00653"></a>00653         } <span class="keywordflow">else</span> {
<a name="l00654"></a>00654             <a class="code" href="classRequest.html">RequestPtr</a> req = <span class="keyword">new</span> <a class="code" href="classRequest.html">Request</a>(l2desc_addr, <span class="keyword">sizeof</span>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>), 0,
<a name="l00655"></a>00655                                          <a class="code" href="classArmISA_1_1TableWalker.html#af713acb7dd4a6f042aa0c04fc880f7e1" title="Request id for requests generated by this walker.">masterId</a>);
<a name="l00656"></a>00656             <a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">PacketPtr</a> pkt = <span class="keyword">new</span> <a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system (e...">Packet</a>(req, <a class="code" href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102aa21449f51bc9023b2dc730a7cd2cbf16">MemCmd::ReadReq</a>);
<a name="l00657"></a>00657             pkt-&gt;<a class="code" href="classPacket.html#aa81ea5325a7aa403fa94f2d84f6f4236" title="Set the data pointer to the following value that should not be freed.">dataStatic</a>((uint8_t*)&amp;<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a35e500a72f5142773e4052a0d40ecace">l2Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L2Descriptor.html#afc9b62c28357155561b58f5705492d38" title="The raw bits of the entry.">data</a>);
<a name="l00658"></a>00658             <a class="code" href="classArmISA_1_1TableWalker.html#a4fed328b3a8f0218a10135c43c305923" title="Port to issue translation requests from.">port</a>.<a class="code" href="classMasterPort.html#a02b195a074185280154268143963df99" title="Send a functional request packet, where the data is instantly updated everywhere in the memory system...">sendFunctional</a>(pkt);
<a name="l00659"></a>00659             <a class="code" href="classArmISA_1_1TableWalker.html#aa10ffa418815a92e2a26e9a8bfea2251">doL2Descriptor</a>();
<a name="l00660"></a>00660             <span class="keyword">delete</span> req;
<a name="l00661"></a>00661             <span class="keyword">delete</span> pkt;
<a name="l00662"></a>00662         }
<a name="l00663"></a>00663         <span class="keywordflow">return</span>;
<a name="l00664"></a>00664       <span class="keywordflow">default</span>:
<a name="l00665"></a>00665         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;A new type in a 2 bit field?\n&quot;</span>);
<a name="l00666"></a>00666     }
<a name="l00667"></a>00667 }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669 <span class="keywordtype">void</span>
<a name="l00670"></a><a class="code" href="classArmISA_1_1TableWalker.html#aa10ffa418815a92e2a26e9a8bfea2251">00670</a> <a class="code" href="classArmISA_1_1TableWalker.html#aa10ffa418815a92e2a26e9a8bfea2251">TableWalker::doL2Descriptor</a>()
<a name="l00671"></a>00671 {
<a name="l00672"></a>00672     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;L2 descriptor for %#x is %#x\n&quot;</span>,
<a name="l00673"></a>00673             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a35e500a72f5142773e4052a0d40ecace">l2Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L2Descriptor.html#afc9b62c28357155561b58f5705492d38" title="The raw bits of the entry.">data</a>);
<a name="l00674"></a>00674     <a class="code" href="structArmISA_1_1TlbEntry.html">TlbEntry</a> <a class="code" href="namespaceArmISA.html#ae42407f27ca903cf975736dddc9114fc">te</a>;
<a name="l00675"></a>00675 
<a name="l00676"></a>00676     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a35e500a72f5142773e4052a0d40ecace">l2Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L2Descriptor.html#a23e4f0083057aa273bc59627542f3adc" title="Is the entry invalid.">invalid</a>()) {
<a name="l00677"></a>00677         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;L2 descriptor invalid, causing fault\n&quot;</span>);
<a name="l00678"></a>00678         <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a8b74d27c4b9da72279366a59fe439ab9" title="If the mode is timing or atomic.">timing</a>) {
<a name="l00679"></a>00679             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a> = NULL;
<a name="l00680"></a>00680             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a985777e9e2e19ee755bf90ba7ee80feb" title="Request that is currently being serviced.">req</a> = NULL;
<a name="l00681"></a>00681         }
<a name="l00682"></a>00682         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a71d58b6d1688fddc963563c06bcc696d" title="If the access is a fetch (for execution, and no-exec) must be checked?">isFetch</a>)
<a name="l00683"></a>00683             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9a3285b98abb97905cab17e5813b9bb4" title="The fault that we are going to return.">fault</a> =
<a name="l00684"></a>00684                 <span class="keyword">new</span> <a class="code" href="classArmISA_1_1PrefetchAbort.html">PrefetchAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>, <a class="code" href="classArmISA_1_1ArmFault.html#a39ec8a1ce23b2d1abc02ef524ef2df06ac373b5b81142e47e8e5cbca24b9566ba">ArmFault::Translation1</a>);
<a name="l00685"></a>00685         <span class="keywordflow">else</span>
<a name="l00686"></a>00686             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9a3285b98abb97905cab17e5813b9bb4" title="The fault that we are going to return.">fault</a> =
<a name="l00687"></a>00687                 <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a3308c75dc514d755443bda443d769b59" title="Domain Client/Manager: ARM DDI 0406B: B3-31.">domain</a>(),
<a name="l00688"></a>00688                               <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#abd258da981e96d128733bbd4d792d748" title="If the access is a write.">isWrite</a>, ArmFault::Translation1);
<a name="l00689"></a>00689         <span class="keywordflow">return</span>;
<a name="l00690"></a>00690     }
<a name="l00691"></a>00691 
<a name="l00692"></a>00692     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a74ffff2c23d9f21c4558d13d64c7521a" title="Cached copy of the sctlr as it existed when translation began.">sctlr</a>.afe &amp;&amp; <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive) from &amp;#39;val&amp;#39; a...">bits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a35e500a72f5142773e4052a0d40ecace">l2Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L2Descriptor.html#a652d4532f158f981b5441a90aab3763f" title="Three bit access protection flags.">ap</a>(), 0) == 0) {
<a name="l00697"></a>00697         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9a3285b98abb97905cab17e5813b9bb4" title="The fault that we are going to return.">fault</a> =
<a name="l00698"></a>00698             <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>, 0, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#abd258da981e96d128733bbd4d792d748" title="If the access is a write.">isWrite</a>,
<a name="l00699"></a>00699                           <a class="code" href="classArmISA_1_1ArmFault.html#a39ec8a1ce23b2d1abc02ef524ef2df06ab9efd41630a072894804f93c93bf0ece">ArmFault::AccessFlag1</a>);
<a name="l00700"></a>00700 
<a name="l00701"></a>00701     }
<a name="l00702"></a>00702 
<a name="l00703"></a>00703     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a35e500a72f5142773e4052a0d40ecace">l2Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L2Descriptor.html#add7782fa2297ff0bbe23df12e4c018a0" title="What is the size of the mapping?">large</a>()) {
<a name="l00704"></a>00704       te.<a class="code" href="structArmISA_1_1TlbEntry.html#afb996c55e70b44cd2d69669a4281037c">N</a> = 16;
<a name="l00705"></a>00705       te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4afe677a2787de7618c9ae0c7ac52d55">pfn</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a35e500a72f5142773e4052a0d40ecace">l2Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L2Descriptor.html#a1343bbf28943cef9f5941666753c31a2" title="Return the physical frame, bits shifted right.">pfn</a>();
<a name="l00706"></a>00706     } <span class="keywordflow">else</span> {
<a name="l00707"></a>00707       te.<a class="code" href="structArmISA_1_1TlbEntry.html#afb996c55e70b44cd2d69669a4281037c">N</a> = 12;
<a name="l00708"></a>00708       te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4afe677a2787de7618c9ae0c7ac52d55">pfn</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a35e500a72f5142773e4052a0d40ecace">l2Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L2Descriptor.html#a1343bbf28943cef9f5941666753c31a2" title="Return the physical frame, bits shifted right.">pfn</a>();
<a name="l00709"></a>00709     }
<a name="l00710"></a>00710 
<a name="l00711"></a>00711     te.<a class="code" href="structArmISA_1_1TlbEntry.html#aff27599d4e6fb38eedadb1180d78dd09">valid</a> = <span class="keyword">true</span>;
<a name="l00712"></a>00712     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a868dd527cef0bd3922b729e8662dbef5">size</a> =  (1 &lt;&lt; te.<a class="code" href="structArmISA_1_1TlbEntry.html#afb996c55e70b44cd2d69669a4281037c">N</a>) - 1;
<a name="l00713"></a>00713     te.<a class="code" href="structArmISA_1_1TlbEntry.html#af9b7ed936e0f3c935eb9c19f169b218c">asid</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aa436516fc4868c89a0b37e57b3dc6280" title="Context ID that we&amp;#39;re servicing the request under.">contextId</a>;
<a name="l00714"></a>00714     te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa3305a476552d55280c8d3294b74f8cd">sNp</a> = <span class="keyword">false</span>;
<a name="l00715"></a>00715     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a975082bed51810d0cb2953d4e4361ccb">vpn</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a> &gt;&gt; te.<a class="code" href="structArmISA_1_1TlbEntry.html#afb996c55e70b44cd2d69669a4281037c">N</a>;
<a name="l00716"></a>00716     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a1025b4849b1a01fa997a2e90c9a51ac8">global</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a35e500a72f5142773e4052a0d40ecace">l2Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L2Descriptor.html#a928799e8ca4f8705dbc9597fbf7957c6" title="Is the translation global (no asid used)?">global</a>();
<a name="l00717"></a>00717     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a63c7605dfb1cbdc03f2d2ba6d39c6488">xn</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a35e500a72f5142773e4052a0d40ecace">l2Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L2Descriptor.html#a1c639c5b5892bad5e63059efa528869b" title="Is execution allowed on this mapping?">xn</a>();
<a name="l00718"></a>00718     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a7e7354fa4ecc350cd54e8f61d6dd2395">ap</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a35e500a72f5142773e4052a0d40ecace">l2Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L2Descriptor.html#a652d4532f158f981b5441a90aab3763f" title="Three bit access protection flags.">ap</a>();
<a name="l00719"></a>00719     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a7ea0c3e4a3f52b274effda03c418d98c">domain</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a3308c75dc514d755443bda443d769b59" title="Domain Client/Manager: ARM DDI 0406B: B3-31.">domain</a>();
<a name="l00720"></a>00720     <a class="code" href="classArmISA_1_1TableWalker.html#afa86a1bbbfaf8b59231b9df1d1089539">memAttrs</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>, te, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a74ffff2c23d9f21c4558d13d64c7521a" title="Cached copy of the sctlr as it existed when translation began.">sctlr</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a35e500a72f5142773e4052a0d40ecace">l2Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L2Descriptor.html#a8ed81b87941a792011d9f3f7100c26ab" title="Memory region attributes: ARM DDI 0406B: B3-32.">texcb</a>(),
<a name="l00721"></a>00721              <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a35e500a72f5142773e4052a0d40ecace">l2Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L2Descriptor.html#a64ed6284ef6b9b128b2ec1b3e58ea5c5" title="If the section is shareable.">shareable</a>());
<a name="l00722"></a>00722 
<a name="l00723"></a>00723     <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a8b74d27c4b9da72279366a59fe439ab9" title="If the mode is timing or atomic.">timing</a>) {
<a name="l00724"></a>00724         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a> = NULL;
<a name="l00725"></a>00725         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a985777e9e2e19ee755bf90ba7ee80feb" title="Request that is currently being serviced.">req</a> = NULL;
<a name="l00726"></a>00726     }
<a name="l00727"></a>00727     <a class="code" href="classArmISA_1_1TableWalker.html#ab5e40ae9d1aa2bfb44a0984627bd9c83" title="TLB that is initiating these table walks.">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#a32a7397627c69aa473125fb40ea7beac">insert</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>, te);
<a name="l00728"></a>00728 }
<a name="l00729"></a>00729 
<a name="l00730"></a>00730 <span class="keywordtype">void</span>
<a name="l00731"></a><a class="code" href="classArmISA_1_1TableWalker.html#aa55c57825ffe48761553b0ebbd4e20ab">00731</a> <a class="code" href="classArmISA_1_1TableWalker.html#aa55c57825ffe48761553b0ebbd4e20ab">TableWalker::doL1DescriptorWrapper</a>()
<a name="l00732"></a>00732 {
<a name="l00733"></a>00733     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a0e4b6ea16cbb0abdc3e0aa26f9abd196" title="Queue of requests that need processing first level translation.">stateQueueL1</a>.front();
<a name="l00734"></a>00734     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a000f388410d4df78117dfc7b117e8e5f" title="Whether L1/L2 descriptor response is delayed in timing mode.">delayed</a> = <span class="keyword">false</span>;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;L1 Desc object host addr: %p\n&quot;</span>,&amp;<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a661e5c13d149a47c6b1be74125f5cc7a" title="The raw bits of the entry.">data</a>);
<a name="l00737"></a>00737     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;L1 Desc object      data: %08x\n&quot;</span>,<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a286f7e72ae017340ab286fd14090d173">l1Desc</a>.<a class="code" href="structArmISA_1_1TableWalker_1_1L1Descriptor.html#a661e5c13d149a47c6b1be74125f5cc7a" title="The raw bits of the entry.">data</a>);
<a name="l00738"></a>00738 
<a name="l00739"></a>00739     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;calling doL1Descriptor for vaddr:%#x\n&quot;</span>, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>);
<a name="l00740"></a>00740     <a class="code" href="classArmISA_1_1TableWalker.html#a6a5556160487c183ab7c8e3c0fea95e4">doL1Descriptor</a>();
<a name="l00741"></a>00741 
<a name="l00742"></a>00742     <a class="code" href="classArmISA_1_1TableWalker.html#a0e4b6ea16cbb0abdc3e0aa26f9abd196" title="Queue of requests that need processing first level translation.">stateQueueL1</a>.pop_front();
<a name="l00743"></a>00743     <a class="code" href="classArmISA_1_1TableWalker.html#acdaa6d4fc9977fca69259dae4c2bc231" title="Checks if all state is cleared and if so, completes drain.">completeDrain</a>();
<a name="l00744"></a>00744     <span class="comment">// Check if fault was generated</span>
<a name="l00745"></a>00745     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9a3285b98abb97905cab17e5813b9bb4" title="The fault that we are going to return.">fault</a> != <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>) {
<a name="l00746"></a>00746         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aa455c2fc892a518452cdcf36392b0c10" title="Translation state for delayed requests.">transState</a>-&gt;<a class="code" href="classBaseTLB_1_1Translation.html#aaa1cd6c2f5ae7d58b0d5d4948cae0ce3">finish</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9a3285b98abb97905cab17e5813b9bb4" title="The fault that we are going to return.">fault</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a985777e9e2e19ee755bf90ba7ee80feb" title="Request that is currently being serviced.">req</a>,
<a name="l00747"></a>00747                                       <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#acd10de558e04ae7b38d0f62ae03207d0" title="Save mode for use in delayed response.">mode</a>);
<a name="l00748"></a>00748 
<a name="l00749"></a>00749         <a class="code" href="classArmISA_1_1TableWalker.html#a92a90a1491b52b1ee28754a4643b4b61" title="If a timing translation is currently in progress.">pending</a> = <span class="keyword">false</span>;
<a name="l00750"></a>00750         <a class="code" href="classArmISA_1_1TableWalker.html#af6aa809f66824c5afb7175630c630428">nextWalk</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>);
<a name="l00751"></a>00751 
<a name="l00752"></a>00752         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a985777e9e2e19ee755bf90ba7ee80feb" title="Request that is currently being serviced.">req</a> = NULL;
<a name="l00753"></a>00753         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a> = NULL;
<a name="l00754"></a>00754         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a000f388410d4df78117dfc7b117e8e5f" title="Whether L1/L2 descriptor response is delayed in timing mode.">delayed</a> = <span class="keyword">false</span>;
<a name="l00755"></a>00755         <span class="keyword">delete</span> <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>;
<a name="l00756"></a>00756     }
<a name="l00757"></a>00757     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a000f388410d4df78117dfc7b117e8e5f" title="Whether L1/L2 descriptor response is delayed in timing mode.">delayed</a>) {
<a name="l00758"></a>00758         <span class="comment">// delay is not set so there is no L2 to do</span>
<a name="l00759"></a>00759         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;calling translateTiming again\n&quot;</span>);
<a name="l00760"></a>00760         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9a3285b98abb97905cab17e5813b9bb4" title="The fault that we are going to return.">fault</a> = <a class="code" href="classArmISA_1_1TableWalker.html#ab5e40ae9d1aa2bfb44a0984627bd9c83" title="TLB that is initiating these table walks.">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#a6ef405dcaea3256b22a205e943f0e1fb">translateTiming</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a985777e9e2e19ee755bf90ba7ee80feb" title="Request that is currently being serviced.">req</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>,
<a name="l00761"></a>00761                                        <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aa455c2fc892a518452cdcf36392b0c10" title="Translation state for delayed requests.">transState</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#acd10de558e04ae7b38d0f62ae03207d0" title="Save mode for use in delayed response.">mode</a>);
<a name="l00762"></a>00762 
<a name="l00763"></a>00763         <a class="code" href="classArmISA_1_1TableWalker.html#a92a90a1491b52b1ee28754a4643b4b61" title="If a timing translation is currently in progress.">pending</a> = <span class="keyword">false</span>;
<a name="l00764"></a>00764         <a class="code" href="classArmISA_1_1TableWalker.html#af6aa809f66824c5afb7175630c630428">nextWalk</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>);
<a name="l00765"></a>00765 
<a name="l00766"></a>00766         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a985777e9e2e19ee755bf90ba7ee80feb" title="Request that is currently being serviced.">req</a> = NULL;
<a name="l00767"></a>00767         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a> = NULL;
<a name="l00768"></a>00768         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a000f388410d4df78117dfc7b117e8e5f" title="Whether L1/L2 descriptor response is delayed in timing mode.">delayed</a> = <span class="keyword">false</span>;
<a name="l00769"></a>00769         <span class="keyword">delete</span> <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>;
<a name="l00770"></a>00770     } <span class="keywordflow">else</span> {
<a name="l00771"></a>00771         <span class="comment">// need to do L2 descriptor</span>
<a name="l00772"></a>00772         <a class="code" href="classArmISA_1_1TableWalker.html#a0872d112c40a4f8c916d1347610d9b7e" title="Queue of requests that have passed first level translation and require an additional level...">stateQueueL2</a>.push_back(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>);
<a name="l00773"></a>00773     }
<a name="l00774"></a>00774     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a> = NULL;
<a name="l00775"></a>00775 }
<a name="l00776"></a>00776 
<a name="l00777"></a>00777 <span class="keywordtype">void</span>
<a name="l00778"></a><a class="code" href="classArmISA_1_1TableWalker.html#a489ceec7e034b54e4973d1f82b164f22">00778</a> <a class="code" href="classArmISA_1_1TableWalker.html#a489ceec7e034b54e4973d1f82b164f22">TableWalker::doL2DescriptorWrapper</a>()
<a name="l00779"></a>00779 {
<a name="l00780"></a>00780     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a0872d112c40a4f8c916d1347610d9b7e" title="Queue of requests that have passed first level translation and require an additional level...">stateQueueL2</a>.front();
<a name="l00781"></a>00781     assert(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a000f388410d4df78117dfc7b117e8e5f" title="Whether L1/L2 descriptor response is delayed in timing mode.">delayed</a>);
<a name="l00782"></a>00782 
<a name="l00783"></a>00783     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;calling doL2Descriptor for vaddr:%#x\n&quot;</span>,
<a name="l00784"></a>00784             <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aefdf3d38cfae38ae193426aa2305a5ce" title="The virtual address that is being translated.">vaddr</a>);
<a name="l00785"></a>00785     <a class="code" href="classArmISA_1_1TableWalker.html#aa10ffa418815a92e2a26e9a8bfea2251">doL2Descriptor</a>();
<a name="l00786"></a>00786 
<a name="l00787"></a>00787     <span class="comment">// Check if fault was generated</span>
<a name="l00788"></a>00788     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9a3285b98abb97905cab17e5813b9bb4" title="The fault that we are going to return.">fault</a> != <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>) {
<a name="l00789"></a>00789         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aa455c2fc892a518452cdcf36392b0c10" title="Translation state for delayed requests.">transState</a>-&gt;<a class="code" href="classBaseTLB_1_1Translation.html#aaa1cd6c2f5ae7d58b0d5d4948cae0ce3">finish</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9a3285b98abb97905cab17e5813b9bb4" title="The fault that we are going to return.">fault</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a985777e9e2e19ee755bf90ba7ee80feb" title="Request that is currently being serviced.">req</a>,
<a name="l00790"></a>00790                                       <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#acd10de558e04ae7b38d0f62ae03207d0" title="Save mode for use in delayed response.">mode</a>);
<a name="l00791"></a>00791     }
<a name="l00792"></a>00792     <span class="keywordflow">else</span> {
<a name="l00793"></a>00793         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;calling translateTiming again\n&quot;</span>);
<a name="l00794"></a>00794         <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a9a3285b98abb97905cab17e5813b9bb4" title="The fault that we are going to return.">fault</a> = <a class="code" href="classArmISA_1_1TableWalker.html#ab5e40ae9d1aa2bfb44a0984627bd9c83" title="TLB that is initiating these table walks.">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#a6ef405dcaea3256b22a205e943f0e1fb">translateTiming</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a985777e9e2e19ee755bf90ba7ee80feb" title="Request that is currently being serviced.">req</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>,
<a name="l00795"></a>00795                                       <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aa455c2fc892a518452cdcf36392b0c10" title="Translation state for delayed requests.">transState</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#acd10de558e04ae7b38d0f62ae03207d0" title="Save mode for use in delayed response.">mode</a>);
<a name="l00796"></a>00796     }
<a name="l00797"></a>00797 
<a name="l00798"></a>00798 
<a name="l00799"></a>00799     <a class="code" href="classArmISA_1_1TableWalker.html#a0872d112c40a4f8c916d1347610d9b7e" title="Queue of requests that have passed first level translation and require an additional level...">stateQueueL2</a>.pop_front();
<a name="l00800"></a>00800     <a class="code" href="classArmISA_1_1TableWalker.html#acdaa6d4fc9977fca69259dae4c2bc231" title="Checks if all state is cleared and if so, completes drain.">completeDrain</a>();
<a name="l00801"></a>00801     <a class="code" href="classArmISA_1_1TableWalker.html#a92a90a1491b52b1ee28754a4643b4b61" title="If a timing translation is currently in progress.">pending</a> = <span class="keyword">false</span>;
<a name="l00802"></a>00802     <a class="code" href="classArmISA_1_1TableWalker.html#af6aa809f66824c5afb7175630c630428">nextWalk</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a>);
<a name="l00803"></a>00803 
<a name="l00804"></a>00804     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a985777e9e2e19ee755bf90ba7ee80feb" title="Request that is currently being serviced.">req</a> = NULL;
<a name="l00805"></a>00805     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#aff2bf7b1c3fb5335b8c14991a34fdf8d" title="Thread context that we&amp;#39;re doing the walk for.">tc</a> = NULL;
<a name="l00806"></a>00806     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>-&gt;<a class="code" href="structArmISA_1_1TableWalker_1_1WalkerState.html#a000f388410d4df78117dfc7b117e8e5f" title="Whether L1/L2 descriptor response is delayed in timing mode.">delayed</a> = <span class="keyword">false</span>;
<a name="l00807"></a>00807 
<a name="l00808"></a>00808     <span class="keyword">delete</span> <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a>;
<a name="l00809"></a>00809     <a class="code" href="classArmISA_1_1TableWalker.html#a742c8bd32f7a96ad82362a3b0f54c1d6">currState</a> = NULL;
<a name="l00810"></a>00810 }
<a name="l00811"></a>00811 
<a name="l00812"></a>00812 <span class="keywordtype">void</span>
<a name="l00813"></a><a class="code" href="classArmISA_1_1TableWalker.html#af6aa809f66824c5afb7175630c630428">00813</a> <a class="code" href="classArmISA_1_1TableWalker.html#af6aa809f66824c5afb7175630c630428">TableWalker::nextWalk</a>(<a class="code" href="classThreadContext.html" title="ThreadContext is the external interface to all thread state for anything outside of the CPU...">ThreadContext</a> *tc)
<a name="l00814"></a>00814 {
<a name="l00815"></a>00815     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a1d69cdeafea580d10df3404277dadb34" title="Queue of requests that have passed are waiting because the walker is currently busy.">pendingQueue</a>.size())
<a name="l00816"></a>00816         <a class="code" href="classEventManager.html#a749a10828b2dd5017a2582960d04e400">schedule</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a0c2b95862da5bf7b3799d121940c2843">doProcessEvent</a>, <a class="code" href="classClockedObject.html#a7c1f64c925f158530be84323a503dbb7" title="Determine the tick when a cycle begins, by default the current one, but the argument also enables the...">clockEdge</a>(<a class="code" href="classCycles.html" title="Cycles is a wrapper class for representing cycle counts, i.e.">Cycles</a>(1)));
<a name="l00817"></a>00817 }
<a name="l00818"></a>00818 
<a name="l00819"></a>00819 
<a name="l00820"></a>00820 
<a name="l00821"></a>00821 <a class="code" href="classArmISA_1_1TableWalker.html">ArmISA::TableWalker</a> *
<a name="l00822"></a>00822 ArmTableWalkerParams::create()
<a name="l00823"></a>00823 {
<a name="l00824"></a>00824     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classArmISA_1_1TableWalker.html#a02cd4b4e18665ec3040b85b14909f188">ArmISA::TableWalker</a>(<span class="keyword">this</span>);
<a name="l00825"></a>00825 }
<a name="l00826"></a>00826 
</pre></div></div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"><address style="align: right;"><small>
Generated on Sun Apr 7 2013 18:16:01 for gem5 by <a href="http://www.doxygen.org/index.html"> doxygen</a> 1.7.1</small></address>

</body>
</html>
